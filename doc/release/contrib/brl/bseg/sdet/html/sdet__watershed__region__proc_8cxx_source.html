<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>contrib/brl/bseg/sdet/sdet_watershed_region_proc.cxx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">contrib/brl/bseg/sdet/sdet_watershed_region_proc.cxx</div>  </div>
</div>
<div class="contents">
<a href="sdet__watershed__region__proc_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// This is brl/bseg/sdet/sdet_watershed_region_proc.cxx</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;<a class="code" href="sdet__watershed__region__proc_8h.html" title="a processor for extracting watershed regions">sdet_watershed_region_proc.h</a>&quot;</span>
<a name="l00003"></a>00003 <span class="comment">//:</span>
<a name="l00004"></a>00004 <span class="comment">// \file</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;vcl_algorithm.h&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/vnl__numeric__traits_8h.html">vnl/vnl_numeric_traits.h</a>&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;vil1/vil1_memory_image_of.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_gel_vsol.tag:../../../../../contrib/gel/vsol/html" href="../../../../../contrib/gel/vsol/html/vsol__box__2d_8h.html">vsol/vsol_box_2d.h</a>&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/brip__vil1__float__ops_8h.html">brip/brip_vil1_float_ops.h</a>&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/brip__roi_8h.html">brip/brip_roi.h</a>&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/brip__watershed_8h.html">brip/brip_watershed.h</a>&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;bdgl/bdgl_region_algs.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;<a class="code" href="sdet__region_8h.html" title="A region class for the watershed algorithm.">sdet/sdet_region.h</a>&gt;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">//Gives a sort on region intensity in increasing order</span>
<a name="l00016"></a>00016 <span class="keyword">static</span> <span class="keywordtype">bool</span> region_intensity_compare_increasing(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span> r1,
<a name="l00017"></a>00017                                                 <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span> r2)
<a name="l00018"></a>00018 {
<a name="l00019"></a>00019   <span class="keywordflow">return</span> r2-&gt;Io() &gt; r1-&gt;Io();
<a name="l00020"></a>00020 }
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment">//Gives a sort on region intensity in decreasing order</span>
<a name="l00023"></a>00023 <span class="keyword">static</span> <span class="keywordtype">bool</span> region_intensity_compare_decreasing(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span> r1,
<a name="l00024"></a>00024                                                 <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span> r2)
<a name="l00025"></a>00025 {
<a name="l00026"></a>00026   <span class="keywordflow">return</span> r1-&gt;Io() &gt; r2-&gt;Io();
<a name="l00027"></a>00027 }
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="comment">//Gives a sort on region area in increasing order</span>
<a name="l00030"></a>00030 <span class="keyword">static</span> <span class="keywordtype">bool</span> region_area_compare_increasing(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span> r1,
<a name="l00031"></a>00031                                            <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span> r2)
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033   <span class="keywordflow">return</span> r2-&gt;Npix() &gt; r1-&gt;Npix();
<a name="l00034"></a>00034 }
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">//Gives a sort on region area in decreasing order</span>
<a name="l00037"></a>00037 <span class="keyword">static</span> <span class="keywordtype">bool</span> region_area_compare_decreasing(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span> r1,
<a name="l00038"></a>00038                                            <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span> r2)
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040   <span class="keywordflow">return</span> r1-&gt;Npix() &gt; r2-&gt;Npix();
<a name="l00041"></a>00041 }
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="comment">//---------------------------------------------------------------</span>
<a name="l00044"></a>00044 <span class="comment">// Constructors</span>
<a name="l00045"></a>00045 <span class="comment">//  regions_ = temp2;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">//----------------------------------------------------------------</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment">//: constructor from a parameter block (the only way)</span>
<a name="l00050"></a>00050 <span class="comment">//</span>
<a name="l00051"></a><a class="code" href="classsdet__watershed__region__proc.html#a2e9c5aa9ff1081acccbd1a910cc18701">00051</a> <a class="code" href="classsdet__watershed__region__proc.html#a2e9c5aa9ff1081acccbd1a910cc18701" title="constructor from a parameter block (the only way).">sdet_watershed_region_proc::sdet_watershed_region_proc</a>(<a class="code" href="classsdet__watershed__region__proc__params.html">sdet_watershed_region_proc_params</a>&amp; wrpp)
<a name="l00052"></a>00052   : <a class="code" href="classsdet__watershed__region__proc__params.html">sdet_watershed_region_proc_params</a>(wrpp)
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054   <a class="code" href="classsdet__watershed__region__proc.html#a20fa91b2948147e42595f0ec4ff8b6f9">regions_valid_</a> = <span class="keyword">false</span>;
<a name="l00055"></a>00055   <a class="code" href="classsdet__watershed__region__proc.html#a1f6ab391642d3b4acac46bff54635a69">region_image_valid_</a> =<span class="keyword">false</span>;
<a name="l00056"></a>00056   <a class="code" href="classsdet__watershed__region__proc.html#ad3d44c68c4be9cda670ebdad43223b4e">boundaries_valid_</a> = <span class="keyword">false</span>;
<a name="l00057"></a>00057   <a class="code" href="classsdet__watershed__region__proc.html#a2394b08c4ee7116ed25e321c0d7827aa">min_label_</a> = 0;
<a name="l00058"></a>00058   <a class="code" href="classsdet__watershed__region__proc.html#a010c16a3eebd34195b058b936d857d43">max_label_</a> = 0;
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">//:Default Destructor</span>
<a name="l00062"></a><a class="code" href="classsdet__watershed__region__proc.html#a7b3bbd8ec79df03ee377101f83fa41b4">00062</a> <a class="code" href="classsdet__watershed__region__proc.html#a7b3bbd8ec79df03ee377101f83fa41b4" title="Default Destructor.">sdet_watershed_region_proc::~sdet_watershed_region_proc</a>()
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064   <span class="keywordflow">for</span> (vcl_map&lt;<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a>, vcl_vector&lt;sdet_region_sptr&gt;* &gt;::iterator
<a name="l00065"></a>00065        rait = <a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>.begin(); rait != <a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>.end(); ++rait)
<a name="l00066"></a>00066     <span class="keyword">delete</span> (*rait).second;
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="comment">//: if an roi is defined then create a chip image and define the bounds</span>
<a name="l00070"></a><a class="code" href="classsdet__watershed__region__proc.html#aec4b2520a356a9fb387bf96e52e49273">00070</a> <span class="keywordtype">void</span> <a class="code" href="classsdet__watershed__region__proc.html#aec4b2520a356a9fb387bf96e52e49273" title="clip image assuming image and roi are set.">sdet_watershed_region_proc::clip_image</a>()
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072   <span class="keywordflow">if</span> (!<a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a> || !<a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>)
<a name="l00073"></a>00073     <span class="keywordflow">return</span>;
<a name="l00074"></a>00074   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vsol_box_2d_sptr</a> box = <a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>-&gt;region(0);
<a name="l00075"></a>00075   <span class="keywordflow">if</span> (! <a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__vil1__float__ops.html#ab3244c3751cbf2b0ab8f20522c6fec65">brip_vil1_float_ops::chip</a>(<a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>, box, <a class="code" href="classsdet__watershed__region__proc.html#ace3a82826fd984480eb2b15c03aea25e">clip_</a>))
<a name="l00076"></a>00076     vcl_cout &lt;&lt; <span class="stringliteral">&quot;sdet_watershed_region_proc::chip_out_roi(.) - failed\n&quot;</span>;
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">//-------------------------------------------------------------------------</span>
<a name="l00080"></a>00080 <span class="comment">//: Set the image to be processed</span>
<a name="l00081"></a>00081 <span class="comment">//</span>
<a name="l00082"></a><a class="code" href="classsdet__watershed__region__proc.html#a4fa49d45100a8d423f515ec6994a7092">00082</a> <span class="keywordtype">void</span> <a class="code" href="classsdet__watershed__region__proc.html#a4fa49d45100a8d423f515ec6994a7092" title="set image and potentially clip.">sdet_watershed_region_proc::set_image</a>(vil1_image <span class="keyword">const</span>&amp; image,
<a name="l00083"></a>00083                                            <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vsol_box_2d_sptr</a> <span class="keyword">const</span>&amp; box)
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085   <span class="keywordflow">if</span> (!image)
<a name="l00086"></a>00086   {
<a name="l00087"></a>00087     vcl_cout &lt;&lt;<span class="stringliteral">&quot;In sdet_watershed_region_proc::set_image(.) - null input\n&quot;</span>;
<a name="l00088"></a>00088     <span class="keywordflow">return</span>;
<a name="l00089"></a>00089   }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   <a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a> = <a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__vil1__float__ops.html#ad72be5f2d266971edde5ec8fcaebb9d9">brip_vil1_float_ops::convert_to_float</a>(image);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <span class="keywordflow">if</span> (box)
<a name="l00094"></a>00094   {
<a name="l00095"></a>00095     <a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a> = <span class="keyword">new</span> <a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__roi.html">brip_roi</a>(image.width(), image.height());
<a name="l00096"></a>00096     <a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>-&gt;add_region(box);
<a name="l00097"></a>00097     this-&gt;<a class="code" href="classsdet__watershed__region__proc.html#aec4b2520a356a9fb387bf96e52e49273" title="clip image assuming image and roi are set.">clip_image</a>();
<a name="l00098"></a>00098   }
<a name="l00099"></a>00099   <a class="code" href="classsdet__watershed__region__proc.html#a20fa91b2948147e42595f0ec4ff8b6f9">regions_valid_</a> = <span class="keyword">false</span>;
<a name="l00100"></a>00100   <a class="code" href="classsdet__watershed__region__proc.html#a1f6ab391642d3b4acac46bff54635a69">region_image_valid_</a> =<span class="keyword">false</span>;
<a name="l00101"></a>00101   <a class="code" href="classsdet__watershed__region__proc.html#ad3d44c68c4be9cda670ebdad43223b4e">boundaries_valid_</a> = <span class="keyword">false</span>;
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 <span class="comment">//----------------------------------------------------------------</span>
<a name="l00106"></a>00106 <span class="comment">//: scan the region label array to fill region pixel data</span>
<a name="l00107"></a>00107 <span class="comment">//</span>
<a name="l00108"></a><a class="code" href="classsdet__watershed__region__proc.html#aed3c05760dbe37e5e4bf94d182ca982c">00108</a> <span class="keywordtype">void</span> <a class="code" href="classsdet__watershed__region__proc.html#aed3c05760dbe37e5e4bf94d182ca982c" title="scan the region label array to fill region pixel data.">sdet_watershed_region_proc::scan_region_data</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__array__2d.html">vbl_array_2d&lt;unsigned int&gt;</a> <span class="keyword">const</span> &amp; lab_array)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110   <span class="keywordtype">int</span> rows = lab_array.<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__array__2d.html#abe25ab10299a0b1c6a075895bfb85fe6">rows</a>(), cols = lab_array.<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__array__2d.html#a5d1d6d4ecc26eff6b99e456078924be6">cols</a>();
<a name="l00111"></a>00111   <span class="keywordtype">int</span> n_regions = <a class="code" href="classsdet__watershed__region__proc.html#a010c16a3eebd34195b058b936d857d43">max_label_</a> - <a class="code" href="classsdet__watershed__region__proc.html#a2394b08c4ee7116ed25e321c0d7827aa">min_label_</a> +1;
<a name="l00112"></a>00112   <span class="comment">//initialize the regions</span>
<a name="l00113"></a>00113   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r = 0; r&lt;rows; r++)
<a name="l00114"></a>00114     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c&lt;cols; c++)
<a name="l00115"></a>00115     {
<a name="l00116"></a>00116       <span class="keywordtype">int</span> imgc = c, imgr = r;
<a name="l00117"></a>00117       <span class="keywordflow">if</span> (<a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>)
<a name="l00118"></a>00118       {
<a name="l00119"></a>00119         imgc = <a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>-&gt;ic(c);
<a name="l00120"></a>00120         imgr = <a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>-&gt;ir(r);
<a name="l00121"></a>00121       }
<a name="l00122"></a>00122       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lab = lab_array[r][c];
<a name="l00123"></a>00123       <span class="keywordflow">if</span> (lab&lt;min_label_ || lab&gt;<a class="code" href="classsdet__watershed__region__proc.html#a010c16a3eebd34195b058b936d857d43">max_label_</a>)
<a name="l00124"></a>00124         <span class="keywordflow">continue</span>;
<a name="l00125"></a>00125       <span class="keywordtype">int</span> index = lab-<a class="code" href="classsdet__watershed__region__proc.html#a2394b08c4ee7116ed25e321c0d7827aa">min_label_</a>;
<a name="l00126"></a>00126       <span class="comment">//dangerous, might not be scaled properly (FIXME)</span>
<a name="l00127"></a>00127       <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a> =  (<span class="keywordtype">unsigned</span> short) <a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>(imgc, imgr);
<a name="l00128"></a>00128       <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>[index]-&gt;IncrementMeans(<span class="keywordtype">float</span>(imgc), <span class="keywordtype">float</span>(imgr), v);
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130   <span class="comment">//fill the region data</span>
<a name="l00131"></a>00131   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt;n_regions; i++)
<a name="l00132"></a>00132     <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>[i]-&gt;InitPixelArrays();
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r = 0; r&lt;rows; r++)
<a name="l00135"></a>00135     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 0; c&lt;cols; c++)
<a name="l00136"></a>00136     {
<a name="l00137"></a>00137       <span class="keywordtype">int</span> imgc = c, imgr = r;
<a name="l00138"></a>00138       <span class="keywordflow">if</span> (<a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>)
<a name="l00139"></a>00139       {
<a name="l00140"></a>00140         imgc = <a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>-&gt;ic(c);
<a name="l00141"></a>00141         imgr = <a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>-&gt;ir(r);
<a name="l00142"></a>00142       }
<a name="l00143"></a>00143       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lab = lab_array[r][c];
<a name="l00144"></a>00144       <span class="keywordflow">if</span> (lab&lt;min_label_ || lab&gt;<a class="code" href="classsdet__watershed__region__proc.html#a010c16a3eebd34195b058b936d857d43">max_label_</a>)
<a name="l00145"></a>00145         <span class="keywordflow">continue</span>;
<a name="l00146"></a>00146       <span class="keywordtype">int</span> index = lab-<a class="code" href="classsdet__watershed__region__proc.html#a2394b08c4ee7116ed25e321c0d7827aa">min_label_</a>;
<a name="l00147"></a>00147       <span class="comment">//dangerous, might not be scaled properly (FIXME)</span>
<a name="l00148"></a>00148       <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a> = (<span class="keywordtype">unsigned</span> short) <a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>(imgc, imgr);
<a name="l00149"></a>00149       <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>[index]-&gt;InsertInPixelArrays(<span class="keywordtype">float</span>(imgc), <span class="keywordtype">float</span>(imgr), v);
<a name="l00150"></a>00150       <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>[index]-&gt;ComputeIntensityStdev();
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="classsdet__watershed__region__proc.html#afe18a31aa583171484e6a1a2d8a79f8c">00154</a> <span class="keywordtype">bool</span> <a class="code" href="classsdet__watershed__region__proc.html#afe18a31aa583171484e6a1a2d8a79f8c">sdet_watershed_region_proc::add_adjacency</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span>&amp; reg,
<a name="l00155"></a>00155                                                <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span>&amp; adj_reg)
<a name="l00156"></a>00156 {
<a name="l00157"></a>00157   vcl_map&lt;sdet_region_sptr, vcl_vector&lt;sdet_region_sptr&gt;* &gt;::iterator rai;
<a name="l00158"></a>00158   rai = <a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>.find(reg);
<a name="l00159"></a>00159 
<a name="l00160"></a>00160   <span class="keywordflow">if</span> (rai !=<a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>.end())
<a name="l00161"></a>00161   {
<a name="l00162"></a>00162     vcl_vector&lt;sdet_region_sptr&gt; * vec = <a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>[reg];
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i =0 ; i &lt; vec-&gt;size(); ++i)
<a name="l00165"></a>00165       <span class="keywordflow">if</span> ((*vec)[i] == adj_reg)
<a name="l00166"></a>00166         <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//adjacency relation already known</span>
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     vec-&gt;push_back(adj_reg);
<a name="l00169"></a>00169   }
<a name="l00170"></a>00170   <span class="keywordflow">else</span><span class="comment">//make a new adjacent region array</span>
<a name="l00171"></a>00171   {
<a name="l00172"></a>00172     vcl_vector&lt;sdet_region_sptr&gt;* adj_array = <span class="keyword">new</span> vcl_vector&lt;sdet_region_sptr&gt;;
<a name="l00173"></a>00173     adj_array-&gt;push_back(adj_reg);
<a name="l00174"></a>00174     <a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>[reg]=adj_array;
<a name="l00175"></a>00175   }
<a name="l00176"></a>00176   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="keywordtype">bool</span>
<a name="l00180"></a><a class="code" href="classsdet__watershed__region__proc.html#af5967ad14300e6501534e74aef2abd6f">00180</a> <a class="code" href="classsdet__watershed__region__proc.html#af5967ad14300e6501534e74aef2abd6f">sdet_watershed_region_proc::remove_adjacencies</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span>&amp; reg)
<a name="l00181"></a>00181 {
<a name="l00182"></a>00182   vcl_map&lt;sdet_region_sptr, vcl_vector&lt;sdet_region_sptr&gt;* &gt;::iterator rai;
<a name="l00183"></a>00183   rai = <a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>.find(reg);
<a name="l00184"></a>00184   <span class="keywordflow">if</span> (rai ==<a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>.end())
<a name="l00185"></a>00185     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00186"></a>00186   vcl_vector&lt;sdet_region_sptr&gt;* adjacencies = (*rai).second;
<a name="l00187"></a>00187   <a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>.erase(rai);
<a name="l00188"></a>00188   <span class="keyword">delete</span> adjacencies;
<a name="l00189"></a>00189   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00190"></a>00190 }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="keywordtype">bool</span> <a class="code" href="classsdet__watershed__region__proc.html#ad7b2b79b685f82d4d53a952617958156">sdet_watershed_region_proc::</a>
<a name="l00193"></a><a class="code" href="classsdet__watershed__region__proc.html#ad7b2b79b685f82d4d53a952617958156">00193</a> <a class="code" href="classsdet__watershed__region__proc.html#ad7b2b79b685f82d4d53a952617958156">adjacent_regions</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span>&amp; reg,
<a name="l00194"></a>00194                  vcl_vector&lt;sdet_region_sptr&gt;&amp; adj_regs)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196   adj_regs.clear();
<a name="l00197"></a>00197   vcl_map&lt;sdet_region_sptr, vcl_vector&lt;sdet_region_sptr&gt;* &gt;::iterator rai;
<a name="l00198"></a>00198   rai = <a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>.find(reg);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200   <span class="keywordflow">if</span> (rai !=<a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>.end())
<a name="l00201"></a>00201   {
<a name="l00202"></a>00202     vcl_vector&lt;sdet_region_sptr&gt; * vec = <a class="code" href="classsdet__watershed__region__proc.html#a1a35418b0d65464d38770c0d8ee09a9c">region_adjacency_</a>[reg];
<a name="l00203"></a>00203     adj_regs = *vec;
<a name="l00204"></a>00204     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00205"></a>00205   }
<a name="l00206"></a>00206   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 <span class="keyword">static</span> <span class="keywordtype">bool</span> found_in_regions(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> <span class="keyword">const</span> &amp;r,
<a name="l00210"></a>00210                              vcl_vector&lt;sdet_region_sptr&gt; <span class="keyword">const</span> &amp; regions)
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212   <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l00213"></a>00213   <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::const_iterator rit = regions.begin();
<a name="l00214"></a>00214        rit != regions.end() &amp;&amp; !found; rit++)
<a name="l00215"></a>00215     <span class="keywordflow">if</span> ((*rit).ptr() == r.<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html#ac1582cca2892f1cce5a9d57f3c13a472">ptr</a>())
<a name="l00216"></a>00216       found = <span class="keyword">true</span>;
<a name="l00217"></a>00217   <span class="keywordflow">return</span> found;
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="keyword">static</span>
<a name="l00221"></a>00221 <span class="keywordtype">void</span> add_new_adjacent_regs(vcl_vector&lt;sdet_region_sptr&gt; <span class="keyword">const</span>&amp; new_adj_regs,
<a name="l00222"></a>00222                            vcl_vector&lt;sdet_region_sptr&gt;&amp; adj_regs)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224   <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::const_iterator rit = new_adj_regs.begin();
<a name="l00225"></a>00225        rit != new_adj_regs.end(); rit++)
<a name="l00226"></a>00226     <span class="keywordflow">if</span> (!found_in_regions(*rit, adj_regs))
<a name="l00227"></a>00227       adj_regs.push_back(*rit);
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00230"></a><a class="code" href="classsdet__watershed__region__proc.html#a3e4930d7bf064b19eedbac251e15b306">00230</a> <span class="keywordtype">bool</span> <a class="code" href="classsdet__watershed__region__proc.html#a3e4930d7bf064b19eedbac251e15b306">sdet_watershed_region_proc::merge_regions</a>()
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232   <span class="comment">//sort input on priority type</span>
<a name="l00233"></a>00233   <span class="keywordflow">switch</span> (<a class="code" href="classsdet__watershed__region__proc__params.html#a85e7a3296621d20ef4a9409e743ede70" title="order for region merge">merge_priority_</a>)
<a name="l00234"></a>00234   {
<a name="l00235"></a>00235    <span class="keywordflow">case</span> <a class="code" href="classsdet__watershed__region__proc.html#af2a0f93c82e080b13c286b34a17b4e24afe60875762f36bc3d0da41f5334367f0">DARK</a>:
<a name="l00236"></a>00236     vcl_sort(<a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin(),
<a name="l00237"></a>00237              <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(), region_intensity_compare_increasing);
<a name="l00238"></a>00238     <span class="keywordflow">break</span>;
<a name="l00239"></a>00239    <span class="keywordflow">case</span> <a class="code" href="classsdet__watershed__region__proc.html#af2a0f93c82e080b13c286b34a17b4e24ae407f7b7fa8a14a1252e72f9e7d30b55">LIGHT</a>:
<a name="l00240"></a>00240     vcl_sort(<a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin(),
<a name="l00241"></a>00241              <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(), region_intensity_compare_decreasing);
<a name="l00242"></a>00242     <span class="keywordflow">break</span>;
<a name="l00243"></a>00243    <span class="keywordflow">case</span> <a class="code" href="classsdet__watershed__region__proc.html#af2a0f93c82e080b13c286b34a17b4e24a10e82f54f290469521535ed943076217">SMALL</a>:
<a name="l00244"></a>00244     vcl_sort(<a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin(),
<a name="l00245"></a>00245              <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(), region_area_compare_increasing);
<a name="l00246"></a>00246     <span class="keywordflow">break</span>;
<a name="l00247"></a>00247    <span class="keywordflow">case</span> <a class="code" href="classsdet__watershed__region__proc.html#af2a0f93c82e080b13c286b34a17b4e24a491aebb913dbce9bc8b238f59cc03483">BIG</a>:
<a name="l00248"></a>00248     vcl_sort(<a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin(),
<a name="l00249"></a>00249              <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(), region_area_compare_decreasing);
<a name="l00250"></a>00250     <span class="keywordflow">break</span>;
<a name="l00251"></a>00251    <span class="keywordflow">default</span>:
<a name="l00252"></a>00252     ;      <span class="comment">//don&#39;t sort at all</span>
<a name="l00253"></a>00253   }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   <span class="keywordflow">if</span> (<a class="code" href="classsdet__watershed__region__proc__params.html#aef5840731c8cd41a04db3e2738bfaefd" title="Print detailed output.">verbose_</a>)
<a name="l00256"></a>00256   {
<a name="l00257"></a>00257     vcl_cout &lt;&lt; <span class="stringliteral">&quot;Regions before merge\n&quot;</span>;
<a name="l00258"></a>00258     this-&gt;<a class="code" href="classsdet__watershed__region__proc.html#a0129faa398ea4bc50dc4b21561c0954e">print_region_info</a>();
<a name="l00259"></a>00259   }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   vcl_vector&lt;sdet_region_sptr&gt; new_regions;
<a name="l00262"></a>00262   vcl_vector&lt;sdet_region_sptr&gt; merged_regions;
<a name="l00263"></a>00263   <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::iterator rit = <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin();
<a name="l00264"></a>00264        rit != <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(); rit++)
<a name="l00265"></a>00265   {
<a name="l00266"></a>00266     <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a>&amp; r = *rit;
<a name="l00267"></a>00267     <span class="keywordflow">if</span> (found_in_regions(r, merged_regions))
<a name="l00268"></a>00268       <span class="keywordflow">continue</span>;
<a name="l00269"></a>00269     <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a>&amp; rm = r; <span class="comment">//merged region</span>
<a name="l00270"></a>00270     vcl_vector&lt;sdet_region_sptr&gt; adj_regs;
<a name="l00271"></a>00271     <span class="keywordflow">if</span> (!<a class="code" href="classsdet__watershed__region__proc.html#ad7b2b79b685f82d4d53a952617958156">adjacent_regions</a>(r, adj_regs))
<a name="l00272"></a>00272       <span class="keywordflow">continue</span>;
<a name="l00273"></a>00273     <span class="keywordtype">bool</span> merged = <span class="keyword">false</span>;
<a name="l00274"></a>00274     vcl_vector&lt;sdet_region_sptr&gt; temp_adj;
<a name="l00275"></a>00275     <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::iterator arit = adj_regs.begin();
<a name="l00276"></a>00276          arit != adj_regs.end(); arit++)
<a name="l00277"></a>00277     {
<a name="l00278"></a>00278       <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a>&amp; ar = *arit;
<a name="l00279"></a>00279       <span class="keywordflow">if</span> (found_in_regions(ar, merged_regions))
<a name="l00280"></a>00280         <span class="keywordflow">continue</span>;
<a name="l00281"></a>00281       <span class="keywordflow">if</span> (r-&gt;Npix()&lt;<a class="code" href="classsdet__watershed__region__proc__params.html#a89e7bb0ab70f9604e71f2f90f28a2075" title="minimum region area">min_area_</a> || ar-&gt;Npix()&lt;<a class="code" href="classsdet__watershed__region__proc__params.html#a89e7bb0ab70f9604e71f2f90f28a2075" title="minimum region area">min_area_</a>)
<a name="l00282"></a>00282         <span class="keywordflow">continue</span>;
<a name="l00283"></a>00283 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00284"></a>00284 <span class="preprocessor"></span>      vcl_cout &lt;&lt; <span class="stringliteral">&quot;R[&quot;</span> &lt;&lt; r-&gt;label() &lt;&lt;<span class="stringliteral">&quot;]:vs:[&quot;</span> &lt;&lt; ar-&gt;label() &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>;
<a name="l00285"></a>00285 <span class="preprocessor">#endif</span>
<a name="l00286"></a>00286 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (bdgl_region_algs::
<a name="l00287"></a>00287           earth_mover_distance(r-&gt;cast_to_digital_region(),
<a name="l00288"></a>00288                               ar-&gt;cast_to_digital_region()) &gt; <a class="code" href="classsdet__watershed__region__proc__params.html#a7c04b728b91bcff1a6467b4e486a63cf" title="region merge tolerance">merge_tol_</a>)
<a name="l00289"></a>00289       {
<a name="l00290"></a>00290         <span class="comment">//will potentially be adjacent to the new region</span>
<a name="l00291"></a>00291         temp_adj.push_back(ar);
<a name="l00292"></a>00292         <span class="keywordflow">continue</span>;
<a name="l00293"></a>00293       }
<a name="l00294"></a>00294       <span class="comment">//found two mergeable regions</span>
<a name="l00295"></a>00295       <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_region_sptr</a> temp;
<a name="l00296"></a>00296       <span class="keywordflow">if</span> (bdgl_region_algs::merge(rm-&gt;cast_to_digital_region(),
<a name="l00297"></a>00297                                   ar-&gt;cast_to_digital_region(), temp))
<a name="l00298"></a>00298       {
<a name="l00299"></a>00299         rm = <span class="keyword">new</span> <a class="code" href="classsdet__region.html">sdet_region</a>(*temp);
<a name="l00300"></a>00300         merged = <span class="keyword">true</span>;
<a name="l00301"></a>00301         merged_regions.push_back(ar);
<a name="l00302"></a>00302         <span class="comment">//now we must add the regions that are adjacent to ar</span>
<a name="l00303"></a>00303         <span class="comment">//since they are adjacent to the new region</span>
<a name="l00304"></a>00304         vcl_vector&lt;sdet_region_sptr&gt; new_adj_regs;
<a name="l00305"></a>00305         <span class="keywordflow">if</span> (<a class="code" href="classsdet__watershed__region__proc.html#ad7b2b79b685f82d4d53a952617958156">adjacent_regions</a>(ar, new_adj_regs))
<a name="l00306"></a>00306           add_new_adjacent_regs(new_adj_regs, temp_adj);
<a name="l00307"></a>00307       }
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     <span class="comment">//declare a new region and update region adjacency map</span>
<a name="l00310"></a>00310     <span class="keywordflow">if</span> (merged)
<a name="l00311"></a>00311     {
<a name="l00312"></a>00312       merged_regions.push_back(r);
<a name="l00313"></a>00313       new_regions.push_back(rm);
<a name="l00314"></a>00314       this-&gt;<a class="code" href="classsdet__watershed__region__proc.html#af5967ad14300e6501534e74aef2abd6f">remove_adjacencies</a>(r);
<a name="l00315"></a>00315       rm-&gt;set_label(++<a class="code" href="classsdet__watershed__region__proc.html#a010c16a3eebd34195b058b936d857d43">max_label_</a>);
<a name="l00316"></a>00316 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00317"></a>00317 <span class="preprocessor"></span>      vcl_cout &lt;&lt; <span class="stringliteral">&quot;New Region[&quot;</span> &lt;&lt; rm-&gt;label() &lt;&lt; <span class="stringliteral">&quot;](&quot;</span> &lt;&lt; rm-&gt;Npix()
<a name="l00318"></a>00318                &lt;&lt; <span class="stringliteral">&quot;)(Xo: &quot;</span> &lt;&lt; rm-&gt;Xo() &lt;&lt; <span class="stringliteral">&quot; Yo: &quot;</span> &lt;&lt; rm -&gt;Yo()
<a name="l00319"></a>00319                &lt;&lt; <span class="stringliteral">&quot; Io: &quot;</span> &lt;&lt; rm -&gt;Io() &lt;&lt;<span class="charliteral">&#39;)&#39;</span> &lt;&lt; vcl_endl;
<a name="l00320"></a>00320 <span class="preprocessor">#endif</span>
<a name="l00321"></a>00321 <span class="preprocessor"></span>      <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::iterator arit = temp_adj.begin();
<a name="l00322"></a>00322            arit != temp_adj.end(); arit++)
<a name="l00323"></a>00323         this-&gt;<a class="code" href="classsdet__watershed__region__proc.html#afe18a31aa583171484e6a1a2d8a79f8c">add_adjacency</a>(rm, *arit);
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325   }
<a name="l00326"></a>00326   <span class="keywordflow">if</span> (<a class="code" href="classsdet__watershed__region__proc__params.html#aef5840731c8cd41a04db3e2738bfaefd" title="Print detailed output.">verbose_</a>)
<a name="l00327"></a>00327   {
<a name="l00328"></a>00328     vcl_cout &lt;&lt; <span class="stringliteral">&quot;# merged regions &quot;</span> &lt;&lt; merged_regions.size() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00329"></a>00329              &lt;&lt; <span class="stringliteral">&quot;# new regions &quot;</span> &lt;&lt; new_regions.size() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00330"></a>00330   }
<a name="l00331"></a>00331   <span class="comment">//remove merged regions from the region_index</span>
<a name="l00332"></a>00332   vcl_vector&lt;sdet_region_sptr&gt; temp2;
<a name="l00333"></a>00333   <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::iterator rit = <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin();
<a name="l00334"></a>00334        rit != <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(); rit++)
<a name="l00335"></a>00335     <span class="keywordflow">if</span> (!found_in_regions(*rit, merged_regions))
<a name="l00336"></a>00336       temp2.push_back(*rit);
<a name="l00337"></a>00337   <span class="comment">//add new regions to region index</span>
<a name="l00338"></a>00338   <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::iterator rit = new_regions.begin();
<a name="l00339"></a>00339        rit != new_regions.end(); rit++)
<a name="l00340"></a>00340     temp2.push_back(*rit);
<a name="l00341"></a>00341   <span class="comment">//replace the index</span>
<a name="l00342"></a>00342   <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a> = temp2;
<a name="l00343"></a>00343   <span class="keywordflow">if</span> (<a class="code" href="classsdet__watershed__region__proc__params.html#aef5840731c8cd41a04db3e2738bfaefd" title="Print detailed output.">verbose_</a>)
<a name="l00344"></a>00344   {
<a name="l00345"></a>00345     vcl_cout &lt;&lt; <span class="stringliteral">&quot;Regions after merge\n&quot;</span>;
<a name="l00346"></a>00346     this-&gt;<a class="code" href="classsdet__watershed__region__proc.html#a0129faa398ea4bc50dc4b21561c0954e">print_region_info</a>();
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348   <a class="code" href="classsdet__watershed__region__proc.html#ad3d44c68c4be9cda670ebdad43223b4e">boundaries_valid_</a> = <span class="keyword">false</span>;
<a name="l00349"></a>00349   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00353"></a>00353 <span class="comment">//: extract a set of digital regions</span>
<a name="l00354"></a><a class="code" href="classsdet__watershed__region__proc.html#abc0c8d26a48162d7f4b0c6f9fe7044cd">00354</a> <span class="keywordtype">bool</span> <a class="code" href="classsdet__watershed__region__proc.html#abc0c8d26a48162d7f4b0c6f9fe7044cd" title="extract a set of digital regions.">sdet_watershed_region_proc::extract_regions</a>()
<a name="l00355"></a>00355 {
<a name="l00356"></a>00356   <span class="keywordflow">if</span> (<a class="code" href="classsdet__watershed__region__proc.html#a20fa91b2948147e42595f0ec4ff8b6f9">regions_valid_</a>)
<a name="l00357"></a>00357     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359   <span class="comment">// Check the image</span>
<a name="l00360"></a>00360   <span class="keywordflow">if</span> (!<a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>)
<a name="l00361"></a>00361   {
<a name="l00362"></a>00362     vcl_cout &lt;&lt; <span class="stringliteral">&quot;In sdet_watershed_region_proc::extract_regions() - no image\n&quot;</span>;
<a name="l00363"></a>00363     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00364"></a>00364   }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   vcl_cout &lt;&lt; <span class="stringliteral">&quot;sdet_watershed_region_proc::extract_regions(): width = &quot;</span>
<a name="l00367"></a>00367            &lt;&lt; <a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>.width() &lt;&lt; <span class="stringliteral">&quot; height = &quot;</span> &lt;&lt; <a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>.height() &lt;&lt; vcl_endl;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   <span class="comment">//Process the image to extract regions</span>
<a name="l00370"></a>00370   <span class="comment">//for now we assume the image is unsigned char or unsigned short</span>
<a name="l00371"></a>00371   <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.clear();
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   <a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__watershed.html">brip_watershed</a> watershed(<a class="code" href="classsdet__watershed__region__proc__params.html#ab36741b4eb0c700ba35de18deada9d9c" title="params associated with step and fold detection">wp_</a>);
<a name="l00374"></a>00374   <span class="keywordflow">if</span> (<a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>)
<a name="l00375"></a>00375     watershed.<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__watershed.html#a438532f9415d41c502c5f1b35f7e5d0f">set_image</a>(<a class="code" href="classsdet__watershed__region__proc.html#ace3a82826fd984480eb2b15c03aea25e">clip_</a>);
<a name="l00376"></a>00376   <span class="keywordflow">else</span>
<a name="l00377"></a>00377     watershed.<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__watershed.html#a438532f9415d41c502c5f1b35f7e5d0f">set_image</a>(<a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>);
<a name="l00378"></a>00378   <span class="keywordflow">if</span> (!watershed.<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__watershed.html#a963ee5b68e23b197a695975d4b4da50b">compute_regions</a>())
<a name="l00379"></a>00379     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00380"></a>00380   <a class="code" href="classsdet__watershed__region__proc.html#a962e3decef555b48bdba96c511f47598">overlay_image_</a> = watershed.<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__watershed.html#ab3edbba848f04d21f7453fff63fd5d12">overlay_image</a>();
<a name="l00381"></a>00381   vil1_memory_image_of&lt;vil1_rgb&lt;unsigned char&gt; &gt; color_image =
<a name="l00382"></a>00382     <a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__vil1__float__ops.html#ab938a96490b91f91f636a308dba7838d">brip_vil1_float_ops::convert_to_rgb</a>(<a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>, 0, 255);
<a name="l00383"></a>00383   <span class="keywordflow">if</span> (<a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>)
<a name="l00384"></a>00384     <a class="code" href="classsdet__watershed__region__proc.html#a962e3decef555b48bdba96c511f47598">overlay_image_</a> =
<a name="l00385"></a>00385       <a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__vil1__float__ops.html#a0c9e8e7e162c52587945791339fbb377">brip_vil1_float_ops::insert_chip_in_image</a>(color_image, <a class="code" href="classsdet__watershed__region__proc.html#a962e3decef555b48bdba96c511f47598">overlay_image_</a>, <a class="code" href="classsdet__watershed__region__proc.html#a83353636e1f338ba2f283c47d4ba6954">roi_</a>);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00388"></a>00388   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__array__2d.html">vbl_array_2d&lt;unsigned int&gt;</a>&amp; lab_array = watershed.<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__watershed.html#ada58352280e8b99d36d035c524a27b6f">region_label_array</a>();
<a name="l00389"></a>00389   <a class="code" href="classsdet__watershed__region__proc.html#a2394b08c4ee7116ed25e321c0d7827aa">min_label_</a> = watershed.<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__watershed.html#ab0c0ecd771d7322f5046a350079cac1f">min_region_label</a>();
<a name="l00390"></a>00390   <a class="code" href="classsdet__watershed__region__proc.html#a010c16a3eebd34195b058b936d857d43">max_label_</a> = watershed.<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__watershed.html#a9d6739bcfcccc70606cc0464be4b1939">max_region_label</a>();
<a name="l00391"></a>00391   <span class="keywordtype">int</span> n_labs = <a class="code" href="classsdet__watershed__region__proc.html#a010c16a3eebd34195b058b936d857d43">max_label_</a> - <a class="code" href="classsdet__watershed__region__proc.html#a2394b08c4ee7116ed25e321c0d7827aa">min_label_</a> + 1;<span class="comment">//number of labels</span>
<a name="l00392"></a>00392 
<a name="l00393"></a>00393   <span class="comment">//initialize the region array</span>
<a name="l00394"></a>00394   <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.resize(n_labs);
<a name="l00395"></a>00395   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n&lt;n_labs; n++)
<a name="l00396"></a>00396   {
<a name="l00397"></a>00397     <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>[n] = <span class="keyword">new</span> <a class="code" href="classsdet__region.html">sdet_region</a>();
<a name="l00398"></a>00398     <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>[n]-&gt;set_label(n+min_label_);
<a name="l00399"></a>00399   }
<a name="l00400"></a>00400   <span class="comment">//initialize region adjacency</span>
<a name="l00401"></a>00401   vcl_vector&lt;unsigned int&gt; adj_regs;
<a name="l00402"></a>00402   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n&lt;n_labs; n++)
<a name="l00403"></a>00403   {
<a name="l00404"></a>00404     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ln = min_label_ + n;
<a name="l00405"></a>00405     <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">sdet_region_sptr</a> rn = <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>[n];
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (watershed.<a class="codeRef" doxygen="contrib_brl_bseg_brip.tag:../../../../../contrib/brl/bseg/brip/html" href="../../../../../contrib/brl/bseg/brip/html/classbrip__watershed.html#a0d7028b2fc0d29fd5ed4500c699f4c3e">adjacent_regions</a>(ln, adj_regs))
<a name="l00407"></a>00407       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt;adj_regs.size(); ++i)
<a name="l00408"></a>00408         this-&gt;<a class="code" href="classsdet__watershed__region__proc.html#afe18a31aa583171484e6a1a2d8a79f8c">add_adjacency</a>(rn, <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>[adj_regs[i]-min_label_]);
<a name="l00409"></a>00409   }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411   <span class="comment">//fill the region intensity data</span>
<a name="l00412"></a>00412   this-&gt;<a class="code" href="classsdet__watershed__region__proc.html#aed3c05760dbe37e5e4bf94d182ca982c" title="scan the region label array to fill region pixel data.">scan_region_data</a>(lab_array);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414   <span class="comment">//sort the regions on intensity (not really needed but good for debugging)</span>
<a name="l00415"></a>00415   vcl_sort(<a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin(),
<a name="l00416"></a>00416            <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(), region_intensity_compare_increasing);
<a name="l00417"></a>00417   <a class="code" href="classsdet__watershed__region__proc.html#a20fa91b2948147e42595f0ec4ff8b6f9">regions_valid_</a> = <span class="keyword">true</span>;
<a name="l00418"></a>00418   <a class="code" href="classsdet__watershed__region__proc.html#ad3d44c68c4be9cda670ebdad43223b4e">boundaries_valid_</a> = <span class="keyword">false</span>;
<a name="l00419"></a>00419   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 <span class="comment">//----------------------------------------------------------</span>
<a name="l00423"></a>00423 <span class="comment">//: Clear internal storage</span>
<a name="l00424"></a>00424 <span class="comment">//</span>
<a name="l00425"></a><a class="code" href="classsdet__watershed__region__proc.html#a7dcce08de7033ba10c25c2a49b21e636">00425</a> <span class="keywordtype">void</span> <a class="code" href="classsdet__watershed__region__proc.html#a7dcce08de7033ba10c25c2a49b21e636" title="Clear internal storage.">sdet_watershed_region_proc::clear</a>()
<a name="l00426"></a>00426 {
<a name="l00427"></a>00427   <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.clear();
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00431"></a>00431 <span class="comment">//: Use a linear approximation to intensity to predict region data.</span>
<a name="l00432"></a>00432 <span class="comment">//  Return the residual error</span>
<a name="l00433"></a><a class="code" href="classsdet__watershed__region__proc.html#a93322f202bd43b5f291bdfd09ac77414">00433</a> vil1_image <a class="code" href="classsdet__watershed__region__proc.html#a93322f202bd43b5f291bdfd09ac77414" title="Use a linear approximation to intensity to predict region data.">sdet_watershed_region_proc::get_residual_image</a>()
<a name="l00434"></a>00434 {
<a name="l00435"></a>00435   <span class="keywordflow">if</span> (!<a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a> || !<a class="code" href="classsdet__watershed__region__proc.html#a20fa91b2948147e42595f0ec4ff8b6f9">regions_valid_</a>)
<a name="l00436"></a>00436   {
<a name="l00437"></a>00437     vcl_cout &lt;&lt; <span class="stringliteral">&quot;In sdet_watershed_region_proc::get_residual_image() - no regions\n&quot;</span>;
<a name="l00438"></a>00438     <span class="keywordflow">return</span> 0;
<a name="l00439"></a>00439   }
<a name="l00440"></a>00440   <span class="keywordtype">int</span> xsize = <a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>.width(), ysize = <a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>.height();
<a name="l00441"></a>00441   vil1_memory_image_of&lt;unsigned char&gt; res_image(xsize, ysize);
<a name="l00442"></a>00442   res_image.fill(0);
<a name="l00443"></a>00443   <span class="keywordtype">float</span> min_res = (float)<a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/classvnl__numeric__traits_3_01unsigned_01short_01_4.html#a593a5c92a0e5c34ff27e9fdbee8dc0dd">vnl_numeric_traits&lt;unsigned short&gt;::maxval</a>;
<a name="l00444"></a>00444   <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::iterator rit = <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin();
<a name="l00445"></a>00445        rit != <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(); rit++)
<a name="l00446"></a>00446     <span class="keywordflow">for</span> ((*rit)-&gt;reset(); (*rit)-&gt;next();)
<a name="l00447"></a>00447     {
<a name="l00448"></a>00448       <span class="keywordtype">float</span> res = (*rit)-&gt;Ir();
<a name="l00449"></a>00449       <span class="keywordflow">if</span> (res&lt;min_res)
<a name="l00450"></a>00450         min_res = res;
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::iterator rit = <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin();
<a name="l00454"></a>00454        rit != <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(); rit++)
<a name="l00455"></a>00455     <span class="keywordflow">for</span> ((*rit)-&gt;reset(); (*rit)-&gt;next();)
<a name="l00456"></a>00456     {
<a name="l00457"></a>00457       <span class="keywordtype">int</span> x = int((*rit)-&gt;X()), y = <span class="keywordtype">int</span>((*rit)-&gt;Y());
<a name="l00458"></a>00458       <span class="keywordtype">float</span> res = (*rit)-&gt;Ir();
<a name="l00459"></a>00459       <span class="keywordtype">float</span> is = res-min_res;<span class="comment">//to ensure non-negative</span>
<a name="l00460"></a>00460       <span class="keywordflow">if</span> (is&gt;255)
<a name="l00461"></a>00461         is = 255;<span class="comment">//to ensure within char</span>
<a name="l00462"></a>00462       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pix = (<span class="keywordtype">unsigned</span> char)is;
<a name="l00463"></a>00463       res_image(x, y)=pix;
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465   <span class="keywordflow">return</span> res_image;
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a><a class="code" href="classsdet__watershed__region__proc.html#a0129faa398ea4bc50dc4b21561c0954e">00468</a> <span class="keywordtype">void</span> <a class="code" href="classsdet__watershed__region__proc.html#a0129faa398ea4bc50dc4b21561c0954e">sdet_watershed_region_proc::print_region_info</a>()
<a name="l00469"></a>00469 {
<a name="l00470"></a>00470   <span class="keywordflow">if</span> (!<a class="code" href="classsdet__watershed__region__proc.html#a20fa91b2948147e42595f0ec4ff8b6f9">regions_valid_</a>)
<a name="l00471"></a>00471     <span class="keywordflow">return</span>;
<a name="l00472"></a>00472   <span class="keywordtype">int</span> index = 0;
<a name="l00473"></a>00473   <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::iterator rit = <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin();
<a name="l00474"></a>00474        rit != <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(); rit++, index++)
<a name="l00475"></a>00475   {
<a name="l00476"></a>00476     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> npix = (*rit)-&gt;Npix();
<a name="l00477"></a>00477     <span class="keywordflow">if</span> (npix&lt;<a class="code" href="classsdet__watershed__region__proc__params.html#a89e7bb0ab70f9604e71f2f90f28a2075" title="minimum region area">min_area_</a>)
<a name="l00478"></a>00478       <span class="keywordflow">continue</span>;
<a name="l00479"></a>00479     vcl_cout &lt;&lt; <span class="stringliteral">&quot;R[&quot;</span> &lt;&lt; (*rit)-&gt;label() &lt;&lt; <span class="stringliteral">&quot;](Np:&quot;</span> &lt;&lt; npix &lt;&lt; <span class="stringliteral">&quot; Io:&quot;</span>
<a name="l00480"></a>00480              &lt;&lt; (*rit)-&gt;Io() &lt;&lt; <span class="stringliteral">&quot; Xo:&quot;</span> &lt;&lt; (*rit)-&gt;Xo()
<a name="l00481"></a>00481              &lt;&lt; <span class="stringliteral">&quot; Yo:&quot;</span> &lt;&lt; (*rit)-&gt;Yo() &lt;&lt; <span class="stringliteral">&quot;):sd&quot;</span>&lt;&lt; (*rit)-&gt;Io_sd() &lt;&lt; vcl_endl;
<a name="l00482"></a>00482   }
<a name="l00483"></a>00483 }
<a name="l00484"></a>00484 
<a name="l00485"></a><a class="code" href="classsdet__watershed__region__proc.html#af13620e2541e729ccecc1064aa8fcf24">00485</a> <span class="keywordtype">bool</span> <a class="code" href="classsdet__watershed__region__proc.html#af13620e2541e729ccecc1064aa8fcf24">sdet_watershed_region_proc::compute_region_image</a>()
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487   <span class="keywordflow">if</span> (!<a class="code" href="classsdet__watershed__region__proc.html#a20fa91b2948147e42595f0ec4ff8b6f9">regions_valid_</a> || !<a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>)
<a name="l00488"></a>00488     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00489"></a>00489   <span class="comment">//create the image assume for now everything is unsigned char</span>
<a name="l00490"></a>00490   <span class="keywordtype">int</span> w = <a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>.width(), h = <a class="code" href="classsdet__watershed__region__proc.html#acad96490af811e2a6340c5f7c491e7db">image_</a>.height();
<a name="l00491"></a>00491   <a class="code" href="classsdet__watershed__region__proc.html#ac9250ad2faa05af904f6b869e96761dc">region_image_</a>.resize(w, h);
<a name="l00492"></a>00492   <a class="code" href="classsdet__watershed__region__proc.html#ac9250ad2faa05af904f6b869e96761dc">region_image_</a>.fill(255);
<a name="l00493"></a>00493   <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::iterator rit = <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin();
<a name="l00494"></a>00494        rit != <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(); rit++)
<a name="l00495"></a>00495     <span class="keywordflow">for</span> ((*rit)-&gt;reset(); (*rit)-&gt;next();)
<a name="l00496"></a>00496     {
<a name="l00497"></a>00497       <span class="keywordtype">int</span> c = int((*rit)-&gt;X()), r = <span class="keywordtype">int</span>((*rit)-&gt;Y());
<a name="l00498"></a>00498       <span class="keywordflow">if</span> (c&lt;0 || r&lt;0 || c&gt;=w || r&gt;=h)
<a name="l00499"></a>00499         <span class="keywordflow">continue</span>;
<a name="l00500"></a>00500       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> val = (<span class="keywordtype">unsigned</span> char)(*rit)-&gt;I();
<a name="l00501"></a>00501       <a class="code" href="classsdet__watershed__region__proc.html#ac9250ad2faa05af904f6b869e96761dc">region_image_</a>(c,r) = val;
<a name="l00502"></a>00502     }
<a name="l00503"></a>00503   <a class="code" href="classsdet__watershed__region__proc.html#a1f6ab391642d3b4acac46bff54635a69">region_image_valid_</a> = <span class="keyword">true</span>;
<a name="l00504"></a>00504   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00505"></a>00505 }
<a name="l00506"></a>00506 
<a name="l00507"></a><a class="code" href="classsdet__watershed__region__proc.html#af7d2d3b5ac09b72ea509c6b949ce55d0">00507</a> vil1_image <a class="code" href="classsdet__watershed__region__proc.html#af7d2d3b5ac09b72ea509c6b949ce55d0">sdet_watershed_region_proc::region_image</a>()
<a name="l00508"></a>00508 {
<a name="l00509"></a>00509   vil1_image out;
<a name="l00510"></a>00510   <span class="keywordflow">if</span> (!<a class="code" href="classsdet__watershed__region__proc.html#a1f6ab391642d3b4acac46bff54635a69">region_image_valid_</a>)
<a name="l00511"></a>00511     <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classsdet__watershed__region__proc.html#af13620e2541e729ccecc1064aa8fcf24">compute_region_image</a>())
<a name="l00512"></a>00512       <span class="keywordflow">return</span> out;
<a name="l00513"></a>00513   <span class="keywordflow">return</span> <a class="code" href="classsdet__watershed__region__proc.html#ac9250ad2faa05af904f6b869e96761dc">region_image_</a>;
<a name="l00514"></a>00514 }
<a name="l00515"></a>00515 
<a name="l00516"></a><a class="code" href="classsdet__watershed__region__proc.html#a82edf450deb28cede3e43b2b3a4bdb6d">00516</a> <span class="keywordtype">void</span> <a class="code" href="classsdet__watershed__region__proc.html#a82edf450deb28cede3e43b2b3a4bdb6d">sdet_watershed_region_proc::compute_boundaries</a>()
<a name="l00517"></a>00517 {
<a name="l00518"></a>00518   <span class="keywordflow">for</span> (vcl_vector&lt;sdet_region_sptr&gt;::iterator rit =  <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.begin();
<a name="l00519"></a>00519        rit != <a class="code" href="classsdet__watershed__region__proc.html#a6cce4584982853e8422c77832eddd135">regions_</a>.end(); rit++)
<a name="l00520"></a>00520   {
<a name="l00521"></a>00521     <span class="keywordflow">if</span> ((*rit)-&gt;Npix()&lt;<a class="code" href="classsdet__watershed__region__proc__params.html#a89e7bb0ab70f9604e71f2f90f28a2075" title="minimum region area">min_area_</a>)
<a name="l00522"></a>00522       <span class="keywordflow">continue</span>;
<a name="l00523"></a>00523     <span class="keywordflow">if</span> ((*rit)-&gt;boundary())
<a name="l00524"></a>00524       <a class="code" href="classsdet__watershed__region__proc.html#a25e0517de50874fc4281819341030bc3">boundaries_</a>.push_back((*rit)-&gt;boundary());
<a name="l00525"></a>00525   }
<a name="l00526"></a>00526   <a class="code" href="classsdet__watershed__region__proc.html#ad3d44c68c4be9cda670ebdad43223b4e">boundaries_valid_</a> = <span class="keyword">true</span>;
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a><a class="code" href="classsdet__watershed__region__proc.html#a46270c13ad163f3c0ae3e58406ef39eb">00529</a> vcl_vector&lt;vsol_polygon_2d_sptr&gt; <a class="code" href="classsdet__watershed__region__proc.html#a46270c13ad163f3c0ae3e58406ef39eb">sdet_watershed_region_proc::boundaries</a>()
<a name="l00530"></a>00530 {
<a name="l00531"></a>00531   <span class="keywordflow">if</span> (!<a class="code" href="classsdet__watershed__region__proc.html#ad3d44c68c4be9cda670ebdad43223b4e">boundaries_valid_</a>)
<a name="l00532"></a>00532     this-&gt;<a class="code" href="classsdet__watershed__region__proc.html#a82edf450deb28cede3e43b2b3a4bdb6d">compute_boundaries</a>();
<a name="l00533"></a>00533   <span class="keywordflow">return</span> <a class="code" href="classsdet__watershed__region__proc.html#a25e0517de50874fc4281819341030bc3">boundaries_</a>;
<a name="l00534"></a>00534 }
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Thu May 2 2013 08:53:33 for contrib/brl/bseg/sdet by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
