<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>contrib/brl/bbas/bsta/bsta_spherical_histogram.txx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">contrib/brl/bbas/bsta/bsta_spherical_histogram.txx</div>  </div>
</div>
<div class="contents">
<a href="bsta__spherical__histogram_8txx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef bsta_spherical_histogram_txx_</span>
<a name="l00002"></a><a class="code" href="bsta__spherical__histogram_8txx.html#a9e05407833c51dcf82442309676c7260">00002</a> <span class="preprocessor"></span><span class="preprocessor">#define bsta_spherical_histogram_txx_</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="comment">//:</span>
<a name="l00004"></a>00004 <span class="comment">// \file</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="code" href="bsta__spherical__histogram_8h.html" title="A 2-d histogram with bins defined on a unit sphere.">bsta_spherical_histogram.h</a>&quot;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;vcl_cmath.h&gt;</span> <span class="comment">// for log()</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;vcl_iostream.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;vcl_cassert.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;vnl/vnl_math.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;vnl/vnl_vector.h&gt;</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">// determine if an angle lies inside an interval that possibly contains</span>
<a name="l00014"></a>00014 <span class="comment">// the branch cut at 0/360</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00017"></a>00017 <span class="keyword">static</span> <span class="keywordtype">bool</span> in_interval(T start, T range, T angle)
<a name="l00018"></a>00018 {
<a name="l00019"></a>00019   T end = start + range;
<a name="l00020"></a>00020   <span class="keywordtype">bool</span> no_cut = (end &lt;= T(360));
<a name="l00021"></a>00021   <span class="keywordflow">if</span> (no_cut) {
<a name="l00022"></a>00022     <span class="keywordflow">return</span> angle &gt;= start &amp;&amp; angle &lt; end;
<a name="l00023"></a>00023   }
<a name="l00024"></a>00024   <span class="comment">// the interval contains the cut</span>
<a name="l00025"></a>00025   <span class="keywordflow">if</span> (angle &gt;= start &amp;&amp; angle&lt;=T(360))
<a name="l00026"></a>00026     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00027"></a>00027   T branch_end = end - T(360);
<a name="l00028"></a>00028   <span class="keywordflow">if</span> (angle &gt;= 0 &amp;&amp; angle &lt; branch_end)
<a name="l00029"></a>00029     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00030"></a>00030   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00031"></a>00031 }
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00034"></a>00034 <span class="keyword">static</span> T start_90_180(T start, T range)
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036   <span class="keywordflow">return</span> -(start+range) + T(90);
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="comment">// find the smallest distance between two azimuth angles, a and b</span>
<a name="l00040"></a>00040 <span class="comment">// if it is assumed that x0 &lt; x1 then compare (x1-x0) with pi - (x1-x0)</span>
<a name="l00041"></a>00041 <span class="comment">// the smaller value is the difference. The sign of the difference is</span>
<a name="l00042"></a>00042 <span class="comment">// determined by whether it is necessary to switch a and b.</span>
<a name="l00043"></a>00043 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00044"></a>00044 <span class="keyword">static</span> T azimuth_diff(T a, T b, T two_pi)
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046   T x0 = a, x1 = b, sign = T(1);
<a name="l00047"></a>00047   <span class="keywordflow">if</span> (a&gt;b) {x0 = b; x1 = a; sign = -sign;}
<a name="l00048"></a>00048   T a1 = x1-x0;
<a name="l00049"></a>00049   T a2 = two_pi - a1;
<a name="l00050"></a>00050   <span class="keywordflow">if</span> (a1&gt;a2) <span class="keywordflow">return</span> -sign*a2;
<a name="l00051"></a>00051   <span class="keywordflow">return</span> sign*a1;
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00055"></a><a class="code" href="classbsta__spherical__histogram.html#af5235d3bd3286e4d62b34527f8ea244f">00055</a> <a class="code" href="classbsta__spherical__histogram.html#af5235d3bd3286e4d62b34527f8ea244f">bsta_spherical_histogram&lt;T&gt;::bsta_spherical_histogram</a>()
<a name="l00056"></a>00056   : n_azimuth_(0), n_elevation_(0),
<a name="l00057"></a>00057     azimuth_start_(0), azimuth_range_(0),
<a name="l00058"></a>00058     elevation_start_(0), elevation_range_(0),
<a name="l00059"></a>00059     az_branch_cut_(B_180_180), el_poles_(B_90_90),
<a name="l00060"></a>00060     units_(DEG), total_counts_valid_(false), total_counts_(0)
<a name="l00061"></a>00061 {
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00065"></a>00065 <a class="code" href="classbsta__spherical__histogram.html#af5235d3bd3286e4d62b34527f8ea244f">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00066"></a><a class="code" href="classbsta__spherical__histogram.html#ae37d92ba19548b72feaebd41dcac9789">00066</a> <a class="code" href="classbsta__spherical__histogram.html#af5235d3bd3286e4d62b34527f8ea244f">bsta_spherical_histogram</a>(<span class="keywordtype">unsigned</span> n_azimuth, <span class="keywordtype">unsigned</span> n_elevation,
<a name="l00067"></a>00067                          T azimuth_start, T azimuth_range, T elevation_start,
<a name="l00068"></a>00068                          T elevation_range, <a class="code" href="classbsta__spherical__histogram.html#a500546eb56ea9a41486362b88cf51051">ang_units</a> units,
<a name="l00069"></a>00069                          <a class="code" href="classbsta__spherical__histogram.html#a77736dea340c597af1a80e43fed8d31b">angle_bounds</a> az_branch_cut, <a class="code" href="classbsta__spherical__histogram.html#a77736dea340c597af1a80e43fed8d31b">angle_bounds</a> el_poles)
<a name="l00070"></a>00070   : n_azimuth_(n_azimuth), n_elevation_(n_elevation),
<a name="l00071"></a>00071     azimuth_start_(azimuth_start), azimuth_range_(azimuth_range),
<a name="l00072"></a>00072     elevation_start_(elevation_start), elevation_range_(elevation_range),
<a name="l00073"></a>00073     az_branch_cut_(az_branch_cut), el_poles_(el_poles),
<a name="l00074"></a>00074     units_(units), total_counts_valid_(false), total_counts_(0)
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076   assert(n_azimuth&gt;0&amp;&amp;n_elevation&gt;0);
<a name="l00077"></a>00077   <span class="comment">// convert to degrees if necessary</span>
<a name="l00078"></a>00078   <span class="keywordflow">if</span> (<a class="code" href="classbsta__spherical__histogram.html#aecb5917f272296926d46e7c6c8de6761">units_</a> == <a class="code" href="classbsta__spherical__histogram.html#a500546eb56ea9a41486362b88cf51051a820511a9e3392fc425d046073129a713">RADIANS</a>) {
<a name="l00079"></a>00079     <a class="code" href="classbsta__spherical__histogram.html#aa7a97178f329fb65e5c56b71d097ca57">azimuth_start_</a>   = <a class="code" href="classbsta__spherical__histogram.html#a97de1b589f997b565b929d059e5e125b">rad_to_deg</a>(<a class="code" href="classbsta__spherical__histogram.html#aa7a97178f329fb65e5c56b71d097ca57">azimuth_start_</a>);
<a name="l00080"></a>00080     <a class="code" href="classbsta__spherical__histogram.html#a266aa3ea3ce75e16ba6eec32bac71277">azimuth_range_</a>   = <a class="code" href="classbsta__spherical__histogram.html#a97de1b589f997b565b929d059e5e125b">rad_to_deg</a>(<a class="code" href="classbsta__spherical__histogram.html#a266aa3ea3ce75e16ba6eec32bac71277">azimuth_range_</a>);
<a name="l00081"></a>00081     <a class="code" href="classbsta__spherical__histogram.html#a4c78cd728bbc6a852e31f04bc599f3f5">elevation_start_</a> = <a class="code" href="classbsta__spherical__histogram.html#a97de1b589f997b565b929d059e5e125b">rad_to_deg</a>(<a class="code" href="classbsta__spherical__histogram.html#a4c78cd728bbc6a852e31f04bc599f3f5">elevation_start_</a>);
<a name="l00082"></a>00082     <a class="code" href="classbsta__spherical__histogram.html#a908e8d5e77ed0a32aa5ba3e12745db77">elevation_range_</a> = <a class="code" href="classbsta__spherical__histogram.html#a97de1b589f997b565b929d059e5e125b">rad_to_deg</a>(<a class="code" href="classbsta__spherical__histogram.html#a908e8d5e77ed0a32aa5ba3e12745db77">elevation_range_</a>);
<a name="l00083"></a>00083   }
<a name="l00084"></a>00084   <span class="comment">//convert azimuth branch_cut to 0-360 if necessary</span>
<a name="l00085"></a>00085   <span class="keywordflow">if</span> (az_branch_cut == <a class="code" href="classbsta__spherical__histogram.html#a77736dea340c597af1a80e43fed8d31bad44f0c0447b36153aa8eda0d88876c11">B_180_180</a>)
<a name="l00086"></a>00086     <span class="keywordflow">if</span> (<a class="code" href="classbsta__spherical__histogram.html#aa7a97178f329fb65e5c56b71d097ca57">azimuth_start_</a>&lt;T(0))
<a name="l00087"></a>00087       <a class="code" href="classbsta__spherical__histogram.html#aa7a97178f329fb65e5c56b71d097ca57">azimuth_start_</a> = <a class="code" href="classbsta__spherical__histogram.html#aa7a97178f329fb65e5c56b71d097ca57">azimuth_start_</a>+ <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(360);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   <span class="comment">//convert elevation range to 0-&gt;180</span>
<a name="l00090"></a>00090   <span class="keywordflow">if</span> (<a class="code" href="classbsta__spherical__histogram.html#ae33ce1b2ca4ffb32257dbdd8b932ffac">el_poles_</a> == <a class="code" href="classbsta__spherical__histogram.html#a77736dea340c597af1a80e43fed8d31ba495f6ea4a42ce23d2f032a6f8f0b69b0">B_90_90</a>)
<a name="l00091"></a>00091     <a class="code" href="classbsta__spherical__histogram.html#a4c78cd728bbc6a852e31f04bc599f3f5">elevation_start_</a> =
<a name="l00092"></a>00092       start_90_180(<a class="code" href="classbsta__spherical__histogram.html#a4c78cd728bbc6a852e31f04bc599f3f5">elevation_start_</a>,<a class="code" href="classbsta__spherical__histogram.html#a908e8d5e77ed0a32aa5ba3e12745db77">elevation_range_</a>);
<a name="l00093"></a>00093 
<a name="l00094"></a>00094   <a class="code" href="classbsta__spherical__histogram.html#a22397508e037e81a927ff4d528133567">delta_az_</a> = <a class="code" href="classbsta__spherical__histogram.html#a266aa3ea3ce75e16ba6eec32bac71277">azimuth_range_</a>/<a class="code" href="classbsta__spherical__histogram.html#a3051803ef66a762efc861dfbc3838b56" title="members.">n_azimuth_</a>;
<a name="l00095"></a>00095   <a class="code" href="classbsta__spherical__histogram.html#a9e81bf7aa9b541ab006eafe12908eb91">delta_el_</a> = <a class="code" href="classbsta__spherical__histogram.html#a908e8d5e77ed0a32aa5ba3e12745db77">elevation_range_</a>/<a class="code" href="classbsta__spherical__histogram.html#aef2c1edf1f78e6161f0b0857f90e6e05">n_elevation_</a>;
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">//: azimuth bounds</span>
<a name="l00099"></a>00099 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00100"></a><a class="code" href="classbsta__spherical__histogram.html#a2742b1a3fdfc7c509023dccbc27a41bc">00100</a> T <a class="code" href="classbsta__spherical__histogram.html#a2742b1a3fdfc7c509023dccbc27a41bc" title="azimuth bounds.">bsta_spherical_histogram&lt;T&gt;::azimuth_start</a>()<span class="keyword"> const</span>
<a name="l00101"></a>00101 <span class="keyword"></span>{
<a name="l00102"></a>00102   T az_start = azimuth_start_;
<a name="l00103"></a>00103   <span class="keywordflow">if</span> (az_branch_cut_==B_180_180)
<a name="l00104"></a>00104     <span class="keywordflow">if</span> (az_start &gt;=T(180))
<a name="l00105"></a>00105       az_start -= T(360);
<a name="l00106"></a>00106   <span class="keywordflow">if</span> (units_ == RADIANS)
<a name="l00107"></a>00107     az_start = deg_to_rad(az_start);
<a name="l00108"></a>00108   <span class="keywordflow">return</span> az_start;
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00112"></a><a class="code" href="classbsta__spherical__histogram.html#a237eb1b791307b3e4c52272eaefb52d0">00112</a> T <a class="code" href="classbsta__spherical__histogram.html#a237eb1b791307b3e4c52272eaefb52d0">bsta_spherical_histogram&lt;T&gt;::azimuth_range</a>()<span class="keyword"> const</span>
<a name="l00113"></a>00113 <span class="keyword"></span>{
<a name="l00114"></a>00114   <span class="keywordflow">if</span> (units_ == RADIANS)
<a name="l00115"></a>00115     <span class="keywordflow">return</span> deg_to_rad(azimuth_range_);
<a name="l00116"></a>00116   <span class="keywordflow">return</span> azimuth_range_;
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 <span class="comment">//: elevation bounds</span>
<a name="l00120"></a>00120 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00121"></a><a class="code" href="classbsta__spherical__histogram.html#ae2f39598c5fa9fc8ec0c3673ed5d6702">00121</a> T <a class="code" href="classbsta__spherical__histogram.html#ae2f39598c5fa9fc8ec0c3673ed5d6702" title="elevation bounds.">bsta_spherical_histogram&lt;T&gt;::elevation_start</a>()<span class="keyword"> const</span>
<a name="l00122"></a>00122 <span class="keyword"></span>{
<a name="l00123"></a>00123   T el_start = elevation_start_;
<a name="l00124"></a>00124   <span class="keywordflow">if</span> (el_poles_==B_90_90)
<a name="l00125"></a>00125     el_start = start_90_180(el_start, elevation_range_);
<a name="l00126"></a>00126   <span class="keywordflow">if</span> (units_ == RADIANS)
<a name="l00127"></a>00127     el_start = deg_to_rad(el_start);
<a name="l00128"></a>00128   <span class="keywordflow">return</span> el_start;
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00132"></a><a class="code" href="classbsta__spherical__histogram.html#a5b6898b7d29e2e16ae177ccaef7e49ab">00132</a> T <a class="code" href="classbsta__spherical__histogram.html#a5b6898b7d29e2e16ae177ccaef7e49ab">bsta_spherical_histogram&lt;T&gt;::elevation_range</a>()<span class="keyword"> const</span>
<a name="l00133"></a>00133 <span class="keyword"></span>{
<a name="l00134"></a>00134   <span class="keywordflow">if</span> (units_ == RADIANS)
<a name="l00135"></a>00135     <span class="keywordflow">return</span> deg_to_rad(elevation_range_);
<a name="l00136"></a>00136   <span class="keywordflow">return</span> elevation_range_;
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00140"></a><a class="code" href="classbsta__spherical__histogram.html#a1f8474ab0c851ab1e1657e811feb3168">00140</a> T <a class="code" href="classbsta__spherical__histogram.html#a1f8474ab0c851ab1e1657e811feb3168">bsta_spherical_histogram&lt;T&gt;::azimuth_center</a>(<span class="keywordtype">int</span> azimuth_index)<span class="keyword"> const</span>
<a name="l00141"></a>00141 <span class="keyword"></span>{
<a name="l00142"></a>00142   <span class="keywordtype">double</span> start = azimuth_index*delta_az_ + azimuth_start_;
<a name="l00143"></a>00143   <span class="keywordtype">double</span> end = start + delta_az_;
<a name="l00144"></a>00144   <span class="keywordtype">double</span> mid = 0.5*(start + end);
<a name="l00145"></a>00145   <span class="keywordflow">if</span> (mid&gt;=360.0)
<a name="l00146"></a>00146     mid -= 360.0;
<a name="l00147"></a>00147   <span class="keywordflow">if</span> (az_branch_cut_==B_180_180 &amp;&amp; mid &gt; 180.0)
<a name="l00148"></a>00148     mid -= 360.0;
<a name="l00149"></a>00149   T middle = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(mid);
<a name="l00150"></a>00150   <span class="keywordflow">if</span> (units_ == RADIANS)
<a name="l00151"></a>00151     <span class="keywordflow">return</span> deg_to_rad(middle);
<a name="l00152"></a>00152   <span class="keywordflow">return</span> middle;
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00156"></a><a class="code" href="classbsta__spherical__histogram.html#a23bbcbddcb9adb18df356a45352e0df4">00156</a> T <a class="code" href="classbsta__spherical__histogram.html#a23bbcbddcb9adb18df356a45352e0df4">bsta_spherical_histogram&lt;T&gt;::elevation_center</a>(<span class="keywordtype">int</span> elevation_index)<span class="keyword"> const</span>
<a name="l00157"></a>00157 <span class="keyword"></span>{
<a name="l00158"></a>00158   <span class="keywordtype">double</span> start = elevation_index*delta_el_;
<a name="l00159"></a>00159   <span class="keywordtype">double</span> end = start + delta_el_;
<a name="l00160"></a>00160   <span class="keywordtype">double</span> mid = 0.5*(start + end);
<a name="l00161"></a>00161   <span class="keywordflow">if</span> (el_poles_ == B_90_90)
<a name="l00162"></a>00162     mid = 90.0-mid;
<a name="l00163"></a>00163   T middle = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(mid);
<a name="l00164"></a>00164   <span class="keywordflow">if</span> (units_ == RADIANS)
<a name="l00165"></a>00165     <span class="keywordflow">return</span> deg_to_rad(middle);
<a name="l00166"></a>00166   <span class="keywordflow">return</span> middle;
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00170"></a>00170 <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#ab659b1799e917c37f865415b176afda3">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00171"></a><a class="code" href="classbsta__spherical__histogram.html#ab659b1799e917c37f865415b176afda3">00171</a> <a class="code" href="classbsta__spherical__histogram.html#ab659b1799e917c37f865415b176afda3">center</a>(<span class="keywordtype">int</span> linear_index, T&amp; az_center, T&amp; el_center)
<a name="l00172"></a>00172 {
<a name="l00173"></a>00173   <span class="comment">//convert linear_index to azimuth and elevation index</span>
<a name="l00174"></a>00174   <span class="keywordtype">int</span> el_index = linear_index/n_azimuth_;
<a name="l00175"></a>00175   <span class="keywordtype">int</span> az_index = linear_index%n_azimuth_;
<a name="l00176"></a>00176   az_center = azimuth_center(az_index);
<a name="l00177"></a>00177   el_center = elevation_center(el_index);
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00181"></a>00181 <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#a6aa759c0f40435e3568dd5999717efeb" title="convenient utilities.">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00182"></a><a class="code" href="classbsta__spherical__histogram.html#a6aa759c0f40435e3568dd5999717efeb">00182</a> <a class="code" href="classbsta__spherical__histogram.html#a6aa759c0f40435e3568dd5999717efeb" title="convenient utilities.">convert_to_cartesian</a>(T azimuth, T elevation, T&amp; x, T&amp; y, T&amp; z)<span class="keyword"> const</span>
<a name="l00183"></a>00183 <span class="keyword"></span>{
<a name="l00184"></a>00184   T az = azimuth, el=elevation;
<a name="l00185"></a>00185   <span class="keywordflow">if</span> (units_==DEG) {
<a name="l00186"></a>00186     az = deg_to_rad(az);
<a name="l00187"></a>00187     el = deg_to_rad(el);
<a name="l00188"></a>00188   }
<a name="l00189"></a>00189   <span class="comment">//convert to standard spherical coordinates if necessary</span>
<a name="l00190"></a>00190   <span class="keywordflow">if</span> (az_branch_cut_ == B_0_360)
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (az&gt;static_cast&lt;T&gt;(vnl_math::pi))
<a name="l00192"></a>00192       az -= <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(2.0*vnl_math::pi);
<a name="l00193"></a>00193   <span class="keywordflow">if</span> (el_poles_ == B_90_90)
<a name="l00194"></a>00194     el = -el + <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(vnl_math::pi/2.0);
<a name="l00195"></a>00195   <span class="comment">//convert to cartesian</span>
<a name="l00196"></a>00196   T s = vcl_sin(el);
<a name="l00197"></a>00197   x = s*vcl_cos(az);
<a name="l00198"></a>00198   y = s*vcl_sin(az);
<a name="l00199"></a>00199   z = vcl_cos(el);
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00203"></a>00203 <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#a6ab3d20df72a9618e3dfe879ad858bdf">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00204"></a><a class="code" href="classbsta__spherical__histogram.html#a6ab3d20df72a9618e3dfe879ad858bdf">00204</a> <a class="code" href="classbsta__spherical__histogram.html#a6ab3d20df72a9618e3dfe879ad858bdf">convert_to_spherical</a>(T x, T y, T z, T&amp; azimuth, T&amp; elevation)<span class="keyword"> const</span>
<a name="l00205"></a>00205 <span class="keyword"></span>{
<a name="l00206"></a>00206   <span class="comment">//internal representation is the standard spherical coordinate system</span>
<a name="l00207"></a>00207   <span class="comment">//azimuth 0-360, elevation 0-180 with North Pole elevation = 0</span>
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   <span class="keywordflow">if</span> (vcl_fabs(z-T(1))&lt;1e-8) {<span class="comment">//essentially at the North Pole</span>
<a name="l00210"></a>00210     azimuth = T(0);<span class="comment">//units don&#39;t matter since azimuth is ambiguous</span>
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (el_poles_ == B_90_90)
<a name="l00212"></a>00212       elevation = T(90);
<a name="l00213"></a>00213     <span class="keywordflow">else</span>
<a name="l00214"></a>00214       elevation = T(0);
<a name="l00215"></a>00215     <span class="keywordflow">if</span> (units_ == RADIANS)
<a name="l00216"></a>00216       elevation = deg_to_rad(elevation);
<a name="l00217"></a>00217     <span class="keywordflow">return</span>;
<a name="l00218"></a>00218   }
<a name="l00219"></a>00219   <span class="keywordflow">if</span> (vcl_fabs(z+T(1))&lt;1e-8) {<span class="comment">//essentially at the South Pole</span>
<a name="l00220"></a>00220     azimuth = T(0);<span class="comment">//units don&#39;t matter since azimuth is ambiguous</span>
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (el_poles_ == B_90_90)
<a name="l00222"></a>00222       elevation = -T(90);
<a name="l00223"></a>00223     <span class="keywordflow">else</span>
<a name="l00224"></a>00224       elevation = T(180);
<a name="l00225"></a>00225     <span class="keywordflow">if</span> (units_ == RADIANS)
<a name="l00226"></a>00226       elevation = deg_to_rad(elevation);
<a name="l00227"></a>00227     <span class="keywordflow">return</span>;
<a name="l00228"></a>00228   }
<a name="l00229"></a>00229   elevation = vcl_acos(z);
<a name="l00230"></a>00230   T s = vcl_sin(elevation);
<a name="l00231"></a>00231   T xa = x/s;
<a name="l00232"></a>00232   T ya = y/s;
<a name="l00233"></a>00233   azimuth = vcl_atan2(ya, xa);<span class="comment">//returns angles with +-180 branch cut</span>
<a name="l00234"></a>00234   <span class="keywordflow">if</span> (az_branch_cut_ == B_0_360)
<a name="l00235"></a>00235     <span class="keywordflow">if</span> (azimuth&lt;0) azimuth += <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(2.0*vnl_math::pi);
<a name="l00236"></a>00236   <span class="keywordflow">if</span> (el_poles_ == B_90_90)
<a name="l00237"></a>00237     elevation = -elevation + <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(0.5*vnl_math::pi);
<a name="l00238"></a>00238   <span class="keywordflow">if</span> (units_ == DEG) {
<a name="l00239"></a>00239     elevation = rad_to_deg(elevation);
<a name="l00240"></a>00240     azimuth = rad_to_deg(azimuth);
<a name="l00241"></a>00241   }
<a name="l00242"></a>00242   <span class="keywordflow">return</span>;
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00246"></a><a class="code" href="classbsta__spherical__histogram.html#a89c3119a6c464bce58a1625bd89027e9">00246</a> <span class="keywordtype">int</span> <a class="code" href="classbsta__spherical__histogram.html#a89c3119a6c464bce58a1625bd89027e9" title="indices for individual spherical coordinates.">bsta_spherical_histogram&lt;T&gt;::azimuth_index</a>(T azimuth)<span class="keyword"> const</span>
<a name="l00247"></a>00247 <span class="keyword"></span>{
<a name="l00248"></a>00248   <span class="keywordflow">if</span> (n_azimuth_==0) <span class="keywordflow">return</span> -1;
<a name="l00249"></a>00249   <span class="comment">//convert to degrees if necessary</span>
<a name="l00250"></a>00250   T conv_az = azimuth;
<a name="l00251"></a>00251   <span class="keywordflow">if</span> (units_==RADIANS)
<a name="l00252"></a>00252     conv_az = rad_to_deg(conv_az);
<a name="l00253"></a>00253   <span class="comment">//convert angle to 0/360 if necessary</span>
<a name="l00254"></a>00254   <span class="keywordflow">if</span> (az_branch_cut_ == B_180_180)
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (conv_az &lt; 0)
<a name="l00256"></a>00256       conv_az += T(360);
<a name="l00257"></a>00257   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i&lt;n_azimuth_; ++i) {
<a name="l00258"></a>00258     T start = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(i*delta_az_)+ azimuth_start_;
<a name="l00259"></a>00259     <span class="keywordflow">if</span> (in_interval(start, delta_az_, conv_az))
<a name="l00260"></a>00260     {
<a name="l00261"></a>00261       <span class="keywordflow">return</span> i;
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263   }
<a name="l00264"></a>00264   <span class="keywordflow">return</span> -1;
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00268"></a><a class="code" href="classbsta__spherical__histogram.html#a1ceb1664735c482336324f92fe09e2ae">00268</a> <span class="keywordtype">int</span> <a class="code" href="classbsta__spherical__histogram.html#a1ceb1664735c482336324f92fe09e2ae">bsta_spherical_histogram&lt;T&gt;::elevation_index</a>(T elevation)<span class="keyword"> const</span>
<a name="l00269"></a>00269 <span class="keyword"></span>{
<a name="l00270"></a>00270   <span class="keywordflow">if</span> (n_elevation_==0) <span class="keywordflow">return</span> -1;
<a name="l00271"></a>00271   <span class="comment">//convert to degrees if necessary</span>
<a name="l00272"></a>00272   T conv_el = elevation;
<a name="l00273"></a>00273   <span class="keywordflow">if</span> (units_==RADIANS)
<a name="l00274"></a>00274     conv_el = rad_to_deg(conv_el);
<a name="l00275"></a>00275   <span class="comment">//standardized elevation coordinates range from</span>
<a name="l00276"></a>00276   <span class="comment">// 0 (at North pole) to 180 at South pole</span>
<a name="l00277"></a>00277   <span class="keywordflow">if</span> (el_poles_ == B_90_90) {
<a name="l00278"></a>00278     conv_el = -conv_el + T(90);
<a name="l00279"></a>00279   }
<a name="l00280"></a>00280   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i&lt;n_elevation_; ++i)
<a name="l00281"></a>00281     <span class="keywordflow">if</span> (static_cast&lt;T&gt;((i+1)*delta_el_) + elevation_start_ &gt;= conv_el)
<a name="l00282"></a>00282     {
<a name="l00283"></a>00283       <span class="keywordflow">return</span> i;
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285   <span class="keywordflow">return</span> -1;
<a name="l00286"></a>00286 }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00289"></a>00289 <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#a34936b95208f11c0188280781be8e6f4">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00290"></a><a class="code" href="classbsta__spherical__histogram.html#a34936b95208f11c0188280781be8e6f4">00290</a> <a class="code" href="classbsta__spherical__histogram.html#a34936b95208f11c0188280781be8e6f4">azimuth_interval</a>(<span class="keywordtype">int</span> azimuth_index, T&amp; azimuth_start, T&amp; azimuth_range)<span class="keyword"> const</span>
<a name="l00291"></a>00291 <span class="keyword"></span>{
<a name="l00292"></a>00292   <span class="keywordflow">if</span> (n_azimuth_==0) {
<a name="l00293"></a>00293     azimuth_start = T(0);
<a name="l00294"></a>00294     azimuth_range = T(0);
<a name="l00295"></a>00295     <span class="keywordflow">return</span>;
<a name="l00296"></a>00296   }
<a name="l00297"></a>00297   T az_start = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(azimuth_index*delta_az_)+azimuth_start_;
<a name="l00298"></a>00298   <span class="comment">//if branch _180 need to shift min, max</span>
<a name="l00299"></a>00299   <span class="keywordflow">if</span> (az_branch_cut_ == B_180_180) {
<a name="l00300"></a>00300     <span class="keywordflow">if</span> (az_start &gt;= T(180))
<a name="l00301"></a>00301       az_start -= T(360);
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303   <span class="keywordflow">else</span>
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (az_start&gt;=T(360)) az_start -=T(360);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306   <span class="comment">// if radians</span>
<a name="l00307"></a>00307   <span class="keywordflow">if</span> (units_ == RADIANS) {
<a name="l00308"></a>00308     azimuth_start = deg_to_rad(az_start);
<a name="l00309"></a>00309     azimuth_range = deg_to_rad(delta_az_);
<a name="l00310"></a>00310     <span class="keywordflow">return</span>;
<a name="l00311"></a>00311   }
<a name="l00312"></a>00312   azimuth_start = az_start;
<a name="l00313"></a>00313   azimuth_range = delta_az_;
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00317"></a>00317 <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#ac38a50270309271fae7ad009db0bfb08">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00318"></a><a class="code" href="classbsta__spherical__histogram.html#ac38a50270309271fae7ad009db0bfb08">00318</a> <a class="code" href="classbsta__spherical__histogram.html#ac38a50270309271fae7ad009db0bfb08">elevation_interval</a>(<span class="keywordtype">int</span> elevation_index, T&amp; elevation_start, T&amp; elevation_range)<span class="keyword"> const</span>
<a name="l00319"></a>00319 <span class="keyword"></span>{
<a name="l00320"></a>00320   <span class="keywordflow">if</span> (n_elevation_==0) {
<a name="l00321"></a>00321     elevation_start = T(0);
<a name="l00322"></a>00322     elevation_range = T(0);
<a name="l00323"></a>00323     <span class="keywordflow">return</span>;
<a name="l00324"></a>00324   }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   T el_start = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(elevation_index*delta_el_);
<a name="l00327"></a>00327   <span class="keywordflow">if</span> (el_poles_ == B_90_90)
<a name="l00328"></a>00328     el_start = start_90_180(el_start, delta_el_);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330   <span class="keywordflow">if</span> (units_ == RADIANS) {
<a name="l00331"></a>00331     elevation_start  = deg_to_rad(el_start);
<a name="l00332"></a>00332     elevation_range  = deg_to_rad(delta_el_);
<a name="l00333"></a>00333     <span class="keywordflow">return</span>;
<a name="l00334"></a>00334   }
<a name="l00335"></a>00335   elevation_start = el_start;
<a name="l00336"></a>00336   elevation_range = delta_el_;
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00340"></a>00340 <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#aa0488310d1460f3051a99aea32aa7a09" title="increment the count in a given bin by mag.">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00341"></a><a class="code" href="classbsta__spherical__histogram.html#aa0488310d1460f3051a99aea32aa7a09">00341</a> <a class="code" href="classbsta__spherical__histogram.html#aa0488310d1460f3051a99aea32aa7a09" title="increment the count in a given bin by mag.">upcount</a>(T azimuth, T elevation, T mag)
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343   <span class="keywordtype">int</span> az_indx = azimuth_index(azimuth);
<a name="l00344"></a>00344   <span class="keywordtype">int</span> el_indx = elevation_index(elevation);
<a name="l00345"></a>00345   <span class="keywordtype">int</span> lidx = linear_index(az_indx, el_indx);
<a name="l00346"></a>00346   <span class="keywordflow">if</span> (!counts_[lidx])
<a name="l00347"></a>00347     counts_[lidx]=T(0);
<a name="l00348"></a>00348   counts_[lidx]+=mag;
<a name="l00349"></a>00349   total_counts_valid_ = <span class="keyword">false</span>;
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00353"></a>00353 <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#a926e279b6ab9f57f3cbaadb40fd4299f" title="weight the increment by spherical area of the bin, i.e. mag/sin(el).">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00354"></a><a class="code" href="classbsta__spherical__histogram.html#a926e279b6ab9f57f3cbaadb40fd4299f">00354</a> <a class="code" href="classbsta__spherical__histogram.html#a926e279b6ab9f57f3cbaadb40fd4299f" title="weight the increment by spherical area of the bin, i.e. mag/sin(el).">upcount_weighted_by_area</a>(T azimuth, T elevation, T mag)
<a name="l00355"></a>00355 {
<a name="l00356"></a>00356   <span class="keywordtype">int</span> el_indx = elevation_index(elevation);
<a name="l00357"></a>00357   <span class="keywordtype">double</span> ecnt = elevation_center(el_indx);
<a name="l00358"></a>00358   T s = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(vcl_fabs(vcl_sin(ecnt)));
<a name="l00359"></a>00359   <span class="keywordflow">if</span> (s&gt;0)
<a name="l00360"></a>00360     mag /= s;
<a name="l00361"></a>00361   upcount(azimuth, elevation, mag);
<a name="l00362"></a>00362 }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00365"></a><a class="code" href="classbsta__spherical__histogram.html#a02ce4f9fe67af4198470551a848ccdf4">00365</a> T <a class="code" href="classbsta__spherical__histogram.html#a02ce4f9fe67af4198470551a848ccdf4" title="total number of counts, cached so non-const.">bsta_spherical_histogram&lt;T&gt;::total_counts</a>()
<a name="l00366"></a>00366 {
<a name="l00367"></a>00367   <span class="keywordflow">if</span> (!total_counts_valid_) {
<a name="l00368"></a>00368     total_counts_ = T(0);
<a name="l00369"></a>00369     <span class="keyword">typename</span> vcl_map&lt;int, T&gt;::iterator cit = counts_.begin();
<a name="l00370"></a>00370     <span class="keywordflow">for</span> (; cit != counts_.end(); ++cit)
<a name="l00371"></a>00371       total_counts_ += (*cit).second;
<a name="l00372"></a>00372     total_counts_valid_ = <span class="keyword">true</span>;
<a name="l00373"></a>00373   }
<a name="l00374"></a>00374   <span class="keywordflow">return</span> total_counts_;
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00378"></a><a class="code" href="classbsta__spherical__histogram.html#ac1af7b41faadcd79748707ebad9e2003">00378</a> T <a class="code" href="classbsta__spherical__histogram.html#ac1af7b41faadcd79748707ebad9e2003" title="probability of a bin.">bsta_spherical_histogram&lt;T&gt;::p</a>(<span class="keywordtype">int</span> azimuth_index, <span class="keywordtype">int</span> elevation_index)
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380   T tcnts = this-&gt;total_counts();
<a name="l00381"></a>00381   <span class="keywordflow">if</span> (tcnts == T(0)) <span class="keywordflow">return</span> T(0);
<a name="l00382"></a>00382   <span class="keywordflow">if</span> (elevation_index&lt;0||elevation_index&gt;=static_cast&lt;int&gt;(n_elevation())||
<a name="l00383"></a>00383      azimuth_index&lt;0||azimuth_index&gt;=static_cast&lt;int&gt;(n_azimuth()))
<a name="l00384"></a>00384     <span class="keywordflow">return</span> T(0);
<a name="l00385"></a>00385   <span class="keywordtype">int</span> lidx = linear_index(azimuth_index, elevation_index);
<a name="l00386"></a>00386   <span class="keywordflow">if</span> (!counts_[lidx])
<a name="l00387"></a>00387     <span class="keywordflow">return</span> 0;
<a name="l00388"></a>00388   <span class="keywordflow">return</span> counts_[lidx]/tcnts;
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00392"></a><a class="code" href="classbsta__spherical__histogram.html#a4091289c1c7b4be189c21e9e648a979a">00392</a> <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#a4091289c1c7b4be189c21e9e648a979a" title="mean of histogram distribution.">bsta_spherical_histogram&lt;T&gt;::mean</a>(T&amp; mean_az, T&amp; mean_el)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394   <span class="comment">//define mean as the average Cartesian unit vector for the</span>
<a name="l00395"></a>00395   <span class="comment">//unit vectors corresponding to the centers of the occupied bins</span>
<a name="l00396"></a>00396   <span class="keywordtype">double</span> mean_x = 0.0, mean_y = 0.0, mean_z = 0.0;
<a name="l00397"></a>00397   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> el = 0; el&lt;static_cast&lt;int&gt;(n_elevation_); ++el) {
<a name="l00398"></a>00398     T ec = elevation_center(el);
<a name="l00399"></a>00399     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> az = 0; az&lt;static_cast&lt;int&gt;(n_azimuth_); ++az) {
<a name="l00400"></a>00400       T ac = azimuth_center(az);
<a name="l00401"></a>00401       T x, y, z;
<a name="l00402"></a>00402       convert_to_cartesian(ac, ec, x, y, z);
<a name="l00403"></a>00403       T pc = p(az, el);
<a name="l00404"></a>00404       mean_x  += pc*x;      mean_y  += pc*y;       mean_z  += pc*z;
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406   }
<a name="l00407"></a>00407   <span class="keywordtype">double</span> length = vcl_sqrt(mean_x*mean_x + mean_y*mean_y + mean_z*mean_z);
<a name="l00408"></a>00408   <span class="keywordflow">if</span> (length&lt;1.0e-8) {
<a name="l00409"></a>00409     mean_az = 0;
<a name="l00410"></a>00410     mean_el = 0;
<a name="l00411"></a>00411     <span class="keywordflow">return</span>;
<a name="l00412"></a>00412   }
<a name="l00413"></a>00413   mean_x /= length;   mean_y /= length;   mean_z /= length;
<a name="l00414"></a>00414   convert_to_spherical(static_cast&lt;T&gt;(mean_x), static_cast&lt;T&gt;(mean_y),
<a name="l00415"></a>00415                        static_cast&lt;T&gt;(mean_z), mean_az, mean_el);
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00419"></a><a class="code" href="classbsta__spherical__histogram.html#ab5116c1963a5a69d8759841c7fdcffd4">00419</a> vnl_matrix_fixed&lt;T, 2, 2&gt; <a class="code" href="classbsta__spherical__histogram.html#ab5116c1963a5a69d8759841c7fdcffd4" title="covariance matrix of histogram cvar = [(az-mu_az)][(az-mu_az) (el-mu_el)].">bsta_spherical_histogram&lt;T&gt;::covariance_matrix</a>()
<a name="l00420"></a>00420 {
<a name="l00421"></a>00421   <span class="keywordtype">double</span> mean_x = T(0), mean_y = T(0) , mean_z = T(0);
<a name="l00422"></a>00422   T two_pi = T(360);
<a name="l00423"></a>00423   <span class="keywordflow">if</span> (units_ == RADIANS)
<a name="l00424"></a>00424     two_pi = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(2.0*vnl_math::pi);
<a name="l00425"></a>00425   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> el = 0; el&lt;static_cast&lt;int&gt;(n_elevation_); ++el) {
<a name="l00426"></a>00426     T ec = elevation_center(el);
<a name="l00427"></a>00427     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> az = 0; az&lt;static_cast&lt;int&gt;(n_azimuth_); ++az) {
<a name="l00428"></a>00428       T pc = p(az, el);
<a name="l00429"></a>00429       <span class="keywordflow">if</span> (pc==T(0)) <span class="keywordflow">continue</span>;
<a name="l00430"></a>00430       T ac = azimuth_center(az);
<a name="l00431"></a>00431       T x, y, z;
<a name="l00432"></a>00432       convert_to_cartesian(ac, ec, x, y, z);
<a name="l00433"></a>00433       mean_x  += pc*x;      mean_y  += pc*y;  mean_z  += pc*z;
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435   }
<a name="l00436"></a>00436   <span class="keywordtype">double</span> length = vcl_sqrt(mean_x*mean_x + mean_y*mean_y + mean_z*mean_z);
<a name="l00437"></a>00437   <span class="keywordflow">if</span> (length&lt;1.0e-8)
<a name="l00438"></a>00438     <span class="keywordflow">return</span> vnl_matrix_fixed&lt;T, 2 ,2&gt; ();
<a name="l00439"></a>00439   mean_x /= length;   mean_y /= length;   mean_z /= length;
<a name="l00440"></a>00440   T mean_az, mean_el;
<a name="l00441"></a>00441   convert_to_spherical(static_cast&lt;T&gt;(mean_x), static_cast&lt;T&gt;(mean_y),
<a name="l00442"></a>00442                        static_cast&lt;T&gt;(mean_z), mean_az, mean_el);
<a name="l00443"></a>00443   T caz=T(0), caz_el=T(0), cel=T(0);
<a name="l00444"></a>00444   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> el = 0; el&lt;static_cast&lt;int&gt;(n_elevation_); ++el) {
<a name="l00445"></a>00445     T ec = elevation_center(el);
<a name="l00446"></a>00446     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> az = 0; az&lt;static_cast&lt;int&gt;(n_azimuth_); ++az)
<a name="l00447"></a>00447     {
<a name="l00448"></a>00448       T pc = p(az, el);
<a name="l00449"></a>00449       <span class="keywordflow">if</span> (pc==T(0)) <span class="keywordflow">continue</span>;
<a name="l00450"></a>00450       T ac = azimuth_center(az);
<a name="l00451"></a>00451       T delta_el = (ec-mean_el);
<a name="l00452"></a>00452       cel += pc*delta_el*delta_el;
<a name="l00453"></a>00453       T delta_az = azimuth_diff(mean_az, ac, two_pi);
<a name="l00454"></a>00454       caz_el += pc*(ec-mean_el)*delta_az;
<a name="l00455"></a>00455       caz += pc*delta_az*delta_az;
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457   }
<a name="l00458"></a>00458   vnl_matrix_fixed&lt;T, 2, 2&gt; ret;
<a name="l00459"></a>00459   ret[0][0] = caz; ret[0][1]=caz_el; ret[1][0]=ret[0][1]; ret[1][1]=cel;
<a name="l00460"></a>00460   <span class="keywordflow">return</span> ret;
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00464"></a><a class="code" href="classbsta__spherical__histogram.html#a4c822c45f0f30ed866d8a11c26703a0e">00464</a> <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#a4c822c45f0f30ed866d8a11c26703a0e" title="marginal standard deviations.">bsta_spherical_histogram&lt;T&gt;::std_dev</a>(T&amp; std_dev_az, T&amp; std_dev_el)
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466   vnl_matrix_fixed&lt;T, 2, 2&gt; covar = covariance_matrix();
<a name="l00467"></a>00467   <span class="keywordtype">double</span> var_az = covar[0][0], var_el = covar[1][1];
<a name="l00468"></a>00468   std_dev_az = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(vcl_sqrt(var_az));
<a name="l00469"></a>00469   std_dev_el = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(vcl_sqrt(var_el));
<a name="l00470"></a>00470 }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00473"></a>00473 vcl_vector&lt;int&gt; <a class="code" href="classbsta__spherical__histogram.html#ab708d581ec54e5d4e501a7cf659e0ed5" title="linear index of bins which have centers lying inside the cone.">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00474"></a><a class="code" href="classbsta__spherical__histogram.html#ab708d581ec54e5d4e501a7cf659e0ed5">00474</a> <a class="code" href="classbsta__spherical__histogram.html#ab708d581ec54e5d4e501a7cf659e0ed5" title="linear index of bins which have centers lying inside the cone.">bins_intersecting_cone</a>(T center_az, T center_el, T cone_half_angle)
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476   vcl_vector&lt;int&gt; ret;
<a name="l00477"></a>00477   T xc, yc ,zc;
<a name="l00478"></a>00478   convert_to_cartesian(center_az, center_el, xc, yc, zc);
<a name="l00479"></a>00479   vnl_vector&lt;double&gt; cone_axis(3);
<a name="l00480"></a>00480   cone_axis[0]=xc; cone_axis[1]=yc; cone_axis[2]=zc;
<a name="l00481"></a>00481   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> az = 0; az&lt;int(n_azimuth_); ++az)
<a name="l00482"></a>00482     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> el = 0; el&lt;int(n_elevation_); ++el) {
<a name="l00483"></a>00483       T azc = azimuth_center(az), elc = elevation_center(el);
<a name="l00484"></a>00484       T xb, yb, zb;
<a name="l00485"></a>00485       convert_to_cartesian(azc, elc, xb, yb, zb);
<a name="l00486"></a>00486       vnl_vector&lt;double&gt; bin_vector(3);
<a name="l00487"></a>00487       bin_vector[0]=xb; bin_vector[1]=yb; bin_vector[2]=zb;
<a name="l00488"></a>00488       <span class="keywordtype">double</span> ang = angle(cone_axis, bin_vector);
<a name="l00489"></a>00489       <span class="keywordflow">if</span> (units_ == DEG)
<a name="l00490"></a>00490         ang = rad_to_deg(static_cast&lt;T&gt;(ang));
<a name="l00491"></a>00491       <span class="keywordflow">if</span> (vcl_fabs(ang)&lt;=cone_half_angle)
<a name="l00492"></a>00492         ret.push_back(linear_index(az, el));
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494   <span class="keywordflow">return</span> ret;
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00498"></a>00498 <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#a2313a985166ed72897a0fe05c2a48352" title="output of bin ranges and counts (zero counts not output).">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00499"></a><a class="code" href="classbsta__spherical__histogram.html#a2313a985166ed72897a0fe05c2a48352">00499</a> <a class="code" href="classbsta__spherical__histogram.html#a2313a985166ed72897a0fe05c2a48352" title="output of bin ranges and counts (zero counts not output).">write_counts_with_interval</a>(vcl_ostream&amp; os, <span class="keywordtype">int</span> azimuth_index,
<a name="l00500"></a>00500                            <span class="keywordtype">int</span> elevation_index) {
<a name="l00501"></a>00501   T az_start, az_range, el_start, el_range;
<a name="l00502"></a>00502   <span class="keywordtype">int</span> lidx = linear_index(azimuth_index,elevation_index);
<a name="l00503"></a>00503   T cnts = counts_[lidx];
<a name="l00504"></a>00504   <span class="keywordflow">if</span> (!(cnts&gt;T(0))) <span class="keywordflow">return</span>;
<a name="l00505"></a>00505   azimuth_interval(azimuth_index, az_start, az_range);
<a name="l00506"></a>00506   elevation_interval(elevation_index, el_start, el_range);
<a name="l00507"></a>00507   os &lt;&lt; <span class="stringliteral">&quot;az(s:&quot;</span>&lt;&lt; az_start &lt;&lt; <span class="stringliteral">&quot; int:&quot;</span> &lt;&lt; az_range &lt;&lt; <span class="stringliteral">&quot;):el(s:&quot;</span>
<a name="l00508"></a>00508      &lt;&lt; el_start &lt;&lt; <span class="stringliteral">&quot; int:&quot;</span> &lt;&lt; el_range &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
<a name="l00509"></a>00509      &lt;&lt; cnts &lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00513"></a>00513 <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#ab6b23c656b5eb93088279df623b126d4" title="output of bin center and counts (zero counts not output).">bsta_spherical_histogram&lt;T&gt;::</a>
<a name="l00514"></a><a class="code" href="classbsta__spherical__histogram.html#ab6b23c656b5eb93088279df623b126d4">00514</a> <a class="code" href="classbsta__spherical__histogram.html#ab6b23c656b5eb93088279df623b126d4" title="output of bin center and counts (zero counts not output).">write_counts_with_center</a>(vcl_ostream&amp; os, <span class="keywordtype">int</span> azimuth_index,
<a name="l00515"></a>00515                          <span class="keywordtype">int</span> elevation_index) {
<a name="l00516"></a>00516   <span class="keywordtype">int</span> lidx = linear_index(azimuth_index,elevation_index);
<a name="l00517"></a>00517   T cnts = counts_[lidx];
<a name="l00518"></a>00518   <span class="keywordflow">if</span> (!(cnts&gt;T(0))) <span class="keywordflow">return</span>;
<a name="l00519"></a>00519   T az_center = azimuth_center(azimuth_index);
<a name="l00520"></a>00520   T el_center = elevation_center(elevation_index);
<a name="l00521"></a>00521   os &lt;&lt; az_center &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; el_center &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; cnts &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00525"></a><a class="code" href="classbsta__spherical__histogram.html#a50cbe87a95fc3f136e0b4e0235cb9c58">00525</a> <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#a50cbe87a95fc3f136e0b4e0235cb9c58" title="write bin centers (azimuth elevation) and non_zero counts to stream.">bsta_spherical_histogram&lt;T&gt;::print_to_text</a>(vcl_ostream&amp; os)
<a name="l00526"></a>00526 {
<a name="l00527"></a>00527   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> el = 0; el&lt;n_elevation(); ++el)
<a name="l00528"></a>00528     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> az = 0; az&lt;n_azimuth(); ++az)
<a name="l00529"></a>00529       this-&gt;write_counts_with_center(os, az, el);
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00533"></a><a class="code" href="classbsta__spherical__histogram.html#a2831d1d1842c691d295889476e134bd3">00533</a> <span class="keywordtype">void</span> <a class="code" href="classbsta__spherical__histogram.html#a2831d1d1842c691d295889476e134bd3" title="display counts in vrml with reference sphere.">bsta_spherical_histogram&lt;T&gt;::print_to_vrml</a>(vcl_ostream&amp; os,
<a name="l00534"></a>00534                                                 T transparency)
<a name="l00535"></a>00535 {
<a name="l00536"></a>00536   os &lt;&lt; <span class="stringliteral">&quot;#VRML V2.0 utf8\n&quot;</span>
<a name="l00537"></a>00537      &lt;&lt; <span class="stringliteral">&quot;Background {\n&quot;</span>
<a name="l00538"></a>00538      &lt;&lt; <span class="stringliteral">&quot;  skyColor [ 0 0 0 ]\n&quot;</span>
<a name="l00539"></a>00539      &lt;&lt; <span class="stringliteral">&quot;  groundColor [ 0 0 0 ]\n&quot;</span>
<a name="l00540"></a>00540      &lt;&lt; <span class="stringliteral">&quot;}\n&quot;</span>
<a name="l00541"></a>00541      &lt;&lt; <span class="stringliteral">&quot;PointLight {\n&quot;</span>
<a name="l00542"></a>00542      &lt;&lt; <span class="stringliteral">&quot;  on FALSE\n&quot;</span>
<a name="l00543"></a>00543      &lt;&lt; <span class="stringliteral">&quot;  intensity 1\n&quot;</span>
<a name="l00544"></a>00544      &lt;&lt; <span class="stringliteral">&quot;ambientIntensity 0\n&quot;</span>
<a name="l00545"></a>00545      &lt;&lt; <span class="stringliteral">&quot;color 1 1 1\n&quot;</span>
<a name="l00546"></a>00546      &lt;&lt; <span class="stringliteral">&quot;location 0 0 0\n&quot;</span>
<a name="l00547"></a>00547      &lt;&lt; <span class="stringliteral">&quot;attenuation 1 0 0\n&quot;</span>
<a name="l00548"></a>00548      &lt;&lt; <span class="stringliteral">&quot;radius 100\n&quot;</span>
<a name="l00549"></a>00549      &lt;&lt; <span class="stringliteral">&quot;}\n&quot;</span>;
<a name="l00550"></a>00550     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> az = 0; az&lt;int(n_azimuth_); ++az)
<a name="l00551"></a>00551       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> el = 0; el&lt;int(n_elevation_); ++el) {
<a name="l00552"></a>00552         T cnts = counts(az, el);
<a name="l00553"></a>00553         <span class="keywordflow">if</span> (cnts&gt;0) {
<a name="l00554"></a>00554           T azc = azimuth_center(az), elc = elevation_center(el);
<a name="l00555"></a>00555           T x, y, z;
<a name="l00556"></a>00556           convert_to_cartesian(azc, elc, x, y, z);
<a name="l00557"></a>00557           os&lt;&lt; <span class="stringliteral">&quot;Transform {\n&quot;</span>
<a name="l00558"></a>00558             &lt;&lt; <span class="stringliteral">&quot;translation &quot;</span> &lt;&lt; x &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; y &lt;&lt; <span class="charliteral">&#39; &#39;</span>
<a name="l00559"></a>00559             &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; z &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00560"></a>00560             &lt;&lt; <span class="stringliteral">&quot;children [\n&quot;</span>
<a name="l00561"></a>00561             &lt;&lt; <span class="stringliteral">&quot;Shape {\n&quot;</span>
<a name="l00562"></a>00562             &lt;&lt; <span class="stringliteral">&quot; appearance Appearance{\n&quot;</span>
<a name="l00563"></a>00563             &lt;&lt; <span class="stringliteral">&quot;   material Material\n&quot;</span>
<a name="l00564"></a>00564             &lt;&lt; <span class="stringliteral">&quot;    {\n&quot;</span>
<a name="l00565"></a>00565             &lt;&lt; <span class="stringliteral">&quot;      diffuseColor &quot;</span> &lt;&lt; 1 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; 1 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; 0 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00566"></a>00566             &lt;&lt; <span class="stringliteral">&quot;      transparency &quot;</span> &lt;&lt; transparency &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00567"></a>00567             &lt;&lt; <span class="stringliteral">&quot;    }\n&quot;</span>
<a name="l00568"></a>00568             &lt;&lt; <span class="stringliteral">&quot;  }\n&quot;</span>
<a name="l00569"></a>00569             &lt;&lt; <span class="stringliteral">&quot; geometry Sphere\n&quot;</span>
<a name="l00570"></a>00570             &lt;&lt;   <span class="stringliteral">&quot;{\n&quot;</span>
<a name="l00571"></a>00571             &lt;&lt; <span class="stringliteral">&quot;  radius &quot;</span> &lt;&lt; p(az, el) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00572"></a>00572             &lt;&lt;  <span class="stringliteral">&quot;   }\n&quot;</span>
<a name="l00573"></a>00573             &lt;&lt;  <span class="stringliteral">&quot;  }\n&quot;</span>
<a name="l00574"></a>00574             &lt;&lt;  <span class="stringliteral">&quot; ]\n&quot;</span>
<a name="l00575"></a>00575             &lt;&lt; <span class="stringliteral">&quot;}\n&quot;</span>;
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577       }
<a name="l00578"></a>00578   os &lt;&lt; <span class="stringliteral">&quot;Transform {\n&quot;</span>
<a name="l00579"></a>00579      &lt;&lt; <span class="stringliteral">&quot;translation &quot;</span> &lt;&lt; 0 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; 0 &lt;&lt; <span class="charliteral">&#39; &#39;</span>
<a name="l00580"></a>00580      &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; 0 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00581"></a>00581      &lt;&lt; <span class="stringliteral">&quot;children [\n&quot;</span>
<a name="l00582"></a>00582      &lt;&lt; <span class="stringliteral">&quot;Shape {\n&quot;</span>
<a name="l00583"></a>00583      &lt;&lt; <span class="stringliteral">&quot; appearance Appearance{\n&quot;</span>
<a name="l00584"></a>00584      &lt;&lt; <span class="stringliteral">&quot;   material Material\n&quot;</span>
<a name="l00585"></a>00585      &lt;&lt; <span class="stringliteral">&quot;    {\n&quot;</span>
<a name="l00586"></a>00586      &lt;&lt; <span class="stringliteral">&quot;      diffuseColor &quot;</span> &lt;&lt; 0 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; 1 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; 0 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00587"></a>00587      &lt;&lt; <span class="stringliteral">&quot;      transparency &quot;</span> &lt;&lt; 0 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00588"></a>00588      &lt;&lt; <span class="stringliteral">&quot;    }\n&quot;</span>
<a name="l00589"></a>00589      &lt;&lt; <span class="stringliteral">&quot;  }\n&quot;</span>
<a name="l00590"></a>00590      &lt;&lt; <span class="stringliteral">&quot; geometry Sphere\n&quot;</span>
<a name="l00591"></a>00591      &lt;&lt;   <span class="stringliteral">&quot;{\n&quot;</span>
<a name="l00592"></a>00592      &lt;&lt; <span class="stringliteral">&quot;  radius &quot;</span> &lt;&lt; 0.95 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00593"></a>00593      &lt;&lt;  <span class="stringliteral">&quot;   }\n&quot;</span>
<a name="l00594"></a>00594      &lt;&lt;  <span class="stringliteral">&quot;  }\n&quot;</span>
<a name="l00595"></a>00595      &lt;&lt;  <span class="stringliteral">&quot; ]\n&quot;</span>
<a name="l00596"></a>00596      &lt;&lt; <span class="stringliteral">&quot;}\n&quot;</span>;
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 <span class="comment">//: Write to stream</span>
<a name="l00600"></a>00600 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00601"></a><a class="code" href="bsta__spherical__histogram_8txx.html#a5580a463c1de7ebfd1d4d828ee1018f4">00601</a> vcl_ostream&amp; operator&lt;&lt;(vcl_ostream&amp; s, bsta_spherical_histogram&lt;T&gt; <span class="keyword">const</span>&amp; h)
<a name="l00602"></a>00602 {
<a name="l00603"></a>00603   <a class="code" href="classbsta__spherical__histogram.html" title="A histogram on the unit sphere.">bsta_spherical_histogram&lt;T&gt;</a>&amp; nch = <span class="keyword">const_cast&lt;</span><a class="code" href="classbsta__spherical__histogram.html" title="A histogram on the unit sphere.">bsta_spherical_histogram&lt;T&gt;</a>&amp;<span class="keyword">&gt;</span>(h);
<a name="l00604"></a>00604   s &lt;&lt; <span class="stringliteral">&quot;bsta_spherical_histogram&lt;T&gt; ==&gt;\n&quot;</span>;
<a name="l00605"></a>00605   <span class="keywordflow">if</span> (h.units() == <a class="code" href="classbsta__spherical__histogram.html" title="A histogram on the unit sphere.">bsta_spherical_histogram&lt;T&gt;::RADIANS</a>)
<a name="l00606"></a>00606     s &lt;&lt; <span class="stringliteral">&quot;units: radians\n&quot;</span>;
<a name="l00607"></a>00607   <span class="keywordflow">else</span> s &lt;&lt; <span class="stringliteral">&quot;units: degrees\n&quot;</span>;
<a name="l00608"></a>00608   s &lt;&lt; <span class="stringliteral">&quot;n_bins_azimuth: &quot;</span> &lt;&lt; h.<a class="code" href="classbsta__spherical__histogram.html#a6d267866e0efab0bf072baa07b156bf7" title="number of bins allowed.">n_azimuth</a>() &lt;&lt; <span class="stringliteral">&quot; n_bins_elevation: &quot;</span>
<a name="l00609"></a>00609     &lt;&lt; h.n_elevation() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00610"></a>00610     &lt;&lt; <span class="stringliteral">&quot;azimuth(start: &quot;</span> &lt;&lt; h.azimuth_start() &lt;&lt;<span class="stringliteral">&quot; interval: &quot;</span> &lt;&lt; h.azimuth_range()&lt;&lt; <span class="stringliteral">&quot; )\n&quot;</span>
<a name="l00611"></a>00611     &lt;&lt; <span class="stringliteral">&quot;elevation(start: &quot;</span>&lt;&lt; h.elevation_start()&lt;&lt;<span class="stringliteral">&quot; interval: &quot;</span> &lt;&lt; h.elevation_range()&lt;&lt;<span class="stringliteral">&quot; )\n&quot;</span>;
<a name="l00612"></a>00612   <span class="keywordflow">if</span> (h.azimuth_branch_cut() == <a class="code" href="classbsta__spherical__histogram.html" title="A histogram on the unit sphere.">bsta_spherical_histogram&lt;T&gt;::B_0_360</a>) {
<a name="l00613"></a>00613     <span class="keywordflow">if</span> (h.units() == <a class="code" href="classbsta__spherical__histogram.html" title="A histogram on the unit sphere.">bsta_spherical_histogram&lt;T&gt;::RADIANS</a>)
<a name="l00614"></a>00614       s &lt;&lt; <span class="stringliteral">&quot;azimuth branch cut: 0/2*PI\n&quot;</span>;
<a name="l00615"></a>00615     <span class="keywordflow">else</span>
<a name="l00616"></a>00616       s &lt;&lt; <span class="stringliteral">&quot;azimuth branch cut: 0/360\n&quot;</span>;
<a name="l00617"></a>00617   }
<a name="l00618"></a>00618   <span class="keywordflow">else</span> {
<a name="l00619"></a>00619     <span class="keywordflow">if</span> (h.units() == <a class="code" href="classbsta__spherical__histogram.html" title="A histogram on the unit sphere.">bsta_spherical_histogram&lt;T&gt;::RADIANS</a>)
<a name="l00620"></a>00620       s &lt;&lt; <span class="stringliteral">&quot;azimuth branch cut: -PI/PI\n&quot;</span>;
<a name="l00621"></a>00621     <span class="keywordflow">else</span>
<a name="l00622"></a>00622       s &lt;&lt; <span class="stringliteral">&quot;azimuth branch cut: -180/180\n&quot;</span>;
<a name="l00623"></a>00623   }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625   <span class="keywordflow">if</span> (h.elevation_poles() == <a class="code" href="classbsta__spherical__histogram.html" title="A histogram on the unit sphere.">bsta_spherical_histogram&lt;T&gt;::B_90_90</a>) {
<a name="l00626"></a>00626     <span class="keywordflow">if</span> (h.units()==<a class="code" href="classbsta__spherical__histogram.html" title="A histogram on the unit sphere.">bsta_spherical_histogram&lt;T&gt;::RADIANS</a>)
<a name="l00627"></a>00627       s &lt;&lt; <span class="stringliteral">&quot;south pole: -PI/2  north_pole: PI\n&quot;</span>;
<a name="l00628"></a>00628     <span class="keywordflow">else</span>
<a name="l00629"></a>00629       s &lt;&lt; <span class="stringliteral">&quot;south pole: -90  north_pole: 90\n&quot;</span>;
<a name="l00630"></a>00630   }
<a name="l00631"></a>00631   <span class="keywordflow">else</span> {
<a name="l00632"></a>00632     <span class="keywordflow">if</span> (h.units()==<a class="code" href="classbsta__spherical__histogram.html" title="A histogram on the unit sphere.">bsta_spherical_histogram&lt;T&gt;::RADIANS</a>)
<a name="l00633"></a>00633       s &lt;&lt; <span class="stringliteral">&quot;south pole: PI  north_pole: 0\n&quot;</span>;
<a name="l00634"></a>00634     <span class="keywordflow">else</span>
<a name="l00635"></a>00635       s &lt;&lt; <span class="stringliteral">&quot;south pole: 180  north_pole: 0\n&quot;</span>;
<a name="l00636"></a>00636   }
<a name="l00637"></a>00637   s &lt;&lt; <span class="stringliteral">&quot;-- counts --\n&quot;</span>;
<a name="l00638"></a>00638   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> r = 0; r&lt;h.n_elevation(); ++r)
<a name="l00639"></a>00639     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> c = 0; c&lt;h.n_azimuth(); ++c)
<a name="l00640"></a>00640       nch.<a class="code" href="classbsta__spherical__histogram.html#a2313a985166ed72897a0fe05c2a48352" title="output of bin ranges and counts (zero counts not output).">write_counts_with_interval</a>(s, c, r);
<a name="l00641"></a>00641   <span class="keywordflow">return</span> s;
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="comment">//: Read from stream</span>
<a name="l00645"></a>00645 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00646"></a><a class="code" href="bsta__spherical__histogram_8txx.html#adbb69474822978dcc78163414e8c8fa2">00646</a> vcl_istream&amp; <a class="code" href="classbsta__histogram.html#a010dd42fa4b1cee167105abf18551630" title="Read histogram from stream.">operator&gt;&gt;</a>(vcl_istream&amp; is, <a class="code" href="classbsta__spherical__histogram.html" title="A histogram on the unit sphere.">bsta_spherical_histogram&lt;T&gt;</a>&amp; h)
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648   <span class="keywordflow">return</span> is;
<a name="l00649"></a>00649 }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 <span class="preprocessor">#undef BSTA_SPHERICAL_HISTOGRAM_INSTANTIATE</span>
<a name="l00652"></a><a class="code" href="bsta__spherical__histogram_8txx.html#a450a7bc3f462f44341bc4c48a8bae4b1">00652</a> <span class="preprocessor"></span><span class="preprocessor">#define BSTA_SPHERICAL_HISTOGRAM_INSTANTIATE(T) \</span>
<a name="l00653"></a>00653 <span class="preprocessor">template class bsta_spherical_histogram&lt;T &gt;;\</span>
<a name="l00654"></a>00654 <span class="preprocessor">template vcl_istream&amp; operator&gt;&gt;(vcl_istream&amp;, bsta_spherical_histogram&lt;T &gt;&amp;);\</span>
<a name="l00655"></a>00655 <span class="preprocessor">template vcl_ostream&amp; operator&lt;&lt;(vcl_ostream&amp;, bsta_spherical_histogram&lt;T &gt; const&amp;)</span>
<a name="l00656"></a>00656 <span class="preprocessor"></span>
<a name="l00657"></a>00657 <span class="preprocessor">#endif // bsta_spherical_histogram_txx_</span>
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 1 2013 17:38:51 for contrib/brl/bbas/bsta by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
