<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>contrib/brl/bbas/imesh/algo/imesh_pca.cxx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">contrib/brl/bbas/imesh/algo/imesh_pca.cxx</div>  </div>
</div>
<div class="contents">
<a href="imesh__pca_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// This is brl/bbas/imesh/algo/imesh_pca.cxx</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;<a class="code" href="imesh__pca_8h.html" title="Mesh PCA parameterization.">imesh_pca.h</a>&quot;</span>
<a name="l00003"></a>00003 <span class="comment">//:</span>
<a name="l00004"></a>00004 <span class="comment">// \file</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;<a class="code" href="imesh__fileio_8h.html" title="Functions for reading mesh files.">imesh/imesh_fileio.h</a>&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;vnl/vnl_vector.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;vnl/algo/vnl_svd.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;vcl_fstream.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;vcl_sstream.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;vcl_cassert.h&gt;</span>
<a name="l00012"></a>00012 
<a name="l00013"></a><a class="code" href="classimesh__pca__mesh.html#a596f3fb48ece38aa738af0f33b053b3f">00013</a> <a class="code" href="classimesh__pca__mesh.html#a4819bf834bbda86112a353cb997f5cf9" title="Default Constructor.">imesh_pca_mesh::imesh_pca_mesh</a>(<span class="keyword">const</span> vcl_vector&lt;imesh_mesh&gt;&amp; meshes)
<a name="l00014"></a>00014   : <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>(meshes[0]), mean_verts_(this-&gt;vertices().clone())
<a name="l00015"></a>00015 {
<a name="l00016"></a>00016   vnl_matrix&lt;double&gt; M = <a class="code" href="classimesh__pca__mesh.html#ad86ad42cd40d0a8132b2a3af815c83d8" title="compute and set the mean return the deviations matrix.">compute_mean</a>(meshes);
<a name="l00017"></a>00017   vnl_svd&lt;double&gt; A(M,-1e-8);
<a name="l00018"></a>00018 
<a name="l00019"></a>00019   <span class="comment">// remove zero singular values</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021   <a class="code" href="classimesh__pca__mesh.html#a132b7074dd49addf8a4eb9c0f8aefc5b">std_devs_</a> = vnl_vector&lt;double&gt;(A.W().diagonal().data_block(), A.rank());
<a name="l00022"></a>00022   <a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a>.set_size(A.rank(),M.rows());
<a name="l00023"></a>00023   A.U().transpose().extract(<a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a>);
<a name="l00024"></a>00024 
<a name="l00025"></a>00025   <a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a>.set_size(<a class="code" href="classimesh__pca__mesh.html#a132b7074dd49addf8a4eb9c0f8aefc5b">std_devs_</a>.size());
<a name="l00026"></a>00026   <a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a>.fill(0.0);
<a name="l00027"></a>00027 }
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">//: compute and set the mean return the deviations matrix</span>
<a name="l00031"></a>00031 vnl_matrix&lt;double&gt;
<a name="l00032"></a><a class="code" href="classimesh__pca__mesh.html#ad86ad42cd40d0a8132b2a3af815c83d8">00032</a> <a class="code" href="classimesh__pca__mesh.html#ad86ad42cd40d0a8132b2a3af815c83d8" title="compute and set the mean return the deviations matrix.">imesh_pca_mesh::compute_mean</a>(<span class="keyword">const</span> vcl_vector&lt;imesh_mesh&gt;&amp; meshes)
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> num_training = meshes.size();
<a name="l00035"></a>00035   vnl_matrix&lt;double&gt; M(this-&gt;<a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a>()*3,num_training);
<a name="l00036"></a>00036   vnl_vector&lt;double&gt; mean(this-&gt;<a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a>()*3,0.0);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;num_training; ++i)
<a name="l00039"></a>00039   {
<a name="l00040"></a>00040     assert(meshes[i].<a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a>() == this-&gt;<a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a>());
<a name="l00041"></a>00041     <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts = meshes[i].vertices&lt;3&gt;();
<a name="l00042"></a>00042     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>=0; <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>&lt;verts.<a class="code" href="classimesh__vertex__array.html#a89539d3e40b411109649389c7a2fd6fa" title="returns the number of vertices.">size</a>(); ++<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>) {
<a name="l00043"></a>00043       M(3*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>,i) = verts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][0];
<a name="l00044"></a>00044       M(3*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>+1,i) = verts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][1];
<a name="l00045"></a>00045       M(3*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>+2,i) = verts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][2];
<a name="l00046"></a>00046       mean[3*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>] += verts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][0];
<a name="l00047"></a>00047       mean[3*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>+1] += verts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][1];
<a name="l00048"></a>00048       mean[3*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>+2] += verts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][2];
<a name="l00049"></a>00049     }
<a name="l00050"></a>00050   }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   mean /= num_training;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;num_training; ++i)
<a name="l00055"></a>00055   {
<a name="l00056"></a>00056     M.set_column(i,M.get_column(i) - mean);
<a name="l00057"></a>00057     <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts = this-&gt;vertices&lt;3&gt;();
<a name="l00058"></a>00058     <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; mverts = this-&gt;mean_vertices&lt;3&gt;();
<a name="l00059"></a>00059     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>=0; <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>&lt;verts.<a class="code" href="classimesh__vertex__array.html#a89539d3e40b411109649389c7a2fd6fa" title="returns the number of vertices.">size</a>(); ++<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>) {
<a name="l00060"></a>00060       verts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][0] = mverts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][0] = mean[3*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>];
<a name="l00061"></a>00061       verts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][1] = mverts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][1] = mean[3*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>+1];
<a name="l00062"></a>00062       verts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][2] = mverts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>][2] = mean[3*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>+2];
<a name="l00063"></a>00063     }
<a name="l00064"></a>00064   }
<a name="l00065"></a>00065 
<a name="l00066"></a>00066   <span class="keywordflow">return</span> M;
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">//: Constructor from a mesh, mean, standard deviations, and PC matrix</span>
<a name="l00071"></a><a class="code" href="classimesh__pca__mesh.html#ab4e47925fec10f016e4622d26e6c7139">00071</a> <a class="code" href="classimesh__pca__mesh.html#a4819bf834bbda86112a353cb997f5cf9" title="Default Constructor.">imesh_pca_mesh::imesh_pca_mesh</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00072"></a>00072                                <span class="keyword">const</span> vnl_vector&lt;double&gt;&amp; mean,
<a name="l00073"></a>00073                                <span class="keyword">const</span> vnl_vector&lt;double&gt;&amp; std_devs,
<a name="l00074"></a>00074                                <span class="keyword">const</span> vnl_matrix&lt;double&gt;&amp; pc)
<a name="l00075"></a>00075   : <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>(mesh)
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077   <a class="code" href="classimesh__pca__mesh.html#a736b1b40b3042e2a6a71c9911ec8ef34" title="Initialize the PCA data (assuming mesh data is already set).">init</a>(mean,std_devs,pc);
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">//: Copy Constructor</span>
<a name="l00082"></a><a class="code" href="classimesh__pca__mesh.html#a5a98305e0c9d33bd89b2758cea95002f">00082</a> <a class="code" href="classimesh__pca__mesh.html#a4819bf834bbda86112a353cb997f5cf9" title="Default Constructor.">imesh_pca_mesh::imesh_pca_mesh</a>(<span class="keyword">const</span> <a class="code" href="classimesh__pca__mesh.html" title="Principal Component Analysis on a set of mesh vertices.">imesh_pca_mesh</a>&amp; other)
<a name="l00083"></a>00083   : <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>(other),
<a name="l00084"></a>00084     std_devs_(other.std_devs_),
<a name="l00085"></a>00085     pc_(other.pc_),
<a name="l00086"></a>00086     mean_verts_((other.mean_verts_.get()) ? other.mean_verts_-&gt;clone() : 0),
<a name="l00087"></a>00087     params_(other.params_)
<a name="l00088"></a>00088 {
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">//: Assignment operator</span>
<a name="l00093"></a><a class="code" href="classimesh__pca__mesh.html#a9b4385d40ab7fbba4e38d1d38a1852ce">00093</a> <a class="code" href="classimesh__pca__mesh.html" title="Principal Component Analysis on a set of mesh vertices.">imesh_pca_mesh</a>&amp; <a class="code" href="classimesh__pca__mesh.html#a9b4385d40ab7fbba4e38d1d38a1852ce" title="Assignment operator.">imesh_pca_mesh::operator=</a>(<span class="keyword">const</span> <a class="code" href="classimesh__pca__mesh.html" title="Principal Component Analysis on a set of mesh vertices.">imesh_pca_mesh</a>&amp; other)
<a name="l00094"></a>00094 {
<a name="l00095"></a>00095   <span class="keywordflow">if</span> (<span class="keyword">this</span> != &amp;other) {
<a name="l00096"></a>00096     this-&gt;<a class="code" href="classimesh__pca__mesh.html#a9b4385d40ab7fbba4e38d1d38a1852ce" title="Assignment operator.">imesh_mesh::operator=</a>(other);
<a name="l00097"></a>00097     <a class="code" href="classimesh__pca__mesh.html#a132b7074dd49addf8a4eb9c0f8aefc5b">std_devs_</a> = other.<a class="code" href="classimesh__pca__mesh.html#a132b7074dd49addf8a4eb9c0f8aefc5b">std_devs_</a>;
<a name="l00098"></a>00098     <a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a> = other.<a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a>;
<a name="l00099"></a>00099     <a class="code" href="classimesh__pca__mesh.html#ac43a2c3eda9feff200b3f070c2e7b016">mean_verts_</a> = vcl_auto_ptr&lt;imesh_vertex_array_base&gt;((other.<a class="code" href="classimesh__pca__mesh.html#ac43a2c3eda9feff200b3f070c2e7b016">mean_verts_</a>.get()) ?
<a name="l00100"></a>00100                                                         other.<a class="code" href="classimesh__pca__mesh.html#ac43a2c3eda9feff200b3f070c2e7b016">mean_verts_</a>-&gt;clone() : 0);
<a name="l00101"></a>00101     <a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a> = other.<a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a>;
<a name="l00102"></a>00102   }
<a name="l00103"></a>00103   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="comment">//: Construct from a mesh with no variation</span>
<a name="l00108"></a><a class="code" href="classimesh__pca__mesh.html#a4a8d5f6a38b57ea3ae401824dc5f5cab">00108</a> <a class="code" href="classimesh__pca__mesh.html#a4819bf834bbda86112a353cb997f5cf9" title="Default Constructor.">imesh_pca_mesh::imesh_pca_mesh</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh)
<a name="l00109"></a>00109   : <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>(mesh), mean_verts_(this-&gt;vertices().clone())
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">//: Initialize the PCA data (assuming mesh data is already set)</span>
<a name="l00115"></a>00115 <span class="comment">//  Use this to add PCA data after a mesh has be loaded from a file</span>
<a name="l00116"></a><a class="code" href="classimesh__pca__mesh.html#a736b1b40b3042e2a6a71c9911ec8ef34">00116</a> <span class="keywordtype">void</span> <a class="code" href="classimesh__pca__mesh.html#a736b1b40b3042e2a6a71c9911ec8ef34" title="Initialize the PCA data (assuming mesh data is already set).">imesh_pca_mesh::init</a>(<span class="keyword">const</span> vnl_vector&lt;double&gt;&amp; mean,
<a name="l00117"></a>00117                           <span class="keyword">const</span> vnl_vector&lt;double&gt;&amp; std_devs,
<a name="l00118"></a>00118                           <span class="keyword">const</span> vnl_matrix&lt;double&gt;&amp; pc)
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120   <a class="code" href="classimesh__pca__mesh.html#a132b7074dd49addf8a4eb9c0f8aefc5b">std_devs_</a> = <a class="code" href="classimesh__pca__mesh.html#af7c4d3f44044e225db58d7e1713937c3" title="Access the standard deviations.">std_devs</a>;
<a name="l00121"></a>00121   <a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a> = pc;
<a name="l00122"></a>00122   <a class="code" href="classimesh__pca__mesh.html#ac43a2c3eda9feff200b3f070c2e7b016">mean_verts_</a>.reset(<span class="keyword">new</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>(this-&gt;<a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a>()));
<a name="l00123"></a>00123 
<a name="l00124"></a>00124   assert(this-&gt;<a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a>()*3 == mean.size());
<a name="l00125"></a>00125   assert(this-&gt;<a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a>()*3 == pc.columns());
<a name="l00126"></a>00126   assert(std_devs.size() == pc.rows());
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; mverts = this-&gt;mean_vertices&lt;3&gt;();
<a name="l00129"></a>00129   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;mverts.size(); ++i)
<a name="l00130"></a>00130   {
<a name="l00131"></a>00131     mverts[i] = <a class="code" href="classimesh__vertex_3_013_01_4.html" title="A 3d vertex specialization with extra capabilities.">imesh_vertex&lt;3&gt;</a>(mean[3*i],mean[3*i+1],mean[3*i+2]);
<a name="l00132"></a>00132   }
<a name="l00133"></a>00133   <a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a> = this-&gt;<a class="code" href="classimesh__pca__mesh.html#a49a99e9ab2192b63959079bafa4dbe18" title="Project mesh vertices into the PCA parameter space.">project</a>(this-&gt;<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>());
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="comment">//: Set the pca parameters</span>
<a name="l00138"></a><a class="code" href="classimesh__pca__mesh.html#aa7e1157634c32912b5b3a3b68807002f">00138</a> <span class="keywordtype">void</span> <a class="code" href="classimesh__pca__mesh.html#aa7e1157634c32912b5b3a3b68807002f" title="Set the pca parameters.">imesh_pca_mesh::set_params</a>(<span class="keyword">const</span> vnl_vector&lt;double&gt;&amp; p)
<a name="l00139"></a>00139 {
<a name="l00140"></a>00140   assert(<a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a>.size() &gt;= p.size());
<a name="l00141"></a>00141   vnl_vector&lt;double&gt; sp(p.size(),0.0);
<a name="l00142"></a>00142   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;
<a name="l00143"></a>00143   <span class="keywordflow">for</span> (; i&lt;p.size(); ++i){
<a name="l00144"></a>00144     <a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a>[i] = p[i];
<a name="l00145"></a>00145     sp[i] = <a class="code" href="classimesh__pca__mesh.html#a132b7074dd49addf8a4eb9c0f8aefc5b">std_devs_</a>[i]*p[i];
<a name="l00146"></a>00146   }
<a name="l00147"></a>00147   <span class="comment">// fill the rest with zeros</span>
<a name="l00148"></a>00148   <span class="keywordflow">for</span> (; i&lt;<a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a>.size(); ++i)
<a name="l00149"></a>00149     <a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a>[i] = 0.0;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151   <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts = this-&gt;vertices&lt;3&gt;();
<a name="l00152"></a>00152   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; mverts = this-&gt;mean_vertices&lt;3&gt;();
<a name="l00153"></a>00153   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;verts.<a class="code" href="classimesh__vertex__array.html#a89539d3e40b411109649389c7a2fd6fa" title="returns the number of vertices.">size</a>(); ++i) {
<a name="l00154"></a>00154     <a class="code" href="classimesh__vertex_3_013_01_4.html" title="A 3d vertex specialization with extra capabilities.">imesh_vertex&lt;3&gt;</a>&amp; <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a> = verts[i];
<a name="l00155"></a>00155     <span class="keyword">const</span> <a class="code" href="classimesh__vertex_3_013_01_4.html" title="A 3d vertex specialization with extra capabilities.">imesh_vertex&lt;3&gt;</a>&amp; mv = mverts[i];
<a name="l00156"></a>00156     v = mv;
<a name="l00157"></a>00157     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0; j&lt;sp.size(); ++j) {
<a name="l00158"></a>00158       v[0] += <a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a>(j,3*i)  *sp[j];
<a name="l00159"></a>00159       v[1] += <a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a>(j,3*i+1)*sp[j];
<a name="l00160"></a>00160       v[2] += <a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a>(j,3*i+2)*sp[j];
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162   }
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">//: Set an individual pca parameter</span>
<a name="l00166"></a>00166 <span class="comment">// This is done by incremental difference, errors may accumulate</span>
<a name="l00167"></a>00167 <span class="comment">// over many calls.</span>
<a name="l00168"></a><a class="code" href="classimesh__pca__mesh.html#a1900de8d7c8df3c8991af88e3a09c947">00168</a> <span class="keywordtype">void</span> <a class="code" href="classimesh__pca__mesh.html#a1900de8d7c8df3c8991af88e3a09c947" title="Set an individual pca parameter.">imesh_pca_mesh::set_param</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx, <span class="keywordtype">double</span> param)
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170   <span class="keywordtype">double</span> diff = <a class="code" href="classimesh__pca__mesh.html#a132b7074dd49addf8a4eb9c0f8aefc5b">std_devs_</a>[idx]*(param - <a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a>[idx]);
<a name="l00171"></a>00171   <a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a>[idx] = param;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts = this-&gt;vertices&lt;3&gt;();
<a name="l00174"></a>00174   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;verts.<a class="code" href="classimesh__vertex__array.html#a89539d3e40b411109649389c7a2fd6fa" title="returns the number of vertices.">size</a>(); ++i) {
<a name="l00175"></a>00175     <a class="code" href="classimesh__vertex_3_013_01_4.html" title="A 3d vertex specialization with extra capabilities.">imesh_vertex&lt;3&gt;</a>&amp; <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a> = verts[i];
<a name="l00176"></a>00176     v[0] += <a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a>(idx,3*i)  *diff;
<a name="l00177"></a>00177     v[1] += <a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a>(idx,3*i+1)*diff;
<a name="l00178"></a>00178     v[2] += <a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a>(idx,3*i+2)*diff;
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="comment">//: Reset all the PCA parameters to zero</span>
<a name="l00184"></a>00184 <span class="comment">//  Returning to the mean mesh</span>
<a name="l00185"></a><a class="code" href="classimesh__pca__mesh.html#a13cccc2afb790316f9cc9d0282a226fb">00185</a> <span class="keywordtype">void</span> <a class="code" href="classimesh__pca__mesh.html#a13cccc2afb790316f9cc9d0282a226fb" title="Reset all the PCA parameters to zero.">imesh_pca_mesh::set_mean</a>()
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187   <a class="code" href="classimesh__pca__mesh.html#a10748b8cd27a4264216e2d66720f4854">params_</a>.fill(0.0);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189   <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts = this-&gt;vertices&lt;3&gt;();
<a name="l00190"></a>00190   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; mverts = this-&gt;mean_vertices&lt;3&gt;();
<a name="l00191"></a>00191   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>=0; <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>&lt;verts.<a class="code" href="classimesh__vertex__array.html#a89539d3e40b411109649389c7a2fd6fa" title="returns the number of vertices.">size</a>(); ++<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>) {
<a name="l00192"></a>00192     verts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>] = mverts[<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a>];
<a name="l00193"></a>00193   }
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 <span class="comment">//: Project mesh vertices into the PCA parameter space</span>
<a name="l00198"></a>00198 vnl_vector&lt;double&gt;
<a name="l00199"></a><a class="code" href="classimesh__pca__mesh.html#a49a99e9ab2192b63959079bafa4dbe18">00199</a> <a class="code" href="classimesh__pca__mesh.html#a49a99e9ab2192b63959079bafa4dbe18" title="Project mesh vertices into the PCA parameter space.">imesh_pca_mesh::project</a>(<span class="keyword">const</span> <a class="code" href="classimesh__vertex__array__base.html" title="Abstract base class for a collection of vertices.">imesh_vertex_array_base</a>&amp; vertices)<span class="keyword"> const</span>
<a name="l00200"></a>00200 <span class="keyword"></span>{
<a name="l00201"></a>00201   assert(<span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>*<span class="keyword">&gt;</span>(&amp;vertices));
<a name="l00202"></a>00202   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts =
<a name="l00203"></a>00203       <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp;<span class="keyword">&gt;</span>(<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; mverts = this-&gt;mean_vertices&lt;3&gt;();
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a> = this-&gt;<a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a>();
<a name="l00208"></a>00208   vnl_vector&lt;double&gt; vals(3*num_verts);
<a name="l00209"></a>00209   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a>; ++i)
<a name="l00210"></a>00210   {
<a name="l00211"></a>00211     <span class="keyword">const</span> <a class="code" href="classimesh__vertex_3_013_01_4.html" title="A 3d vertex specialization with extra capabilities.">imesh_vertex&lt;3&gt;</a>&amp; mv = mverts[i];
<a name="l00212"></a>00212     <span class="keyword">const</span> <a class="code" href="classimesh__vertex_3_013_01_4.html" title="A 3d vertex specialization with extra capabilities.">imesh_vertex&lt;3&gt;</a>&amp; <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a> = verts[i];
<a name="l00213"></a>00213     vals[3*i]   = v[0] - mv[0];
<a name="l00214"></a>00214     vals[3*i+1] = v[1] - mv[1];
<a name="l00215"></a>00215     vals[3*i+2] = v[2] - mv[2];
<a name="l00216"></a>00216   }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   vnl_vector&lt;double&gt; p = <a class="code" href="classimesh__pca__mesh.html#a48b87939e22fffe7eee17faca8abfb6a">pc_</a>*vals;
<a name="l00219"></a>00219   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;p.size(); ++i)
<a name="l00220"></a>00220     p[i] /= <a class="code" href="classimesh__pca__mesh.html#a132b7074dd49addf8a4eb9c0f8aefc5b">std_devs_</a>[i];
<a name="l00221"></a>00221   <span class="keywordflow">return</span> p;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="comment">//=============================================================================</span>
<a name="l00226"></a>00226 <span class="comment">// External functions</span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 <span class="comment">//: Compute the image Jacobians at each vertex for PCA parameters in the result</span>
<a name="l00230"></a>00230 <span class="comment">//  Matrix n, row i is the image space derivative</span>
<a name="l00231"></a>00231 <span class="comment">//  at vertex n with respect to the ith pca parameter</span>
<a name="l00232"></a>00232 vcl_vector&lt;vnl_matrix&lt;double&gt; &gt;
<a name="l00233"></a><a class="code" href="imesh__pca_8h.html#a9e1f9a8cadc578efda01ce0676ce59db">00233</a> <a class="code" href="imesh__pca_8cxx.html#a9e1f9a8cadc578efda01ce0676ce59db" title="Compute the image Jacobians at each vertex for PCA parameters in the result.">imesh_pca_image_jacobians</a>(<span class="keyword">const</span> vpgl_proj_camera&lt;double&gt;&amp; camera,
<a name="l00234"></a>00234                           <span class="keyword">const</span> <a class="code" href="classimesh__pca__mesh.html" title="Principal Component Analysis on a set of mesh vertices.">imesh_pca_mesh</a>&amp; mesh)
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236   <span class="comment">// convert vertices to vgl points</span>
<a name="l00237"></a>00237   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts = mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>&lt;3&gt;();
<a name="l00238"></a>00238   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_verts = mesh.<a class="code" href="classimesh__mesh.html#ada3a543c59a612878479ca3a7a61331b" title="Return the number of vertices.">num_verts</a>();
<a name="l00239"></a>00239   vcl_vector&lt;vgl_point_3d&lt;double&gt; &gt; pts(num_verts);
<a name="l00240"></a>00240   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;num_verts; ++i)
<a name="l00241"></a>00241     pts[i] = verts[i];
<a name="l00242"></a>00242 
<a name="l00243"></a>00243   <span class="comment">// compute the Jacobians at each point</span>
<a name="l00244"></a>00244   vcl_vector&lt;vnl_matrix_fixed&lt;double,2,3&gt; &gt; J = image_jacobians(camera,pts);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="comment">// map the image Jacobians into PCA Jacobians</span>
<a name="l00247"></a>00247   <span class="keyword">const</span> vnl_matrix&lt;double&gt;&amp; pc = mesh.<a class="code" href="classimesh__pca__mesh.html#a34e5fcba49f6a0d69479cfbabd5b1af0" title="Access the principal components.">principal_comps</a>();
<a name="l00248"></a>00248   <span class="keyword">const</span> vnl_vector&lt;double&gt;&amp; std = mesh.<a class="code" href="classimesh__pca__mesh.html#af7c4d3f44044e225db58d7e1713937c3" title="Access the standard deviations.">std_devs</a>();
<a name="l00249"></a>00249 
<a name="l00250"></a>00250   vcl_vector&lt;vnl_matrix&lt;double&gt; &gt; img_jac(num_verts);
<a name="l00251"></a>00251   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;num_verts; ++i)
<a name="l00252"></a>00252   {
<a name="l00253"></a>00253     vnl_matrix&lt;double&gt; dir_3d(pc.rows(),3);
<a name="l00254"></a>00254     pc.extract(dir_3d,0,3*i);
<a name="l00255"></a>00255     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;std.size(); ++j) {
<a name="l00256"></a>00256       dir_3d(j,0) /= std[j];
<a name="l00257"></a>00257       dir_3d(j,1) /= std[j];
<a name="l00258"></a>00258       dir_3d(j,2) /= std[j];
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     img_jac[i] = J[i]*dir_3d.transpose();
<a name="l00262"></a>00262   }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264   <span class="keywordflow">return</span> img_jac;
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 <span class="comment">//: Read a PCA mesh from a mean mesh and a pca file</span>
<a name="l00269"></a><a class="code" href="imesh__pca_8h.html#ade4ab956d66f18ad8147cb61cbbcb6ec">00269</a> <a class="code" href="classimesh__pca__mesh.html" title="Principal Component Analysis on a set of mesh vertices.">imesh_pca_mesh</a> <a class="code" href="imesh__pca_8cxx.html#ade4ab956d66f18ad8147cb61cbbcb6ec" title="Read a PCA mesh from a mean mesh and a pca file.">imesh_read_pca</a>(<span class="keyword">const</span> vcl_string&amp; mean_file,
<a name="l00270"></a>00270                               <span class="keyword">const</span> vcl_string&amp; pca_file)
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272   <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a> mean;
<a name="l00273"></a>00273   vnl_vector&lt;double&gt; m,s;
<a name="l00274"></a>00274   vnl_matrix&lt;double&gt; P;
<a name="l00275"></a>00275   <a class="code" href="imesh__fileio_8cxx.html#ab7722b87baadedd724a9a3e2828c49f5" title="Read a mesh from a file, determine type from extension.">imesh_read</a>(mean_file,mean);
<a name="l00276"></a>00276   <a class="code" href="imesh__pca_8cxx.html#ade4ab956d66f18ad8147cb61cbbcb6ec" title="Read a PCA mesh from a mean mesh and a pca file.">imesh_read_pca</a>(pca_file,m,s,P);
<a name="l00277"></a>00277   <span class="keywordflow">return</span> <a class="code" href="classimesh__pca__mesh.html" title="Principal Component Analysis on a set of mesh vertices.">imesh_pca_mesh</a>(mean,m,s,P);
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="comment">//: Read a PCA file</span>
<a name="l00282"></a><a class="code" href="imesh__pca_8h.html#a6fc19c2af156b08eb20818007da406fe">00282</a> <span class="keywordtype">bool</span> <a class="code" href="imesh__pca_8cxx.html#ade4ab956d66f18ad8147cb61cbbcb6ec" title="Read a PCA mesh from a mean mesh and a pca file.">imesh_read_pca</a>(<span class="keyword">const</span> vcl_string&amp; pca_file,
<a name="l00283"></a>00283                     vnl_vector&lt;double&gt;&amp; mean,
<a name="l00284"></a>00284                     vnl_vector&lt;double&gt;&amp; std_devs,
<a name="l00285"></a>00285                     vnl_matrix&lt;double&gt;&amp; pc)
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287   vcl_ifstream ifs(pca_file.c_str());
<a name="l00288"></a>00288   <span class="keywordflow">if</span> (!ifs.is_open())
<a name="l00289"></a>00289     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   vcl_vector&lt;double&gt; data;
<a name="l00292"></a>00292   <span class="keywordflow">if</span> (ifs.peek() == <span class="charliteral">&#39;#&#39;</span>) {
<a name="l00293"></a>00293     vcl_string s;
<a name="l00294"></a>00294     ifs &gt;&gt; s;
<a name="l00295"></a>00295     <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;#mag&quot;</span>) {
<a name="l00296"></a>00296       vcl_string line;
<a name="l00297"></a>00297       vcl_getline(ifs,line);
<a name="l00298"></a>00298       vcl_stringstream ss(line);
<a name="l00299"></a>00299       <span class="keywordtype">double</span> val;
<a name="l00300"></a>00300       <span class="keywordflow">while</span> (ss &gt;&gt; val) {
<a name="l00301"></a>00301         data.push_back(val);
<a name="l00302"></a>00302       }
<a name="l00303"></a>00303       std_devs.set_size(data.size());
<a name="l00304"></a>00304       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;std_devs.size(); ++i)
<a name="l00305"></a>00305         std_devs[i] = data[i];
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307   }
<a name="l00308"></a>00308   vcl_string line;
<a name="l00309"></a>00309   data.clear();
<a name="l00310"></a>00310   vcl_vector&lt;vcl_vector&lt;double&gt; &gt; data_M;
<a name="l00311"></a>00311   <span class="keywordflow">while</span> (vcl_getline(ifs,line).good()) {
<a name="l00312"></a>00312     vcl_stringstream ss(line);
<a name="l00313"></a>00313     <span class="keywordtype">double</span> val;
<a name="l00314"></a>00314     ss &gt;&gt; val;
<a name="l00315"></a>00315     data.push_back(val);
<a name="l00316"></a>00316     vcl_vector&lt;double&gt; row;
<a name="l00317"></a>00317     <span class="keywordflow">while</span> (ss &gt;&gt; val) {
<a name="l00318"></a>00318       row.push_back(val);
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320     data_M.push_back(row);
<a name="l00321"></a>00321   }
<a name="l00322"></a>00322   mean.set_size(data.size());
<a name="l00323"></a>00323   pc.set_size(data_M[0].size(),mean.size());
<a name="l00324"></a>00324   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;mean.size(); ++i) {
<a name="l00325"></a>00325     mean[i] = data[i];
<a name="l00326"></a>00326     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0; j&lt;pc.rows(); ++j) {
<a name="l00327"></a>00327       pc(j,i) = data_M[i][j];
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329   }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 <span class="comment">//: Write the mean mesh and PCA file</span>
<a name="l00336"></a><a class="code" href="imesh__pca_8h.html#ac47f6f831542adb9a373628b49c3810a">00336</a> <span class="keywordtype">void</span> <a class="code" href="imesh__pca_8cxx.html#ac47f6f831542adb9a373628b49c3810a" title="Write the mean mesh and PCA file.">imesh_write_pca</a>(<span class="keyword">const</span> vcl_string&amp; mesh_file,
<a name="l00337"></a>00337                      <span class="keyword">const</span> vcl_string&amp; pca_file,
<a name="l00338"></a>00338                      <span class="keyword">const</span> <a class="code" href="classimesh__pca__mesh.html" title="Principal Component Analysis on a set of mesh vertices.">imesh_pca_mesh</a>&amp; pmesh)
<a name="l00339"></a>00339 {
<a name="l00340"></a>00340   <span class="keyword">const</span> vnl_vector&lt;double&gt;&amp; std_dev = pmesh.<a class="code" href="classimesh__pca__mesh.html#af7c4d3f44044e225db58d7e1713937c3" title="Access the standard deviations.">std_devs</a>();
<a name="l00341"></a>00341   <span class="keyword">const</span> vnl_matrix&lt;double&gt;&amp; pc = pmesh.<a class="code" href="classimesh__pca__mesh.html#a34e5fcba49f6a0d69479cfbabd5b1af0" title="Access the principal components.">principal_comps</a>();
<a name="l00342"></a>00342   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; mverts = pmesh.<a class="code" href="classimesh__pca__mesh.html#a820a532cbf35976f7ba8b0513794ca85" title="Access the vector of mean vertices.">mean_vertices</a>&lt;3&gt;();
<a name="l00343"></a>00343   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_data = pc.columns();
<a name="l00344"></a>00344   vnl_vector&lt;double&gt; mean(num_data);
<a name="l00345"></a>00345   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;num_data; ++i)
<a name="l00346"></a>00346     mean[i] = mverts[i/3][i%3];
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   vcl_auto_ptr&lt;imesh_vertex_array_base&gt; verts(mverts.<a class="code" href="classimesh__vertex__array.html#a2a099d9a7f353ce5e3ade67cdcf00efc" title="Produce a clone of this object (dynamic copy).">clone</a>());
<a name="l00349"></a>00349   vcl_auto_ptr&lt;imesh_face_array_base&gt; faces(pmesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>().<a class="code" href="classimesh__face__array__base.html#ab77e8024ddfd27d0b2d567995f864be4" title="Produce a clone of this object (dynamic copy).">clone</a>());
<a name="l00350"></a>00350   <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a> mean_mesh(verts,faces);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <a class="code" href="imesh__pca_8cxx.html#ac47f6f831542adb9a373628b49c3810a" title="Write the mean mesh and PCA file.">imesh_write_pca</a>(pca_file,mean,std_dev,pc);
<a name="l00353"></a>00353   <a class="code" href="imesh__fileio_8cxx.html#a4501672043b26002f7c80e28e84e59d2" title="Write a mesh to a wavefront OBJ file.">imesh_write_obj</a>(mesh_file,mean_mesh);
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 <span class="comment">//: Write a PCA file</span>
<a name="l00358"></a><a class="code" href="imesh__pca_8h.html#a1dec5be19d8b589d672a05f2446d0044">00358</a> <span class="keywordtype">bool</span> <a class="code" href="imesh__pca_8cxx.html#ac47f6f831542adb9a373628b49c3810a" title="Write the mean mesh and PCA file.">imesh_write_pca</a>(<span class="keyword">const</span> vcl_string&amp; filename,
<a name="l00359"></a>00359                      <span class="keyword">const</span> vnl_vector&lt;double&gt;&amp; mean,
<a name="l00360"></a>00360                      <span class="keyword">const</span> vnl_vector&lt;double&gt;&amp; svals,
<a name="l00361"></a>00361                      <span class="keyword">const</span> vnl_matrix&lt;double&gt;&amp; vars)
<a name="l00362"></a>00362 {
<a name="l00363"></a>00363   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_comps = svals.size();
<a name="l00364"></a>00364   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_data = mean.size();
<a name="l00365"></a>00365   vcl_ofstream ofs(filename.c_str());
<a name="l00366"></a>00366   ofs &lt;&lt; <span class="stringliteral">&quot;#mag&quot;</span>;
<a name="l00367"></a>00367   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;num_comps; ++i)
<a name="l00368"></a>00368     ofs &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; svals[i];
<a name="l00369"></a>00369   ofs &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00370"></a>00370   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;num_data; ++j) {
<a name="l00371"></a>00371     ofs &lt;&lt; mean[j];
<a name="l00372"></a>00372     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;num_comps; ++i)
<a name="l00373"></a>00373       ofs &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; vars(i,j);
<a name="l00374"></a>00374     ofs &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00375"></a>00375   }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377   ofs.close();
<a name="l00378"></a>00378   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00379"></a>00379 }
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Thu May 2 2013 08:52:54 for contrib/brl/bbas/imesh by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
