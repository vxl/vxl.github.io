<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>contrib/brl/bbas/imesh/algo/imesh_project.cxx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">contrib/brl/bbas/imesh/algo/imesh_project.cxx</div>  </div>
</div>
<div class="contents">
<a href="imesh__project_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// This is brl/bbas/imesh/algo/imesh_project.cxx</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;<a class="code" href="imesh__project_8h.html" title="Functions to project a mesh into an image.">imesh_project.h</a>&quot;</span>
<a name="l00003"></a>00003 <span class="comment">//:</span>
<a name="l00004"></a>00004 <span class="comment">// \file</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;<a class="code" href="imesh__operations_8h.html" title="Operations on meshes.">imesh/imesh_operations.h</a>&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;<a class="code" href="imesh__intersect_8h.html" title="Functions for mesh intersections.">imesh/algo/imesh_intersect.h</a>&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__point__2d_8h.html">vgl/vgl_point_2d.h</a>&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__homg__point__2d_8h.html">vgl/vgl_homg_point_2d.h</a>&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__homg__point__3d_8h.html">vgl/vgl_homg_point_3d.h</a>&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__3d_8h.html">vgl/vgl_vector_3d.h</a>&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__plane__3d_8h.html">vgl/vgl_plane_3d.h</a>&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__line__3d__2__points_8h.html">vgl/vgl_line_3d_2_points.h</a>&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__triangle__test_8h.html">vgl/vgl_triangle_test.h</a>&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__intersection_8h.html">vgl/vgl_intersection.h</a>&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__distance_8h.html">vgl/vgl_distance.h</a>&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__triangle__scan__iterator_8h.html">vgl/vgl_triangle_scan_iterator.h</a>&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;vcl_algorithm.h&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;vcl_limits.h&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;vcl_cmath.h&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;vcl_cassert.h&gt;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="keywordtype">void</span>
<a name="l00026"></a><a class="code" href="imesh__project_8h.html#a33a4498a2b8100719b797b675d254992">00026</a> <a class="code" href="imesh__project_8cxx.html#a33a4498a2b8100719b797b675d254992" title="project the 3D vertices into 2D using the camera.">imesh_project_verts</a>(<span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts3d,
<a name="l00027"></a>00027                     <span class="keyword">const</span> vpgl_proj_camera&lt;double&gt;&amp; camera,
<a name="l00028"></a>00028                     vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; verts2d)
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030   verts2d.resize(verts3d.<a class="code" href="classimesh__vertex__array.html#a89539d3e40b411109649389c7a2fd6fa" title="returns the number of vertices.">size</a>());
<a name="l00031"></a>00031   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;verts3d.<a class="code" href="classimesh__vertex__array.html#a89539d3e40b411109649389c7a2fd6fa" title="returns the number of vertices.">size</a>(); ++i)
<a name="l00032"></a>00032     verts2d[i] = camera.project(verts3d[i]);
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="keywordtype">void</span>
<a name="l00036"></a><a class="code" href="imesh__project_8h.html#ae3ee99ff358818940a1910a7f111e975">00036</a> <a class="code" href="imesh__project_8cxx.html#a33a4498a2b8100719b797b675d254992" title="project the 3D vertices into 2D using the camera.">imesh_project_verts</a>(<span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> &gt;&amp; verts3d,
<a name="l00037"></a>00037                     <span class="keyword">const</span> vpgl_proj_camera&lt;double&gt;&amp; camera,
<a name="l00038"></a>00038                     vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; verts2d)
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040   verts2d.resize(verts3d.size());
<a name="l00041"></a>00041   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;verts3d.size(); ++i)
<a name="l00042"></a>00042     verts2d[i] = camera.project(verts3d[i]);
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="keywordtype">void</span>
<a name="l00047"></a><a class="code" href="imesh__project_8h.html#a1d5d16f9ed086b1a977840b8ffcb71e3">00047</a> <a class="code" href="imesh__project_8cxx.html#a33a4498a2b8100719b797b675d254992" title="project the 3D vertices into 2D using the camera.">imesh_project_verts</a>(<span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> &gt;&amp; verts3d,
<a name="l00048"></a>00048                     <span class="keyword">const</span> vpgl_proj_camera&lt;double&gt;&amp; camera,
<a name="l00049"></a>00049                     vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; verts2d,
<a name="l00050"></a>00050                     vcl_vector&lt;double&gt;&amp; depths)
<a name="l00051"></a>00051 {
<a name="l00052"></a>00052   verts2d.resize(verts3d.size());
<a name="l00053"></a>00053   depths.resize(verts3d.size());
<a name="l00054"></a>00054   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;verts3d.size(); ++i) {
<a name="l00055"></a>00055     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__homg__point__2d.html">vgl_homg_point_2d&lt;double&gt;</a> pt = camera.project(verts3d[i]);
<a name="l00056"></a>00056     verts2d[i] = pt;
<a name="l00057"></a>00057     depths[i] = pt.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__homg__point__2d.html#ab452fbf6dec9591ff07c0ebb7b05f1e1">w</a>();
<a name="l00058"></a>00058   }
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="keywordtype">void</span>
<a name="l00063"></a><a class="code" href="imesh__project_8h.html#a81a7121640f105227ced8e0f7eb86b27">00063</a> <a class="code" href="imesh__project_8cxx.html#a33a4498a2b8100719b797b675d254992" title="project the 3D vertices into 2D using the camera.">imesh_project_verts</a>(<span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts3d,
<a name="l00064"></a>00064                     <span class="keyword">const</span> vpgl_proj_camera&lt;double&gt;&amp; camera,
<a name="l00065"></a>00065                     vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; verts2d,
<a name="l00066"></a>00066                     vcl_vector&lt;double&gt;&amp; depths)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068   verts2d.resize(verts3d.<a class="code" href="classimesh__vertex__array.html#a89539d3e40b411109649389c7a2fd6fa" title="returns the number of vertices.">size</a>());
<a name="l00069"></a>00069   depths.resize(verts3d.<a class="code" href="classimesh__vertex__array.html#a89539d3e40b411109649389c7a2fd6fa" title="returns the number of vertices.">size</a>());
<a name="l00070"></a>00070   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;verts3d.<a class="code" href="classimesh__vertex__array.html#a89539d3e40b411109649389c7a2fd6fa" title="returns the number of vertices.">size</a>(); ++i) {
<a name="l00071"></a>00071     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__homg__point__2d.html">vgl_homg_point_2d&lt;double&gt;</a> pt = camera.project(verts3d[i]);
<a name="l00072"></a>00072     verts2d[i] = pt;
<a name="l00073"></a>00073     depths[i] = pt.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__homg__point__2d.html#ab452fbf6dec9591ff07c0ebb7b05f1e1">w</a>();
<a name="l00074"></a>00074   }
<a name="l00075"></a>00075 }
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="keywordtype">void</span>
<a name="l00079"></a><a class="code" href="imesh__project_8h.html#a6cd631bb3e519ab5e593dfe5688cde02">00079</a> <a class="code" href="imesh__project_8cxx.html#a6cd631bb3e519ab5e593dfe5688cde02" title="distort the 2D vertices using the lens.">imesh_distort_verts</a>(<span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; in_verts,
<a name="l00080"></a>00080                     <span class="keyword">const</span> bpgl_lens_distortion&lt;double&gt;&amp; lens,
<a name="l00081"></a>00081                     vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; out_verts)
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083   out_verts.resize(in_verts.size());
<a name="l00084"></a>00084   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;in_verts.size(); ++i)
<a name="l00085"></a>00085     out_verts[i] = lens.undistort(<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__homg__point__2d.html">vgl_homg_point_2d&lt;double&gt;</a>(in_verts[i]));
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">//: Render a triangle defined by its vertices</span>
<a name="l00090"></a><a class="code" href="imesh__project_8cxx.html#a47610ef26dfbbfb6a22ef65a2e38d465">00090</a> <span class="keywordtype">void</span> <a class="code" href="imesh__project_8cxx.html#a47610ef26dfbbfb6a22ef65a2e38d465" title="Render a triangle defined by its vertices.">imesh_render_triangle</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; v1,
<a name="l00091"></a>00091                            <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; v2,
<a name="l00092"></a>00092                            <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; v3,
<a name="l00093"></a>00093                            vil_image_view&lt;bool&gt;&amp; image)
<a name="l00094"></a>00094 {
<a name="l00095"></a>00095   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html">vgl_triangle_scan_iterator&lt;double&gt;</a> tsi;
<a name="l00096"></a>00096   tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a7636b28a203d89065241c9e1db1a5661">a</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#ab9610fa3da9d378958a691d027e6905d">x</a> = v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>();  tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a7636b28a203d89065241c9e1db1a5661">a</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#a1a363c25b2b1df42c8669432cdd0a372">y</a> = v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>();
<a name="l00097"></a>00097   tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a08cb7203876e02e15df777cd6bf95df7">b</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#ab9610fa3da9d378958a691d027e6905d">x</a> = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>();  tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a08cb7203876e02e15df777cd6bf95df7">b</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#a1a363c25b2b1df42c8669432cdd0a372">y</a> = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>();
<a name="l00098"></a>00098   tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#ae5cbf04a60e5d6ac819cca4827f360c8">c</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#ab9610fa3da9d378958a691d027e6905d">x</a> = v3.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>();  tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#ae5cbf04a60e5d6ac819cca4827f360c8">c</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#a1a363c25b2b1df42c8669432cdd0a372">y</a> = v3.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>();
<a name="l00099"></a>00099   <span class="keywordflow">for</span> (tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a5175fe83cef4dea6abdbce3494383240">reset</a>(); tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a6206acad03b4692dc0bda3ef69e3573b">next</a>(); ) {
<a name="l00100"></a>00100     <span class="keywordtype">int</span> y = tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#ab1c1df182032248f67da4ff1518a1222">scany</a>();
<a name="l00101"></a>00101     <span class="keywordflow">if</span> (y&lt;0 || y&gt;=<span class="keywordtype">int</span>(image.nj())) <span class="keywordflow">continue</span>;
<a name="l00102"></a>00102     <span class="keywordtype">int</span> min_x = tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a4042bffed4c33369038cf026ac1c1f2b">startx</a>();
<a name="l00103"></a>00103     <span class="keywordtype">int</span> max_x = tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a122cb28ad60903d8983b7ff926e0952a">endx</a>();
<a name="l00104"></a>00104     <span class="keywordflow">if</span> (min_x &gt;= (<span class="keywordtype">int</span>)image.ni() || max_x &lt; 0)
<a name="l00105"></a>00105       <span class="keywordflow">continue</span>;
<a name="l00106"></a>00106     <span class="keywordflow">if</span> (min_x &lt; 0) min_x = 0;
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (max_x &gt;= (<span class="keywordtype">int</span>)image.ni()) max_x = image.ni()-1;
<a name="l00108"></a>00108     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = min_x; x &lt;= max_x; ++x) {
<a name="l00109"></a>00109       image(x,y) = <span class="keyword">true</span>;
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111   }
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="comment">//: Render a triangle defined by its vertices</span>
<a name="l00116"></a><a class="code" href="imesh__project_8h.html#a54f5569e9bc036a70f825ddd208f1678">00116</a> <span class="keywordtype">void</span> <a class="code" href="imesh__project_8cxx.html#a54f5569e9bc036a70f825ddd208f1678" title="Render a triangle defined by its vertices.">imesh_render_triangle_interp</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; v1,
<a name="l00117"></a>00117                                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; v2,
<a name="l00118"></a>00118                                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; v3,
<a name="l00119"></a>00119                                   <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; i1, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; i2, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; i3,
<a name="l00120"></a>00120                                   vil_image_view&lt;double&gt;&amp; image)
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html">vgl_triangle_scan_iterator&lt;double&gt;</a> tsi;
<a name="l00123"></a>00123   tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a7636b28a203d89065241c9e1db1a5661">a</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#ab9610fa3da9d378958a691d027e6905d">x</a>= v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>();  tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a7636b28a203d89065241c9e1db1a5661">a</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#a1a363c25b2b1df42c8669432cdd0a372">y</a> = v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>();
<a name="l00124"></a>00124   tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a08cb7203876e02e15df777cd6bf95df7">b</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#ab9610fa3da9d378958a691d027e6905d">x</a> = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>();  tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a08cb7203876e02e15df777cd6bf95df7">b</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#a1a363c25b2b1df42c8669432cdd0a372">y</a> = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>();
<a name="l00125"></a>00125   tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#ae5cbf04a60e5d6ac819cca4827f360c8">c</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#ab9610fa3da9d378958a691d027e6905d">x</a> = v3.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>();  tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#ae5cbf04a60e5d6ac819cca4827f360c8">c</a>.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/structvgl__triangle__scan__iterator_1_1pt.html#a1a363c25b2b1df42c8669432cdd0a372">y</a> = v3.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>();
<a name="l00126"></a>00126   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> b1(v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()-v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(), v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()-v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>(), i2-i1);
<a name="l00127"></a>00127   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> b2(v3.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()-v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(), v3.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()-v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>(), i3-i1);
<a name="l00128"></a>00128   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> n = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#ae238212d8b18ea93da5fba3f397f984a">cross_product</a>(b1,b2);
<a name="l00129"></a>00129   <span class="keywordtype">double</span> A = -n.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>()/n.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>();
<a name="l00130"></a>00130   <span class="keywordtype">double</span> B = -n.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>()/n.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>();
<a name="l00131"></a>00131   <span class="keywordtype">double</span> C = (v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()*n.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>() + v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()*n.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>() + i1*n.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>())/n.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>();
<a name="l00132"></a>00132   <span class="keywordflow">for</span> (tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a5175fe83cef4dea6abdbce3494383240">reset</a>(); tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a6206acad03b4692dc0bda3ef69e3573b">next</a>(); ) {
<a name="l00133"></a>00133     <span class="keywordtype">int</span> y = tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#ab1c1df182032248f67da4ff1518a1222">scany</a>();
<a name="l00134"></a>00134     <span class="keywordflow">if</span> (y&lt;0 || y&gt;=<span class="keywordtype">int</span>(image.nj())) <span class="keywordflow">continue</span>;
<a name="l00135"></a>00135     <span class="keywordtype">int</span> min_x = tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a4042bffed4c33369038cf026ac1c1f2b">startx</a>();
<a name="l00136"></a>00136     <span class="keywordtype">int</span> max_x = tsi.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__triangle__scan__iterator.html#a122cb28ad60903d8983b7ff926e0952a">endx</a>();
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (min_x &gt;= (<span class="keywordtype">int</span>)image.ni() || max_x &lt; 0)
<a name="l00138"></a>00138       <span class="keywordflow">continue</span>;
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (min_x &lt; 0) min_x = 0;
<a name="l00140"></a>00140     <span class="keywordflow">if</span> (max_x &gt;= (<span class="keywordtype">int</span>)image.ni()) max_x = image.ni()-1;
<a name="l00141"></a>00141     <span class="keywordtype">double</span> new_i = B*y+C;
<a name="l00142"></a>00142     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = min_x; x &lt;= max_x; ++x) {
<a name="l00143"></a>00143       <span class="keywordtype">double</span> depth = new_i + A*x;
<a name="l00144"></a>00144       <span class="keywordflow">if</span> (depth &lt; image(x,y))
<a name="l00145"></a>00145         image(x,y) = depth;
<a name="l00146"></a>00146     }
<a name="l00147"></a>00147   }
<a name="l00148"></a>00148 }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="keywordtype">void</span>
<a name="l00152"></a><a class="code" href="imesh__project_8cxx.html#a1ac39238076ef35845a27137ebd66b0e">00152</a> <a class="code" href="imesh__project_8cxx.html#a1ac39238076ef35845a27137ebd66b0e">imesh_render_triangles</a>(<span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp; tris,
<a name="l00153"></a>00153                        <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; img_verts,
<a name="l00154"></a>00154                        vil_image_view&lt;bool&gt;&amp; image)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;tris.<a class="code" href="classimesh__regular__face__array.html#a0bce851a5654124af302093c4fa836be" title="returns the number of faces.">size</a>(); ++i) {
<a name="l00157"></a>00157     <a class="code" href="imesh__project_8cxx.html#a47610ef26dfbbfb6a22ef65a2e38d465" title="Render a triangle defined by its vertices.">imesh_render_triangle</a>(img_verts[tris(i,0)],
<a name="l00158"></a>00158                           img_verts[tris(i,1)],
<a name="l00159"></a>00159                           img_verts[tris(i,2)],
<a name="l00160"></a>00160                           image);
<a name="l00161"></a>00161   }
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="keywordtype">void</span>
<a name="l00166"></a><a class="code" href="imesh__project_8cxx.html#a518819828add08636d52fdbb281ffe26">00166</a> <a class="code" href="imesh__project_8cxx.html#a518819828add08636d52fdbb281ffe26">imesh_render_faces</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00167"></a>00167                    <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; img_verts,
<a name="l00168"></a>00168                    vil_image_view&lt;bool&gt;&amp; image)
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170   <span class="keyword">const</span> <a class="code" href="classimesh__face__array__base.html" title="Abstract base class for a collection of faces.">imesh_face_array_base</a>&amp; faces = mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>();
<a name="l00171"></a>00171   vcl_auto_ptr&lt;imesh_regular_face_array&lt;3&gt; &gt; tri_data;
<a name="l00172"></a>00172   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>* tris;
<a name="l00173"></a>00173   <span class="keywordflow">if</span> (faces.<a class="code" href="classimesh__face__array__base.html#a2384d28fc0f452535ab21e9f13ae9830" title="returns the number of vertices per face if the same for all faces, zero otherwise.">regularity</a>() != 3) {
<a name="l00174"></a>00174     tri_data = <a class="code" href="imesh__operations_8cxx.html#a4837785b66816f4aca2a86bdee043642" title="Subdivide mesh faces into triangle.">imesh_triangulate</a>(faces);
<a name="l00175"></a>00175     tris = tri_data.get();
<a name="l00176"></a>00176   }
<a name="l00177"></a>00177   <span class="keywordflow">else</span> {
<a name="l00178"></a>00178     tris = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>*<span class="keyword">&gt;</span>(&amp;faces);
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180   <a class="code" href="imesh__project_8cxx.html#a1ac39238076ef35845a27137ebd66b0e">imesh_render_triangles</a>(*tris,img_verts,image);
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="keywordtype">void</span>
<a name="l00185"></a><a class="code" href="imesh__project_8h.html#a1aeafa01a649e3521929fd21e97c2e44">00185</a> <a class="code" href="imesh__project_8cxx.html#a1aeafa01a649e3521929fd21e97c2e44" title="Render the faces of the mesh into the image by interpolating the values at the vertices.">imesh_render_triangles_interp</a>(<span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp; tris,
<a name="l00186"></a>00186                               <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; img_verts,
<a name="l00187"></a>00187                               <span class="keyword">const</span> vcl_vector&lt;double&gt;&amp; vals,
<a name="l00188"></a>00188                               vil_image_view&lt;double&gt;&amp; image)
<a name="l00189"></a>00189 {
<a name="l00190"></a>00190   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;tris.<a class="code" href="classimesh__regular__face__array.html#a0bce851a5654124af302093c4fa836be" title="returns the number of faces.">size</a>(); ++i) {
<a name="l00191"></a>00191     <span class="keyword">const</span> <a class="code" href="classimesh__regular__face.html">imesh_regular_face&lt;3&gt;</a>&amp; tri = tris[i];
<a name="l00192"></a>00192     <a class="code" href="imesh__project_8cxx.html#a54f5569e9bc036a70f825ddd208f1678" title="Render a triangle defined by its vertices.">imesh_render_triangle_interp</a>(img_verts[tri[0]],
<a name="l00193"></a>00193                                  img_verts[tri[1]],
<a name="l00194"></a>00194                                  img_verts[tri[2]],
<a name="l00195"></a>00195                                  vals[tri[0]],
<a name="l00196"></a>00196                                  vals[tri[1]],
<a name="l00197"></a>00197                                  vals[tri[2]],
<a name="l00198"></a>00198                                  image);
<a name="l00199"></a>00199   }
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="keywordtype">void</span>
<a name="l00203"></a><a class="code" href="imesh__project_8h.html#ae48f4016ff5d85166e6d5e01772b32f7">00203</a> <a class="code" href="imesh__project_8cxx.html#ae48f4016ff5d85166e6d5e01772b32f7" title="Triangulates the faces and then calls imesh_render_triangles_interp.">imesh_render_faces_interp</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00204"></a>00204                           <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; img_verts,
<a name="l00205"></a>00205                           <span class="keyword">const</span> vcl_vector&lt;double&gt;&amp; vals,
<a name="l00206"></a>00206                           vil_image_view&lt;double&gt;&amp; image)
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208   <span class="keyword">const</span> <a class="code" href="classimesh__face__array__base.html" title="Abstract base class for a collection of faces.">imesh_face_array_base</a>&amp; faces = mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>();
<a name="l00209"></a>00209   vcl_auto_ptr&lt;imesh_regular_face_array&lt;3&gt; &gt; tri_data;
<a name="l00210"></a>00210   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>* tris;
<a name="l00211"></a>00211   <span class="keywordflow">if</span> (faces.<a class="code" href="classimesh__face__array__base.html#a2384d28fc0f452535ab21e9f13ae9830" title="returns the number of vertices per face if the same for all faces, zero otherwise.">regularity</a>() != 3) {
<a name="l00212"></a>00212     tri_data = <a class="code" href="imesh__operations_8cxx.html#a4837785b66816f4aca2a86bdee043642" title="Subdivide mesh faces into triangle.">imesh_triangulate</a>(faces);
<a name="l00213"></a>00213     tris = tri_data.get();
<a name="l00214"></a>00214   }
<a name="l00215"></a>00215   <span class="keywordflow">else</span> {
<a name="l00216"></a>00216     tris = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>*<span class="keyword">&gt;</span>(&amp;faces);
<a name="l00217"></a>00217   }
<a name="l00218"></a>00218   <a class="code" href="imesh__project_8cxx.html#a1aeafa01a649e3521929fd21e97c2e44" title="Render the faces of the mesh into the image by interpolating the values at the vertices.">imesh_render_triangles_interp</a>(*tris,img_verts,vals,image);
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="comment">//: project the mesh onto the image plane using the camera and lens distortion</span>
<a name="l00223"></a>00223 <span class="comment">//  Set each pixel of the image to true if the mesh project onto it</span>
<a name="l00224"></a><a class="code" href="imesh__project_8h.html#a4896998dc03a6085d01f05b019f9bf1d">00224</a> <span class="keywordtype">void</span> <a class="code" href="imesh__project_8cxx.html#a4896998dc03a6085d01f05b019f9bf1d" title="project the mesh onto the image plane using the camera and lens distortion.">imesh_project</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00225"></a>00225                    <span class="keyword">const</span> vpgl_proj_camera&lt;double&gt;&amp; camera,
<a name="l00226"></a>00226                    <span class="keyword">const</span> bpgl_lens_distortion&lt;double&gt;&amp; lens,
<a name="l00227"></a>00227                    vil_image_view&lt;bool&gt;&amp; image)
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229   assert(mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>().<a class="code" href="classimesh__vertex__array__base.html#a1d44c26595aee4d33d77f64d75ae571d" title="returns the dimension of the vertices.">dim</a>() == 3);
<a name="l00230"></a>00230   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts3d =
<a name="l00231"></a>00231       <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp;<span class="keyword">&gt;</span>(mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>());
<a name="l00232"></a>00232   vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt; verts2d;
<a name="l00233"></a>00233   <a class="code" href="imesh__project_8cxx.html#a33a4498a2b8100719b797b675d254992" title="project the 3D vertices into 2D using the camera.">imesh_project_verts</a>(verts3d, camera, verts2d);
<a name="l00234"></a>00234   <a class="code" href="imesh__project_8cxx.html#a6cd631bb3e519ab5e593dfe5688cde02" title="distort the 2D vertices using the lens.">imesh_distort_verts</a>(verts2d, lens, verts2d);
<a name="l00235"></a>00235   <a class="code" href="imesh__project_8cxx.html#a518819828add08636d52fdbb281ffe26">imesh_render_faces</a>(mesh, verts2d, image);
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 <span class="comment">//: project the front-facing triangles of the mesh onto the image plane</span>
<a name="l00240"></a>00240 <span class="comment">//  Using the camera and lens distortion</span>
<a name="l00241"></a>00241 <span class="comment">//  Set each pixel of the image to true if the mesh projects onto it</span>
<a name="l00242"></a><a class="code" href="imesh__project_8h.html#a9579cdd45df6d39d476fb18c102e2d61">00242</a> <span class="keywordtype">void</span> <a class="code" href="imesh__project_8cxx.html#a4896998dc03a6085d01f05b019f9bf1d" title="project the mesh onto the image plane using the camera and lens distortion.">imesh_project</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00243"></a>00243                    <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> &gt;&amp; normals,
<a name="l00244"></a>00244                    <span class="keyword">const</span> vpgl_proj_camera&lt;double&gt;&amp; camera,
<a name="l00245"></a>00245                    <span class="keyword">const</span> bpgl_lens_distortion&lt;double&gt;&amp; lens,
<a name="l00246"></a>00246                    vil_image_view&lt;bool&gt;&amp; image,
<a name="l00247"></a>00247                    <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html">vgl_box_2d&lt;unsigned int&gt;</a>* bbox)
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249   <span class="keyword">const</span> <a class="code" href="classimesh__face__array__base.html" title="Abstract base class for a collection of faces.">imesh_face_array_base</a>&amp; faces = mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>();
<a name="l00250"></a>00250   vcl_auto_ptr&lt;imesh_regular_face_array&lt;3&gt; &gt; tri_data;
<a name="l00251"></a>00251   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>* tri_ptr;
<a name="l00252"></a>00252   <span class="keywordflow">if</span> (faces.<a class="code" href="classimesh__face__array__base.html#a2384d28fc0f452535ab21e9f13ae9830" title="returns the number of vertices per face if the same for all faces, zero otherwise.">regularity</a>() != 3) {
<a name="l00253"></a>00253     tri_data = <a class="code" href="imesh__operations_8cxx.html#a4837785b66816f4aca2a86bdee043642" title="Subdivide mesh faces into triangle.">imesh_triangulate</a>(faces);
<a name="l00254"></a>00254     tri_ptr = tri_data.get();
<a name="l00255"></a>00255   }
<a name="l00256"></a>00256   <span class="keywordflow">else</span> {
<a name="l00257"></a>00257     tri_ptr = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>*<span class="keyword">&gt;</span>(&amp;faces);
<a name="l00258"></a>00258   }
<a name="l00259"></a>00259   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp; tris = *tri_ptr;
<a name="l00260"></a>00260   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts3d = mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>&lt;3&gt;();
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt; verts2d;
<a name="l00263"></a>00263   <a class="code" href="imesh__project_8cxx.html#a33a4498a2b8100719b797b675d254992" title="project the 3D vertices into 2D using the camera.">imesh_project_verts</a>(verts3d, camera, verts2d);
<a name="l00264"></a>00264   <a class="code" href="imesh__project_8cxx.html#a6cd631bb3e519ab5e593dfe5688cde02" title="distort the 2D vertices using the lens.">imesh_distort_verts</a>(verts2d, lens, verts2d);
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   <span class="keywordflow">if</span> (bbox) {
<a name="l00267"></a>00267     bbox-&gt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a41b9cf6985e27c476b6f7ecfc642fd5d">set_min_x</a>(0);  bbox-&gt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a2c02ebae4da29539a6d4bc7a6f3edf10">set_min_y</a>(0);
<a name="l00268"></a>00268     bbox-&gt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#aff21c00fcef546a48831302bee2dd5b2">set_max_x</a>(image.ni()-1);  bbox-&gt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a5ce2b94d626c8d3b483977fb91ecc35b">set_max_y</a>(image.nj()-1);
<a name="l00269"></a>00269     <a class="code" href="imesh__project_8cxx.html#a53a7af6573a97e084eec14b61d632b40" title="Compute the bounds of the projection of a set of image points.">imesh_projection_bounds</a>(verts2d,*bbox);
<a name="l00270"></a>00270   }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__homg__point__3d.html">vgl_homg_point_3d&lt;double&gt;</a> c(camera.camera_center());
<a name="l00273"></a>00273   <span class="keywordflow">if</span> (c.w() &lt; 0.0)
<a name="l00274"></a>00274     c.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__homg__point__3d.html#a316d529aeb0d52b253754d76ce5996dc">rescale_w</a>(-c.w());
<a name="l00275"></a>00275 
<a name="l00276"></a>00276   <span class="keyword">typedef</span> vcl_vector&lt;vgl_vector_3d&lt;double&gt; &gt;::const_iterator itr_n;
<a name="l00277"></a>00277   itr_n n = normals.begin();
<a name="l00278"></a>00278   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;tris.<a class="code" href="classimesh__regular__face__array.html#a0bce851a5654124af302093c4fa836be" title="returns the number of faces.">size</a>(); ++i, ++n) {
<a name="l00279"></a>00279     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a>&amp; v1 = verts3d[tris(i,0)];
<a name="l00280"></a>00280     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> d(c.x()-v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html#a1ad910614a911c7d322c086438d6441d">x</a>()*c.w(),
<a name="l00281"></a>00281                             c.y()-v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html#a6fcfebd50c3f8570fafd49df0687feb2">y</a>()*c.w(),
<a name="l00282"></a>00282                             c.z()-v1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html#a477066fab00b63b2641305fb7e41fb62">z</a>()*c.w());
<a name="l00283"></a>00283     <span class="keywordflow">if</span> (<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(*n,d) &lt; 0.0)
<a name="l00284"></a>00284       <span class="keywordflow">continue</span>;
<a name="l00285"></a>00285     <a class="code" href="imesh__project_8cxx.html#a47610ef26dfbbfb6a22ef65a2e38d465" title="Render a triangle defined by its vertices.">imesh_render_triangle</a>(verts2d[tris(i,0)],
<a name="l00286"></a>00286                           verts2d[tris(i,1)],
<a name="l00287"></a>00287                           verts2d[tris(i,2)],
<a name="l00288"></a>00288                           image);
<a name="l00289"></a>00289   }
<a name="l00290"></a>00290 }
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="comment">//: project the mesh onto the image plane using the camera</span>
<a name="l00294"></a>00294 <span class="comment">//  Set each pixel of the image to true if the mesh projects onto it</span>
<a name="l00295"></a><a class="code" href="imesh__project_8h.html#a17f00c3026594d4b9c3cc3b04a583b96">00295</a> <span class="keywordtype">void</span> <a class="code" href="imesh__project_8cxx.html#a4896998dc03a6085d01f05b019f9bf1d" title="project the mesh onto the image plane using the camera and lens distortion.">imesh_project</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00296"></a>00296                    <span class="keyword">const</span> vpgl_proj_camera&lt;double&gt;&amp; camera,
<a name="l00297"></a>00297                    vil_image_view&lt;bool&gt;&amp; image)
<a name="l00298"></a>00298 {
<a name="l00299"></a>00299   assert(mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>().<a class="code" href="classimesh__vertex__array__base.html#a1d44c26595aee4d33d77f64d75ae571d" title="returns the dimension of the vertices.">dim</a>() == 3);
<a name="l00300"></a>00300   vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt; verts2d;
<a name="l00301"></a>00301   <a class="code" href="imesh__project_8cxx.html#a33a4498a2b8100719b797b675d254992" title="project the 3D vertices into 2D using the camera.">imesh_project_verts</a>(mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>&lt;3&gt;(), camera, verts2d);
<a name="l00302"></a>00302   <a class="code" href="imesh__project_8cxx.html#a518819828add08636d52fdbb281ffe26">imesh_render_faces</a>(mesh, verts2d, image);
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">//: project the mesh onto the image plane using the camera</span>
<a name="l00307"></a>00307 <span class="comment">//  Set each pixel of the image to the depth to the mesh</span>
<a name="l00308"></a><a class="code" href="imesh__project_8h.html#aa1e38c8a5f288e3d47e4921637092a5b">00308</a> <span class="keywordtype">void</span> <a class="code" href="imesh__project_8cxx.html#aa1e38c8a5f288e3d47e4921637092a5b" title="project the mesh onto the image plane using the camera.">imesh_project_depth</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00309"></a>00309                          <span class="keyword">const</span> vpgl_proj_camera&lt;double&gt;&amp; camera,
<a name="l00310"></a>00310                          vil_image_view&lt;double&gt;&amp; image)
<a name="l00311"></a>00311 {
<a name="l00312"></a>00312   assert(mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>().<a class="code" href="classimesh__vertex__array__base.html#a1d44c26595aee4d33d77f64d75ae571d" title="returns the dimension of the vertices.">dim</a>() == 3);
<a name="l00313"></a>00313   vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt; verts2d;
<a name="l00314"></a>00314   vcl_vector&lt;double&gt; depths;
<a name="l00315"></a>00315   image.fill(vcl_numeric_limits&lt;double&gt;::infinity());
<a name="l00316"></a>00316   <a class="code" href="imesh__project_8cxx.html#a33a4498a2b8100719b797b675d254992" title="project the 3D vertices into 2D using the camera.">imesh_project_verts</a>(mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>&lt;3&gt;(), camera, verts2d, depths);
<a name="l00317"></a>00317   <a class="code" href="imesh__project_8cxx.html#ae48f4016ff5d85166e6d5e01772b32f7" title="Triangulates the faces and then calls imesh_render_triangles_interp.">imesh_render_faces_interp</a>(mesh, verts2d, depths, image);
<a name="l00318"></a>00318 }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 
<a name="l00321"></a>00321 <span class="comment">//: Compute the bounds of the projection of a set of image points</span>
<a name="l00322"></a>00322 <span class="comment">//  The returned bounds are the intersection of the input bounds</span>
<a name="l00323"></a>00323 <span class="comment">// and the bounding box of the points</span>
<a name="l00324"></a><a class="code" href="imesh__project_8h.html#a53a7af6573a97e084eec14b61d632b40">00324</a> <span class="keywordtype">void</span> <a class="code" href="imesh__project_8cxx.html#a53a7af6573a97e084eec14b61d632b40" title="Compute the bounds of the projection of a set of image points.">imesh_projection_bounds</a>(<span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; img_pts,
<a name="l00325"></a>00325                              <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html">vgl_box_2d&lt;unsigned int&gt;</a>&amp; bbox)
<a name="l00326"></a>00326 {
<a name="l00327"></a>00327   assert(!img_pts.empty());
<a name="l00328"></a>00328   <span class="keyword">typedef</span> vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt;::const_iterator itr_p;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330   <span class="keywordtype">int</span> i0 = bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a1e0a7d799b8061e4cbf0282850ca38b9">max_x</a>(), i1 = bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a9b033f4a971cf6a86c0f281310dafd51">min_x</a>(),
<a name="l00331"></a>00331       j0 = bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a091bf54fb98be0b5c08b14209f6c50bf">max_y</a>(), j1 = bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#ad24cb8db7515810e3683a52114e60a22">min_y</a>();
<a name="l00332"></a>00332   <span class="keywordflow">for</span> (itr_p p = img_pts.begin(); p != img_pts.end(); ++p) {
<a name="l00333"></a>00333     <span class="keywordtype">double</span> x = p-&gt;x(), y = p-&gt;y();
<a name="l00334"></a>00334     <span class="keywordtype">int</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(vcl_ceil(x))-1;
<a name="l00335"></a>00335     <span class="keywordflow">if</span> (v &lt; i0) i0 = v;
<a name="l00336"></a>00336     v = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(vcl_floor(x))+1;
<a name="l00337"></a>00337     <span class="keywordflow">if</span> (v &gt; i1) i1 = v;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     v = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(vcl_ceil(y))-1;
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (v &lt; j0) j0 = v;
<a name="l00341"></a>00341     v = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(vcl_floor(y))+1;
<a name="l00342"></a>00342     <span class="keywordflow">if</span> (v &gt; j1) j1 = v;
<a name="l00343"></a>00343   }
<a name="l00344"></a>00344   <span class="keywordflow">if</span> (i0 &gt; static_cast&lt;int&gt;(bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a9b033f4a971cf6a86c0f281310dafd51">min_x</a>())) bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a41b9cf6985e27c476b6f7ecfc642fd5d">set_min_x</a>(static_cast&lt;unsigned int&gt;(i0));
<a name="l00345"></a>00345   <span class="keywordflow">if</span> (i1 &lt; static_cast&lt;int&gt;(bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a1e0a7d799b8061e4cbf0282850ca38b9">max_x</a>())) bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#aff21c00fcef546a48831302bee2dd5b2">set_max_x</a>(static_cast&lt;unsigned int&gt;(i1));
<a name="l00346"></a>00346   <span class="keywordflow">if</span> (j0 &gt; static_cast&lt;int&gt;(bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#ad24cb8db7515810e3683a52114e60a22">min_y</a>())) bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a2c02ebae4da29539a6d4bc7a6f3edf10">set_min_y</a>(static_cast&lt;unsigned int&gt;(j0));
<a name="l00347"></a>00347   <span class="keywordflow">if</span> (j1 &lt; static_cast&lt;int&gt;(bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a091bf54fb98be0b5c08b14209f6c50bf">max_y</a>())) bbox.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html#a5ce2b94d626c8d3b483977fb91ecc35b">set_max_y</a>(static_cast&lt;unsigned int&gt;(j1));
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="comment">//: back project an image point onto the mesh using the camera</span>
<a name="l00352"></a>00352 <span class="comment">//  Return true if the ray intersects the mesh</span>
<a name="l00353"></a><a class="code" href="imesh__project_8h.html#a9fb8c05559a34fac487b36de928b91cd">00353</a> <span class="keywordtype">int</span> <a class="code" href="imesh__project_8cxx.html#a9fb8c05559a34fac487b36de928b91cd" title="back project an image point onto the mesh using the camera.">imesh_project_onto_mesh</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00354"></a>00354                             <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> &gt;&amp; normals,
<a name="l00355"></a>00355                             <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; verts2d,
<a name="l00356"></a>00356                             <span class="keyword">const</span> vpgl_perspective_camera&lt;double&gt;&amp; camera,
<a name="l00357"></a>00357                             <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_2d,
<a name="l00358"></a>00358                             <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a>&amp; pt_3d)
<a name="l00359"></a>00359 {
<a name="l00360"></a>00360   <span class="keywordtype">int</span> tri_idx = -1;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__3d__2__points.html">vgl_line_3d_2_points&lt;double&gt;</a> ray = camera.backproject(pt_2d);
<a name="l00363"></a>00363   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> d = ray.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__3d__2__points.html#a8b12d362528e44d7c0967db3132d5fa2">direction</a>();
<a name="l00364"></a>00364   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#ac4986a4b72b1d54b872d5863ac35d3e8">normalize</a>(d);
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> center = camera.get_camera_center();
<a name="l00367"></a>00367 
<a name="l00368"></a>00368   <span class="comment">// get mesh faces as triangles</span>
<a name="l00369"></a>00369   assert(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>().<a class="code" href="classimesh__face__array__base.html#a2384d28fc0f452535ab21e9f13ae9830" title="returns the number of vertices per face if the same for all faces, zero otherwise.">regularity</a>() == 3);
<a name="l00370"></a>00370   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp; tris =
<a name="l00371"></a>00371       <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp;<span class="keyword">&gt;</span>(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>());
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   assert(mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>().<a class="code" href="classimesh__vertex__array__base.html#a1d44c26595aee4d33d77f64d75ae571d" title="returns the dimension of the vertices.">dim</a>() == 3);
<a name="l00374"></a>00374   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts3d = mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>&lt;3&gt;();
<a name="l00375"></a>00375 
<a name="l00376"></a>00376   <span class="keyword">typedef</span> <a class="code" href="classimesh__regular__face__array.html#a1a744815292e098dec6ba18a2899b05c">imesh_regular_face_array&lt;3&gt;::const_iterator</a> itr_t;
<a name="l00377"></a>00377   <span class="keyword">typedef</span> vcl_vector&lt;vgl_vector_3d&lt;double&gt; &gt;::const_iterator itr_n;
<a name="l00378"></a>00378   itr_n n = normals.begin();
<a name="l00379"></a>00379   <span class="keywordtype">double</span> depth = vcl_numeric_limits&lt;double&gt;::infinity();
<a name="l00380"></a>00380   <span class="keywordtype">int</span> i = 0;
<a name="l00381"></a>00381   <span class="keywordflow">for</span> (itr_t itr = tris.begin(); itr != tris.end(); ++itr, ++n, ++i) {
<a name="l00382"></a>00382     <span class="keywordflow">if</span> (<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(*n,d) &gt; 0.0)
<a name="l00383"></a>00383       <span class="keywordflow">continue</span>;
<a name="l00384"></a>00384     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a = verts2d[(*itr)[0]];
<a name="l00385"></a>00385     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b = verts2d[(*itr)[1]];
<a name="l00386"></a>00386     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c = verts2d[(*itr)[2]];
<a name="l00387"></a>00387     <span class="keywordflow">if</span> (vgl_triangle_test_inside&lt;double&gt;(a.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(), a.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>(), b.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(), b.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>(),
<a name="l00388"></a>00388                                         c.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(), c.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>(), pt_2d.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(), pt_2d.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>())) {
<a name="l00389"></a>00389       <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__plane__3d.html">vgl_plane_3d&lt;double&gt;</a> tri(verts3d[(*itr)[0]],
<a name="l00390"></a>00390                                verts3d[(*itr)[1]],
<a name="l00391"></a>00391                                verts3d[(*itr)[2]]);
<a name="l00392"></a>00392       <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> pt3 = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/algo_2vgl__intersection_8h.html#a64447bf999aea2432ca2760d8839ec48">vgl_intersection</a>(ray, tri);
<a name="l00393"></a>00393       <span class="keywordtype">double</span> dist = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__distance_8h.html#ac9930d1f03c451335bece92966734504">vgl_distance</a>(pt3,center);
<a name="l00394"></a>00394       <span class="keywordflow">if</span> (dist &lt; depth) {
<a name="l00395"></a>00395         depth = dist;
<a name="l00396"></a>00396         pt_3d = pt3;
<a name="l00397"></a>00397         tri_idx = i;
<a name="l00398"></a>00398       }
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400   }
<a name="l00401"></a>00401   <span class="keywordflow">return</span> tri_idx;
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="comment">//: back project image points onto the mesh using the camera</span>
<a name="l00406"></a>00406 <span class="comment">//  Returns a vector of all valid 3d points and indices to corresponding 2d points</span>
<a name="l00407"></a><a class="code" href="imesh__project_8h.html#a0e54f8d7a4d5a19b84aca56b5c3c80da">00407</a> <span class="keywordtype">void</span> <a class="code" href="imesh__project_8cxx.html#a9fb8c05559a34fac487b36de928b91cd" title="back project an image point onto the mesh using the camera.">imesh_project_onto_mesh</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00408"></a>00408                              <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> &gt;&amp; normals,
<a name="l00409"></a>00409                              <span class="keyword">const</span> vpgl_perspective_camera&lt;double&gt;&amp; camera,
<a name="l00410"></a>00410                              <span class="keyword">const</span> vcl_vector&lt; <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; pts_2d,
<a name="l00411"></a>00411                              vcl_vector&lt;unsigned int &gt;&amp; idx_2d,
<a name="l00412"></a>00412                              vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> &gt;&amp; pts_3d)
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414   vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt; verts2d;
<a name="l00415"></a>00415   assert(mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>().<a class="code" href="classimesh__vertex__array__base.html#a1d44c26595aee4d33d77f64d75ae571d" title="returns the dimension of the vertices.">dim</a>() == 3);
<a name="l00416"></a>00416   <a class="code" href="imesh__project_8cxx.html#a33a4498a2b8100719b797b675d254992" title="project the 3D vertices into 2D using the camera.">imesh_project_verts</a>(mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>&lt;3&gt;(), camera, verts2d);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> pt_3d;
<a name="l00419"></a>00419   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;pts_2d.size(); ++i)
<a name="l00420"></a>00420   {
<a name="l00421"></a>00421     <span class="keywordflow">if</span> (<a class="code" href="imesh__project_8cxx.html#a9fb8c05559a34fac487b36de928b91cd" title="back project an image point onto the mesh using the camera.">imesh_project_onto_mesh</a>(mesh, normals, verts2d, camera, pts_2d[i], pt_3d)) {
<a name="l00422"></a>00422       pts_3d.push_back(pt_3d);
<a name="l00423"></a>00423       idx_2d.push_back(i);
<a name="l00424"></a>00424     }
<a name="l00425"></a>00425   }
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 <span class="comment">// anonymous namespace</span>
<a name="l00430"></a>00430 <span class="keyword">namespace</span>{
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="keywordtype">void</span>
<a name="l00433"></a>00433 xy_to_barycentric(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_xy,
<a name="l00434"></a>00434                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a,
<a name="l00435"></a>00435                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b,
<a name="l00436"></a>00436                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c,
<a name="l00437"></a>00437                   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_bary)
<a name="l00438"></a>00438 {
<a name="l00439"></a>00439   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html">vgl_vector_2d&lt;double&gt;</a> v1(b-a), v2(c-a), <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__homg__line__2d_8txx.html#ad49b25478287e1337feef22ecbeed231">vp</a>(pt_xy-a);
<a name="l00440"></a>00440   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html">vgl_vector_2d&lt;double&gt;</a> v1n(-v1.y(), v1.x());
<a name="l00441"></a>00441   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html">vgl_vector_2d&lt;double&gt;</a> v2n(v2.y(), -v2.x());
<a name="l00442"></a>00442   <span class="keywordtype">double</span> s = 1.0/(v2.y()*v1.x() - v2.x()*v1.y());
<a name="l00443"></a>00443   pt_bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() = s * <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(v1n,vp);
<a name="l00444"></a>00444   pt_bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() = s * <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(v2n,vp);
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 <span class="keywordtype">void</span>
<a name="l00448"></a>00448 barycentric_to_xy(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_bary,
<a name="l00449"></a>00449                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a,
<a name="l00450"></a>00450                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b,
<a name="l00451"></a>00451                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c,
<a name="l00452"></a>00452                   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_xy)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454   <span class="keywordtype">double</span> z = 1.0 - pt_bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() - pt_bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>();
<a name="l00455"></a>00455   pt_xy.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() = z*a.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() + pt_bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()*b.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() + pt_bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()*c.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>();
<a name="l00456"></a>00456   pt_xy.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() = z*a.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() + pt_bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()*b.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() + pt_bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()*c.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>();
<a name="l00457"></a>00457 }
<a name="l00458"></a>00458 <span class="comment">// end of namespace</span>
<a name="l00459"></a>00459 };
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 <span class="comment">//: back project an image point onto the mesh using the camera</span>
<a name="l00463"></a>00463 <span class="comment">//  The resulting point is in barycentric coordinates for the returned triangle</span>
<a name="l00464"></a>00464 <span class="comment">//  Returns the index of the intersected triangle, or -1 for no intersection</span>
<a name="l00465"></a><a class="code" href="imesh__project_8h.html#a1a5ec14a39a3e3bff2f0937621897b96">00465</a> <span class="keywordtype">int</span> <a class="code" href="imesh__project_8cxx.html#a1a5ec14a39a3e3bff2f0937621897b96" title="back project an image point onto the mesh using the camera.">imesh_project_onto_mesh_barycentric</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00466"></a>00466                                         <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> &gt;&amp; normals,
<a name="l00467"></a>00467                                         <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; verts2d,
<a name="l00468"></a>00468                                         <span class="keyword">const</span> vpgl_perspective_camera&lt;double&gt;&amp; camera,
<a name="l00469"></a>00469                                         <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_img,
<a name="l00470"></a>00470                                         <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_bary)
<a name="l00471"></a>00471 {
<a name="l00472"></a>00472   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> pt_3d;
<a name="l00473"></a>00473 
<a name="l00474"></a>00474   <span class="comment">// get mesh faces as triangles</span>
<a name="l00475"></a>00475   assert(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>().<a class="code" href="classimesh__face__array__base.html#a2384d28fc0f452535ab21e9f13ae9830" title="returns the number of vertices per face if the same for all faces, zero otherwise.">regularity</a>() == 3);
<a name="l00476"></a>00476   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp; tris =
<a name="l00477"></a>00477       <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp;<span class="keyword">&gt;</span>(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>());
<a name="l00478"></a>00478 
<a name="l00479"></a>00479   <span class="keywordtype">int</span> tri_idx = <a class="code" href="imesh__project_8cxx.html#a9fb8c05559a34fac487b36de928b91cd" title="back project an image point onto the mesh using the camera.">imesh_project_onto_mesh</a>(mesh, normals, verts2d, camera, pt_img, pt_3d);
<a name="l00480"></a>00480   <span class="keywordflow">if</span> (tri_idx &gt;= 0) {
<a name="l00481"></a>00481     <span class="keyword">const</span> <a class="code" href="classimesh__regular__face.html">imesh_regular_face&lt;3&gt;</a>&amp; tri = tris[tri_idx];
<a name="l00482"></a>00482     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a = verts2d[tri[0]];
<a name="l00483"></a>00483     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b = verts2d[tri[1]];
<a name="l00484"></a>00484     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c = verts2d[tri[2]];
<a name="l00485"></a>00485     xy_to_barycentric(pt_img,a,b,c,pt_bary);
<a name="l00486"></a>00486   }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488   <span class="keywordflow">return</span> tri_idx;
<a name="l00489"></a>00489 }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 <span class="comment">//: back project an image point onto the mesh using the camera</span>
<a name="l00492"></a>00492 <span class="comment">//  Then project from the mesh into normalized texture coordinate (UV)</span>
<a name="l00493"></a>00493 <span class="comment">//  Assumes the mesh has both normals and texture coordinates</span>
<a name="l00494"></a>00494 <span class="comment">//  \returns the index of the intersected triangle, or -1 for no intersection</span>
<a name="l00495"></a><a class="code" href="imesh__project_8h.html#a8f95d85a9cc65f0822e885798d6b4a80">00495</a> <span class="keywordtype">int</span> <a class="code" href="imesh__project_8cxx.html#a8f95d85a9cc65f0822e885798d6b4a80" title="back project an image point onto the mesh using the camera.">imesh_project_onto_mesh_texture</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00496"></a>00496                                     <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; verts2d,
<a name="l00497"></a>00497                                     <span class="keyword">const</span> vpgl_perspective_camera&lt;double&gt;&amp; camera,
<a name="l00498"></a>00498                                     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_img,
<a name="l00499"></a>00499                                     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_uv)
<a name="l00500"></a>00500 {
<a name="l00501"></a>00501   <span class="keywordflow">if</span> (!mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>().<a class="code" href="classimesh__face__array__base.html#a9c35b446a46aeb20826ab17b00334199" title="Return true if the faces have normals.">has_normals</a>() || !mesh.<a class="code" href="classimesh__mesh.html#ab12f3001dfa1a43bca90aee0a7a40161" title="Returns texture coordinate availability.">has_tex_coords</a>())
<a name="l00502"></a>00502     <span class="keywordflow">return</span> -1;
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <span class="comment">// get mesh faces as triangles</span>
<a name="l00505"></a>00505   assert(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>().<a class="code" href="classimesh__face__array__base.html#a2384d28fc0f452535ab21e9f13ae9830" title="returns the number of vertices per face if the same for all faces, zero otherwise.">regularity</a>() == 3);
<a name="l00506"></a>00506   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp; tris =
<a name="l00507"></a>00507       <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp;<span class="keyword">&gt;</span>(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>());
<a name="l00508"></a>00508 
<a name="l00509"></a>00509   <span class="keyword">const</span> vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt;&amp; tex_coords = mesh.<a class="code" href="classimesh__mesh.html#a65e903b14ba2f870d227e6f8eafe9f4a" title="Return the texture coordinates.">tex_coords</a>();
<a name="l00510"></a>00510 
<a name="l00511"></a>00511   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> pt_bary;
<a name="l00512"></a>00512   <span class="keywordtype">int</span> tri_idx = <a class="code" href="imesh__project_8cxx.html#a1a5ec14a39a3e3bff2f0937621897b96" title="back project an image point onto the mesh using the camera.">imesh_project_onto_mesh_barycentric</a>(mesh, tris.normals(),
<a name="l00513"></a>00513                                                     verts2d, camera,
<a name="l00514"></a>00514                                                     pt_img, pt_bary);
<a name="l00515"></a>00515   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i1, i2, i3;
<a name="l00516"></a>00516   <span class="keywordflow">if</span> (mesh.<a class="code" href="classimesh__mesh.html#ab12f3001dfa1a43bca90aee0a7a40161" title="Returns texture coordinate availability.">has_tex_coords</a>() == <a class="code" href="classimesh__mesh.html#a21e233470b6ce89ff07187e5af06e06eaf02d743da2ea49ab2c7808f246bf8c61">imesh_mesh::TEX_COORD_ON_VERT</a>) {
<a name="l00517"></a>00517     <span class="keyword">const</span> <a class="code" href="classimesh__regular__face.html">imesh_regular_face&lt;3&gt;</a>&amp; tri = tris[tri_idx];
<a name="l00518"></a>00518     i1 = tri[0];
<a name="l00519"></a>00519     i2 = tri[1];
<a name="l00520"></a>00520     i3 = tri[2];
<a name="l00521"></a>00521   }
<a name="l00522"></a>00522   <span class="keywordflow">else</span> {
<a name="l00523"></a>00523     <a class="code" href="classimesh__half__edge__set_1_1f__const__iterator.html" title="A const iterator of half edges adjacent to a face.">imesh_half_edge_set::f_const_iterator</a> fi = mesh.<a class="code" href="classimesh__mesh.html#a33e77f683b5001cf3db0852519d84e55" title="Return the half edge set.">half_edges</a>().<a class="code" href="classimesh__half__edge__set.html#ad3a48821a815ddd8a891eacbb51c6048" title="Access a face iterator for face.">face_begin</a>(tri_idx);
<a name="l00524"></a>00524     assert(tris[tri_idx][0] == fi-&gt;vert_index());
<a name="l00525"></a>00525     i1 = fi-&gt;edge_index();
<a name="l00526"></a>00526     i2 = (++fi)-&gt;edge_index();
<a name="l00527"></a>00527     i3 = (++fi)-&gt;edge_index();
<a name="l00528"></a>00528   }
<a name="l00529"></a>00529   <span class="keywordflow">if</span> (tri_idx &gt;= 0) {
<a name="l00530"></a>00530     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a = tex_coords[i1];
<a name="l00531"></a>00531     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b = tex_coords[i2];
<a name="l00532"></a>00532     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c = tex_coords[i3];
<a name="l00533"></a>00533     barycentric_to_xy(pt_bary,a,b,c,pt_uv);
<a name="l00534"></a>00534   }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536   <span class="keywordflow">return</span> tri_idx;
<a name="l00537"></a>00537 }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 <span class="comment">//: project a texture point onto a mesh face index with barycentric coordinates</span>
<a name="l00541"></a>00541 <span class="comment">//  \returns the index of the intersected triangle, or -1 for no intersection</span>
<a name="l00542"></a><a class="code" href="imesh__project_8h.html#a66de7ee1c484f0abd87a33adf3981adc">00542</a> <span class="keywordtype">int</span> <a class="code" href="imesh__project_8cxx.html#a66de7ee1c484f0abd87a33adf3981adc" title="project a texture point onto a mesh face index with barycentric coordinates.">imesh_project_texture_to_barycentric</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00543"></a>00543                                          <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_2d,
<a name="l00544"></a>00544                                          <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_uv)
<a name="l00545"></a>00545 {
<a name="l00546"></a>00546   <span class="comment">// get mesh faces as triangles</span>
<a name="l00547"></a>00547   assert(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>().<a class="code" href="classimesh__face__array__base.html#a2384d28fc0f452535ab21e9f13ae9830" title="returns the number of vertices per face if the same for all faces, zero otherwise.">regularity</a>() == 3);
<a name="l00548"></a>00548   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp; tris =
<a name="l00549"></a>00549       <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp;<span class="keyword">&gt;</span>(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>());
<a name="l00550"></a>00550   <span class="keyword">typedef</span> <a class="code" href="classimesh__regular__face__array.html#a1a744815292e098dec6ba18a2899b05c">imesh_regular_face_array&lt;3&gt;::const_iterator</a> itr_t;
<a name="l00551"></a>00551 
<a name="l00552"></a>00552   <span class="keywordflow">if</span> (!mesh.<a class="code" href="classimesh__mesh.html#ab12f3001dfa1a43bca90aee0a7a40161" title="Returns texture coordinate availability.">has_tex_coords</a>())
<a name="l00553"></a>00553     <span class="keywordflow">return</span> <a class="code" href="imesh__face_8h.html#a912fbe6a50c33b0a185ac9d6a03be1ff">imesh_invalid_idx</a>;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555   <span class="keyword">const</span> vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt;&amp; tc = mesh.<a class="code" href="classimesh__mesh.html#a65e903b14ba2f870d227e6f8eafe9f4a" title="Return the texture coordinates.">tex_coords</a>();
<a name="l00556"></a>00556 
<a name="l00557"></a>00557   <span class="keywordflow">if</span> (mesh.<a class="code" href="classimesh__mesh.html#ab12f3001dfa1a43bca90aee0a7a40161" title="Returns texture coordinate availability.">has_tex_coords</a>() == <a class="code" href="classimesh__mesh.html#a21e233470b6ce89ff07187e5af06e06eaf02d743da2ea49ab2c7808f246bf8c61">imesh_mesh::TEX_COORD_ON_VERT</a>)
<a name="l00558"></a>00558   {
<a name="l00559"></a>00559     <span class="keywordtype">int</span> i = 0;
<a name="l00560"></a>00560     <span class="keywordflow">for</span> (itr_t itr = tris.<a class="code" href="classimesh__regular__face__array.html#a67939b431cb1a3987ef27b6f54b8cf91">begin</a>(); itr != tris.end(); ++itr, ++i) {
<a name="l00561"></a>00561       <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a = tc[(*itr)[0]];
<a name="l00562"></a>00562       <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b = tc[(*itr)[1]];
<a name="l00563"></a>00563       <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c = tc[(*itr)[2]];
<a name="l00564"></a>00564       <span class="keywordtype">double</span> dsc = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__triangle__test_8h.html#af56b6335180cbc9e6e786fd462d2bc43">vgl_triangle_test_discriminant</a>(a.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(),a.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>(),b.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(),b.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>(),c.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(),c.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>());
<a name="l00565"></a>00565       <span class="keywordflow">if</span> (dsc &lt;= 0.0) <span class="keywordflow">continue</span>;
<a name="l00566"></a>00566       xy_to_barycentric(pt_2d,a,b,c,pt_uv);
<a name="l00567"></a>00567       <span class="keywordflow">if</span> (pt_uv.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() &lt; 0.0) <span class="keywordflow">continue</span>;
<a name="l00568"></a>00568       <span class="keywordflow">if</span> (pt_uv.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() &lt; 0.0) <span class="keywordflow">continue</span>;
<a name="l00569"></a>00569       <span class="keywordflow">if</span> (pt_uv.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()+pt_uv.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() &gt;1.0) <span class="keywordflow">continue</span>;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571       <span class="keywordflow">return</span> i;
<a name="l00572"></a>00572     }
<a name="l00573"></a>00573   }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575   <span class="keywordflow">return</span> <a class="code" href="imesh__face_8h.html#a912fbe6a50c33b0a185ac9d6a03be1ff">imesh_invalid_idx</a>;
<a name="l00576"></a>00576 }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578 <span class="preprocessor">#if 1</span>
<a name="l00579"></a>00579 <span class="preprocessor"></span><span class="keyword">namespace</span>{
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 <span class="comment">// intersect a straight line in texture space with the texture triangles</span>
<a name="l00582"></a>00582 <span class="keywordtype">bool</span> trace_texture(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00583"></a>00583                    <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; end_xy,
<a name="l00584"></a>00584                    vcl_vector&lt;unsigned long&gt;&amp; idxs,
<a name="l00585"></a>00585                    vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; isect_bary)
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587   <span class="keyword">const</span> vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt;&amp; tc = mesh.<a class="code" href="classimesh__mesh.html#a65e903b14ba2f870d227e6f8eafe9f4a" title="Return the texture coordinates.">tex_coords</a>();
<a name="l00588"></a>00588   assert(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>().<a class="code" href="classimesh__face__array__base.html#a2384d28fc0f452535ab21e9f13ae9830" title="returns the number of vertices per face if the same for all faces, zero otherwise.">regularity</a>() == 3);
<a name="l00589"></a>00589   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp; tris =
<a name="l00590"></a>00590       <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp;<span class="keyword">&gt;</span>(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>());
<a name="l00591"></a>00591   assert(mesh.<a class="code" href="classimesh__mesh.html#a85de014d83c0515a79c59ee8bf2bfb5e" title="Returns true if the mesh has computed half edges.">has_half_edges</a>());
<a name="l00592"></a>00592   <span class="keyword">const</span> <a class="code" href="classimesh__half__edge__set.html" title="A collection of indexed half edges.">imesh_half_edge_set</a>&amp; he = mesh.<a class="code" href="classimesh__mesh.html#a33e77f683b5001cf3db0852519d84e55" title="Return the half edge set.">half_edges</a>();
<a name="l00593"></a>00593   assert(!isect_bary.empty());
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   <span class="keywordtype">double</span> eps = 1e-2;
<a name="l00596"></a>00596   <span class="keywordtype">double</span> eps2 = eps*eps;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> nbary;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600   <span class="comment">// get the last point and start from here</span>
<a name="l00601"></a>00601   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> tidx = idxs.back();
<a name="l00602"></a>00602   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> bary = isect_bary.back();
<a name="l00603"></a>00603 
<a name="l00604"></a>00604   <span class="comment">// split into intersection type and half edge index</span>
<a name="l00605"></a>00605   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>  heidx = tidx&gt;&gt;2;
<a name="l00606"></a>00606   <span class="comment">//unsigned char type = tidx &amp; 3;</span>
<a name="l00607"></a>00607 
<a name="l00608"></a>00608   <span class="keywordflow">for</span> (;;)
<a name="l00609"></a>00609   {
<a name="l00610"></a>00610     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fidx = he[heidx].face_index();
<a name="l00611"></a>00611     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a = tc[tris[fidx][0]];
<a name="l00612"></a>00612     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b = tc[tris[fidx][1]];
<a name="l00613"></a>00613     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c = tc[tris[fidx][2]];
<a name="l00614"></a>00614     <span class="comment">// compute barycentric coordinates of the end point</span>
<a name="l00615"></a>00615     xy_to_barycentric(end_xy,a,b,c,nbary);
<a name="l00616"></a>00616     <span class="comment">// compute the line direction in the current barycentric coordinates</span>
<a name="l00617"></a>00617     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html">vgl_vector_2d&lt;double&gt;</a> duv(bary-nbary);
<a name="l00618"></a>00618     <span class="comment">// if the last point was close enough to the end</span>
<a name="l00619"></a>00619     <span class="keywordflow">if</span> (duv.sqr_length() &lt;eps2)
<a name="l00620"></a>00620       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622     <span class="comment">// if the end point is inside the triangle then we are done</span>
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() &gt; 0 &amp;&amp; nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() &gt; 0 &amp;&amp; 1.0-nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()-nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()&gt;0) {
<a name="l00624"></a>00624       idxs.push_back(heidx&lt;&lt;2); <span class="comment">// this is a face point</span>
<a name="l00625"></a>00625       isect_bary.push_back(nbary);
<a name="l00626"></a>00626       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()==0.0 &amp;&amp; nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()&gt;0 &amp;&amp; nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()&lt;1) ||
<a name="l00629"></a>00629             (nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()==0.0 &amp;&amp; nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()&gt;0 &amp;&amp; nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()&lt;1) ||
<a name="l00630"></a>00630             (nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()+nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()==1.0 &amp;&amp; nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()&gt;0 &amp;&amp; nbary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()&gt;0)) {
<a name="l00631"></a>00631       idxs.push_back((heidx&lt;&lt;2) + 1); <span class="comment">// this is an edge point</span>
<a name="l00632"></a>00632       isect_bary.push_back(nbary);
<a name="l00633"></a>00633       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636     <span class="comment">// intersect the line with the with the current triangle</span>
<a name="l00637"></a>00637     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> s = <a class="code" href="imesh__intersect_8cxx.html#a4ea122982becb558dd3ee871562cafb3" title="Find the closest intersection point from p along d with triangle a,b,c.">imesh_triangle_intersect</a>(bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(),bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>(),duv.x(),duv.y(), eps);
<a name="l00638"></a>00638     <span class="keyword">typedef</span> <a class="code" href="classimesh__half__edge__set_1_1f__const__iterator.html" title="A const iterator of half edges adjacent to a face.">imesh_half_edge_set::f_const_iterator</a> fitr;
<a name="l00639"></a>00639     fitr fi = he.face_begin(fidx);
<a name="l00640"></a>00640     assert(fi-&gt;face_index() == fidx);
<a name="l00641"></a>00641     <span class="keywordflow">if</span> (s == 3 || s == 5 || s == 6) <span class="comment">// intersects with an edge</span>
<a name="l00642"></a>00642     {
<a name="l00643"></a>00643       <span class="keywordtype">double</span> t = 1 - bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>();
<a name="l00644"></a>00644       <span class="keywordflow">if</span> (s==6) {
<a name="l00645"></a>00645         ++fi;
<a name="l00646"></a>00646         t = bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>();
<a name="l00647"></a>00647       }
<a name="l00648"></a>00648       <span class="keywordflow">if</span> (s==5) {
<a name="l00649"></a>00649         ++fi;
<a name="l00650"></a>00650         ++fi;
<a name="l00651"></a>00651         t = bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>();
<a name="l00652"></a>00652       }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654 
<a name="l00655"></a>00655       <span class="comment">// switch to the triangle on the other side of the edge</span>
<a name="l00656"></a>00656       heidx = fi-&gt;pair_index();
<a name="l00657"></a>00657       fidx = he[heidx].face_index();
<a name="l00658"></a>00658 
<a name="l00659"></a>00659       <span class="comment">// check if the next triangle is out of bounds</span>
<a name="l00660"></a>00660       <span class="keywordflow">if</span> (fidx == <a class="code" href="imesh__face_8h.html#a912fbe6a50c33b0a185ac9d6a03be1ff">imesh_invalid_idx</a> ||
<a name="l00661"></a>00661           (!mesh.<a class="code" href="classimesh__mesh.html#af8104674317162d271369e0b5bf033cb" title="Return a vector indicating which faces have texture.">valid_tex_faces</a>().empty() &amp;&amp;
<a name="l00662"></a>00662            !mesh.<a class="code" href="classimesh__mesh.html#af8104674317162d271369e0b5bf033cb" title="Return a vector indicating which faces have texture.">valid_tex_faces</a>()[fidx]) )
<a name="l00663"></a>00663       {
<a name="l00664"></a>00664         <span class="comment">// add the boundary point and exit</span>
<a name="l00665"></a>00665         idxs.<a class="code" href="classimesh__regular__face__array.html#a007c9751c5bd5f01f0de0c4eb6cfd9d4" title="Add a face to the array.">push_back</a>((fi-&gt;half_edge_index()&lt;&lt;2) + 1); <span class="comment">// this is an edge point</span>
<a name="l00666"></a>00666         isect_bary.push_back(bary);
<a name="l00667"></a>00667         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00668"></a>00668       }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670       <span class="comment">// map the barycentric coordinates into those of the adjacent triangle</span>
<a name="l00671"></a>00671       fi = he.face_begin(fidx);
<a name="l00672"></a>00672       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> s2 = 0;
<a name="l00673"></a>00673       <span class="keywordflow">for</span> (; fi-&gt;half_edge_index() != heidx &amp;&amp; s2&lt;4; ++s2, ++fi)
<a name="l00674"></a>00674         ;
<a name="l00675"></a>00675       bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a69aee9c48b4aafc7fe71b486ba418e97">set</a>(0,0);
<a name="l00676"></a>00676       <span class="keywordflow">switch</span> (s2)
<a name="l00677"></a>00677       {
<a name="l00678"></a>00678         <span class="keywordflow">case</span> 0: bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() = t; <span class="keywordflow">break</span>;
<a name="l00679"></a>00679         <span class="keywordflow">case</span> 1: bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() = 1-t; bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()=t; <span class="keywordflow">break</span>;
<a name="l00680"></a>00680         <span class="keywordflow">case</span> 2: bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() = 1-t; <span class="keywordflow">break</span>;
<a name="l00681"></a>00681         <span class="keywordflow">default</span>:
<a name="l00682"></a>00682           assert(<span class="keyword">false</span>);
<a name="l00683"></a>00683       }
<a name="l00684"></a>00684 
<a name="l00685"></a>00685       <span class="comment">// insert the intersection</span>
<a name="l00686"></a>00686       idxs.push_back((heidx&lt;&lt;2) + 1); <span class="comment">// this is an edge point</span>
<a name="l00687"></a>00687       isect_bary.push_back(bary);
<a name="l00688"></a>00688     }
<a name="l00689"></a>00689     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == 1 || s == 2 || s == 4) <span class="comment">// intersects with a vertex</span>
<a name="l00690"></a>00690     {
<a name="l00691"></a>00691       <span class="keywordflow">if</span> (s==2) {
<a name="l00692"></a>00692         ++fi;
<a name="l00693"></a>00693       }
<a name="l00694"></a>00694       <span class="keywordflow">if</span> (s==4) {
<a name="l00695"></a>00695         ++fi;
<a name="l00696"></a>00696         ++fi;
<a name="l00697"></a>00697       }
<a name="l00698"></a>00698       assert(fi-&gt;vert_index() == tris[fidx][(s==4)?2:s-1]);
<a name="l00699"></a>00699 
<a name="l00700"></a>00700       <span class="comment">// find the direction vector in texture coordinates</span>
<a name="l00701"></a>00701       <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html">vgl_vector_2d&lt;double&gt;</a> dir(end_xy-tc[fi-&gt;vert_index()]);
<a name="l00702"></a>00702       <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#ac4986a4b72b1d54b872d5863ac35d3e8">normalize</a>(dir);
<a name="l00703"></a>00703 
<a name="l00704"></a>00704       <span class="comment">// find the face adjacent to the vertex that contains the outgoing vector</span>
<a name="l00705"></a>00705       <a class="code" href="classimesh__half__edge__set_1_1v__const__iterator.html" title="A const iterator of half edges adjacent to a vertex.">imesh_half_edge_set::v_const_iterator</a> vi(fi);
<a name="l00706"></a>00706       <a class="code" href="classimesh__half__edge__set_1_1v__const__iterator.html" title="A const iterator of half edges adjacent to a vertex.">imesh_half_edge_set::v_const_iterator</a> vend(vi);
<a name="l00707"></a>00707       ++vi;
<a name="l00708"></a>00708       <span class="keywordtype">double</span> max_ang = -2*vnl_math::pi;
<a name="l00709"></a>00709       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> max_heidx = 0;
<a name="l00710"></a>00710       <span class="keywordflow">for</span> (; vi!=vend; ++vi) {
<a name="l00711"></a>00711         <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html">vgl_vector_2d&lt;double&gt;</a> d(tc[he[vi-&gt;pair_index()].vert_index()]
<a name="l00712"></a>00712                                 - tc[vi-&gt;vert_index()]);
<a name="l00713"></a>00713         <span class="comment">// rotate to compute angle relative to dir</span>
<a name="l00714"></a>00714         <span class="keywordtype">double</span> ang = vcl_atan2(d.y()*dir.x()-d.x()*dir.y(),
<a name="l00715"></a>00715                                d.x()*dir.x()+d.y()*dir.y());
<a name="l00716"></a>00716         <span class="keywordflow">if</span> (ang &gt; 0) ang -= 2*vnl_math::pi;
<a name="l00717"></a>00717         <span class="keywordflow">if</span> (ang &gt; max_ang) {
<a name="l00718"></a>00718           max_ang = ang;
<a name="l00719"></a>00719           max_heidx = vi-&gt;half_edge_index();
<a name="l00720"></a>00720         }
<a name="l00721"></a>00721       }
<a name="l00722"></a>00722       <span class="comment">// switch to the triangle on the other side of the vertex</span>
<a name="l00723"></a>00723       heidx = max_heidx;
<a name="l00724"></a>00724       fidx = he[heidx].face_index();
<a name="l00725"></a>00725 
<a name="l00726"></a>00726       <span class="comment">// check if the next triangle is out of bounds</span>
<a name="l00727"></a>00727       <span class="keywordflow">if</span> (fidx == <a class="code" href="imesh__face_8h.html#a912fbe6a50c33b0a185ac9d6a03be1ff">imesh_invalid_idx</a> ||
<a name="l00728"></a>00728           (!mesh.<a class="code" href="classimesh__mesh.html#af8104674317162d271369e0b5bf033cb" title="Return a vector indicating which faces have texture.">valid_tex_faces</a>().empty() &amp;&amp;
<a name="l00729"></a>00729            !mesh.<a class="code" href="classimesh__mesh.html#af8104674317162d271369e0b5bf033cb" title="Return a vector indicating which faces have texture.">valid_tex_faces</a>()[fidx]) )
<a name="l00730"></a>00730       {
<a name="l00731"></a>00731         <span class="comment">// add the boundary point and exit</span>
<a name="l00732"></a>00732         idxs.<a class="code" href="classimesh__regular__face__array.html#a007c9751c5bd5f01f0de0c4eb6cfd9d4" title="Add a face to the array.">push_back</a>((fi-&gt;half_edge_index()&lt;&lt;2) + 2); <span class="comment">// this is an edge point</span>
<a name="l00733"></a>00733         isect_bary.push_back(bary);
<a name="l00734"></a>00734         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00735"></a>00735       }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737       <span class="comment">// map the barycentric coordinates into those of the next triangle</span>
<a name="l00738"></a>00738       <span class="keywordtype">unsigned</span> vidx = fi-&gt;vert_index();
<a name="l00739"></a>00739       fi = he.face_begin(fidx);
<a name="l00740"></a>00740       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> s2 = 0;
<a name="l00741"></a>00741       <span class="keywordflow">for</span> (; fi-&gt;vert_index() != vidx &amp;&amp; s2&lt;4; ++s2, ++fi)
<a name="l00742"></a>00742         ;
<a name="l00743"></a>00743       bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a69aee9c48b4aafc7fe71b486ba418e97">set</a>(0,0);
<a name="l00744"></a>00744       <span class="keywordflow">switch</span> (s2)
<a name="l00745"></a>00745       {
<a name="l00746"></a>00746         <span class="keywordflow">case</span> 0: <span class="keywordflow">break</span>;
<a name="l00747"></a>00747         <span class="keywordflow">case</span> 1: bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() = 1; <span class="keywordflow">break</span>;
<a name="l00748"></a>00748         <span class="keywordflow">case</span> 2: bary.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() = 1; <span class="keywordflow">break</span>;
<a name="l00749"></a>00749         <span class="keywordflow">default</span>:
<a name="l00750"></a>00750           assert(<span class="keyword">false</span>);
<a name="l00751"></a>00751       }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753       <span class="comment">// insert the intersection</span>
<a name="l00754"></a>00754       idxs.push_back((heidx&lt;&lt;2) + 2); <span class="comment">// this is a vertex point</span>
<a name="l00755"></a>00755       isect_bary.push_back(bary);
<a name="l00756"></a>00756     }
<a name="l00757"></a>00757     <span class="keywordflow">else</span>
<a name="l00758"></a>00758     {
<a name="l00759"></a>00759       vcl_cout &lt;&lt; <span class="stringliteral">&quot;invalid intersection&quot;</span> &lt;&lt; vcl_endl;
<a name="l00760"></a>00760       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00761"></a>00761     }
<a name="l00762"></a>00762   }
<a name="l00763"></a>00763   <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// will never be reached! -- just avoids a compiler warning</span>
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 <span class="comment">// end of namespace</span>
<a name="l00766"></a>00766 }
<a name="l00767"></a>00767 <span class="preprocessor">#endif</span>
<a name="l00768"></a>00768 <span class="preprocessor"></span>
<a name="l00769"></a>00769 <span class="comment">//: project a texture polygon into barycentric coordinates</span>
<a name="l00770"></a>00770 <span class="comment">//  \returns true if the polygon is not clipped by the mesh texture</span>
<a name="l00771"></a>00771 <span class="comment">//  \returns the vector of barycentric points by reference</span>
<a name="l00772"></a>00772 <span class="comment">//  \returns a vector of coded half edge indices</span>
<a name="l00773"></a>00773 <span class="comment">//  the half edge indices are scaled by a factor of 4</span>
<a name="l00774"></a>00774 <span class="comment">//  the last two bits indicate the intersection type:</span>
<a name="l00775"></a>00775 <span class="comment">//  - 0 for face</span>
<a name="l00776"></a>00776 <span class="comment">//  - 1 for edge</span>
<a name="l00777"></a>00777 <span class="comment">//  - 2 for vertex</span>
<a name="l00778"></a>00778 <span class="comment">//  barycentric coordinate refer to the adjacent triangle</span>
<a name="l00779"></a>00779 <span class="comment">//  \returns a mapping from each original point into barycentric points.</span>
<a name="l00780"></a>00780 <span class="comment">//  if an original point is not mapped the value is -1</span>
<a name="l00781"></a><a class="code" href="imesh__project_8h.html#a6cb5d580017c289621b83b991997add0">00781</a> <span class="keywordtype">bool</span> <a class="code" href="imesh__project_8cxx.html#a66de7ee1c484f0abd87a33adf3981adc" title="project a texture point onto a mesh face index with barycentric coordinates.">imesh_project_texture_to_barycentric</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00782"></a>00782                                           <span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; pts_2d,
<a name="l00783"></a>00783                                           vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; pts_uv,
<a name="l00784"></a>00784                                           vcl_vector&lt;unsigned long&gt;&amp; idxs,
<a name="l00785"></a>00785                                           vcl_vector&lt;int&gt;&amp; map_back)
<a name="l00786"></a>00786 {
<a name="l00787"></a>00787   <span class="keywordtype">bool</span> clipped = <span class="keyword">false</span>;
<a name="l00788"></a>00788   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> npts = pts_2d.size();
<a name="l00789"></a>00789   pts_uv.clear();
<a name="l00790"></a>00790   idxs.clear();
<a name="l00791"></a>00791   map_back.clear();
<a name="l00792"></a>00792   map_back.resize(npts,-1);
<a name="l00793"></a>00793   assert(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>().<a class="code" href="classimesh__face__array__base.html#a2384d28fc0f452535ab21e9f13ae9830" title="returns the number of vertices per face if the same for all faces, zero otherwise.">regularity</a>() == 3);
<a name="l00794"></a>00794   assert(mesh.<a class="code" href="classimesh__mesh.html#a85de014d83c0515a79c59ee8bf2bfb5e" title="Returns true if the mesh has computed half edges.">has_half_edges</a>());
<a name="l00795"></a>00795   <span class="keyword">const</span> <a class="code" href="classimesh__half__edge__set.html" title="A collection of indexed half edges.">imesh_half_edge_set</a>&amp; he = mesh.<a class="code" href="classimesh__mesh.html#a33e77f683b5001cf3db0852519d84e55" title="Return the half edge set.">half_edges</a>();
<a name="l00796"></a>00796 
<a name="l00797"></a>00797   <span class="comment">// find a starting point</span>
<a name="l00798"></a>00798   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00799"></a>00799   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx=0;
<a name="l00800"></a>00800   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> pt_uv;
<a name="l00801"></a>00801   <span class="keywordflow">for</span> (i=0; i&lt;npts; ++i)
<a name="l00802"></a>00802   {
<a name="l00803"></a>00803     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt = pts_2d[i];
<a name="l00804"></a>00804     <span class="keywordflow">if</span> (pt.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() &gt;= 0.0 &amp;&amp; pt.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>() &lt;= 1.0 &amp;&amp; pt.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() &gt;= 0.0 &amp;&amp; pt.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>() &lt;= 1.0)
<a name="l00805"></a>00805     {
<a name="l00806"></a>00806       idx = <a class="code" href="imesh__project_8cxx.html#a66de7ee1c484f0abd87a33adf3981adc" title="project a texture point onto a mesh face index with barycentric coordinates.">imesh_project_texture_to_barycentric</a>(mesh,pt,pt_uv);
<a name="l00807"></a>00807       <span class="keywordflow">if</span> (idx != <a class="code" href="imesh__face_8h.html#a912fbe6a50c33b0a185ac9d6a03be1ff">imesh_invalid_idx</a>)
<a name="l00808"></a>00808         <span class="keywordflow">break</span>;
<a name="l00809"></a>00809     }
<a name="l00810"></a>00810     clipped = <span class="keyword">true</span>;
<a name="l00811"></a>00811   }
<a name="l00812"></a>00812   <span class="keywordflow">if</span> (i==npts) <span class="comment">// includes the case npts==0; in which case idx would be uninitialized</span>
<a name="l00813"></a>00813     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00814"></a>00814 
<a name="l00815"></a>00815   idxs.push_back(he.face_begin(idx)-&gt;half_edge_index()&lt;&lt;2);
<a name="l00816"></a>00816   pts_uv.push_back(pt_uv);
<a name="l00817"></a>00817   map_back[i] = 0;
<a name="l00818"></a>00818 
<a name="l00819"></a>00819   <span class="comment">// trace the rest of the polygon</span>
<a name="l00820"></a>00820   <span class="keywordtype">bool</span> valid = <span class="keyword">true</span>;
<a name="l00821"></a>00821   <span class="keywordtype">int</span> num_found = 0;
<a name="l00822"></a>00822   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=(i+1)%npts; j!=i; j=(j+1)%npts, ++num_found )
<a name="l00823"></a>00823   {
<a name="l00824"></a>00824     valid = trace_texture(mesh,pts_2d[j],idxs,pts_uv);
<a name="l00825"></a>00825     <span class="keywordflow">if</span> (!valid)
<a name="l00826"></a>00826       <span class="keywordflow">break</span>; <span class="comment">// curve is clipped so exit here</span>
<a name="l00827"></a>00827     map_back[j] = idxs.size()-1;
<a name="l00828"></a>00828   }
<a name="l00829"></a>00829   <span class="comment">// if the curve was clipped, try tracing in reverse to get the rest</span>
<a name="l00830"></a>00830   <span class="keywordflow">if</span> (!valid)
<a name="l00831"></a>00831   {
<a name="l00832"></a>00832     vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt; rev_pts_uv(1,pts_uv.front());
<a name="l00833"></a>00833     vcl_vector&lt;unsigned long&gt; rev_idxs(1,idxs.front());
<a name="l00834"></a>00834     vcl_vector&lt;int&gt; rev_map_back(pts_2d.size(),-1);
<a name="l00835"></a>00835     rev_map_back[i]=0;
<a name="l00836"></a>00836     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> step = npts-1;
<a name="l00837"></a>00837     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=(i+step)%npts; j!=i; j=(j+step)%npts )
<a name="l00838"></a>00838     {
<a name="l00839"></a>00839       valid = trace_texture(mesh,pts_2d[j],rev_idxs,rev_pts_uv);
<a name="l00840"></a>00840       <span class="keywordflow">if</span> (!valid)
<a name="l00841"></a>00841         <span class="keywordflow">break</span>; <span class="comment">// curve is clipped so exit here</span>
<a name="l00842"></a>00842       rev_map_back[j] = rev_idxs.size()-1;
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845     <span class="comment">// reverse the reverse searching arrays and append the original search</span>
<a name="l00846"></a>00846     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;npts; ++j)
<a name="l00847"></a>00847     {
<a name="l00848"></a>00848       <span class="keywordflow">if</span> (map_back[j] &gt;=0)
<a name="l00849"></a>00849         map_back[j] += rev_idxs.size()-1;
<a name="l00850"></a>00850       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rev_map_back[j] &gt;= 0)
<a name="l00851"></a>00851         map_back[j] = rev_idxs.size()-1 - rev_map_back[j];
<a name="l00852"></a>00852     }
<a name="l00853"></a>00853 
<a name="l00854"></a>00854     vcl_reverse(rev_pts_uv.begin(),rev_pts_uv.end());
<a name="l00855"></a>00855     vcl_reverse(rev_idxs.begin(),rev_idxs.end());
<a name="l00856"></a>00856     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_new_pts = rev_pts_uv.size();
<a name="l00857"></a>00857     rev_pts_uv.resize(rev_pts_uv.size()+pts_uv.size()-1);
<a name="l00858"></a>00858     vcl_copy(pts_uv.begin()+1, pts_uv.end(), rev_pts_uv.begin()+num_new_pts);
<a name="l00859"></a>00859     rev_idxs.resize(rev_idxs.size()+idxs.size()-1);
<a name="l00860"></a>00860     vcl_copy(idxs.begin()+1, idxs.end(), rev_idxs.begin()+num_new_pts);
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 
<a name="l00863"></a>00863     idxs.swap(rev_idxs);
<a name="l00864"></a>00864     pts_uv.swap(rev_pts_uv);
<a name="l00865"></a>00865 
<a name="l00866"></a>00866     <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// return true to indicate clipping</span>
<a name="l00867"></a>00867   }
<a name="l00868"></a>00868 
<a name="l00869"></a>00869   <span class="comment">// connect back to the first point, but remove the duplicated first point</span>
<a name="l00870"></a>00870   valid = trace_texture(mesh,pts_2d[i],idxs,pts_uv);
<a name="l00871"></a>00871   <span class="keywordflow">if</span> (!valid)
<a name="l00872"></a>00872     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00873"></a>00873 
<a name="l00874"></a>00874   idxs.pop_back();
<a name="l00875"></a>00875   pts_uv.pop_back();
<a name="l00876"></a>00876 
<a name="l00877"></a>00877   assert(pts_uv.size() == idxs.size());
<a name="l00878"></a>00878 
<a name="l00879"></a>00879   <span class="keywordflow">return</span> clipped;
<a name="l00880"></a>00880 }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882 
<a name="l00883"></a>00883 <span class="comment">//: compute the matrix that maps texture points to 3-d for a given triangle index</span>
<a name="l00884"></a>00884 <span class="comment">// $(u,v,1)$ maps into 3-d $(x,y,z)$</span>
<a name="l00885"></a>00885 vnl_matrix_fixed&lt;double,3,3&gt;
<a name="l00886"></a><a class="code" href="imesh__project_8h.html#ae44ab8478d53b33deca8c96c3da4f6d9">00886</a> <a class="code" href="imesh__project_8cxx.html#ae44ab8478d53b33deca8c96c3da4f6d9" title="compute the matrix that maps texture points to 3-d for a given triangle index.">imesh_project_texture_to_3d_map</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tidx)
<a name="l00887"></a>00887 {
<a name="l00888"></a>00888   assert(mesh.<a class="code" href="classimesh__mesh.html#ab12f3001dfa1a43bca90aee0a7a40161" title="Returns texture coordinate availability.">has_tex_coords</a>());
<a name="l00889"></a>00889   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp; triangles =
<a name="l00890"></a>00890       <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classimesh__regular__face__array.html" title="An array of mesh faces of arbitrary size.">imesh_regular_face_array&lt;3&gt;</a>&amp;<span class="keyword">&gt;</span>(mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>());
<a name="l00891"></a>00891   <span class="keyword">const</span> <a class="code" href="classimesh__regular__face.html">imesh_regular_face&lt;3&gt;</a>&amp; tri = triangles[tidx];
<a name="l00892"></a>00892   <span class="keyword">const</span> vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt;&amp; tex = mesh.<a class="code" href="classimesh__mesh.html#a65e903b14ba2f870d227e6f8eafe9f4a" title="Return the texture coordinates.">tex_coords</a>();
<a name="l00893"></a>00893   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts = mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>&lt;3&gt;();
<a name="l00894"></a>00894 
<a name="l00895"></a>00895   vnl_matrix_fixed&lt;double,3,3&gt; M1;
<a name="l00896"></a>00896   {
<a name="l00897"></a>00897     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a = tex[tri[0]];
<a name="l00898"></a>00898     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b = tex[tri[1]];
<a name="l00899"></a>00899     <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c = tex[tri[2]];
<a name="l00900"></a>00900     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html">vgl_vector_2d&lt;double&gt;</a> v1(b-a), v2(c-a);
<a name="l00901"></a>00901     <span class="keywordtype">double</span> s = 1.0 / (v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html#a642daa8ef893f47ddf5d5c7f408efcda">y</a>()*v1.x() - v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html#acc1b6069f02b8f8da2e1662f07abdd17">x</a>()*v1.y());
<a name="l00902"></a>00902     M1(0,0) = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html#a642daa8ef893f47ddf5d5c7f408efcda">y</a>()*s;   M1(0,1) = -v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html#acc1b6069f02b8f8da2e1662f07abdd17">x</a>()*s;   M1(0,2) = -a.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()*s;
<a name="l00903"></a>00903     M1(1,0) = -v1.y()*s;  M1(1,1) = v1.x()*s;    M1(1,2) = -a.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()*s;
<a name="l00904"></a>00904     M1(2,0) = 0.0;        M1(2,1) = 0.0;         M1(2,2) = 1.0;
<a name="l00905"></a>00905   }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907   vnl_matrix_fixed&lt;double,3,3&gt; M2;
<a name="l00908"></a>00908   {
<a name="l00909"></a>00909     <span class="keyword">const</span> <a class="code" href="classimesh__vertex_3_013_01_4.html" title="A 3d vertex specialization with extra capabilities.">imesh_vertex&lt;3&gt;</a>&amp; a = verts[tri[0]];
<a name="l00910"></a>00910     <span class="keyword">const</span> <a class="code" href="classimesh__vertex_3_013_01_4.html" title="A 3d vertex specialization with extra capabilities.">imesh_vertex&lt;3&gt;</a>&amp; b = verts[tri[1]];
<a name="l00911"></a>00911     <span class="keyword">const</span> <a class="code" href="classimesh__vertex_3_013_01_4.html" title="A 3d vertex specialization with extra capabilities.">imesh_vertex&lt;3&gt;</a>&amp; c = verts[tri[2]];
<a name="l00912"></a>00912     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> v1(b[0]-a[0],b[1]-a[1],b[2]-a[2]),
<a name="l00913"></a>00913                           v2(c[0]-a[0],c[1]-a[1],c[2]-a[2]);
<a name="l00914"></a>00914     M2(0,0) = v1.x();   M2(0,1) = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>();   M2(0,2) = a[0];
<a name="l00915"></a>00915     M2(1,0) = v1.y();   M2(1,1) = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>();   M2(1,2) = a[1];
<a name="l00916"></a>00916     M2(2,0) = v1.z();   M2(2,1) = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>();   M2(2,2) = a[2];
<a name="l00917"></a>00917   }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 
<a name="l00920"></a>00920   <span class="keywordflow">return</span> M2*M1;
<a name="l00921"></a>00921 }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 
<a name="l00924"></a>00924 <span class="comment">//: compute the affine matrix that maps triangle (a1,b1,c1) to (a2,b2,c2)</span>
<a name="l00925"></a>00925 vnl_matrix_fixed&lt;double,3,3&gt;
<a name="l00926"></a><a class="code" href="imesh__project_8h.html#ae0cb2bdd9ebc535934749284aa26ee51">00926</a> <a class="code" href="imesh__project_8cxx.html#ae0cb2bdd9ebc535934749284aa26ee51" title="compute the affine matrix that maps triangle (a1,b1,c1) to (a2,b2,c2).">imesh_affine_map</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a1,
<a name="l00927"></a>00927                  <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b1,
<a name="l00928"></a>00928                  <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c1,
<a name="l00929"></a>00929                  <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a2,
<a name="l00930"></a>00930                  <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b2,
<a name="l00931"></a>00931                  <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c2)
<a name="l00932"></a>00932 {
<a name="l00933"></a>00933   <span class="comment">// triangle 1 to barycentric coordinates</span>
<a name="l00934"></a>00934   vnl_matrix_fixed&lt;double,3,3&gt; M1;
<a name="l00935"></a>00935   {
<a name="l00936"></a>00936     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html">vgl_vector_2d&lt;double&gt;</a> v1(b1-a1), v2(c1-a1);
<a name="l00937"></a>00937     <span class="keywordtype">double</span> s = 1.0 / (v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html#a642daa8ef893f47ddf5d5c7f408efcda">y</a>()*v1.x() - v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html#acc1b6069f02b8f8da2e1662f07abdd17">x</a>()*v1.y());
<a name="l00938"></a>00938     M1(0,0) = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html#a642daa8ef893f47ddf5d5c7f408efcda">y</a>()*s;   M1(0,1) = -v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html#acc1b6069f02b8f8da2e1662f07abdd17">x</a>()*s;   M1(0,2) = (a1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()*c1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()-a1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()*c1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>())*s;
<a name="l00939"></a>00939     M1(1,0) = -v1.y()*s;  M1(1,1) = v1.x()*s;    M1(1,2) = (a1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()*b1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()-a1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()*b1.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>())*s;
<a name="l00940"></a>00940     M1(2,0) = 0.0;        M1(2,1) = 0.0;         M1(2,2) = 1.0;
<a name="l00941"></a>00941   }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943   <span class="comment">// barycentric coordinates to triangle 2</span>
<a name="l00944"></a>00944   vnl_matrix_fixed&lt;double,3,3&gt; M2;
<a name="l00945"></a>00945   {
<a name="l00946"></a>00946     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html">vgl_vector_2d&lt;double&gt;</a> v1(b2-a2), v2(c2-a2);
<a name="l00947"></a>00947     M2(0,0) = v1.x();   M2(0,1) = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html#acc1b6069f02b8f8da2e1662f07abdd17">x</a>();   M2(0,2) = a2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>();
<a name="l00948"></a>00948     M2(1,0) = v1.y();   M2(1,1) = v2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__2d.html#a642daa8ef893f47ddf5d5c7f408efcda">y</a>();   M2(1,2) = a2.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>();
<a name="l00949"></a>00949     M2(2,0) = 0.0;      M2(2,1) = 0.0;      M2(2,2) = 1.0;
<a name="l00950"></a>00950   }
<a name="l00951"></a>00951 
<a name="l00952"></a>00952   <span class="keywordflow">return</span> M2*M1;
<a name="l00953"></a>00953 }
<a name="l00954"></a>00954 
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 <span class="comment">//: project barycentric coordinates with an index to texture space</span>
<a name="l00957"></a>00957 <span class="comment">//  \param idx is the face index</span>
<a name="l00958"></a>00958 <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>
<a name="l00959"></a><a class="code" href="imesh__project_8h.html#a01f62bc7a3ee8984fb82744156ced16d">00959</a> <a class="code" href="imesh__project_8cxx.html#a01f62bc7a3ee8984fb82744156ced16d" title="project barycentric coordinates with an index to texture space.">imesh_project_barycentric_to_texture</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00960"></a>00960                                      <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_uv,
<a name="l00961"></a>00961                                      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx)
<a name="l00962"></a>00962 {
<a name="l00963"></a>00963   assert(mesh.<a class="code" href="classimesh__mesh.html#ab12f3001dfa1a43bca90aee0a7a40161" title="Returns texture coordinate availability.">has_tex_coords</a>());
<a name="l00964"></a>00964   <span class="keyword">const</span> vcl_vector&lt;vgl_point_2d&lt;double&gt; &gt;&amp; tc = mesh.<a class="code" href="classimesh__mesh.html#a65e903b14ba2f870d227e6f8eafe9f4a" title="Return the texture coordinates.">tex_coords</a>();
<a name="l00965"></a>00965   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; a = tc[mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>()(idx,0)];
<a name="l00966"></a>00966   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; b = tc[mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>()(idx,1)];
<a name="l00967"></a>00967   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; c = tc[mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>()(idx,2)];
<a name="l00968"></a>00968   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> p;
<a name="l00969"></a>00969   barycentric_to_xy(pt_uv,a,b,c,p);
<a name="l00970"></a>00970   <span class="keywordflow">return</span> p;
<a name="l00971"></a>00971 }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973 
<a name="l00974"></a>00974 <span class="comment">//: project barycentric coordinates with an index the mesh surface (3D)</span>
<a name="l00975"></a>00975 <span class="comment">//  \param idx is the face index</span>
<a name="l00976"></a>00976 <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a>
<a name="l00977"></a><a class="code" href="imesh__project_8h.html#a05aa573a50f23e1c2be086d777140146">00977</a> <a class="code" href="imesh__project_8cxx.html#a05aa573a50f23e1c2be086d777140146" title="project barycentric coordinates with an index the mesh surface (3D).">imesh_project_barycentric_to_mesh</a>(<span class="keyword">const</span> <a class="code" href="classimesh__mesh.html" title="A simple mesh.">imesh_mesh</a>&amp; mesh,
<a name="l00978"></a>00978                                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; pt_uv,
<a name="l00979"></a>00979                                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx)
<a name="l00980"></a>00980 {
<a name="l00981"></a>00981   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> pt(0,0,0);
<a name="l00982"></a>00982   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v1 = mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>()(idx,0);
<a name="l00983"></a>00983   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v2 = mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>()(idx,1);
<a name="l00984"></a>00984   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v3 = mesh.<a class="code" href="classimesh__mesh.html#a0c318307ea669c54b7fe8f92b9f06df9" title="Access the vector of faces.">faces</a>()(idx,2);
<a name="l00985"></a>00985   <span class="keyword">const</span> <a class="code" href="classimesh__vertex__array.html" title="An array of vertices of dimension d.">imesh_vertex_array&lt;3&gt;</a>&amp; verts = mesh.<a class="code" href="classimesh__mesh.html#ae22a5853a69f2ca520d82433a7f27009" title="Access the vector of vertices.">vertices</a>&lt;3&gt;();
<a name="l00986"></a>00986   pt += (1-pt_uv.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()-pt_uv.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>())*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a>(verts[v1][0],verts[v1][1],verts[v1][2]);
<a name="l00987"></a>00987   pt += pt_uv.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>()*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a>(verts[v2][0],verts[v2][1],verts[v2][2]);
<a name="l00988"></a>00988   pt += pt_uv.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>()*<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a>(verts[v3][0],verts[v3][1],verts[v3][2]);
<a name="l00989"></a>00989 
<a name="l00990"></a>00990   <span class="keywordflow">return</span> pt;
<a name="l00991"></a>00991 }
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Thu May 2 2013 08:52:54 for contrib/brl/bbas/imesh by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
