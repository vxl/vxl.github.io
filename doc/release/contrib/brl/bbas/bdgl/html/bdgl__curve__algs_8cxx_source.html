<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>contrib/brl/bbas/bdgl/bdgl_curve_algs.cxx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">contrib/brl/bbas/bdgl/bdgl_curve_algs.cxx</div>  </div>
</div>
<div class="contents">
<a href="bdgl__curve__algs_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="bdgl__curve__algs_8h.html" title="vdgl_digital_curve algorithms">bdgl_curve_algs.h</a>&quot;</span>
<a name="l00002"></a>00002 <span class="comment">//:</span>
<a name="l00003"></a>00003 <span class="comment">// \file</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;vcl_cmath.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;vcl_cstdlib.h&gt;</span> <span class="comment">// for std::abs(int)</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;vcl_cassert.h&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;vcl_iostream.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/vnl__numeric__traits_8h.html">vnl/vnl_numeric_traits.h</a>&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/vnl__double__2_8h.html">vnl/vnl_double_2.h</a>&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/vnl__double__3_8h.html">vnl/vnl_double_3.h</a>&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/vnl__math_8h.html">vnl/vnl_math.h</a>&gt;</span> <span class="comment">// for pi</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__line__2d_8h.html">vgl/vgl_line_2d.h</a>&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__point__2d_8h.html">vgl/vgl_point_2d.h</a>&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__homg__point__2d_8h.html">vgl/vgl_homg_point_2d.h</a>&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__box__2d_8h.html">vgl/vgl_box_2d.h</a>&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__intersection_8h.html">vgl/vgl_intersection.h</a>&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__homg__operators__2d_8h.html">vgl/algo/vgl_homg_operators_2d.h</a>&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_gel_vsol.tag:../../../../../contrib/gel/vsol/html" href="../../../../../contrib/gel/vsol/html/vsol__box__2d_8h.html">vsol/vsol_box_2d.h</a>&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/vdgl__edgel__chain_8h.html">vdgl/vdgl_edgel_chain.h</a>&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/vdgl__interpolator_8h.html">vdgl/vdgl_interpolator.h</a>&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/vdgl__interpolator__linear_8h.html">vdgl/vdgl_interpolator_linear.h</a>&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/vdgl__digital__curve_8h.html">vdgl/vdgl_digital_curve.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/vnl__gaussian__kernel__1d_8h.html">vnl/algo/vnl_gaussian_kernel_1d.h</a>&gt;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a> = 1e-16;
<a name="l00026"></a>00026 <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="classbdgl__curve__algs.html#a7c144422263d4c376e10ab143d1306bf">bdgl_curve_algs::max_edgel_sep</a> = 2.0; <span class="comment">// the maximum separation</span>
<a name="l00027"></a>00027                                                    <span class="comment">// of edgels (in pixels)</span>
<a name="l00028"></a>00028 <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="classbdgl__curve__algs.html#a9b416d8315fbf929769c09ce041fb8fc">bdgl_curve_algs::synthetic</a> = 0;<span class="comment">//Indicates synthetic edgel</span>
<a name="l00029"></a>00029                                             <span class="comment">//default constructor is -1</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">//: Destructor</span>
<a name="l00032"></a><a class="code" href="classbdgl__curve__algs.html#a947de6e6358227cf9434e1cf0b9c908c">00032</a> <a class="code" href="classbdgl__curve__algs.html#a947de6e6358227cf9434e1cf0b9c908c" title="Destructor.">bdgl_curve_algs::~bdgl_curve_algs</a>()
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034 }
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">//:</span>
<a name="l00037"></a>00037 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00038"></a>00038 <span class="comment">// Finds the index (on the interval [0.0 1.0]) on a digital curve closest</span>
<a name="l00039"></a>00039 <span class="comment">// to the given point (x, y).</span>
<a name="l00040"></a><a class="code" href="classbdgl__curve__algs.html#a40c36d23acd392b1dd1b0d6a20d1bb84">00040</a> <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="keywordtype">double</span> <a class="code" href="classbdgl__curve__algs.html#af2feeac17f59ef67ca72ef2438cc2e1e" title="Finds the index on a digital curve closest to the given point.">bdgl_curve_algs::closest_point</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> <span class="keyword">const</span>&amp; dc,
<a name="l00043"></a>00043                                       <span class="keyword">const</span> <span class="keywordtype">double</span> x, <span class="keyword">const</span> <span class="keywordtype">double</span> y)
<a name="l00044"></a>00044 {
<a name="l00045"></a>00045   <span class="keywordflow">if</span> (!dc)
<a name="l00046"></a>00046   {
<a name="l00047"></a>00047     vcl_cout&lt;&lt;<span class="stringliteral">&quot;In bdgl_curve_algs::closest_point(..) -&quot;</span>
<a name="l00048"></a>00048             &lt;&lt; <span class="stringliteral">&quot; warning, null digital curve\n&quot;</span>;
<a name="l00049"></a>00049     <span class="keywordflow">return</span> 0;
<a name="l00050"></a>00050   }
<a name="l00051"></a>00051   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_interpolator_sptr</a> interp = dc-&gt;get_interpolator();
<a name="l00052"></a>00052   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a>  ec = interp-&gt;get_edgel_chain();
<a name="l00053"></a>00053   <span class="keywordtype">int</span> index = <a class="code" href="classbdgl__curve__algs.html#af2feeac17f59ef67ca72ef2438cc2e1e" title="Finds the index on a digital curve closest to the given point.">closest_point</a>(ec, x, y);
<a name="l00054"></a>00054   <span class="keywordtype">double</span> parm = index/ec-&gt;size();
<a name="l00055"></a>00055   <span class="keywordflow">return</span> parm;
<a name="l00056"></a>00056 }
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="comment">//:</span>
<a name="l00059"></a>00059 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00060"></a><a class="code" href="classbdgl__curve__algs.html#af2feeac17f59ef67ca72ef2438cc2e1e">00060</a> <span class="comment">// Finds the index on an edgel_chain closest to the given</span>
<a name="l00061"></a>00061 <span class="comment">// point (x, y). Later this routine can become a method on</span>
<a name="l00062"></a>00062 <span class="comment">// vdgl_edgel_chain.</span>
<a name="l00063"></a>00063 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00064"></a>00064 <span class="keywordtype">int</span> <a class="code" href="classbdgl__curve__algs.html#af2feeac17f59ef67ca72ef2438cc2e1e" title="Finds the index on a digital curve closest to the given point.">bdgl_curve_algs::closest_point</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a> <span class="keyword">const</span>&amp; ec,
<a name="l00065"></a>00065                                    <span class="keyword">const</span> <span class="keywordtype">double</span> x, <span class="keyword">const</span> <span class="keywordtype">double</span> y)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067   <span class="keywordflow">if</span> (!ec)
<a name="l00068"></a>00068   {
<a name="l00069"></a>00069     vcl_cout&lt;&lt;<span class="stringliteral">&quot;In bdgl_curve_algs::closest_point(..) - warning, null chain\n&quot;</span>;
<a name="l00070"></a>00070     <span class="keywordflow">return</span> 0;
<a name="l00071"></a>00071   }
<a name="l00072"></a>00072   <span class="comment">//for now just scan the curve and save the closest point</span>
<a name="l00073"></a>00073   <span class="keywordtype">double</span> mind = vnl_numeric_traits&lt;double&gt;::maxval;
<a name="l00074"></a>00074   <span class="keywordtype">int</span> N =ec-&gt;size(), imin = 0;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt;N; i++)
<a name="l00077"></a>00077   {
<a name="l00078"></a>00078     <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> ed = ec-&gt;edgel(i);
<a name="l00079"></a>00079     <span class="keywordtype">double</span> d = vcl_sqrt((ed.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a0560c0d65ffea87e055d8d4277603756">x</a>()-x)*(ed.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a0560c0d65ffea87e055d8d4277603756">x</a>()-x) + (ed.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#aa4f7f78e5c18a94c1a5a28f0f3927927">y</a>()-y)*(ed.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#aa4f7f78e5c18a94c1a5a28f0f3927927">y</a>()-y));
<a name="l00080"></a>00080     <span class="keywordflow">if</span> (d&lt;mind)
<a name="l00081"></a>00081     {
<a name="l00082"></a>00082       mind = d;
<a name="l00083"></a>00083       imin = i;
<a name="l00084"></a>00084     }
<a name="l00085"></a>00085   }
<a name="l00086"></a>00086   <span class="keywordflow">return</span> imin;
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">//:</span>
<a name="l00090"></a>00090 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00091"></a><a class="code" href="classbdgl__curve__algs.html#a77ded0b6f95e8ad95d77390c0fbbc7bf">00091</a> <span class="comment">// Finds the closest point, (xc, yc) on a digital curve to a given</span>
<a name="l00092"></a>00092 <span class="comment">// location (x,y).</span>
<a name="l00093"></a>00093 <span class="comment">// Current implementation is not the best since it is discrete with</span>
<a name="l00094"></a>00094 <span class="comment">// the edgel_chain index.  Ultimately it should use the interpolator</span>
<a name="l00095"></a>00095 <span class="comment">// to refine the location on the digital_curve.</span>
<a name="l00096"></a>00096 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00097"></a>00097 <span class="keywordtype">bool</span> <a class="code" href="classbdgl__curve__algs.html#af2feeac17f59ef67ca72ef2438cc2e1e" title="Finds the index on a digital curve closest to the given point.">bdgl_curve_algs::closest_point</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> <span class="keyword">const</span>&amp; dc,
<a name="l00098"></a>00098                                     <span class="keyword">const</span> <span class="keywordtype">double</span> x, <span class="keyword">const</span> <span class="keywordtype">double</span> y,
<a name="l00099"></a>00099                                     <span class="keywordtype">double</span>&amp; xc, <span class="keywordtype">double</span>&amp; yc)
<a name="l00100"></a>00100 {
<a name="l00101"></a>00101   <span class="keywordflow">if</span> (!dc)
<a name="l00102"></a>00102   {
<a name="l00103"></a>00103     vcl_cout&lt;&lt;<span class="stringliteral">&quot;In bdgl_curve_algs::closest_point(..) - warning, null curve\n&quot;</span>;
<a name="l00104"></a>00104     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00105"></a>00105   }
<a name="l00106"></a>00106   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_interpolator_sptr</a> interp = dc-&gt;get_interpolator();
<a name="l00107"></a>00107   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a> ec = interp-&gt;get_edgel_chain();
<a name="l00108"></a>00108   <span class="keywordtype">int</span> index = <a class="code" href="classbdgl__curve__algs.html#af2feeac17f59ef67ca72ef2438cc2e1e" title="Finds the index on a digital curve closest to the given point.">bdgl_curve_algs::closest_point</a>(ec, x, y);
<a name="l00109"></a>00109   xc = (*ec)[index].x();
<a name="l00110"></a>00110   yc = (*ec)[index].y();
<a name="l00111"></a>00111   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">//: Interpolates between p0 and p1 finding the closest point to p.</span>
<a name="l00115"></a>00115 <span class="comment">//  Returns the parameter t on [0, 1] -&gt; [p0, p1].</span>
<a name="l00116"></a>00116 <span class="keyword">static</span> <span class="keywordtype">double</span> interpolate_segment(vnl_double_2&amp; p0,
<a name="l00117"></a>00117                                   vnl_double_2&amp; p1,
<a name="l00118"></a>00118                                   vnl_double_2&amp; p,
<a name="l00119"></a>00119                                   vnl_double_2&amp; pc)
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121   <span class="keywordtype">double</span> Dx = p1[0]-p0[0], Dy = p1[1]-p0[1];
<a name="l00122"></a>00122   <span class="keywordtype">double</span> dx = p[0]-p0[0], dy = p[1]-p0[1];
<a name="l00123"></a>00123   <span class="keywordtype">double</span> den = Dx*Dx + Dy*Dy;
<a name="l00124"></a>00124   <span class="keywordflow">if</span> (den&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>)
<a name="l00125"></a>00125   {
<a name="l00126"></a>00126     pc = p0;
<a name="l00127"></a>00127     <span class="keywordflow">return</span> 0;
<a name="l00128"></a>00128   }
<a name="l00129"></a>00129   <span class="keywordtype">double</span> t = (dx*Dx + Dy*dy)/den;
<a name="l00130"></a>00130   <span class="comment">//clip t to lie within the interval</span>
<a name="l00131"></a>00131   <span class="keywordflow">if</span> (t&lt;0)
<a name="l00132"></a>00132     t=0.0;
<a name="l00133"></a>00133   <span class="keywordflow">if</span> (t&gt;1.0)
<a name="l00134"></a>00134     t=1.0;
<a name="l00135"></a>00135   pc[0] = t*Dx + p0[0];   pc[1] = t*Dy + p0[1];
<a name="l00136"></a>00136   <span class="keywordflow">return</span> t;
<a name="l00137"></a><a class="code" href="classbdgl__curve__algs.html#a84ada3755e1c1683b985b1d24eff6e54">00137</a> }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="comment">//:</span>
<a name="l00140"></a>00140 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00141"></a>00141 <span class="comment">// Finds the closest point on an edgel chain near a given point (x, y)</span>
<a name="l00142"></a>00142 <span class="comment">// in the neighborhood of an index.  We assume that the nearest</span>
<a name="l00143"></a>00143 <span class="comment">// point is on the interval [index, index+1].</span>
<a name="l00144"></a>00144 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00145"></a>00145 <span class="keywordtype">bool</span> <a class="code" href="classbdgl__curve__algs.html#a84ada3755e1c1683b985b1d24eff6e54" title="Finds location on a digital curve closest to the given point at index.">bdgl_curve_algs::closest_point_near</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a> <span class="keyword">const</span>&amp; ec,
<a name="l00146"></a>00146                                          <span class="keyword">const</span> <span class="keywordtype">int</span> index,
<a name="l00147"></a>00147                                          <span class="keyword">const</span> <span class="keywordtype">double</span> x,
<a name="l00148"></a>00148                                          <span class="keyword">const</span> <span class="keywordtype">double</span> y,
<a name="l00149"></a>00149                                          <span class="keywordtype">double</span> &amp; xc,
<a name="l00150"></a>00150                                          <span class="keywordtype">double</span> &amp; yc)
<a name="l00151"></a>00151 {
<a name="l00152"></a>00152   <span class="keywordtype">int</span> last = ec-&gt;size()-1;<span class="comment">//last edgel</span>
<a name="l00153"></a>00153   vnl_double_2 p(x, y);
<a name="l00154"></a>00154   vnl_double_2 p0, p1, pc;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156   <span class="keywordflow">if</span> (index&lt;0)
<a name="l00157"></a>00157     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00158"></a>00158   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index&lt;last)
<a name="l00159"></a>00159   {
<a name="l00160"></a>00160     p0[0]=(*ec)[index].x();
<a name="l00161"></a>00161     p0[1]=(*ec)[index].y();
<a name="l00162"></a>00162     p1[0]=(*ec)[index+1].x();
<a name="l00163"></a>00163     p1[1]=(*ec)[index+1].y();
<a name="l00164"></a>00164   }
<a name="l00165"></a>00165   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index==last)
<a name="l00166"></a>00166   {
<a name="l00167"></a>00167     p0[0]=(*ec)[index-1].x();
<a name="l00168"></a>00168     p0[1]=(*ec)[index-1].y();
<a name="l00169"></a>00169     p1[0]=(*ec)[index].x();
<a name="l00170"></a>00170     p1[1]=(*ec)[index].y();
<a name="l00171"></a>00171   }
<a name="l00172"></a>00172   <span class="keywordflow">else</span> <span class="comment">// index &gt; last</span>
<a name="l00173"></a>00173     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <span class="keywordtype">double</span> t = interpolate_segment(p0, p1, p, pc);
<a name="l00176"></a><a class="code" href="classbdgl__curve__algs.html#a5c2231e2566471eaf7ab3d68d16f47a3">00176</a>   vcl_cout &lt;&lt; <span class="stringliteral">&quot;At &quot;</span> &lt;&lt; p &lt;&lt; <span class="stringliteral">&quot; t = &quot;</span> &lt;&lt; t &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00177"></a>00177   xc = pc[0];   yc = pc[1];
<a name="l00178"></a>00178   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="comment">//:</span>
<a name="l00182"></a>00182 <span class="comment">// It is sometimes necessary to reverse the order of the digital curve</span>
<a name="l00183"></a>00183 <span class="comment">// so that the initial point corresponds to v1 of a topology edge</span>
<a name="l00184"></a>00184 <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> <a class="code" href="classbdgl__curve__algs.html#a5c2231e2566471eaf7ab3d68d16f47a3" title="Reverses the edgel chain.">bdgl_curve_algs::reverse</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> <span class="keyword">const</span>&amp; dc)
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186   <span class="keywordflow">if</span> (!dc)
<a name="l00187"></a>00187     <span class="keywordflow">return</span> 0;
<a name="l00188"></a>00188   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_interpolator_sptr</a> intrp = dc-&gt;get_interpolator();
<a name="l00189"></a>00189   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a> ec = intrp-&gt;get_edgel_chain();
<a name="l00190"></a>00190   <span class="keywordtype">int</span> N = ec-&gt;size();
<a name="l00191"></a><a class="code" href="classbdgl__curve__algs.html#af471a0d4606710404dbbc06ebb7b3cbd">00191</a>   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a> rev_ec = <span class="keyword">new</span> <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel__chain.html">vdgl_edgel_chain</a>();
<a name="l00192"></a>00192   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt;N; i++)
<a name="l00193"></a>00193     rev_ec-&gt;add_edgel((*ec)[N-1-i]);
<a name="l00194"></a>00194   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_interpolator_sptr</a> rev_intrp = <span class="keyword">new</span> <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__interpolator__linear.html">vdgl_interpolator_linear</a>(rev_ec);
<a name="l00195"></a>00195   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> rev_dc = <span class="keyword">new</span> <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__digital__curve.html">vdgl_digital_curve</a>(rev_intrp);
<a name="l00196"></a>00196   <span class="keywordflow">return</span> rev_dc;
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 <span class="comment">//: preliminary test to see if an infinite line intersects the bounding box of the digital curve.</span>
<a name="l00199"></a>00199 <span class="keywordtype">bool</span> <a class="code" href="classbdgl__curve__algs.html#af471a0d4606710404dbbc06ebb7b3cbd" title="Intersect the bounding box of the digital curve with the line as a test.">bdgl_curve_algs::intersect_bounding_box</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> <span class="keyword">const</span>&amp; dc,
<a name="l00200"></a>00200                                              <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html">vgl_line_2d&lt;double&gt;</a> &amp; line)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vsol_box_2d_sptr</a> bb = dc-&gt;get_bounding_box();
<a name="l00203"></a>00203   <span class="keywordflow">if</span> (!bb)
<a name="l00204"></a>00204     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00205"></a>00205   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__box__2d.html">vgl_box_2d&lt;double&gt;</a> box(bb-&gt;get_min_x(), bb-&gt;get_max_x(),
<a name="l00206"></a>00206                          bb-&gt;get_min_y(), bb-&gt;get_max_y());
<a name="l00207"></a>00207   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> p0, p1;
<a name="l00208"></a>00208   <span class="keywordflow">if</span> (<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/algo_2vgl__intersection_8h.html#a64447bf999aea2432ca2760d8839ec48">vgl_intersection</a>(box, line, p0, p1))
<a name="l00209"></a>00209     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00210"></a>00210   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 <span class="comment">//: Intersect an infinite line with a line formed by the two input points , p0 and p1.</span>
<a name="l00213"></a>00213 <span class="comment">// It is assumed that the two lines do intersect.</span>
<a name="l00214"></a>00214 <span class="comment">// If they are parallel, &quot;false&quot; is returned.</span>
<a name="l00215"></a>00215 <span class="keyword">static</span> <span class="keywordtype">bool</span> intersect_crossing(vnl_double_3&amp; line_coefs,
<a name="l00216"></a>00216                                vnl_double_3&amp; p0,
<a name="l00217"></a>00217                                vnl_double_3&amp; p1,
<a name="l00218"></a>00218                                vnl_double_3&amp; inter)
<a name="l00219"></a>00219 {
<a name="l00220"></a>00220   <span class="comment">//Form the line from p0 and p1</span>
<a name="l00221"></a>00221   vnl_double_3 lv01 = <a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/vnl__cross_8h.html#aa48028b5abe52d461ac5724b0b788844">vnl_cross_3d</a>(p0, p1);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223   <span class="comment">//Find the intersection point</span>
<a name="l00224"></a>00224   inter = <a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/vnl__cross_8h.html#aa48028b5abe52d461ac5724b0b788844">vnl_cross_3d</a>(lv01, line_coefs);
<a name="l00225"></a>00225   <span class="comment">//Check sanity of the intersection</span>
<a name="l00226"></a>00226   <span class="keywordflow">return</span> vcl_fabs(inter[2]) &gt;= <a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>;
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 <span class="comment">//: Recursive helper function for intersect_line_fast</span>
<a name="l00231"></a>00231 <span class="keyword">static</span> <span class="keywordtype">bool</span> intersect_line_helper(<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel__chain.html">vdgl_edgel_chain</a> <span class="keyword">const</span>&amp; ec,
<a name="l00232"></a>00232                                   vnl_double_3&amp; lv,
<a name="l00233"></a>00233                                   <span class="keywordtype">double</span> dist1, <span class="keywordtype">double</span> dist2,
<a name="l00234"></a>00234                                   <span class="keywordtype">int</span> index1, <span class="keywordtype">int</span> index2,
<a name="l00235"></a>00235                                   vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; pts)
<a name="l00236"></a>00236 {
<a name="l00237"></a>00237   <span class="keywordtype">int</span> di = (index2 - index1);
<a name="l00238"></a>00238   <span class="keywordflow">if</span> (di&lt;1) {
<a name="l00239"></a>00239     vcl_cout &lt;&lt; <span class="stringliteral">&quot;In bdgl_curve_algs::intersect_line_helper -&quot;</span>
<a name="l00240"></a>00240              &lt;&lt; <span class="stringliteral">&quot; invalid curve segment\n&quot;</span>;
<a name="l00241"></a>00241     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00242"></a>00242   }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244   <span class="keywordflow">if</span> (vcl_fabs(dist2)&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a> || dist1*dist2&lt;0.0) {
<a name="l00245"></a>00245     <span class="comment">// base case: compute the intersection</span>
<a name="l00246"></a>00246     <span class="keywordflow">if</span> (di==1) {
<a name="l00247"></a>00247       <span class="comment">// the first and last edgels</span>
<a name="l00248"></a>00248       <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> <span class="keyword">const</span>&amp; e1 = ec[index1];
<a name="l00249"></a>00249       <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> <span class="keyword">const</span>&amp; e2 = ec[index2];
<a name="l00250"></a>00250       vnl_double_3 p1(e1.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a84e3cc04abbd3e58d6abfc954974c3f0">get_x</a>(), e1.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a4202f1f31f2ee257f5760b2b390677e4">get_y</a>(), 1.0);
<a name="l00251"></a>00251       vnl_double_3 p2(e2.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a84e3cc04abbd3e58d6abfc954974c3f0">get_x</a>(), e2.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a4202f1f31f2ee257f5760b2b390677e4">get_y</a>(), 1.0);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253       vnl_double_3 inter;
<a name="l00254"></a>00254       <span class="keywordflow">if</span> (intersect_crossing(lv, p1, p2, inter)) {
<a name="l00255"></a>00255         <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> p(inter[0]/inter[2], inter[1]/inter[2]);
<a name="l00256"></a>00256         pts.push_back(p);
<a name="l00257"></a>00257         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00258"></a>00258       }
<a name="l00259"></a>00259       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261   }
<a name="l00262"></a>00262   <span class="keywordflow">else</span>{
<a name="l00263"></a>00263     <span class="keywordflow">if</span> (di==1) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00264"></a>00264     <span class="keywordflow">if</span> ((di*<a class="code" href="classbdgl__curve__algs.html#a7c144422263d4c376e10ab143d1306bf">bdgl_curve_algs::max_edgel_sep</a>)&lt;vcl_fabs(dist1+dist2)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00265"></a>00265   }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267   <span class="keywordtype">int</span> mid_index = index1 + di/2;
<a name="l00268"></a>00268   vnl_double_3 mid_point(ec[mid_index].get_x(), ec[mid_index].get_y(), 1.0);
<a name="l00269"></a>00269   <span class="keywordtype">double</span> mid_dist = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(mid_point, lv);
<a name="l00270"></a>00270   <span class="keywordtype">bool</span> i1 = intersect_line_helper(ec, lv, dist1, mid_dist, index1, mid_index, pts);
<a name="l00271"></a>00271   <span class="keywordtype">bool</span> i2 = intersect_line_helper(ec, lv, mid_dist, dist2, mid_index, index2, pts);
<a name="l00272"></a>00272   <span class="keywordflow">return</span> i1 || i2;
<a name="l00273"></a><a class="code" href="classbdgl__curve__algs.html#a3ca1c4add53f58a55d50d78256d4805a">00273</a> }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="comment">//-------------------------------------------------------------</span>
<a name="l00276"></a>00276 <span class="comment">//: intersect an infinite line with the digital curve.</span>
<a name="l00277"></a>00277 <span class="comment">//  If there is no intersection return false. Note that the line</span>
<a name="l00278"></a>00278 <span class="comment">//  can intersect multiple times. All the intersections are returned.</span>
<a name="l00279"></a>00279 <span class="comment">//</span>
<a name="l00280"></a>00280 <span class="comment">//  This implementation uses a recursive helper function</span>
<a name="l00281"></a>00281 <span class="keywordtype">bool</span> <a class="code" href="classbdgl__curve__algs.html#a2557592e760e2cf1b89361ff58a50b08" title="Intersect the curve with an infinite line, return the index values.">bdgl_curve_algs::intersect_line_fast</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> <span class="keyword">const</span>&amp; dc,
<a name="l00282"></a>00282                                           <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html">vgl_line_2d&lt;double&gt;</a> &amp; line,
<a name="l00283"></a>00283                                           vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; pts)
<a name="l00284"></a>00284 {
<a name="l00285"></a>00285   <span class="keywordflow">if</span> (!dc)
<a name="l00286"></a>00286   {
<a name="l00287"></a>00287     vcl_cout &lt;&lt; <span class="stringliteral">&quot;In bdgl_curve_algs::intersect_line_fast - null curve\n&quot;</span>;
<a name="l00288"></a>00288     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00289"></a>00289   }
<a name="l00290"></a>00290   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_interpolator_sptr</a> interp = dc-&gt;get_interpolator();
<a name="l00291"></a>00291   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a>  ec = interp-&gt;get_edgel_chain();
<a name="l00292"></a>00292 
<a name="l00293"></a>00293   <span class="comment">// normalized the line so that the algebraic distance between</span>
<a name="l00294"></a>00294   <span class="comment">// lv and (x,y,1) is the geometric distance</span>
<a name="l00295"></a>00295   line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a59900655c69f9dbc12ae4e51c16aca81">normalize</a>();
<a name="l00296"></a>00296   vnl_double_3 lv(line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a514cb88be30de5ca197bb866878c6c39">a</a>(), line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a7a58fce013a75f492c9b49ede0eb2b4c">b</a>(), line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a556109b3c8173a446c37eed3b9284674">c</a>());
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   <span class="comment">// the first and last edgels</span>
<a name="l00299"></a>00299   <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> <span class="keyword">const</span>&amp; e1 = (*ec)[0];
<a name="l00300"></a>00300   <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> <span class="keyword">const</span>&amp; e2 = (*ec)[ec-&gt;size()-1];
<a name="l00301"></a>00301 
<a name="l00302"></a>00302   vnl_double_3 p1(e1.get_x(), e1.get_y(), 1.0);
<a name="l00303"></a>00303   vnl_double_3 p2(e2.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a84e3cc04abbd3e58d6abfc954974c3f0">get_x</a>(), e2.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a4202f1f31f2ee257f5760b2b390677e4">get_y</a>(), 1.0);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305   <span class="keywordtype">double</span> dist1 = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(p1, lv);
<a name="l00306"></a>00306   <span class="keywordtype">double</span> dist2 = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(p2, lv);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   <span class="keywordtype">bool</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__homg__line__3d__2__points_8h.html#a940c11f17a733fa4f4ba8fae6a217b2c">intersection</a> = <span class="keyword">false</span>;
<a name="l00309"></a>00309   <span class="comment">// This case (the first edgel is on the line)</span>
<a name="l00310"></a>00310   <span class="comment">// is not covered by the recursion</span>
<a name="l00311"></a>00311   <span class="keywordflow">if</span> (vcl_fabs(dist1)&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>) {
<a name="l00312"></a>00312     <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> <span class="keyword">const</span>&amp; e = (*ec)[1];
<a name="l00313"></a>00313     vnl_double_3 p(e.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a84e3cc04abbd3e58d6abfc954974c3f0">get_x</a>(), e.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a4202f1f31f2ee257f5760b2b390677e4">get_y</a>(), 1.0);
<a name="l00314"></a>00314     vnl_double_3 inter;
<a name="l00315"></a>00315     <span class="keywordflow">if</span> (intersect_crossing(lv, p1, p, inter)) {
<a name="l00316"></a>00316       <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> p(inter[0]/inter[2], inter[1]/inter[2]);
<a name="l00317"></a>00317       pts.push_back(p);
<a name="l00318"></a>00318       intersection = <span class="keyword">true</span>;
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320   }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322   <span class="keywordflow">return</span> intersect_line_helper(*ec, lv, dist1, dist2, 0, ec-&gt;size()-1, pts) ||
<a name="l00323"></a><a class="code" href="classbdgl__curve__algs.html#a2ae8792399236055a015f3006313916c">00323</a>          intersection;
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 <span class="comment">//-------------------------------------------------------------</span>
<a name="l00328"></a>00328 <span class="comment">//: intersect an infinite line with the digital curve.</span>
<a name="l00329"></a>00329 <span class="comment">//  If there is no intersection return false. Note that the line</span>
<a name="l00330"></a>00330 <span class="comment">//  can intersect multiple times. All the intersections are returned.</span>
<a name="l00331"></a>00331 <span class="keywordtype">bool</span> <a class="code" href="classbdgl__curve__algs.html#a8ff42d189db4d2e169941d9251124a44" title="Intersect the curve with an infinite line, return the index values.">bdgl_curve_algs::intersect_line</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> <span class="keyword">const</span>&amp; dc,
<a name="l00332"></a>00332                                      <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html">vgl_line_2d&lt;double&gt;</a>&amp; line,
<a name="l00333"></a>00333                                      vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; pts)
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335   <span class="keywordflow">if</span> (!dc)
<a name="l00336"></a>00336   {
<a name="l00337"></a>00337     vcl_cout &lt;&lt; <span class="stringliteral">&quot;In bdgl_curve_algs::intersect_line - null curve\n&quot;</span>;
<a name="l00338"></a>00338     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00339"></a>00339   }
<a name="l00340"></a>00340   <span class="comment">//compute the resolution of the intersection. The digital curve is</span>
<a name="l00341"></a>00341   <span class="comment">//typically embedded in image coordinates so we would want to compute the</span>
<a name="l00342"></a>00342   <span class="comment">//intersection to 0.1 pixels.  The parametrization of the curve is [0,1]</span>
<a name="l00343"></a>00343   <span class="comment">//so the search interval on the parmeter should be dt = 1/(10*dc-&gt;length())</span>
<a name="l00344"></a>00344   <span class="comment">//That is, this change of dt corresponds to 0.1 pixel on the curve.</span>
<a name="l00345"></a>00345 
<a name="l00346"></a>00346   <span class="keywordtype">bool</span> intersection = <span class="keyword">false</span>;
<a name="l00347"></a>00347   vnl_double_3 lv(line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a514cb88be30de5ca197bb866878c6c39">a</a>(), line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a7a58fce013a75f492c9b49ede0eb2b4c">b</a>(), line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a556109b3c8173a446c37eed3b9284674">c</a>());
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   <span class="comment">//We take advantage of the fact that the algebraic distance to</span>
<a name="l00350"></a>00350   <span class="comment">//a line changes sign if we cross it.</span>
<a name="l00351"></a>00351   <span class="keywordtype">double</span> t=0, dt = 1/(10*dc-&gt;length());
<a name="l00352"></a>00352   vnl_double_3 p0(dc-&gt;get_x(t), dc-&gt;get_y(t), 1.0), p1;
<a name="l00353"></a>00353   <span class="keywordflow">for</span> (<span class="keywordtype">double</span> t=dt; t&lt;=1.0; t+=dt)
<a name="l00354"></a>00354   {
<a name="l00355"></a>00355     p1[0]=dc-&gt;get_x(t); p1[1]=dc-&gt;get_y(t); p1[2]= 1.0;
<a name="l00356"></a>00356     <span class="keywordtype">double</span> sign0 = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(p0, lv);
<a name="l00357"></a>00357     <span class="keywordtype">double</span> sign1 = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(p1, lv);
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (vcl_fabs(sign0)&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>||              <span class="comment">//we have crossed or</span>
<a name="l00359"></a>00359         vcl_fabs(sign1)&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>||sign0*sign1&lt;=0) <span class="comment">// are on the line</span>
<a name="l00360"></a>00360     {
<a name="l00361"></a>00361       vnl_double_3 inter;
<a name="l00362"></a>00362       <span class="keywordflow">if</span> (intersect_crossing(lv, p0, p1, inter))
<a name="l00363"></a>00363       {
<a name="l00364"></a>00364         <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> p(inter[0]/inter[2], inter[1]/inter[2]);
<a name="l00365"></a>00365         pts.push_back(p);
<a name="l00366"></a>00366         intersection = <span class="keyword">true</span>;
<a name="l00367"></a>00367       }
<a name="l00368"></a>00368     }
<a name="l00369"></a>00369     p0=p1;
<a name="l00370"></a>00370   }
<a name="l00371"></a>00371   <span class="keywordflow">return</span> intersection;
<a name="l00372"></a>00372 }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 <span class="comment">//------------------------------------------------------------------</span>
<a name="l00375"></a>00375 <span class="comment">//:</span>
<a name="l00376"></a>00376 <span class="comment">// Given a line segment and a point interior to the line segment</span>
<a name="l00377"></a>00377 <span class="comment">// find the intermediate line parameter value for the point. t0 and t1</span>
<a name="l00378"></a>00378 <span class="comment">// are the line parameter values for p0 and p1 respectively.</span>
<a name="l00379"></a>00379 <span class="keyword">static</span> <span class="keywordtype">double</span> interpolate_parameter(<span class="keyword">const</span> <span class="keywordtype">double</span> t0, <span class="keyword">const</span> <span class="keywordtype">double</span> t1,
<a name="l00380"></a>00380                                     vnl_double_3&amp; p0,
<a name="l00381"></a>00381                                     vnl_double_3&amp; p1,
<a name="l00382"></a>00382                                     vnl_double_3&amp; pt)
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384   <span class="keywordflow">if</span> (vcl_fabs(p0[2])&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>)
<a name="l00385"></a>00385     <span class="keywordflow">return</span> t0;
<a name="l00386"></a>00386   <span class="keywordflow">if</span> (vcl_fabs(p1[2])&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>)
<a name="l00387"></a>00387     <span class="keywordflow">return</span> t0;
<a name="l00388"></a>00388   <span class="keywordflow">if</span> (vcl_fabs(pt[2])&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>)
<a name="l00389"></a>00389     <span class="keywordflow">return</span> t0;
<a name="l00390"></a>00390   <span class="keywordtype">double</span> x0 = p0[0]/p0[2], y0 = p0[1]/p0[2];
<a name="l00391"></a>00391   <span class="keywordtype">double</span> x1 = p1[0]/p1[2], y1 = p1[1]/p1[2];
<a name="l00392"></a>00392   <span class="keywordtype">double</span> xt = pt[0]/pt[2], yt = pt[1]/pt[2];
<a name="l00393"></a>00393   <span class="keywordtype">double</span> d01 = vcl_sqrt((x1-x0)*(x1-x0) + (y1-y0)*(y1-y0));
<a name="l00394"></a>00394   <span class="keywordtype">double</span> d0t = vcl_sqrt((xt-x0)*(xt-x0) + (yt-y0)*(yt-y0));
<a name="l00395"></a>00395   <span class="keywordtype">double</span> r = d0t/d01;<span class="comment">//relative length from p0 to pt</span>
<a name="l00396"></a>00396   <span class="keywordtype">double</span> dt = t1-t0;
<a name="l00397"></a>00397   <span class="keywordflow">return</span> t0 + r*dt;
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 <span class="comment">//: Recursive helper function for intersect_line_fast</span>
<a name="l00402"></a>00402 <span class="keyword">static</span> <span class="keywordtype">bool</span> intersect_line_helper(<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel__chain.html">vdgl_edgel_chain</a> <span class="keyword">const</span>&amp; ec,
<a name="l00403"></a>00403                                   vnl_double_3&amp; lv,
<a name="l00404"></a>00404                                   <span class="keywordtype">double</span> dist1, <span class="keywordtype">double</span> dist2,
<a name="l00405"></a>00405                                   <span class="keywordtype">int</span> index1, <span class="keywordtype">int</span> index2,
<a name="l00406"></a>00406                                   vcl_vector&lt;double&gt;&amp; indices)
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408   <span class="keywordtype">int</span> di = (index2 - index1);
<a name="l00409"></a>00409   <span class="keywordflow">if</span> (di&lt;1) {
<a name="l00410"></a>00410     vcl_cout &lt;&lt; <span class="stringliteral">&quot;In bdgl_curve_algs::intersect_line_helper -&quot;</span>
<a name="l00411"></a>00411              &lt;&lt; <span class="stringliteral">&quot; invalid curve segment\n&quot;</span>;
<a name="l00412"></a>00412     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00413"></a>00413   }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415   <span class="keywordflow">if</span> (vcl_fabs(dist2)&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a> || dist1*dist2&lt;0.0) {
<a name="l00416"></a>00416     <span class="comment">// base case: compute the intersection</span>
<a name="l00417"></a>00417     <span class="keywordflow">if</span> (di==1) {
<a name="l00418"></a>00418       <span class="comment">// the first and last edgels</span>
<a name="l00419"></a>00419       <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> <span class="keyword">const</span>&amp; e1 = ec[index1];
<a name="l00420"></a>00420       <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> <span class="keyword">const</span>&amp; e2 = ec[index2];
<a name="l00421"></a>00421       vnl_double_3 p1(e1.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a84e3cc04abbd3e58d6abfc954974c3f0">get_x</a>(), e1.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a4202f1f31f2ee257f5760b2b390677e4">get_y</a>(), 1.0);
<a name="l00422"></a>00422       vnl_double_3 p2(e2.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a84e3cc04abbd3e58d6abfc954974c3f0">get_x</a>(), e2.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a4202f1f31f2ee257f5760b2b390677e4">get_y</a>(), 1.0);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424       vnl_double_3 inter;
<a name="l00425"></a>00425       <span class="keywordflow">if</span> (intersect_crossing(lv, p1, p2, inter)) {
<a name="l00426"></a>00426         <span class="keywordtype">double</span> param_step = 1.0/(ec.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel__chain.html#a05ad00d23910bbc396b63e62bbc990eb">size</a>()-1);
<a name="l00427"></a>00427         <span class="keywordtype">double</span> ti = interpolate_parameter(index1*param_step, index2*param_step,
<a name="l00428"></a>00428                                           p1, p2, inter);
<a name="l00429"></a>00429         indices.push_back(ti);
<a name="l00430"></a>00430         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00431"></a>00431       }
<a name="l00432"></a>00432       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434   }
<a name="l00435"></a>00435   <span class="keywordflow">else</span>{
<a name="l00436"></a>00436     <span class="keywordflow">if</span> (di==1) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00437"></a>00437     <span class="keywordflow">if</span> ((di*bdgl_curve_algs::max_edgel_sep)&lt;vcl_fabs(dist1+dist2)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00438"></a>00438   }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440   <span class="keywordtype">int</span> mid_index = index1 + di/2;
<a name="l00441"></a>00441   vnl_double_3 mid_point(ec[mid_index].get_x(), ec[mid_index].get_y(), 1.0);
<a name="l00442"></a>00442   <span class="keywordtype">double</span> mid_dist = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(mid_point, lv);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   <span class="keywordtype">bool</span> i1 = intersect_line_helper(ec, lv, dist1, mid_dist, index1, mid_index, indices);
<a name="l00445"></a>00445   <span class="keywordtype">bool</span> i2 = intersect_line_helper(ec, lv, mid_dist, dist2, mid_index, index2, indices);
<a name="l00446"></a>00446   <span class="keywordflow">return</span> i1 || i2;
<a name="l00447"></a>00447 }
<a name="l00448"></a><a class="code" href="classbdgl__curve__algs.html#a2557592e760e2cf1b89361ff58a50b08">00448</a> 
<a name="l00449"></a>00449 <span class="comment">//-------------------------------------------------------------</span>
<a name="l00450"></a>00450 <span class="comment">//: intersect an infinite line with the digital curve.</span>
<a name="l00451"></a>00451 <span class="comment">//  If there is no intersection return false. Note that the line</span>
<a name="l00452"></a>00452 <span class="comment">//  can intersect multiple times. The curve parameter indices at</span>
<a name="l00453"></a>00453 <span class="comment">//  the intersection points are returned</span>
<a name="l00454"></a>00454 <span class="comment">//</span>
<a name="l00455"></a>00455 <span class="comment">//  This implementation uses a recursive helper function</span>
<a name="l00456"></a>00456 <span class="keywordtype">bool</span> <a class="code" href="classbdgl__curve__algs.html#a2557592e760e2cf1b89361ff58a50b08" title="Intersect the curve with an infinite line, return the index values.">bdgl_curve_algs::intersect_line_fast</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> <span class="keyword">const</span>&amp; dc,
<a name="l00457"></a>00457                                           <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html">vgl_line_2d&lt;double&gt;</a> &amp; line,
<a name="l00458"></a>00458                                           vcl_vector&lt;double&gt;&amp; indices)
<a name="l00459"></a>00459 {
<a name="l00460"></a>00460   <span class="keywordflow">if</span> (!dc)
<a name="l00461"></a>00461   {
<a name="l00462"></a>00462     vcl_cout &lt;&lt; <span class="stringliteral">&quot;In bdgl_curve_algs::intersect_line_fast - null curve\n&quot;</span>;
<a name="l00463"></a>00463     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00464"></a>00464   }
<a name="l00465"></a>00465   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_interpolator_sptr</a> interp = dc-&gt;get_interpolator();
<a name="l00466"></a>00466   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a>  ec = interp-&gt;get_edgel_chain();
<a name="l00467"></a>00467 
<a name="l00468"></a>00468   <span class="comment">// normalized the line so that the algebraic distance between</span>
<a name="l00469"></a>00469   <span class="comment">// lv and (x,y,1) is the geometric distance</span>
<a name="l00470"></a>00470   line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a59900655c69f9dbc12ae4e51c16aca81">normalize</a>();
<a name="l00471"></a>00471   vnl_double_3 lv(line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a514cb88be30de5ca197bb866878c6c39">a</a>(), line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a7a58fce013a75f492c9b49ede0eb2b4c">b</a>(), line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a556109b3c8173a446c37eed3b9284674">c</a>());
<a name="l00472"></a>00472 
<a name="l00473"></a>00473   <span class="comment">// the first and last edgels</span>
<a name="l00474"></a>00474   <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> <span class="keyword">const</span>&amp; e1 = (*ec)[0];
<a name="l00475"></a>00475   <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> <span class="keyword">const</span>&amp; e2 = (*ec)[ec-&gt;size()-1];
<a name="l00476"></a>00476 
<a name="l00477"></a>00477   vnl_double_3 p1(e1.get_x(), e1.get_y(), 1.0);
<a name="l00478"></a>00478   vnl_double_3 p2(e2.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a84e3cc04abbd3e58d6abfc954974c3f0">get_x</a>(), e2.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a4202f1f31f2ee257f5760b2b390677e4">get_y</a>(), 1.0);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480   <span class="keywordtype">double</span> dist1 = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(p1, lv);
<a name="l00481"></a>00481   <span class="keywordtype">double</span> dist2 = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(p2, lv);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483   <span class="keywordtype">bool</span> intersection = <span class="keyword">false</span>;
<a name="l00484"></a>00484   <span class="comment">// This case (the first edgel is on the line)</span>
<a name="l00485"></a>00485   <span class="comment">// is not covered by the recursion</span>
<a name="l00486"></a>00486   <span class="keywordflow">if</span> (vcl_fabs(dist1)&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>) {
<a name="l00487"></a>00487     <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> <span class="keyword">const</span>&amp; e = (*ec)[1];
<a name="l00488"></a>00488     vnl_double_3 p(e.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a84e3cc04abbd3e58d6abfc954974c3f0">get_x</a>(), e.<a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html#a4202f1f31f2ee257f5760b2b390677e4">get_y</a>(), 1.0);
<a name="l00489"></a>00489     vnl_double_3 inter;
<a name="l00490"></a>00490     <span class="keywordflow">if</span> (intersect_crossing(lv, p1, p, inter)) {
<a name="l00491"></a>00491       <span class="keywordtype">double</span> param_step = 1.0/(ec-&gt;size()-1);
<a name="l00492"></a>00492       <span class="keywordtype">double</span> ti = interpolate_parameter(0.0, param_step, p1, p, inter);
<a name="l00493"></a>00493       indices.push_back(ti);
<a name="l00494"></a>00494       intersection = <span class="keyword">true</span>;
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496   }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498   <span class="keywordflow">return</span> intersect_line_helper(*ec, lv, dist1, dist2, 0, ec-&gt;size()-1, indices) ||
<a name="l00499"></a>00499          intersection;
<a name="l00500"></a><a class="code" href="classbdgl__curve__algs.html#a8ff42d189db4d2e169941d9251124a44">00500</a> }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 
<a name="l00503"></a>00503 <span class="comment">//-------------------------------------------------------------</span>
<a name="l00504"></a>00504 <span class="comment">//: intersect an infinite line with the digital curve.</span>
<a name="l00505"></a>00505 <span class="comment">//  If there is no intersection return false. Note that the line</span>
<a name="l00506"></a>00506 <span class="comment">//  can intersect multiple times. The curve parameter indices at</span>
<a name="l00507"></a>00507 <span class="comment">//  the intersection points are returned</span>
<a name="l00508"></a>00508 <span class="keywordtype">bool</span> <a class="code" href="classbdgl__curve__algs.html#a8ff42d189db4d2e169941d9251124a44" title="Intersect the curve with an infinite line, return the index values.">bdgl_curve_algs::intersect_line</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> <span class="keyword">const</span>&amp; dc,
<a name="l00509"></a>00509                                      <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html">vgl_line_2d&lt;double&gt;</a>&amp; line,
<a name="l00510"></a>00510                                      vcl_vector&lt;double&gt;&amp; indices)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512   <span class="keywordflow">if</span> (!dc)
<a name="l00513"></a>00513   {
<a name="l00514"></a>00514     vcl_cout &lt;&lt; <span class="stringliteral">&quot;In bdgl_curve_algs::intersect_line - null curve\n&quot;</span>;
<a name="l00515"></a>00515     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00516"></a>00516   }
<a name="l00517"></a>00517   <span class="comment">//compute the resolution of the intersection. The digital curve is</span>
<a name="l00518"></a>00518   <span class="comment">//typically embedded in image coordinates so we would want to compute the</span>
<a name="l00519"></a>00519   <span class="comment">//intersection to 0.1 pixels.  The parametrization of the curve is [0,1]</span>
<a name="l00520"></a>00520   <span class="comment">//so the search interval on the parmeter should be dt = 1/(10*dc-&gt;length())</span>
<a name="l00521"></a>00521   <span class="comment">//That is, this change of dt corresponds to 0.1 pixel on the curve.</span>
<a name="l00522"></a>00522 
<a name="l00523"></a>00523   <span class="keywordtype">bool</span> intersection = <span class="keyword">false</span>;
<a name="l00524"></a>00524   vnl_double_3 lv(line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a514cb88be30de5ca197bb866878c6c39">a</a>(), line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a7a58fce013a75f492c9b49ede0eb2b4c">b</a>(), line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a556109b3c8173a446c37eed3b9284674">c</a>());
<a name="l00525"></a>00525 
<a name="l00526"></a>00526   <span class="comment">//We take advantage of the fact that the algebraic distance to</span>
<a name="l00527"></a>00527   <span class="comment">//a line changes sign if we cross it.</span>
<a name="l00528"></a>00528   <span class="keywordtype">double</span> t=0, dt = 1/(10*dc-&gt;length());
<a name="l00529"></a>00529   vnl_double_3 p0(dc-&gt;get_x(t), dc-&gt;get_y(t), 1.0), p1;
<a name="l00530"></a>00530   <span class="keywordflow">for</span> (<span class="keywordtype">double</span> t=dt; t&lt;=1.0; t+=dt)
<a name="l00531"></a>00531   {
<a name="l00532"></a>00532     p1[0]=dc-&gt;get_x(t); p1[1]=dc-&gt;get_y(t); p1[2]= 1.0;
<a name="l00533"></a>00533     <span class="keywordtype">double</span> sign0 = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(p0, lv);
<a name="l00534"></a>00534     <span class="keywordtype">double</span> sign1 = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(p1, lv);
<a name="l00535"></a>00535     <span class="keywordflow">if</span> (vcl_fabs(sign0)&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>||              <span class="comment">//we have crossed or</span>
<a name="l00536"></a>00536         vcl_fabs(sign1)&lt;<a class="code" href="classbdgl__curve__algs.html#af74917715d0b4fdda4bf28e7fce30722">bdgl_curve_algs::tol</a>||sign0*sign1&lt;=0) <span class="comment">// are on the line</span>
<a name="l00537"></a>00537     {
<a name="l00538"></a>00538       vnl_double_3 inter;
<a name="l00539"></a>00539       <span class="keywordflow">if</span> (intersect_crossing(lv, p0, p1, inter))
<a name="l00540"></a>00540       {
<a name="l00541"></a>00541         <span class="keywordtype">double</span> ti = interpolate_parameter(t, t+dt, p0, p1, inter);
<a name="l00542"></a>00542         indices.push_back(ti);
<a name="l00543"></a>00543         intersection = <span class="keyword">true</span>;
<a name="l00544"></a>00544       }
<a name="l00545"></a>00545     }
<a name="l00546"></a><a class="code" href="classbdgl__curve__algs.html#a2c0f0a03f1bdd8b62f3e35963cf3ef1b">00546</a>     p0=p1;
<a name="l00547"></a>00547   }
<a name="l00548"></a>00548   <span class="keywordflow">return</span> intersection;
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 <span class="comment">//:Intersect a curve and find the closest point to \a ref_point with a compatible gradient angle</span>
<a name="l00553"></a>00553 <span class="keywordtype">bool</span>
<a name="l00554"></a>00554 <a class="code" href="classbdgl__curve__algs.html#a2c0f0a03f1bdd8b62f3e35963cf3ef1b" title="Intersect a curve with a line and match the reference edgel point.">bdgl_curve_algs::match_intersection</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> <span class="keyword">const</span>&amp; dc,
<a name="l00555"></a>00555                                     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html">vgl_line_2d&lt;double&gt;</a>&amp; line,
<a name="l00556"></a>00556                                     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> <span class="keyword">const</span>&amp; ref_point,
<a name="l00557"></a>00557                                     <span class="keywordtype">double</span> ref_gradient_angle,
<a name="l00558"></a>00558                                     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; point)
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560   <span class="keywordtype">double</span> angle_thresh = 7.0;<span class="comment">//epipolar angle threshold</span>
<a name="l00561"></a>00561   <span class="keywordtype">double</span> angle_tol = 12.5;<span class="comment">//gradient angle threshold</span>
<a name="l00562"></a>00562   <span class="keywordflow">if</span> (!dc)
<a name="l00563"></a>00563     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00564"></a>00564   <span class="keywordtype">double</span> la = line.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__line__2d.html#a473f4d4d515e760089711e8305efbcb9">slope_degrees</a>();
<a name="l00565"></a>00565   <span class="keywordflow">if</span> (la&lt;0)
<a name="l00566"></a>00566     la+=180;
<a name="l00567"></a>00567   vcl_vector&lt;double&gt; indices;
<a name="l00568"></a>00568   <span class="keywordflow">if</span> (!<a class="code" href="classbdgl__curve__algs.html#a8ff42d189db4d2e169941d9251124a44" title="Intersect the curve with an infinite line, return the index values.">bdgl_curve_algs::intersect_line</a>(dc, line, indices))
<a name="l00569"></a>00569     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00570"></a>00570   <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__homg__point__2d.html">vgl_homg_point_2d&lt;double&gt;</a> rph(ref_point.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(), ref_point.<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>());
<a name="l00571"></a>00571   <span class="keywordtype">double</span> dist = 1e10;
<a name="l00572"></a>00572   <span class="keywordtype">bool</span> found_valid_intersection = <span class="keyword">false</span>;
<a name="l00573"></a>00573   <span class="keywordflow">for</span> (vcl_vector&lt;double&gt;::iterator iit = indices.begin();
<a name="l00574"></a>00574        iit != indices.end(); iit++)
<a name="l00575"></a>00575   {
<a name="l00576"></a>00576     <span class="keywordtype">double</span> grad_angle = dc-&gt;get_theta(*iit);
<a name="l00577"></a>00577     <span class="keywordflow">if</span> (vcl_fabs(ref_gradient_angle-grad_angle)&gt;angle_tol)
<a name="l00578"></a>00578       <span class="keywordflow">continue</span>;
<a name="l00579"></a>00579     <span class="keywordtype">double</span> ca = dc-&gt;get_tangent_angle(*iit);
<a name="l00580"></a>00580     <span class="keywordflow">if</span> (ca&lt;0)
<a name="l00581"></a>00581       ca+=180;
<a name="l00582"></a>00582     <span class="keywordtype">double</span> delt = vcl_fabs(vcl_sin(vcl_fabs(vnl_math::pi_over_180*(ca-la)))*vnl_math::deg_per_rad);
<a name="l00583"></a>00583     <span class="keywordflow">if</span> (delt&lt;angle_thresh)
<a name="l00584"></a>00584       <span class="keywordflow">continue</span>;
<a name="l00585"></a>00585     <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__homg__point__2d.html">vgl_homg_point_2d&lt;double&gt;</a> ph(dc-&gt;get_x(*iit), dc-&gt;get_y(*iit));
<a name="l00586"></a>00586     <span class="keywordtype">double</span> d = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__homg__operators__2d.html">vgl_homg_operators_2d&lt;double&gt;::distance_squared</a>(rph, ph);
<a name="l00587"></a>00587     d = vcl_sqrt(d);
<a name="l00588"></a>00588     found_valid_intersection = <span class="keyword">true</span>;
<a name="l00589"></a>00589     <span class="keywordflow">if</span> (d&lt;dist)
<a name="l00590"></a>00590     {
<a name="l00591"></a>00591       <span class="comment">//double best_delt = delt;</span>
<a name="l00592"></a>00592       <span class="comment">//double best_ind = *iit;</span>
<a name="l00593"></a>00593       dist = d;
<a name="l00594"></a>00594       point = <a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>(dc-&gt;get_x(*iit), dc-&gt;get_y(*iit));
<a name="l00595"></a>00595     }
<a name="l00596"></a>00596   }
<a name="l00597"></a>00597   <span class="keywordflow">return</span> found_valid_intersection;
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 <span class="comment">//: generate contiguous pixels on a straight line.</span>
<a name="l00601"></a>00601 <span class="comment">// Advance along a line and generate contiguous pixels on a straight</span>
<a name="l00602"></a>00602 <span class="comment">// line defined by (xs, ys) : (xe, ye).  The samples are generated</span>
<a name="l00603"></a>00603 <span class="comment">// as values of (x, y).</span>
<a name="l00604"></a>00604 <span class="comment">// The routine is called in a loop that generates the points, e.g.,</span>
<a name="l00605"></a>00605 <span class="comment">// \code</span>
<a name="l00606"></a><a class="code" href="classbdgl__curve__algs.html#a400729aa86df35be1fecb98357024683">00606</a> <span class="comment">//   while (line_gen(xs, ys, xe, ye, init, done, x, y))</span>
<a name="l00607"></a>00607 <span class="comment">//   { ...</span>
<a name="l00608"></a>00608 <span class="comment">// \endcode</span>
<a name="l00609"></a>00609 <span class="comment">// The routine needs two internal state variables, init and done.</span>
<a name="l00610"></a>00610 <span class="comment">// init should be set to true</span>
<a name="l00611"></a>00611 <span class="comment">// done should be set to false</span>
<a name="l00612"></a>00612 <span class="comment">// when the routine is first called.</span>
<a name="l00613"></a>00613 <span class="comment">//</span>
<a name="l00614"></a>00614 <span class="keywordtype">bool</span> <a class="code" href="classbdgl__curve__algs.html#a400729aa86df35be1fecb98357024683" title="Generate points along a digital straight line.">bdgl_curve_algs::line_gen</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> xs, <span class="keyword">const</span> <span class="keywordtype">float</span> ys,
<a name="l00615"></a>00615                                <span class="keyword">const</span> <span class="keywordtype">float</span> xe, <span class="keyword">const</span> <span class="keywordtype">float</span> ye,
<a name="l00616"></a>00616                                <span class="keywordtype">bool</span>&amp; init, <span class="keywordtype">bool</span>&amp; done,
<a name="l00617"></a>00617                                <span class="keywordtype">float</span>&amp; x, <span class="keywordtype">float</span>&amp; y)
<a name="l00618"></a>00618 {
<a name="l00619"></a>00619   assert(xs &gt;= 0.0f); assert(ys &gt;= 0.0f);
<a name="l00620"></a>00620   <span class="keyword">const</span> <span class="keywordtype">float</span> pix_edge = 1.0f; <span class="comment">//We are working at scale = 1.0</span>
<a name="l00621"></a>00621   <span class="keyword">static</span> <span class="keywordtype">float</span> xi=0, yi=0;
<a name="l00622"></a>00622   <span class="keywordflow">if</span> (init)
<a name="l00623"></a>00623   {
<a name="l00624"></a>00624     xi = xs;
<a name="l00625"></a>00625     yi = ys;
<a name="l00626"></a>00626     x = (float)(xi/pix_edge);
<a name="l00627"></a>00627     y = (float)(yi/pix_edge);
<a name="l00628"></a>00628     init = <span class="keyword">false</span>;
<a name="l00629"></a>00629     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00630"></a>00630   }
<a name="l00631"></a>00631   <span class="keywordflow">if</span> (done) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00632"></a>00632   <span class="keywordtype">float</span> dx = xe-xs;
<a name="l00633"></a>00633   <span class="keywordtype">float</span> dy = ye-ys;
<a name="l00634"></a>00634   <span class="keywordtype">float</span> mag = vcl_sqrt(dx*dx + dy*dy);
<a name="l00635"></a>00635   <span class="keywordflow">if</span> (mag&lt;pix_edge)<span class="comment">//Can&#39;t reach the next pixel under any circumstances</span>
<a name="l00636"></a>00636   {                <span class="comment">//so just output the target, xe, ye.</span>
<a name="l00637"></a>00637     x = (float)xe; y = (float)ye;
<a name="l00638"></a>00638     done = <span class="keyword">true</span>;
<a name="l00639"></a>00639     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00640"></a>00640   }
<a name="l00641"></a>00641   <span class="keywordtype">float</span> delta = (0.5f*pix_edge)/mag; <span class="comment">//move in 1/2 pixel increments</span>
<a name="l00642"></a>00642   <span class="comment">//Previous pixel location</span>
<a name="l00643"></a>00643   <span class="keywordtype">int</span> xp = int(xi/pix_edge);
<a name="l00644"></a>00644   <span class="keywordtype">int</span> yp = int(yi/pix_edge);
<a name="l00645"></a>00645   <span class="comment">//Increment along the line until the motion is greater than one pixel</span>
<a name="l00646"></a>00646   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt;3; i++)
<a name="l00647"></a>00647   {
<a name="l00648"></a>00648     xi += dx*delta;
<a name="l00649"></a>00649     yi += dy*delta;
<a name="l00650"></a>00650     <span class="comment">//Check for end of segment, make sure we emit the end of the segment</span>
<a name="l00651"></a>00651     <span class="keywordflow">if</span> ((xe&gt;=xs&amp;&amp;xi&gt;xe)||(xe&lt;=xs&amp;&amp;xi&lt;xe)||(ye&gt;=ys&amp;&amp;yi&gt;ye)||(ye&lt;=ys&amp;&amp;yi&lt;ye))
<a name="l00652"></a>00652     {
<a name="l00653"></a>00653       x = (float)xe; y = (float)ye;
<a name="l00654"></a>00654       done = <span class="keyword">true</span>;
<a name="l00655"></a>00655       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00656"></a>00656     }
<a name="l00657"></a>00657     <span class="comment">//Check if we have advanced by more than .5 pixels</span>
<a name="l00658"></a>00658     x = (float)(xi/pix_edge);
<a name="l00659"></a>00659     y = (float)(yi/pix_edge);
<a name="l00660"></a>00660     <span class="keywordflow">if</span> (2*vcl_abs(<span class="keywordtype">int</span>(x)-xp)&gt;pix_edge || 2*vcl_abs(<span class="keywordtype">int</span>(y)-yp)&gt;pix_edge)
<a name="l00661"></a>00661       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00662"></a>00662   }
<a name="l00663"></a><a class="code" href="classbdgl__curve__algs.html#ad228275a150d58d3b09304f2454ed899">00663</a>   vcl_cout &lt;&lt; <span class="stringliteral">&quot;in bdgl_curve_algs::line_gen - shouldn&#39;t happen\n&quot;</span>;
<a name="l00664"></a>00664   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00665"></a>00665 }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667 <span class="comment">//:</span>
<a name="l00668"></a>00668 <span class="comment">// Given an existing edgel_chain, add new edgels from the end</span>
<a name="l00669"></a>00669 <span class="comment">// along a straight digital line to reach (x, y). The number of</span>
<a name="l00670"></a>00670 <span class="comment">// edgels added is returned</span>
<a name="l00671"></a>00671 <span class="keywordtype">int</span> <a class="code" href="classbdgl__curve__algs.html#ad228275a150d58d3b09304f2454ed899" title="Add edgels to an edgel chain along a digital straight line.">bdgl_curve_algs::add_straight_edgels</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a> <span class="keyword">const</span>&amp; ec,
<a name="l00672"></a>00672                                          <span class="keyword">const</span> <span class="keywordtype">double</span> xe, <span class="keyword">const</span> <span class="keywordtype">double</span> ye,
<a name="l00673"></a>00673                                          <span class="keywordtype">bool</span> debug)
<a name="l00674"></a>00674 {
<a name="l00675"></a>00675   assert (ec);
<a name="l00676"></a>00676   assert (ec-&gt;size() &gt; 0);
<a name="l00677"></a>00677   <span class="keywordtype">int</span> Npix = 0, last = ec-&gt;size()-1;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679   <span class="keywordtype">float</span> xs = float((*ec)[last].x()), ys = float((*ec)[last].y());
<a name="l00680"></a>00680   <span class="keywordtype">bool</span> first = <span class="keyword">true</span>, init = <span class="keyword">true</span>, done = <span class="keyword">false</span>;
<a name="l00681"></a>00681   <span class="keywordtype">float</span> x, y;
<a name="l00682"></a>00682   <span class="keywordflow">while</span> (<a class="code" href="classbdgl__curve__algs.html#a400729aa86df35be1fecb98357024683" title="Generate points along a digital straight line.">bdgl_curve_algs::line_gen</a>(xs, ys, <span class="keywordtype">float</span>(xe), <span class="keywordtype">float</span>(ye), init, done, x, y))
<a name="l00683"></a>00683     <span class="keywordflow">if</span> (!first)
<a name="l00684"></a>00684     {
<a name="l00685"></a>00685       <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> ed(x, y, <a class="code" href="classbdgl__curve__algs.html#a9b416d8315fbf929769c09ce041fb8fc">bdgl_curve_algs::synthetic</a>);
<a name="l00686"></a>00686       ec-&gt;add_edgel(ed);
<a name="l00687"></a>00687       Npix++;
<a name="l00688"></a>00688       <span class="keywordflow">if</span> (debug)
<a name="l00689"></a>00689         vcl_cout &lt;&lt; <span class="stringliteral">&quot;Adding edgel &quot;</span> &lt;&lt; ed &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00690"></a>00690     }
<a name="l00691"></a><a class="code" href="classbdgl__curve__algs.html#a910e5f030fead380cd2cb298ba420873">00691</a>     <span class="keywordflow">else</span>
<a name="l00692"></a>00692       first = <span class="keyword">false</span>;<span class="comment">//skip first point since it is already last element of ec</span>
<a name="l00693"></a>00693   <span class="keywordflow">return</span> Npix;
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696 <span class="comment">//:</span>
<a name="l00697"></a>00697 <span class="comment">// returns either 0 or N depending on which end of the chain is</span>
<a name="l00698"></a>00698 <span class="comment">// closer to the given point</span>
<a name="l00699"></a>00699 <span class="keywordtype">int</span> <a class="code" href="classbdgl__curve__algs.html#a910e5f030fead380cd2cb298ba420873" title="Finds the end of the edgel chain closest to the given point.">bdgl_curve_algs::closest_end</a>(<a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a> <span class="keyword">const</span> &amp; ec,
<a name="l00700"></a>00700                                  <span class="keyword">const</span> <span class="keywordtype">double</span> x, <span class="keyword">const</span> <span class="keywordtype">double</span> y)
<a name="l00701"></a>00701 {
<a name="l00702"></a>00702   <span class="keywordflow">if</span> (!ec)
<a name="l00703"></a>00703   {
<a name="l00704"></a>00704     vcl_cout &lt;&lt; <span class="stringliteral">&quot;In bdgl_curve_algs::closest_end - null edgel chain\n&quot;</span>;
<a name="l00705"></a>00705     <span class="keywordflow">return</span> 0;
<a name="l00706"></a>00706   }
<a name="l00707"></a>00707   <span class="keywordtype">int</span> N = ec-&gt;size();
<a name="l00708"></a>00708   <span class="keywordflow">if</span> (!N)
<a name="l00709"></a>00709   {
<a name="l00710"></a>00710     vcl_cout &lt;&lt; <span class="stringliteral">&quot;In bdgl_curve_algs::closest_end - no edgels in chain\n&quot;</span>;
<a name="l00711"></a>00711     <span class="keywordflow">return</span> 0;
<a name="l00712"></a>00712   }
<a name="l00713"></a>00713   <span class="keywordtype">double</span> x0 = (*ec)[0].x(), y0=(*ec)[0].y();
<a name="l00714"></a>00714   <span class="keywordtype">double</span> xn = (*ec)[N-1].x(), yn=(*ec)[N-1].y();
<a name="l00715"></a>00715   <span class="keywordtype">double</span> d0 = vcl_sqrt((x0-x)*(x0-x)+ (y0-y)*(y0-y));
<a name="l00716"></a>00716   <span class="keywordtype">double</span> dn = vcl_sqrt((xn-x)*(xn-x)+ (yn-y)*(yn-y));
<a name="l00717"></a><a class="code" href="classbdgl__curve__algs.html#aa5034aa36552390055c7b175df13192c">00717</a>   <span class="keywordflow">if</span> (d0&lt;dn)
<a name="l00718"></a>00718     <span class="keywordflow">return</span> 0;
<a name="l00719"></a>00719   <span class="keywordflow">return</span> N;
<a name="l00720"></a>00720 }
<a name="l00721"></a>00721 
<a name="l00722"></a>00722 
<a name="l00723"></a>00723 <span class="comment">// smooth a curve by convolving x(s),y(s) with a gaussian filter</span>
<a name="l00724"></a>00724 <span class="keywordtype">void</span> <a class="code" href="classbdgl__curve__algs.html#aa5034aa36552390055c7b175df13192c">bdgl_curve_algs::</a>
<a name="l00725"></a>00725 <a class="code" href="classbdgl__curve__algs.html#aa5034aa36552390055c7b175df13192c">smooth_curve</a>(vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt; &amp;curve,<span class="keywordtype">double</span> sigma)
<a name="l00726"></a>00726 {
<a name="l00727"></a>00727   <a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/classvnl__gaussian__kernel__1d.html">vnl_gaussian_kernel_1d</a> gauss_1d(sigma);
<a name="l00728"></a>00728   curve.insert(curve.begin(),curve[0]);
<a name="l00729"></a>00729   curve.insert(curve.begin(),curve[0]);
<a name="l00730"></a>00730   curve.insert(curve.begin(),curve[0]);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732   curve.insert(curve.end(),curve[curve.size()-1]);
<a name="l00733"></a>00733   curve.insert(curve.end(),curve[curve.size()-1]);
<a name="l00734"></a>00734   curve.insert(curve.end(),curve[curve.size()-1]);
<a name="l00735"></a>00735   <span class="keywordtype">double</span> sum=gauss_1d[0];
<a name="l00736"></a>00736   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1;i&lt;gauss_1d.<a class="codeRef" doxygen="core_vnl.tag:../../../../../core/vnl/html" href="../../../../../core/vnl/html/classvnl__gaussian__kernel__1d.html#a57f33ae1c8edc01cadbaa5b14c48a85a">width</a>();i++)
<a name="l00737"></a>00737     sum+=2*gauss_1d[i];
<a name="l00738"></a>00738 
<a name="l00739"></a>00739   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=3; i+3&lt;curve.size(); ++i)
<a name="l00740"></a>00740   {
<a name="l00741"></a>00741     <span class="keywordtype">double</span> x=curve[i-3].x()*gauss_1d[3] + curve[i-2].x()*gauss_1d[2]+
<a name="l00742"></a>00742              curve[i-1].x()*gauss_1d[1] + curve[i  ].x()*gauss_1d[0]+
<a name="l00743"></a>00743              curve[i+1].x()*gauss_1d[1] + curve[i+2].x()*gauss_1d[2]+
<a name="l00744"></a>00744              curve[i+3].x()*gauss_1d[3];
<a name="l00745"></a>00745     <span class="keywordtype">double</span> y=curve[i-3].y()*gauss_1d[3] + curve[i-2].y()*gauss_1d[2]+
<a name="l00746"></a>00746              curve[i-1].y()*gauss_1d[1] + curve[i  ].y()*gauss_1d[0]+
<a name="l00747"></a>00747              curve[i+1].y()*gauss_1d[1] + curve[i+2].y()*gauss_1d[2]+
<a name="l00748"></a><a class="code" href="classbdgl__curve__algs.html#accfc87aff9245f4936ae75f7243c8593">00748</a>              curve[i+3].y()*gauss_1d[3];
<a name="l00749"></a>00749     x/=sum;
<a name="l00750"></a>00750     y/=sum;
<a name="l00751"></a>00751     curve[i].set(x,y);
<a name="l00752"></a>00752   }
<a name="l00753"></a>00753 }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a>  <a class="code" href="classbdgl__curve__algs.html#accfc87aff9245f4936ae75f7243c8593">bdgl_curve_algs::</a>
<a name="l00756"></a>00756 <a class="code" href="classbdgl__curve__algs.html#accfc87aff9245f4936ae75f7243c8593">create_digital_curves</a>(vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../../core/vgl/html" href="../../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt; &amp; curve)
<a name="l00757"></a>00757 {
<a name="l00758"></a>00758   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_edgel_chain_sptr</a> vec;
<a name="l00759"></a>00759   vec= <span class="keyword">new</span> <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel__chain.html">vdgl_edgel_chain</a>;
<a name="l00760"></a>00760   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;curve.size(); ++j)
<a name="l00761"></a>00761   {
<a name="l00762"></a>00762     <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__edgel.html">vdgl_edgel</a> el(curve[j].x(),curve[j].y(), 0,0 );
<a name="l00763"></a>00763     vec-&gt;add_edgel(el);
<a name="l00764"></a>00764   }
<a name="l00765"></a>00765   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_interpolator_sptr</a> interp= <span class="keyword">new</span> <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__interpolator__linear.html">vdgl_interpolator_linear</a>(vec);
<a name="l00766"></a>00766   <a class="codeRef" doxygen="core_vbl.tag:../../../../../core/vbl/html" href="../../../../../core/vbl/html/classvbl__smart__ptr.html">vdgl_digital_curve_sptr</a> dc = <span class="keyword">new</span> <a class="codeRef" doxygen="contrib_gel_vdgl.tag:../../../../../contrib/gel/vdgl/html" href="../../../../../contrib/gel/vdgl/html/classvdgl__digital__curve.html">vdgl_digital_curve</a>(interp);
<a name="l00767"></a>00767   <span class="keywordflow">return</span> dc;
<a name="l00768"></a>00768 }
<a name="l00769"></a>00769 
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Thu May 2 2013 08:52:20 for contrib/brl/bbas/bdgl by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
