<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>contrib/mul/msm/tools/msm_draw_shape_modes.cxx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">contrib/mul/msm/tools/msm_draw_shape_modes.cxx</div>  </div>
</div>
<div class="contents">
<a href="msm__draw__shape__modes_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//:</span>
<a name="l00002"></a>00002 <span class="comment">// \file</span>
<a name="l00003"></a>00003 <span class="comment">// \brief Tool to write eps files showing modes of model</span>
<a name="l00004"></a>00004 <span class="comment">// \author Tim Cootes</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;mbl/mbl_read_props.h&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;mbl/mbl_exception.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;vul/vul_arg.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;vul/vul_string.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;vcl_sstream.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;vcl_fstream.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;vcl_string.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;vcl_algorithm.h&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/vsl__quick__file_8h.html">vsl/vsl_quick_file.h</a>&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;<a class="code" href="msm__shape__model_8h.html" title="Contains mean/modes etc of a shape model and aligner details.">msm/msm_shape_model.h</a>&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;<a class="code" href="msm__shape__instance_8h.html" title="Representation of an instance of a shape model.">msm/msm_shape_instance.h</a>&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;<a class="code" href="msm__curve_8h.html" title="List of points making a curve - for defining boundaries.">msm/msm_curve.h</a>&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;<a class="code" href="msm__add__all__loaders_8h.html">msm/msm_add_all_loaders.h</a>&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;<a class="code" href="msm__draw__shape__to__eps_8h.html" title="Draws current shape instance to an eps file.">msm/utils/msm_draw_shape_to_eps.h</a>&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="msm__shape__mode__view_8h.html" title="Generates shapes displaying modes of a shape model.">msm/utils/msm_shape_mode_view.h</a>&gt;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">/*</span>
<a name="l00025"></a>00025 <span class="comment">Parameter file format:</span>
<a name="l00026"></a>00026 <span class="comment">&lt;START FILE&gt;</span>
<a name="l00027"></a>00027 <span class="comment">//: File to load model from</span>
<a name="l00028"></a>00028 <span class="comment">shape_model_path: shape_model.bfs</span>
<a name="l00029"></a>00029 <span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment">curves_path: face_front.crvs</span>
<a name="l00031"></a>00031 <span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">// Maximum number of shape modes</span>
<a name="l00033"></a>00033 <span class="comment">max_modes: 99</span>
<a name="l00034"></a>00034 <span class="comment"></span>
<a name="l00035"></a>00035 <span class="comment">//: Number of SDs to vary mode by</span>
<a name="l00036"></a>00036 <span class="comment">n_sds: 3.0</span>
<a name="l00037"></a>00037 <span class="comment"></span>
<a name="l00038"></a>00038 <span class="comment">//: Current number of shapes per mode</span>
<a name="l00039"></a>00039 <span class="comment">n_per_mode: 3</span>
<a name="l00040"></a>00040 <span class="comment"></span>
<a name="l00041"></a>00041 <span class="comment">//: When true, generate 2*n_per_mode frames of a movie for each mode</span>
<a name="l00042"></a>00042 <span class="comment">make_movie: false</span>
<a name="l00043"></a>00043 <span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">//: When true, overlap all the shapes to highlight changes</span>
<a name="l00045"></a>00045 <span class="comment">//  Shapes on one side of mean are drawn with dashes, on the other with dots.</span>
<a name="l00046"></a>00046 <span class="comment">overlap_shapes: false</span>
<a name="l00047"></a>00047 <span class="comment"></span>
<a name="l00048"></a>00048 <span class="comment">//: Radius of points to display (if &lt;0, then don&#39;t draw points)</span>
<a name="l00049"></a>00049 <span class="comment">point_radius: 2</span>
<a name="l00050"></a>00050 <span class="comment"></span>
<a name="l00051"></a>00051 <span class="comment">//: Line width</span>
<a name="l00052"></a>00052 <span class="comment">line-width: 1</span>
<a name="l00053"></a>00053 <span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment">line_colour: black</span>
<a name="l00055"></a>00055 <span class="comment">point_colour: red</span>
<a name="l00056"></a>00056 <span class="comment"></span>
<a name="l00057"></a>00057 <span class="comment">// Approximate width of region to display shape</span>
<a name="l00058"></a>00058 <span class="comment">width: 100</span>
<a name="l00059"></a>00059 <span class="comment"></span>
<a name="l00060"></a>00060 <span class="comment">// Optional paths to text files containing a matrix and vector</span>
<a name="l00061"></a>00061 <span class="comment">// defining a linear subspace of the parameter space.</span>
<a name="l00062"></a>00062 <span class="comment">// When supplied, the tool will generate the shapes by</span>
<a name="l00063"></a>00063 <span class="comment">// moving along the modes defined in the subspace.</span>
<a name="l00064"></a>00064 <span class="comment">// A subspace model of the form x=mean+(PQ)b is created,</span>
<a name="l00065"></a>00065 <span class="comment">// where P is the matrix of original modes, Q is the loaded matrix</span>
<a name="l00066"></a>00066 <span class="comment">// defining the subspace.  so each column defines a subspace mode.</span>
<a name="l00067"></a>00067 <span class="comment">// subspace_mode_path: subspace_mode_matrix.txt</span>
<a name="l00068"></a>00068 <span class="comment">// subspace_var_path: subspace_var_vector.txt</span>
<a name="l00069"></a>00069 <span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">base_name: mode</span>
<a name="l00071"></a>00071 <span class="comment">output_dir: ./</span>
<a name="l00072"></a>00072 <span class="comment"></span>
<a name="l00073"></a>00073 <span class="comment">&lt;END FILE&gt;</span>
<a name="l00074"></a>00074 <span class="comment">*/</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="keywordtype">void</span> <a class="code" href="msm__apply__tps__warp_8cxx.html#ae5ad5cbeccaedc03a48d3c7eaa803e79">print_usage</a>()
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078   vcl_cout &lt;&lt; <span class="stringliteral">&quot;msm_draw_shape_modes -p param_file\n&quot;</span>
<a name="l00079"></a>00079            &lt;&lt; <span class="stringliteral">&quot;Tool to write eps files showing modes of model.\n&quot;</span>
<a name="l00080"></a><a class="code" href="msm__draw__shape__modes_8cxx.html#aded754c96a3daa770d7d4fc89f044c56">00080</a>            &lt;&lt; vcl_endl;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <a class="code" href="msm__build__shape__model_8cxx.html#a66dedc08d79c489c010e39c0e3199471">vul_arg_display_usage_and_exit</a>();
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">//: Structure to hold parameters</span>
<a name="l00086"></a>00086 <span class="keyword">struct </span><a class="code" href="structtool__params.html" title="Structure to hold parameters.">tool_params</a>
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088   <span class="comment">//: Path to shape model</span>
<a name="l00089"></a>00089   vcl_string <a class="code" href="structtool__params.html#a65b4cede47ef846a730d42ab8b8fa72d" title="File to save shape model to.">shape_model_path</a>;
<a name="l00090"></a><a class="code" href="structtool__params.html#a0f7ecab6b4d6e58ac795efff6612cd5c">00090</a>   vcl_string <a class="code" href="structtool__params.html#a0f7ecab6b4d6e58ac795efff6612cd5c">curves_path</a>;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092   <span class="comment">//: Maximum number of shape modes</span>
<a name="l00093"></a>00093   <span class="keywordtype">unsigned</span> <a class="code" href="structtool__params.html#afd887d9d7c80eca669e92056b5da6600" title="Maximum number of shape modes.">max_modes</a>;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   <span class="comment">//: Number of SDs to vary mode by</span>
<a name="l00096"></a><a class="code" href="structtool__params.html#a1e1e432b53b3a01ba21f6f9ebd8d3b80">00096</a>   <span class="keywordtype">double</span> <a class="code" href="structtool__params.html#a1e1e432b53b3a01ba21f6f9ebd8d3b80" title="Number of SDs to vary mode by.">n_sds</a>;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098   <span class="comment">//: Current number of shapes per mode</span>
<a name="l00099"></a><a class="code" href="structtool__params.html#a516e2e02ea240f037b32f483c39f34ab">00099</a>   <span class="keywordtype">unsigned</span> <a class="code" href="structtool__params.html#a516e2e02ea240f037b32f483c39f34ab" title="Current number of shapes per mode.">n_per_mode</a>;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="comment">//: When true, generate 2*n_per_mode frames of a movie for each mode</span>
<a name="l00102"></a><a class="code" href="structtool__params.html#a4257f54765a69afa0ef1dc690442b06f">00102</a>   <span class="keywordtype">bool</span> <a class="code" href="structtool__params.html#a4257f54765a69afa0ef1dc690442b06f" title="When true, generate 2*n_per_mode frames of a movie for each mode.">make_movie</a>;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104   <span class="comment">//: When true, overlap all the shapes to highlight changes</span>
<a name="l00105"></a><a class="code" href="structtool__params.html#a7d19dd1f29a8a4129b8f7468a476dba9">00105</a>   <span class="keywordtype">bool</span> <a class="code" href="structtool__params.html#a7d19dd1f29a8a4129b8f7468a476dba9" title="When true, overlap all the shapes to highlight changes.">overlap_shapes</a>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="comment">//: Approximate width of region to display shape</span>
<a name="l00108"></a><a class="code" href="structtool__params.html#afc5aa4d424d964423a5d5eac6aaf6a4c">00108</a>   <span class="keywordtype">double</span> <a class="code" href="structtool__params.html#afc5aa4d424d964423a5d5eac6aaf6a4c" title="Approximate width of region to display shape.">width</a>;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   <span class="comment">//: Optional path to text file containing a mode matrix</span>
<a name="l00111"></a><a class="code" href="structtool__params.html#a2d3825a38d502e44bcff219afdbda882">00111</a>   vcl_string <a class="code" href="structtool__params.html#a2d3825a38d502e44bcff219afdbda882" title="Optional path to text file containing a mode matrix.">subspace_mode_path</a>;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   <span class="comment">//: Optional path to text files containing a variance vector</span>
<a name="l00114"></a><a class="code" href="structtool__params.html#a76a13f2038549ec293a392b1b84350ee">00114</a>   vcl_string <a class="code" href="structtool__params.html#a76a13f2038549ec293a392b1b84350ee" title="Optional path to text files containing a variance vector.">subspace_var_path</a>;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   <span class="comment">//: Base name for output</span>
<a name="l00117"></a><a class="code" href="structtool__params.html#ac9171de90dfdfacb36f323a66b8c7c25">00117</a>   vcl_string <a class="code" href="structtool__params.html#ac9171de90dfdfacb36f323a66b8c7c25" title="Base name for output.">base_name</a>;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119   <span class="comment">//: Directory to save eps files</span>
<a name="l00120"></a><a class="code" href="structtool__params.html#adc388fd3bf0b404b762144ec00587260">00120</a>   vcl_string <a class="code" href="structtool__params.html#adc388fd3bf0b404b762144ec00587260" title="Directory to save eps files.">output_dir</a>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122   <span class="comment">//: Line colour</span>
<a name="l00123"></a><a class="code" href="structtool__params.html#a1260710360b16c22ae2acf63e66db8ff">00123</a>   vcl_string <a class="code" href="structtool__params.html#a1260710360b16c22ae2acf63e66db8ff" title="Line colour.">line_colour</a>;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="comment">//: Point colour</span>
<a name="l00126"></a><a class="code" href="structtool__params.html#aaf6eb71a59e9b795e11b999ad654415b">00126</a>   vcl_string <a class="code" href="structtool__params.html#aaf6eb71a59e9b795e11b999ad654415b" title="Point colour.">point_colour</a>;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   <span class="comment">//: Radius of points to display (if &lt;0, then don&#39;t draw points)</span>
<a name="l00129"></a><a class="code" href="structtool__params.html#aa48c244195886f755afb268080bbe7ff">00129</a>   <span class="keywordtype">double</span> <a class="code" href="structtool__params.html#aa48c244195886f755afb268080bbe7ff" title="Radius of points to display (if &lt;0, then don&#39;t draw points).">point_radius</a>;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131   <span class="comment">//: Line width</span>
<a name="l00132"></a><a class="code" href="structtool__params.html#a43346bf97686a9302cfd8202f8e2c0e9">00132</a>   <span class="keywordtype">double</span> <a class="code" href="structtool__params.html#a43346bf97686a9302cfd8202f8e2c0e9" title="Line width.">line_width</a>;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   <span class="comment">//: Parse named text file to read in data</span>
<a name="l00135"></a>00135   <span class="comment">//  Throws a mbl_exception_parse_error if fails</span>
<a name="l00136"></a>00136   <span class="keywordtype">void</span> <a class="code" href="structtool__params.html#a34405952d50e4b53ea345989d3e28055" title="Parse named text file to read in data.">read_from_file</a>(<span class="keyword">const</span> vcl_string&amp; path);
<a name="l00137"></a>00137 };
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="comment">//: Parse named text file to read in data</span>
<a name="l00140"></a>00140 <span class="comment">//  Throws a mbl_exception_parse_error if fails</span>
<a name="l00141"></a>00141 <span class="keywordtype">void</span> <a class="code" href="structtool__params.html#a34405952d50e4b53ea345989d3e28055" title="Parse named text file to read in data.">tool_params::read_from_file</a>(<span class="keyword">const</span> vcl_string&amp; path)
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143   vcl_ifstream ifs(path.c_str());
<a name="l00144"></a>00144   <span class="keywordflow">if</span> (!ifs)
<a name="l00145"></a>00145   {
<a name="l00146"></a>00146     vcl_string error_msg = <span class="stringliteral">&quot;Failed to open file: &quot;</span>+path;
<a name="l00147"></a>00147     <span class="keywordflow">throw</span> (mbl_exception_parse_error(error_msg));
<a name="l00148"></a>00148   }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150   mbl_read_props_type props = mbl_read_props_ws(ifs);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   <a class="code" href="structtool__params.html#a0f7ecab6b4d6e58ac795efff6612cd5c">curves_path</a>=props[<span class="stringliteral">&quot;curves_path&quot;</span>];
<a name="l00153"></a>00153   <a class="code" href="structtool__params.html#a516e2e02ea240f037b32f483c39f34ab" title="Current number of shapes per mode.">n_per_mode</a>=vul_string_atoi(props.get_optional_property(<span class="stringliteral">&quot;n_per_mode&quot;</span>,<span class="stringliteral">&quot;3&quot;</span>));
<a name="l00154"></a>00154   <a class="code" href="structtool__params.html#afd887d9d7c80eca669e92056b5da6600" title="Maximum number of shape modes.">max_modes</a>=vul_string_atoi(props.get_optional_property(<span class="stringliteral">&quot;max_modes&quot;</span>,<span class="stringliteral">&quot;5&quot;</span>));
<a name="l00155"></a>00155   <a class="code" href="structtool__params.html#a7d19dd1f29a8a4129b8f7468a476dba9" title="When true, overlap all the shapes to highlight changes.">overlap_shapes</a>=vul_string_to_bool(props.get_optional_property(<span class="stringliteral">&quot;overlap_shapes&quot;</span>,<span class="stringliteral">&quot;false&quot;</span>));
<a name="l00156"></a>00156   <a class="code" href="structtool__params.html#a4257f54765a69afa0ef1dc690442b06f" title="When true, generate 2*n_per_mode frames of a movie for each mode.">make_movie</a>=vul_string_to_bool(props.get_optional_property(<span class="stringliteral">&quot;make_movie&quot;</span>,<span class="stringliteral">&quot;false&quot;</span>));
<a name="l00157"></a>00157   <a class="code" href="structtool__params.html#a1e1e432b53b3a01ba21f6f9ebd8d3b80" title="Number of SDs to vary mode by.">n_sds</a>=vul_string_atof(props.get_optional_property(<span class="stringliteral">&quot;n_sds&quot;</span>,<span class="stringliteral">&quot;3.0&quot;</span>));
<a name="l00158"></a>00158   <a class="code" href="structtool__params.html#aa48c244195886f755afb268080bbe7ff" title="Radius of points to display (if &lt;0, then don&#39;t draw points).">point_radius</a>=vul_string_atof(props.get_optional_property(<span class="stringliteral">&quot;point_radius&quot;</span>,<span class="stringliteral">&quot;1.5&quot;</span>));
<a name="l00159"></a>00159   <a class="code" href="structtool__params.html#a43346bf97686a9302cfd8202f8e2c0e9" title="Line width.">line_width</a>=vul_string_atof(props.get_optional_property(<span class="stringliteral">&quot;line_width&quot;</span>,<span class="stringliteral">&quot;1&quot;</span>));
<a name="l00160"></a>00160   <a class="code" href="structtool__params.html#afc5aa4d424d964423a5d5eac6aaf6a4c" title="Approximate width of region to display shape.">width</a>=vul_string_atof(props.get_optional_property(<span class="stringliteral">&quot;width&quot;</span>,<span class="stringliteral">&quot;100&quot;</span>));
<a name="l00161"></a>00161   <a class="code" href="structtool__params.html#a1260710360b16c22ae2acf63e66db8ff" title="Line colour.">line_colour</a>=props.get_optional_property(<span class="stringliteral">&quot;line_colour&quot;</span>,<span class="stringliteral">&quot;black&quot;</span>);
<a name="l00162"></a>00162   <a class="code" href="structtool__params.html#aaf6eb71a59e9b795e11b999ad654415b" title="Point colour.">point_colour</a>=props.get_optional_property(<span class="stringliteral">&quot;point_colour&quot;</span>,<span class="stringliteral">&quot;red&quot;</span>);
<a name="l00163"></a>00163   <a class="code" href="structtool__params.html#ac9171de90dfdfacb36f323a66b8c7c25" title="Base name for output.">base_name</a>=props.get_optional_property(<span class="stringliteral">&quot;base_name&quot;</span>,<span class="stringliteral">&quot;./&quot;</span>);
<a name="l00164"></a>00164   <a class="code" href="structtool__params.html#adc388fd3bf0b404b762144ec00587260" title="Directory to save eps files.">output_dir</a>=props.get_optional_property(<span class="stringliteral">&quot;output_dir&quot;</span>,<span class="stringliteral">&quot;./&quot;</span>);
<a name="l00165"></a>00165   <a class="code" href="structtool__params.html#a65b4cede47ef846a730d42ab8b8fa72d" title="File to save shape model to.">shape_model_path</a>=props.get_optional_property(<span class="stringliteral">&quot;shape_model_path&quot;</span>,
<a name="l00166"></a>00166                                                <span class="stringliteral">&quot;shape_aam.bfs&quot;</span>);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <span class="keywordflow">if</span> (make_movie) overlap_shapes=<span class="keyword">true</span>;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   <a class="code" href="structtool__params.html#a2d3825a38d502e44bcff219afdbda882" title="Optional path to text file containing a mode matrix.">subspace_mode_path</a> = props[<span class="stringliteral">&quot;subspace_mode_path&quot;</span>];
<a name="l00171"></a>00171   <span class="keywordflow">if</span> (<a class="code" href="structtool__params.html#a2d3825a38d502e44bcff219afdbda882" title="Optional path to text file containing a mode matrix.">subspace_mode_path</a>==<span class="stringliteral">&quot;-&quot;</span>) <a class="code" href="structtool__params.html#a2d3825a38d502e44bcff219afdbda882" title="Optional path to text file containing a mode matrix.">subspace_mode_path</a>=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <a class="code" href="structtool__params.html#a76a13f2038549ec293a392b1b84350ee" title="Optional path to text files containing a variance vector.">subspace_var_path</a> = props[<span class="stringliteral">&quot;subspace_var_path&quot;</span>];
<a name="l00174"></a>00174   <span class="keywordflow">if</span> (<a class="code" href="structtool__params.html#a76a13f2038549ec293a392b1b84350ee" title="Optional path to text files containing a variance vector.">subspace_var_path</a>==<span class="stringliteral">&quot;-&quot;</span>) <a class="code" href="structtool__params.html#a76a13f2038549ec293a392b1b84350ee" title="Optional path to text files containing a variance vector.">subspace_var_path</a>=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176   <span class="comment">// Don&#39;t look for unused props so can use a single common parameter file.</span>
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="msm__draw__shape__modes_8cxx.html#aa2dd660b853d2d81656c5440dfb38fee">00180</a> <span class="keywordtype">void</span> <a class="code" href="msm__draw__shape__modes_8cxx.html#aa2dd660b853d2d81656c5440dfb38fee">draw_mode</a>(<a class="code" href="classmsm__shape__mode__view.html" title="Generates shapes displaying modes of a shape model.">msm_shape_mode_view</a>&amp; mode_view,
<a name="l00181"></a>00181                <span class="keyword">const</span> <a class="code" href="classmsm__curves.html" title="Container for a set of curves.">msm_curves</a>&amp; curves,
<a name="l00182"></a>00182                <a class="code" href="structtool__params.html" title="Structure to hold parameters.">tool_params</a>&amp; params)
<a name="l00183"></a>00183 {
<a name="l00184"></a>00184   mode_view.<a class="code" href="classmsm__shape__mode__view.html#aad84337746c73c5bd1de0bf3d3195355" title="Compute the shapes so they fit into current window.">compute_shapes</a>();
<a name="l00185"></a>00185   <span class="keywordtype">unsigned</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__vector_8h.html#a00626facb4f86efb8618a4c5f5c3c5f8">m</a> = mode_view.<a class="code" href="classmsm__shape__mode__view.html#afe9f821979567d384ea608c7c3769f29" title="Current mode.">mode</a>();
<a name="l00186"></a>00186   <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html">vgl_box_2d&lt;int&gt;</a> win_box = mode_view.<a class="code" href="classmsm__shape__mode__view.html#aaba4d6e22e5f5c29158a81a89a0c6ca5" title="Current display window.">display_window</a>();
<a name="l00187"></a>00187 
<a name="l00188"></a>00188   vcl_stringstream ss;
<a name="l00189"></a>00189   ss&lt;&lt;params.<a class="code" href="structtool__params.html#adc388fd3bf0b404b762144ec00587260" title="Directory to save eps files.">output_dir</a>&lt;&lt;<span class="charliteral">&#39;/&#39;</span>&lt;&lt;params.<a class="code" href="structtool__params.html#ac9171de90dfdfacb36f323a66b8c7c25" title="Base name for output.">base_name</a>&lt;&lt;<span class="stringliteral">&quot;_s&quot;</span>&lt;&lt;m&lt;&lt;<span class="stringliteral">&quot;.eps&quot;</span>;
<a name="l00190"></a>00190   mbl_eps_writer writer(ss.str().c_str(),
<a name="l00191"></a>00191                         win_box.<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html#af292836a69e4e09c91a7f3d66e51b536">width</a>(),win_box.<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html#a0d46b87ed63e134c5fa9a6c1a97b039d">height</a>());
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <span class="keywordtype">unsigned</span> n_shapes = mode_view.<a class="code" href="classmsm__shape__mode__view.html#a2f6c371379e0cedf4f81d25cbeb86dab" title="Current array of sets of points.">points</a>().size();
<a name="l00194"></a>00194   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;n_shapes;++i)
<a name="l00195"></a>00195   {
<a name="l00196"></a>00196     writer.set_colour(params.<a class="code" href="structtool__params.html#aaf6eb71a59e9b795e11b999ad654415b" title="Point colour.">point_colour</a>);
<a name="l00197"></a>00197     <span class="keywordflow">if</span> (params.<a class="code" href="structtool__params.html#aa48c244195886f755afb268080bbe7ff" title="Radius of points to display (if &lt;0, then don&#39;t draw points).">point_radius</a>&gt;0)
<a name="l00198"></a>00198       <a class="code" href="msm__draw__shape__to__eps_8cxx.html#a552301182402b1863bba859865ffaf0c" title="Draws points to an eps file with given radius.">msm_draw_points_to_eps</a>(writer,mode_view.<a class="code" href="classmsm__shape__mode__view.html#a2f6c371379e0cedf4f81d25cbeb86dab" title="Current array of sets of points.">points</a>()[i],
<a name="l00199"></a>00199                              params.<a class="code" href="structtool__params.html#aa48c244195886f755afb268080bbe7ff" title="Radius of points to display (if &lt;0, then don&#39;t draw points).">point_radius</a>);
<a name="l00200"></a>00200     writer.set_colour(params.<a class="code" href="structtool__params.html#a1260710360b16c22ae2acf63e66db8ff" title="Line colour.">line_colour</a>);
<a name="l00201"></a>00201     writer.set_line_width(params.<a class="code" href="structtool__params.html#a43346bf97686a9302cfd8202f8e2c0e9" title="Line width.">line_width</a>);
<a name="l00202"></a>00202     <span class="keywordflow">if</span> (params.<a class="code" href="structtool__params.html#a7d19dd1f29a8a4129b8f7468a476dba9" title="When true, overlap all the shapes to highlight changes.">overlap_shapes</a>)
<a name="l00203"></a>00203     {
<a name="l00204"></a>00204       <span class="comment">// Use dashes for one side of mean, dots for the other</span>
<a name="l00205"></a>00205       <span class="keywordflow">if</span> (i&lt;n_shapes/2) writer.ofs()&lt;&lt;<span class="stringliteral">&quot;[3 2] 0 setdash&quot;</span>&lt;&lt;vcl_endl;  <span class="comment">// Dashes</span>
<a name="l00206"></a>00206       <span class="keywordflow">else</span>
<a name="l00207"></a>00207       <span class="keywordflow">if</span> (i==n_shapes/2) writer.ofs()&lt;&lt;<span class="stringliteral">&quot;[1 0] 0 setdash&quot;</span>&lt;&lt;vcl_endl;  <span class="comment">// Solid</span>
<a name="l00208"></a>00208       <span class="keywordflow">else</span>
<a name="l00209"></a>00209         writer.ofs()&lt;&lt;<span class="stringliteral">&quot;[1 2] 0 setdash&quot;</span>&lt;&lt;vcl_endl;  <span class="comment">// Dots</span>
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211     <a class="code" href="msm__draw__shape__to__eps_8cxx.html#ae469ae39cb5be9bd9730d7c40929e025" title="Draws current shape instance to an eps file.">msm_draw_shape_to_eps</a>(writer,mode_view.<a class="code" href="classmsm__shape__mode__view.html#a2f6c371379e0cedf4f81d25cbeb86dab" title="Current array of sets of points.">points</a>()[i],curves);
<a name="l00212"></a>00212   }
<a name="l00213"></a>00213   writer.close();
<a name="l00214"></a>00214   vcl_cout&lt;&lt;<span class="stringliteral">&quot;Saved to &quot;</span>&lt;&lt;ss.str()&lt;&lt;vcl_endl;
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 <span class="comment">//: Write a set of eps files defining a movie of the mode.</span>
<a name="l00218"></a><a class="code" href="msm__draw__shape__modes_8cxx.html#ad74217f1f9529647a3a4891a6f306835">00218</a> <span class="keywordtype">void</span> <a class="code" href="msm__draw__shape__modes_8cxx.html#ad74217f1f9529647a3a4891a6f306835" title="Write a set of eps files defining a movie of the mode.">draw_mode_frames</a>(<a class="code" href="classmsm__shape__mode__view.html" title="Generates shapes displaying modes of a shape model.">msm_shape_mode_view</a>&amp; mode_view,
<a name="l00219"></a>00219                       <span class="keyword">const</span> <a class="code" href="classmsm__curves.html" title="Container for a set of curves.">msm_curves</a>&amp; curves,
<a name="l00220"></a>00220                       <a class="code" href="structtool__params.html" title="Structure to hold parameters.">tool_params</a>&amp; params)
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222   mode_view.<a class="code" href="classmsm__shape__mode__view.html#aad84337746c73c5bd1de0bf3d3195355" title="Compute the shapes so they fit into current window.">compute_shapes</a>();
<a name="l00223"></a>00223   <span class="keywordtype">unsigned</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__vector_8h.html#a00626facb4f86efb8618a4c5f5c3c5f8">m</a> = mode_view.<a class="code" href="classmsm__shape__mode__view.html#afe9f821979567d384ea608c7c3769f29" title="Current mode.">mode</a>();
<a name="l00224"></a>00224   <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html">vgl_box_2d&lt;int&gt;</a> win_box = mode_view.<a class="code" href="classmsm__shape__mode__view.html#aaba4d6e22e5f5c29158a81a89a0c6ca5" title="Current display window.">display_window</a>();
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <span class="keywordtype">unsigned</span> n_shapes = mode_view.<a class="code" href="classmsm__shape__mode__view.html#a2f6c371379e0cedf4f81d25cbeb86dab" title="Current array of sets of points.">points</a>().size();
<a name="l00227"></a>00227   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;2*n_shapes-2;++i)
<a name="l00228"></a>00228   {
<a name="l00229"></a>00229     <span class="comment">// f goes from 0 - (n_shapes-1), then back down to 1</span>
<a name="l00230"></a>00230     <span class="keywordtype">unsigned</span> f=i;
<a name="l00231"></a>00231     <span class="keywordflow">if</span> (i&gt;=n_shapes) f=2*n_shapes-2-i;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     vcl_stringstream ss;
<a name="l00234"></a>00234     ss&lt;&lt;params.<a class="code" href="structtool__params.html#adc388fd3bf0b404b762144ec00587260" title="Directory to save eps files.">output_dir</a>&lt;&lt;<span class="charliteral">&#39;/&#39;</span>&lt;&lt;params.<a class="code" href="structtool__params.html#ac9171de90dfdfacb36f323a66b8c7c25" title="Base name for output.">base_name</a>&lt;&lt;<span class="stringliteral">&quot;_s&quot;</span>&lt;&lt;m&lt;&lt;<span class="charliteral">&#39;_&#39;</span>;
<a name="l00235"></a>00235     <span class="keywordflow">if</span> (i&lt;10) ss&lt;&lt;<span class="charliteral">&#39;0&#39;</span>;
<a name="l00236"></a>00236     ss&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot;.eps&quot;</span>;
<a name="l00237"></a>00237     mbl_eps_writer writer(ss.str().c_str(),
<a name="l00238"></a>00238                           win_box.<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html#af292836a69e4e09c91a7f3d66e51b536">width</a>(),win_box.<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html#a0d46b87ed63e134c5fa9a6c1a97b039d">height</a>());
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     writer.set_colour(params.<a class="code" href="structtool__params.html#aaf6eb71a59e9b795e11b999ad654415b" title="Point colour.">point_colour</a>);
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (params.<a class="code" href="structtool__params.html#aa48c244195886f755afb268080bbe7ff" title="Radius of points to display (if &lt;0, then don&#39;t draw points).">point_radius</a>&gt;0)
<a name="l00242"></a>00242       <a class="code" href="msm__draw__shape__to__eps_8cxx.html#a552301182402b1863bba859865ffaf0c" title="Draws points to an eps file with given radius.">msm_draw_points_to_eps</a>(writer,mode_view.<a class="code" href="classmsm__shape__mode__view.html#a2f6c371379e0cedf4f81d25cbeb86dab" title="Current array of sets of points.">points</a>()[f],
<a name="l00243"></a>00243                              params.<a class="code" href="structtool__params.html#aa48c244195886f755afb268080bbe7ff" title="Radius of points to display (if &lt;0, then don&#39;t draw points).">point_radius</a>);
<a name="l00244"></a>00244     writer.set_colour(params.<a class="code" href="structtool__params.html#a1260710360b16c22ae2acf63e66db8ff" title="Line colour.">line_colour</a>);
<a name="l00245"></a>00245     writer.set_line_width(params.<a class="code" href="structtool__params.html#a43346bf97686a9302cfd8202f8e2c0e9" title="Line width.">line_width</a>);
<a name="l00246"></a>00246     <a class="code" href="msm__draw__shape__to__eps_8cxx.html#ae469ae39cb5be9bd9730d7c40929e025" title="Draws current shape instance to an eps file.">msm_draw_shape_to_eps</a>(writer,mode_view.<a class="code" href="classmsm__shape__mode__view.html#a2f6c371379e0cedf4f81d25cbeb86dab" title="Current array of sets of points.">points</a>()[f],curves);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     writer.close();
<a name="l00249"></a>00249   }
<a name="l00250"></a>00250   vcl_cout&lt;&lt;<span class="stringliteral">&quot;Saved &quot;</span>&lt;&lt;2*n_shapes-2&lt;&lt;<span class="stringliteral">&quot; frames to &quot;</span>
<a name="l00251"></a>00251           &lt;&lt;params.<a class="code" href="structtool__params.html#ac9171de90dfdfacb36f323a66b8c7c25" title="Base name for output.">base_name</a>&lt;&lt;<span class="stringliteral">&quot;_s&quot;</span>&lt;&lt;m&lt;&lt;<span class="stringliteral">&quot;_XX.eps&quot;</span>&lt;&lt;vcl_endl;
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 <span class="comment">//: Create new model where modes are a subspace of the original model</span>
<a name="l00255"></a>00255 <span class="comment">//  Loads in a matrix Q defining modes, and vector V defining variance</span>
<a name="l00256"></a>00256 <span class="comment">//  Modes of new model are given by (PQ) where P are the modes of the</span>
<a name="l00257"></a>00257 <span class="comment">//  original.</span>
<a name="l00258"></a><a class="code" href="msm__draw__shape__modes_8cxx.html#a8bf1f7a2969ea2b838ced702141495ac">00258</a> <a class="code" href="classmsm__shape__model.html" title="Contains mean/modes etc of a shape model.">msm_shape_model</a> <a class="code" href="msm__draw__shape__modes_8cxx.html#a8bf1f7a2969ea2b838ced702141495ac" title="Create new model where modes are a subspace of the original model.">create_subspace_model</a>(
<a name="l00259"></a>00259             <span class="keyword">const</span> <a class="code" href="classmsm__shape__model.html" title="Contains mean/modes etc of a shape model.">msm_shape_model</a>&amp; shape_model,
<a name="l00260"></a>00260             <span class="keyword">const</span> vcl_string&amp; mode_path,
<a name="l00261"></a>00261             <span class="keyword">const</span> vcl_string&amp; var_path)
<a name="l00262"></a>00262 {
<a name="l00263"></a>00263   <span class="comment">// Attempt to load in modes</span>
<a name="l00264"></a>00264   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> Q;
<a name="l00265"></a>00265   vcl_ifstream Qs(mode_path.c_str());
<a name="l00266"></a>00266   <span class="keywordflow">if</span> (!Qs)
<a name="l00267"></a>00267   {
<a name="l00268"></a>00268     vcl_cout&lt;&lt;<span class="stringliteral">&quot;Failed to open &quot;</span>&lt;&lt;mode_path&lt;&lt;vcl_endl;
<a name="l00269"></a>00269     vcl_abort();
<a name="l00270"></a>00270   }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   <span class="keywordflow">if</span> (!Q.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#ab0676a387828802724660ca6361ae575">read_ascii</a>(Qs))
<a name="l00273"></a>00273   {
<a name="l00274"></a>00274     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;Failed to read matrix from &quot;</span>&lt;&lt;mode_path&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00275"></a>00275     vcl_abort();
<a name="l00276"></a>00276   }
<a name="l00277"></a>00277   Qs.close();
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> new_var;
<a name="l00280"></a>00280   vcl_ifstream Vs(var_path.c_str());
<a name="l00281"></a>00281   <span class="keywordflow">if</span> (!Vs)
<a name="l00282"></a>00282   {
<a name="l00283"></a>00283     vcl_cout&lt;&lt;<span class="stringliteral">&quot;Failed to open &quot;</span>&lt;&lt;var_path&lt;&lt;vcl_endl;
<a name="l00284"></a>00284     vcl_abort();
<a name="l00285"></a>00285   }
<a name="l00286"></a>00286   <span class="keywordflow">if</span> (!new_var.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#a53bdaf519569889910d4b9cd013ab18a">read_ascii</a>(Vs))
<a name="l00287"></a>00287   {
<a name="l00288"></a>00288     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;Failed to read vector from &quot;</span>&lt;&lt;var_path&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00289"></a>00289     vcl_abort();
<a name="l00290"></a>00290   }
<a name="l00291"></a>00291   Vs.close();
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 vcl_cout&lt;&lt;<span class="stringliteral">&quot;new_var: &quot;</span>&lt;&lt;new_var&lt;&lt;vcl_endl;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   vcl_cerr&lt;&lt;<span class="stringliteral">&quot;Number of subspace modes = &quot;</span>&lt;&lt;Q.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4a7d869d8750ba5056f6c6551575fa23">columns</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297   <span class="keywordflow">if</span> (Q.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4a7d869d8750ba5056f6c6551575fa23">columns</a>()!=new_var.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#a11191c91a1dbb4e1d8423dad8b110712">size</a>())
<a name="l00298"></a>00298   {
<a name="l00299"></a>00299     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;Number of variances = &quot;</span>&lt;&lt;new_var.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#a11191c91a1dbb4e1d8423dad8b110712">size</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00300"></a>00300             &lt;&lt;<span class="stringliteral">&quot;Numbers differ.&quot;</span>&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00301"></a>00301     vcl_abort();
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304   <span class="keywordflow">if</span> (Q.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()&gt;shape_model.<a class="code" href="classmsm__ref__shape__model.html#ac1228b8038ef14fb97f45b18f6e60561" title="Number of modes.">n_modes</a>())
<a name="l00305"></a>00305   {
<a name="l00306"></a>00306     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;More rows in matrix than number of modes available.&quot;</span>&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00307"></a>00307     vcl_abort();
<a name="l00308"></a>00308   }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; allP = shape_model.<a class="code" href="classmsm__ref__shape__model.html#af65763345b3253e3393646bf04ce97e0" title="Modes of variation.">modes</a>();
<a name="l00311"></a>00311   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> subP = allP.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a6978f66bc36f8936ccbab4716aa40a48">extract</a>(allP.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>(),Q.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>());
<a name="l00312"></a>00312 
<a name="l00313"></a>00313   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> newP = subP * Q;
<a name="l00314"></a>00314 
<a name="l00315"></a>00315   <a class="code" href="classmsm__shape__model.html" title="Contains mean/modes etc of a shape model.">msm_shape_model</a> new_model;
<a name="l00316"></a>00316   new_model.<a class="code" href="classmsm__shape__model.html#a227d6ddc2fe13600a246f6368f40bcb9" title="Set up model.">set</a>(shape_model.<a class="code" href="classmsm__ref__shape__model.html#a7c74d83be12ce1660fa015e7adb44a57" title="Mean of shape model as points.">mean_points</a>(),newP,new_var,
<a name="l00317"></a>00317                 shape_model.<a class="code" href="classmsm__shape__model.html#af18a0bd53e6aa0935fef21a12b96094c" title="Pose to use as a default (for convenience).">default_pose</a>(),
<a name="l00318"></a>00318                 shape_model.<a class="code" href="classmsm__shape__model.html#a04eb0b95d72544c634f78dc6234a7ea2" title="Object used to deal with global transformations.">aligner</a>(),
<a name="l00319"></a>00319                 shape_model.<a class="code" href="classmsm__ref__shape__model.html#a46332dcf98a3259be68514a4f2668016" title="Current object which limits parameters.">param_limiter</a>());
<a name="l00320"></a>00320 
<a name="l00321"></a>00321   <span class="keywordflow">return</span> new_model;
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a><a class="code" href="msm__draw__shape__modes_8cxx.html#a3c04138a5bfe5d72780bb7e82a18e627">00324</a> <span class="keywordtype">int</span> <a class="code" href="msm__apply__tps__warp_8cxx.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326   vul_arg&lt;vcl_string&gt; param_path(<span class="stringliteral">&quot;-p&quot;</span>,<span class="stringliteral">&quot;Parameter filename&quot;</span>);
<a name="l00327"></a>00327   vul_arg_parse(argc,argv);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   <a class="code" href="msm__add__all__loaders_8cxx.html#abf377f7bdb689d211effb9653fd30555" title="Add all binary loaders and factory objects for msm library.">msm_add_all_loaders</a>();
<a name="l00330"></a>00330 
<a name="l00331"></a>00331   <span class="keywordflow">if</span> (param_path()==<span class="stringliteral">&quot;&quot;</span>)
<a name="l00332"></a>00332   {
<a name="l00333"></a>00333     <a class="code" href="msm__apply__tps__warp_8cxx.html#ae5ad5cbeccaedc03a48d3c7eaa803e79">print_usage</a>();
<a name="l00334"></a>00334     <span class="keywordflow">return</span> 0;
<a name="l00335"></a>00335   }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   <a class="code" href="structtool__params.html" title="Structure to hold parameters.">tool_params</a> params;
<a name="l00338"></a>00338   <span class="keywordflow">try</span>
<a name="l00339"></a>00339   {
<a name="l00340"></a>00340     params.<a class="code" href="structtool__params.html#a34405952d50e4b53ea345989d3e28055" title="Parse named text file to read in data.">read_from_file</a>(param_path());
<a name="l00341"></a>00341   }
<a name="l00342"></a>00342   <span class="keywordflow">catch</span> (mbl_exception_parse_error&amp; e)
<a name="l00343"></a>00343   {
<a name="l00344"></a>00344     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;Error: &quot;</span>&lt;&lt;e.what()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00345"></a>00345     <span class="keywordflow">return</span> 1;
<a name="l00346"></a>00346   }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   <a class="code" href="classmsm__shape__model.html" title="Contains mean/modes etc of a shape model.">msm_shape_model</a> shape_model;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350   <span class="keywordflow">if</span> (!<a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/vsl__quick__file_8h.html#a8414321dd17656ee456c572eb7daab7b">vsl_quick_file_load</a>(shape_model,params.<a class="code" href="structtool__params.html#a65b4cede47ef846a730d42ab8b8fa72d" title="File to save shape model to.">shape_model_path</a>))
<a name="l00351"></a>00351   {
<a name="l00352"></a>00352     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;Failed to load shape model from &quot;</span>
<a name="l00353"></a>00353             &lt;&lt;params.<a class="code" href="structtool__params.html#a65b4cede47ef846a730d42ab8b8fa72d" title="File to save shape model to.">shape_model_path</a>&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00354"></a>00354     <span class="keywordflow">return</span> 2;
<a name="l00355"></a>00355   }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357   vcl_cout&lt;&lt;<span class="stringliteral">&quot;Model: &quot;</span>&lt;&lt;shape_model&lt;&lt;vcl_endl;
<a name="l00358"></a>00358   vcl_cerr&lt;&lt;<span class="stringliteral">&quot;First mode variances are &quot;</span>;
<a name="l00359"></a>00359   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;8;++i)
<a name="l00360"></a>00360     <span class="keywordflow">if</span> (i&lt;shape_model.<a class="code" href="classmsm__ref__shape__model.html#ac1228b8038ef14fb97f45b18f6e60561" title="Number of modes.">n_modes</a>())
<a name="l00361"></a>00361       vcl_cout&lt;&lt;shape_model.<a class="code" href="classmsm__ref__shape__model.html#aaaf5c003c247338585b45f798b74162d" title="Variance for each mode.">mode_var</a>()[i]&lt;&lt;<span class="charliteral">&#39; &#39;</span>;
<a name="l00362"></a>00362   vcl_cout&lt;&lt;vcl_endl;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364   <span class="keywordflow">if</span> (params.<a class="code" href="structtool__params.html#a2d3825a38d502e44bcff219afdbda882" title="Optional path to text file containing a mode matrix.">subspace_mode_path</a>!=<span class="stringliteral">&quot;&quot;</span>)
<a name="l00365"></a>00365     shape_model = <a class="code" href="msm__draw__shape__modes_8cxx.html#a8bf1f7a2969ea2b838ced702141495ac" title="Create new model where modes are a subspace of the original model.">create_subspace_model</a>(shape_model,
<a name="l00366"></a>00366                                         params.<a class="code" href="structtool__params.html#a2d3825a38d502e44bcff219afdbda882" title="Optional path to text file containing a mode matrix.">subspace_mode_path</a>,
<a name="l00367"></a>00367                                         params.<a class="code" href="structtool__params.html#a76a13f2038549ec293a392b1b84350ee" title="Optional path to text files containing a variance vector.">subspace_var_path</a>);
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   <a class="code" href="classmsm__curves.html" title="Container for a set of curves.">msm_curves</a> curves;
<a name="l00370"></a>00370   <span class="keywordflow">if</span> (!curves.<a class="code" href="classmsm__curves.html#aaf0a645f05b1a37d4070107e164ce6bf" title="Read from text file.">read_text_file</a>(params.<a class="code" href="structtool__params.html#a0f7ecab6b4d6e58ac795efff6612cd5c">curves_path</a>))
<a name="l00371"></a>00371     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;Failed to read in curves from &quot;</span>&lt;&lt;params.<a class="code" href="structtool__params.html#a0f7ecab6b4d6e58ac795efff6612cd5c">curves_path</a>&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   <a class="code" href="classmsm__shape__mode__view.html" title="Generates shapes displaying modes of a shape model.">msm_shape_mode_view</a> mode_view;
<a name="l00374"></a>00374   mode_view.<a class="code" href="classmsm__shape__mode__view.html#a24c5600cb8756311e5ae88734474b90e" title="Define shape model.">set_shape_model</a>(shape_model);
<a name="l00375"></a>00375 <span class="preprocessor">#if 0</span>
<a name="l00376"></a>00376 <span class="preprocessor"></span>  <span class="comment">// Estimate aspect ratio</span>
<a name="l00377"></a>00377   <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html">vgl_box_2d&lt;double&gt;</a> bounds = shape_model.<a class="code" href="classmsm__ref__shape__model.html#a7c74d83be12ce1660fa015e7adb44a57" title="Mean of shape model as points.">mean_points</a>().<a class="code" href="classmsm__points.html#a92f25fd0649410740731fd32fee9272d" title="Return bounding box of points.">bounds</a>();
<a name="l00378"></a>00378   <span class="keywordtype">double</span> asp=bounds.<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html#a0d46b87ed63e134c5fa9a6c1a97b039d">height</a>()/(1e-3+bounds.<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html#af292836a69e4e09c91a7f3d66e51b536">width</a>());
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   <span class="keywordtype">int</span> win_width;
<a name="l00381"></a>00381   <span class="keywordflow">if</span> (params.<a class="code" href="structtool__params.html#a7d19dd1f29a8a4129b8f7468a476dba9" title="When true, overlap all the shapes to highlight changes.">overlap_shapes</a>)
<a name="l00382"></a>00382     win_width=int(params.<a class="code" href="structtool__params.html#afc5aa4d424d964423a5d5eac6aaf6a4c" title="Approximate width of region to display shape.">width</a>);
<a name="l00383"></a>00383   <span class="keywordflow">else</span>
<a name="l00384"></a>00384     win_width=int(params.<a class="code" href="structtool__params.html#afc5aa4d424d964423a5d5eac6aaf6a4c" title="Approximate width of region to display shape.">width</a>*params.<a class="code" href="structtool__params.html#a516e2e02ea240f037b32f483c39f34ab" title="Current number of shapes per mode.">n_per_mode</a>);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386   <span class="keywordtype">int</span> win_height=int(asp*params.<a class="code" href="structtool__params.html#afc5aa4d424d964423a5d5eac6aaf6a4c" title="Approximate width of region to display shape.">width</a>);
<a name="l00387"></a>00387   mode_view.set_display_window(<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html">vgl_box_2d&lt;int&gt;</a>(0,win_width, 0,win_height));
<a name="l00388"></a>00388 <span class="preprocessor">#endif // 0</span>
<a name="l00389"></a>00389 <span class="preprocessor"></span>  mode_view.set_range(params.<a class="code" href="structtool__params.html#a1e1e432b53b3a01ba21f6f9ebd8d3b80" title="Number of SDs to vary mode by.">n_sds</a>);
<a name="l00390"></a>00390   mode_view.set_n_per_mode(params.<a class="code" href="structtool__params.html#a516e2e02ea240f037b32f483c39f34ab" title="Current number of shapes per mode.">n_per_mode</a>);
<a name="l00391"></a>00391   mode_view.set_overlap_shapes(params.<a class="code" href="structtool__params.html#a7d19dd1f29a8a4129b8f7468a476dba9" title="When true, overlap all the shapes to highlight changes.">overlap_shapes</a>);
<a name="l00392"></a>00392   mode_view.set_display_width(params.<a class="code" href="structtool__params.html#afc5aa4d424d964423a5d5eac6aaf6a4c" title="Approximate width of region to display shape.">width</a>);
<a name="l00393"></a>00393   <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__box__2d.html">vgl_box_2d&lt;int&gt;</a> win_box = mode_view.display_window();
<a name="l00394"></a>00394 
<a name="l00395"></a>00395   <span class="keywordtype">unsigned</span> n_modes = vcl_min(params.<a class="code" href="structtool__params.html#afd887d9d7c80eca669e92056b5da6600" title="Maximum number of shape modes.">max_modes</a>,shape_model.<a class="code" href="classmsm__ref__shape__model.html#ac1228b8038ef14fb97f45b18f6e60561" title="Number of modes.">n_modes</a>());
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__vector_8h.html#a00626facb4f86efb8618a4c5f5c3c5f8">m</a>=0;<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__vector_8h.html#a00626facb4f86efb8618a4c5f5c3c5f8">m</a>&lt;n_modes;++<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__vector_8h.html#a00626facb4f86efb8618a4c5f5c3c5f8">m</a>)
<a name="l00398"></a>00398   {
<a name="l00399"></a>00399     mode_view.set_mode(1+<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__vector_8h.html#a00626facb4f86efb8618a4c5f5c3c5f8">m</a>);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (params.<a class="code" href="structtool__params.html#a4257f54765a69afa0ef1dc690442b06f" title="When true, generate 2*n_per_mode frames of a movie for each mode.">make_movie</a>)
<a name="l00402"></a>00402       <a class="code" href="msm__draw__shape__modes_8cxx.html#ad74217f1f9529647a3a4891a6f306835" title="Write a set of eps files defining a movie of the mode.">draw_mode_frames</a>(mode_view,curves,params);
<a name="l00403"></a>00403     <span class="keywordflow">else</span>
<a name="l00404"></a>00404       <a class="code" href="msm__draw__shape__modes_8cxx.html#aa2dd660b853d2d81656c5440dfb38fee">draw_mode</a>(mode_view,curves,params);
<a name="l00405"></a>00405   }
<a name="l00406"></a>00406   <span class="keywordflow">return</span> 0;
<a name="l00407"></a>00407 }
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 1 2013 17:35:01 for contrib/mul/msm by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
