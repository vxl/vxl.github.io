<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>contrib/mul/fhs/fhs_searcher.h Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">contrib/mul/fhs/fhs_searcher.h</div>  </div>
</div>
<div class="contents">
<a href="fhs__searcher_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// This is mul/fhs/fhs_searcher.h</span>
<a name="l00002"></a>00002 <span class="preprocessor">#ifndef fhs_searcher_h_</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor">#define fhs_searcher_h_</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="comment">//:</span>
<a name="l00005"></a>00005 <span class="comment">// \file</span>
<a name="l00006"></a>00006 <span class="comment">// \author Tim Cootes</span>
<a name="l00007"></a>00007 <span class="comment">// \brief Use F&amp;H&#39;s DP style algorithm to search for global solutions</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;<a class="code" href="fhs__arc_8h.html" title="Link between one node and another.">fhs/fhs_arc.h</a>&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/vgl__fwd_8h.html">vgl/vgl_fwd.h</a>&gt;</span> <span class="comment">// for point_2d&lt;T&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_mul_vimt.tag:../../../../contrib/mul/vimt/html" href="../../../../contrib/mul/vimt/html/vimt__image__2d__of_8h.html">vimt/vimt_image_2d_of.h</a>&gt;</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="comment">//: Use F&amp;H&#39;s DP style algorithm to search for global solutions to model match</span>
<a name="l00014"></a>00014 <span class="comment">//  Model consists of a set of features, together with a tree of neighbour</span>
<a name="l00015"></a>00015 <span class="comment">//  relationships of the form pos(j) = pos(i) + (N(mx,var_x),N(my,var_y))</span>
<a name="l00016"></a>00016 <span class="comment">//  where N(m,var) is a gaussian with mean m and variance var.</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00018"></a>00018 <span class="comment">//  The aim is to find a set of points {p(i)} which minimise</span>
<a name="l00019"></a>00019 <span class="comment">//  sum_i F_i(p(i)) + sum_k shape_cost(arc(k))</span>
<a name="l00020"></a>00020 <span class="comment">//  where k indexes the set of arcs defining neighbour relationships,</span>
<a name="l00021"></a>00021 <span class="comment">//  and shape_cost(arc) = dx*dx/arc.var_x + dy*dy.var_y  (dx=p(arc_j).x()-p(arc_i).x()-arc.mx)</span>
<a name="l00022"></a>00022 <span class="comment">//  This is achieved using a combination of a quadratic distance function</span>
<a name="l00023"></a>00023 <span class="comment">//  applied to each feature response image F(i), and a dynamic programming</span>
<a name="l00024"></a>00024 <span class="comment">//  approach to combining the data.</span>
<a name="l00025"></a>00025 <span class="comment">//</span>
<a name="l00026"></a>00026 <span class="comment">//  Algorithm based on papers by Felzenszwalb and Huttenlocher on</span>
<a name="l00027"></a>00027 <span class="comment">//  Pictoral Structure Matching.</span>
<a name="l00028"></a><a class="code" href="classfhs__searcher.html">00028</a> <span class="keyword">class </span><a class="code" href="classfhs__searcher.html" title="Use F&amp;H&#39;s DP style algorithm to search for global solutions to model match.">fhs_searcher</a>
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030  <span class="keyword">private</span>:
<a name="l00031"></a>00031   <span class="comment">//: Arcs defining neighbour relationships between features</span>
<a name="l00032"></a>00032   <span class="comment">//  Ordered so that parents precede children</span>
<a name="l00033"></a><a class="code" href="classfhs__searcher.html#aa5cb7fbc9489affa2b3b7df481384ed9">00033</a>   vcl_vector&lt;fhs_arc&gt; <a class="code" href="classfhs__searcher.html#aa5cb7fbc9489affa2b3b7df481384ed9" title="Arcs defining neighbour relationships between features.">arc_</a>;
<a name="l00034"></a>00034   
<a name="l00035"></a>00035   <span class="comment">//: Scaling applied to shape cost (default 1.0)</span>
<a name="l00036"></a><a class="code" href="classfhs__searcher.html#a16b50a327e989acf007ff04c78e33882">00036</a>   <span class="keywordtype">double</span> <a class="code" href="classfhs__searcher.html#a16b50a327e989acf007ff04c78e33882" title="Scaling applied to shape cost (default 1.0).">geom_wt_</a>;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <span class="comment">//: arc_to_j_[j] gives index of arc ending at given j</span>
<a name="l00039"></a><a class="code" href="classfhs__searcher.html#ad5ac54a8fc52e66c716cf7b0a3ff5c54">00039</a>   vcl_vector&lt;unsigned&gt; <a class="code" href="classfhs__searcher.html#ad5ac54a8fc52e66c716cf7b0a3ff5c54" title="arc_to_j_[j] gives index of arc ending at given j.">arc_to_j_</a>;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041   <span class="comment">//: children_[i] gives list of child nodes of node i in tree</span>
<a name="l00042"></a><a class="code" href="classfhs__searcher.html#a9e20b52cf63a8773a36b988d1390d78e">00042</a>   vcl_vector&lt;vcl_vector&lt;unsigned&gt; &gt; <a class="code" href="classfhs__searcher.html#a9e20b52cf63a8773a36b988d1390d78e" title="children_[i] gives list of child nodes of node i in tree.">children_</a>;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044   <span class="comment">//: Workspace for accumulated sum of responses</span>
<a name="l00045"></a><a class="code" href="classfhs__searcher.html#a62e466d9b294d2ed572847e8f6017f2e">00045</a>   vcl_vector&lt;vimt_image_2d_of&lt;float&gt; &gt; <a class="code" href="classfhs__searcher.html#a62e466d9b294d2ed572847e8f6017f2e" title="Workspace for accumulated sum of responses.">sum_im_</a>;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   <span class="comment">//: Workspace for sum of responses, transformed by distance function</span>
<a name="l00048"></a><a class="code" href="classfhs__searcher.html#a303ea364f4bbb6352d839a57a3311e46">00048</a>   vcl_vector&lt;vimt_image_2d_of&lt;float&gt; &gt; <a class="code" href="classfhs__searcher.html#a303ea364f4bbb6352d839a57a3311e46" title="Workspace for sum of responses, transformed by distance function.">dist_im_</a>;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050   <span class="comment">//: pos_[i](x,y,0),pos_[i](x,y,1) is position of best response for (x,y)</span>
<a name="l00051"></a>00051   <span class="comment">//  Result is in image co-ordinates.</span>
<a name="l00052"></a><a class="code" href="classfhs__searcher.html#a87e1030e4e37aa583d63576a3d007de9">00052</a>   vcl_vector&lt;vimt_image_2d_of&lt;int&gt; &gt; <a class="code" href="classfhs__searcher.html#a87e1030e4e37aa583d63576a3d007de9" title="pos_[i](x,y,0),pos_[i](x,y,1) is position of best response for (x,y).">pos_im_</a>;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <span class="comment">//: Combine responses for image im_index, given supplied feature_response for that node</span>
<a name="l00055"></a>00055   <span class="keywordtype">void</span> <a class="code" href="classfhs__searcher.html#a0aa0bc2f276c2870cb0eb0a50df6a2de" title="Combine responses for image im_index, given supplied feature_response for that node.">combine_responses</a>(<span class="keywordtype">unsigned</span> im_index,
<a name="l00056"></a>00056                          <span class="keyword">const</span> <a class="codeRef" doxygen="contrib_mul_vimt.tag:../../../../contrib/mul/vimt/html" href="../../../../contrib/mul/vimt/html/classvimt__image__2d__of.html">vimt_image_2d_of&lt;float&gt;</a>&amp; feature_response);
<a name="l00057"></a>00057 
<a name="l00058"></a>00058  <span class="keyword">public</span>:
<a name="l00059"></a>00059   <span class="comment">//: Default constructor</span>
<a name="l00060"></a>00060   <a class="code" href="classfhs__searcher.html#a7627aa6cb7e1f64fc36a776c22bd2d51" title="Default constructor.">fhs_searcher</a>();
<a name="l00061"></a>00061 
<a name="l00062"></a>00062   <span class="comment">//: Set tree defining relationships between features</span>
<a name="l00063"></a>00063   <span class="comment">//  Input arcs define neighbour relationships in any order.</span>
<a name="l00064"></a>00064   <span class="comment">//  root_node defines which feature to be used as the root</span>
<a name="l00065"></a>00065   <span class="keywordtype">void</span> <a class="code" href="classfhs__searcher.html#a4f3d2d816398ab53404819fb419d55f5" title="Set tree defining relationships between features.">set_tree</a>(<span class="keyword">const</span> vcl_vector&lt;fhs_arc&gt;&amp; arcs, <span class="keywordtype">unsigned</span> <a class="code" href="classfhs__searcher.html#a91561038597bcf6762c6ef1c8f3edfa1" title="Index of root node (set by last call to set_tree().">root_node</a>);
<a name="l00066"></a>00066   
<a name="l00067"></a>00067     <span class="comment">//: Set scaling applied to shape cost (default 1.0)</span>
<a name="l00068"></a>00068   <span class="keywordtype">void</span> <a class="code" href="classfhs__searcher.html#ac764d0cd353ad217d3eda4a9f37027a3" title="Set scaling applied to shape cost (default 1.0).">set_geom_wt</a>(<span class="keywordtype">double</span> geom_wt);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071   <span class="comment">//: Index of root node (set by last call to set_tree()</span>
<a name="l00072"></a>00072   <span class="keywordtype">unsigned</span> <a class="code" href="classfhs__searcher.html#a91561038597bcf6762c6ef1c8f3edfa1" title="Index of root node (set by last call to set_tree().">root_node</a>() <span class="keyword">const</span>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074   <span class="comment">//: Number of points represented</span>
<a name="l00075"></a><a class="code" href="classfhs__searcher.html#aa30c5244dcff332e8d88db86c87b09dd">00075</a>   <span class="keywordtype">unsigned</span> <a class="code" href="classfhs__searcher.html#aa30c5244dcff332e8d88db86c87b09dd" title="Number of points represented.">n_points</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classfhs__searcher.html#aa5cb7fbc9489affa2b3b7df481384ed9" title="Arcs defining neighbour relationships between features.">arc_</a>.size()+1; }
<a name="l00076"></a>00076 
<a name="l00077"></a>00077   <span class="comment">//: Perform global search</span>
<a name="l00078"></a>00078   <span class="comment">//  Images of feature response supplied.  The transformation</span>
<a name="l00079"></a>00079   <span class="comment">//  (world2im()) for each image can be used to indicate regions</span>
<a name="l00080"></a>00080   <span class="comment">//  which don&#39;t necessarily overlap.  However, effective displacements</span>
<a name="l00081"></a>00081   <span class="comment">//  are assumed to be in pixel sized steps.</span>
<a name="l00082"></a>00082   <span class="comment">//</span>
<a name="l00083"></a>00083   <span class="comment">//  After calling search(), results can be obtained using</span>
<a name="l00084"></a>00084   <span class="comment">//  points() and best_points() etc</span>
<a name="l00085"></a>00085   <span class="comment">//  \param geom_wt is the weighting applied to the geometric component of the cost.</span>
<a name="l00086"></a>00086   <span class="keywordtype">void</span> <a class="code" href="classfhs__searcher.html#a4bd54f532f594eba5731463e18b47243" title="Perform global search.">search</a>(<span class="keyword">const</span> vcl_vector&lt;<a class="codeRef" doxygen="contrib_mul_vimt.tag:../../../../contrib/mul/vimt/html" href="../../../../contrib/mul/vimt/html/classvimt__image__2d__of.html">vimt_image_2d_of&lt;float&gt;</a> &gt;&amp; feature_response);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   <span class="comment">//: Compute optimal position of all points given position of root</span>
<a name="l00089"></a>00089   <span class="comment">//  Assumes search() has been called first</span>
<a name="l00090"></a>00090   <span class="keywordtype">void</span> <a class="code" href="classfhs__searcher.html#a8167060ef058b732c541bddfda0e1402" title="Compute optimal position of all points given position of root.">points_from_root</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>&amp; root_pt,
<a name="l00091"></a>00091                         vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; pts) <span class="keyword">const</span>;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <span class="comment">//: Compute optimal position of all points</span>
<a name="l00094"></a>00094   <span class="comment">//  Assumes search() has been called first</span>
<a name="l00095"></a>00095   <span class="comment">//  Returns cost at optimal position</span>
<a name="l00096"></a>00096   <span class="keywordtype">double</span> <a class="code" href="classfhs__searcher.html#aa5a1699d0e54b2f14ff2dc71029b1bce" title="Compute optimal position of all points.">best_points</a>(vcl_vector&lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt;&amp; pts) <span class="keyword">const</span>;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098   <span class="comment">//: Return final total cost image for root</span>
<a name="l00099"></a>00099   <span class="keyword">const</span> <a class="codeRef" doxygen="contrib_mul_vimt.tag:../../../../contrib/mul/vimt/html" href="../../../../contrib/mul/vimt/html/classvimt__image__2d__of.html">vimt_image_2d_of&lt;float&gt;</a>&amp; <a class="code" href="classfhs__searcher.html#aacd20d4d28418a8ec08903798759c233" title="Return final total cost image for root.">root_cost_image</a>() <span class="keyword">const</span>;
<a name="l00100"></a>00100 };
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="preprocessor">#endif // fhs_searcher_h_</span>
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 1 2013 17:35:38 for contrib/mul/fhs by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
