<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>contrib/mul/m23d/m23d_ortho_rigid_builder.cxx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">contrib/mul/m23d/m23d_ortho_rigid_builder.cxx</div>  </div>
</div>
<div class="contents">
<a href="m23d__ortho__rigid__builder_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="m23d__ortho__rigid__builder_8h.html" title="Implementation of the Tomasi &amp; Kanade reconstruction algorithm.">m23d_ortho_rigid_builder.h</a>&quot;</span>
<a name="l00002"></a>00002 <span class="comment">//:</span>
<a name="l00003"></a>00003 <span class="comment">// \file</span>
<a name="l00004"></a>00004 <span class="comment">// \author Tim Cootes</span>
<a name="l00005"></a>00005 <span class="comment">// \brief Implementation of the Tomasi &amp; Kanade reconstruction algorithm</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;<a class="code" href="m23d__rotation__from__ortho__projection_8h.html" title="Generate pure 3 x 3 rotation matrix from 2 x 3 projection matrix.">m23d/m23d_rotation_from_ortho_projection.h</a>&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;<a class="code" href="m23d__scaled__ortho__projection_8h.html" title="Extracts scaled rotation/projection component of 2x3 projection matrix P.">m23d/m23d_scaled_ortho_projection.h</a>&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;<a class="code" href="m23d__set__q__constraint_8h.html" title="Functions to construct linear constraints as rows in a matrix.">m23d/m23d_set_q_constraint.h</a>&gt;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__inverse_8h.html">vnl/vnl_inverse.h</a>&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__svd_8h.html">vnl/algo/vnl_svd.h</a>&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__symmetric__eigensystem_8h.html">vnl/algo/vnl_symmetric_eigensystem.h</a>&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/vgl__vector__3d_8h.html">vgl/vgl_vector_3d.h</a>&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;vcl_iostream.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;vcl_cassert.h&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;vcl_cstdlib.h&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">//: Reconstruct structure from set of 2d pts</span>
<a name="l00021"></a>00021 <span class="comment">// Formulates measurement matrix P2D then calls reconstruct function above</span>
<a name="l00022"></a><a class="code" href="classm23d__ortho__rigid__builder.html#ad485f254ac1c9cff67c40cb8c153929c">00022</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#af689cc344a0b79c9ec16038e78b1998c" title="Reconstruct structure of 3D points given multiple 2D views.">m23d_ortho_rigid_builder::reconstruct</a>(<span class="keyword">const</span> vcl_vector&lt; vcl_vector&lt; <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a> &gt; &gt;&amp; pt_vec_list )
<a name="l00023"></a>00023 {
<a name="l00024"></a>00024   <span class="comment">// convert pts into a matrix</span>
<a name="l00025"></a>00025   <span class="keywordtype">int</span> nf= pt_vec_list.size();
<a name="l00026"></a>00026   <span class="keywordtype">int</span> n0= pt_vec_list[0].size();
<a name="l00027"></a>00027   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> D(2*nf,n0);
<a name="l00028"></a>00028   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nf; ++i)
<a name="l00029"></a>00029   {
<a name="l00030"></a>00030     <span class="keywordflow">if</span> ( (<span class="keywordtype">unsigned</span>)n0!= pt_vec_list[i].size() )
<a name="l00031"></a>00031     {
<a name="l00032"></a>00032       vcl_cerr&lt;&lt;<span class="stringliteral">&quot;ERROR m23d_ortho_rigid_builder::reconstruct()\n&quot;</span>
<a name="l00033"></a>00033               &lt;&lt;<span class="stringliteral">&quot;problem with different numbers of pts\n&quot;</span>
<a name="l00034"></a>00034               &lt;&lt;<span class="stringliteral">&quot;pt_vec_list[0].size()= &quot;</span>&lt;&lt;pt_vec_list[0].size()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00035"></a>00035               &lt;&lt;<span class="stringliteral">&quot;pt_vec_list[&quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot;].size()= &quot;</span>&lt;&lt;pt_vec_list[i].size()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00036"></a>00036       vcl_abort();
<a name="l00037"></a>00037     }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p=0; p&lt;n0; ++p)
<a name="l00040"></a>00040     {
<a name="l00041"></a>00041        D(2*i,p)= pt_vec_list[i][p].x();
<a name="l00042"></a>00042        D(2*i+1,p)= pt_vec_list[i][p].y();
<a name="l00043"></a>00043     }
<a name="l00044"></a>00044   }
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <a class="code" href="classm23d__ortho__rigid__builder.html#af689cc344a0b79c9ec16038e78b1998c" title="Reconstruct structure of 3D points given multiple 2D views.">reconstruct</a>(D);
<a name="l00047"></a>00047 }
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment">//: Reconstruct structure of 3D points given multiple 2D views</span>
<a name="l00051"></a>00051 <span class="comment">//  Data assumed to be scaled orthographic projections.</span>
<a name="l00052"></a>00052 <span class="comment">//  The result is stored in the shape_3d() matrix.</span>
<a name="l00053"></a>00053 <span class="comment">//  The estimated projection matrices are stored in the projections() matrix.</span>
<a name="l00054"></a>00054 <span class="comment">//  \param P2D 2ns x np matrix. Rows contain alternating x&#39;s and y&#39;s from 2D shapes</span>
<a name="l00055"></a><a class="code" href="classm23d__ortho__rigid__builder.html#af689cc344a0b79c9ec16038e78b1998c">00055</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#af689cc344a0b79c9ec16038e78b1998c" title="Reconstruct structure of 3D points given multiple 2D views.">m23d_ortho_rigid_builder::reconstruct</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; P2D)
<a name="l00056"></a>00056 {
<a name="l00057"></a>00057   assert(P2D.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()%2==0);
<a name="l00058"></a>00058   <span class="keywordtype">unsigned</span> nf = P2D.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()/2;
<a name="l00059"></a>00059   <span class="keywordtype">unsigned</span> np = P2D.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>();
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <span class="comment">// Take copy of 2D points and remove CoG from each</span>
<a name="l00062"></a>00062   <a class="code" href="classm23d__ortho__rigid__builder.html#a7050dc85baeaddadaafce2bdd31b4428" title="Centred version of the 2D views supplied to reconstruct().">P2Dc_</a>=P2D;
<a name="l00063"></a>00063   <a class="code" href="classm23d__ortho__rigid__builder.html#ab6aa31f0aceab2ae736c4b9b4828fc91" title="The CoG of each shape supplied to reconstruct().">cog_</a>.resize(nf);
<a name="l00064"></a>00064   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;nf;++i)
<a name="l00065"></a>00065   {
<a name="l00066"></a>00066     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> row_x=P2D.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#aa798b087903b1528197357cd4c6f2e95">get_row</a>(2*i);
<a name="l00067"></a>00067     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> row_y=P2D.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#aa798b087903b1528197357cd4c6f2e95">get_row</a>(2*i+1);
<a name="l00068"></a>00068     <span class="keywordtype">double</span> cog_x = row_x.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#a974bfe429368ed871e6a98c52af5752d">mean</a>();
<a name="l00069"></a>00069     <span class="keywordtype">double</span> cog_y = row_y.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#a974bfe429368ed871e6a98c52af5752d">mean</a>();
<a name="l00070"></a>00070     row_x-=cog_x;
<a name="l00071"></a>00071     row_y-=cog_y;
<a name="l00072"></a>00072     <a class="code" href="classm23d__ortho__rigid__builder.html#a7050dc85baeaddadaafce2bdd31b4428" title="Centred version of the 2D views supplied to reconstruct().">P2Dc_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#adc196bd7f503952815ae16297e9bffd5">set_row</a>(2*i,row_x);
<a name="l00073"></a>00073     <a class="code" href="classm23d__ortho__rigid__builder.html#a7050dc85baeaddadaafce2bdd31b4428" title="Centred version of the 2D views supplied to reconstruct().">P2Dc_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#adc196bd7f503952815ae16297e9bffd5">set_row</a>(2*i+1,row_y);
<a name="l00074"></a>00074     <a class="code" href="classm23d__ortho__rigid__builder.html#ab6aa31f0aceab2ae736c4b9b4828fc91" title="The CoG of each shape supplied to reconstruct().">cog_</a>[i]=<a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;double&gt;</a>(cog_x,cog_y);
<a name="l00075"></a>00075   }
<a name="l00076"></a>00076 
<a name="l00077"></a>00077   <span class="comment">// Use SVD to get first estimate of the projection/shape matrices</span>
<a name="l00078"></a>00078   <span class="comment">// These are ambiguous up to a 3x3 affine transformation.</span>
<a name="l00079"></a>00079   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html">vnl_svd&lt;double&gt;</a> svd(<a class="code" href="classm23d__ortho__rigid__builder.html#a7050dc85baeaddadaafce2bdd31b4428" title="Centred version of the 2D views supplied to reconstruct().">P2Dc_</a>);
<a name="l00080"></a>00080   <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a1fa1949e6219d0db6e3ad50a32d7e1e0">set_size</a>(2*nf,3);
<a name="l00081"></a>00081   <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a1fa1949e6219d0db6e3ad50a32d7e1e0">set_size</a>(3,np);
<a name="l00082"></a>00082   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> W(3,3);
<a name="l00083"></a>00083   W.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a98da5b87fa05cdab4b7b844ddf8a9074">fill</a>(0);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;3;++i)
<a name="l00086"></a>00086   {
<a name="l00087"></a>00087     <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#abe844803572d5640c760689ccbbbc1a7">set_column</a>(i, <span class="comment">/* svd.W(i)* */</span> svd.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html#ab90d87b0dd53bb3afe92e7c4e6a1d090">U</a>().<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a381354e34437c46e90bc636d246d86ce">get_column</a>(i) );
<a name="l00088"></a>00088     <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#adc196bd7f503952815ae16297e9bffd5">set_row</a>(i, svd.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html#ac5495ca5d9689cbcbb147b5e63e8ee6a">V</a>().<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a381354e34437c46e90bc636d246d86ce">get_column</a>(i) );
<a name="l00089"></a>00089     W(i,i)= vcl_sqrt( svd.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html#a3b3197be0858ae3315117e6d49cfa4ff">W</a>(i) );
<a name="l00090"></a>00090   }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="preprocessor">#if 0</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span>  vcl_cout&lt;&lt;<span class="stringliteral">&quot;W= &quot;</span>&lt;&lt;W&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00094"></a>00094           &lt;&lt;<span class="stringliteral">&quot;P_.rows()= &quot;</span>&lt;&lt;<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00095"></a>00095           &lt;&lt;<span class="stringliteral">&quot;P_.cols()= &quot;</span>&lt;&lt;<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00096"></a>00096           &lt;&lt;<span class="stringliteral">&quot;P3D_.rows()= &quot;</span>&lt;&lt;<a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00097"></a>00097           &lt;&lt;<span class="stringliteral">&quot;P3D_.cols()= &quot;</span>&lt;&lt;<a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>()&lt;&lt;vcl_endl;
<a name="l00098"></a>00098 <span class="preprocessor">#endif</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>  <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>= <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>*W;
<a name="l00100"></a>00100   <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>= W*<a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>;
<a name="l00101"></a>00101 <span class="preprocessor">#if 0</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>  vcl_cout&lt;&lt;<span class="stringliteral">&quot;P_.extract(2,3)= &quot;</span>&lt;&lt;<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a6978f66bc36f8936ccbab4716aa40a48">extract</a>(2,3)&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00103"></a>00103           &lt;&lt;<span class="stringliteral">&quot;P3D_.extract(3,5)= &quot;</span>&lt;&lt;P3D_.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a6978f66bc36f8936ccbab4716aa40a48">extract</a>(3,5)&lt;&lt;vcl_endl;
<a name="l00104"></a>00104 <span class="preprocessor">#endif</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="comment">// start of new method</span>
<a name="l00108"></a>00108 
<a name="l00109"></a>00109   <span class="comment">//using notation from orig paper</span>
<a name="l00110"></a>00110   <span class="comment">//ie</span>
<a name="l00111"></a>00111   <span class="comment">//i QQt i=1</span>
<a name="l00112"></a>00112   <span class="comment">//j QQt j=1</span>
<a name="l00113"></a>00113   <span class="comment">//i QQt j=0</span>
<a name="l00114"></a>00114   <span class="comment">// find this matrix Q</span>
<a name="l00115"></a>00115   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> Q; <span class="comment">// will be 3x3</span>
<a name="l00116"></a>00116   <a class="code" href="classm23d__ortho__rigid__builder.html#a94586ba7a441316600d4db0e6d6f0290" title="find matrix Q using constraints on matrix P which must contain orthonormal projects in each (2*3) sub...">find_correction_matrix</a>( Q, <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <span class="comment">// apply correction</span>
<a name="l00119"></a>00119   <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>= <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>*Q;
<a name="l00120"></a>00120   P3D_=<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__inverse_8h.html#ae861a19f1bfc63caa92078aa251900ac">vnl_inverse</a>(Q) * <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>; <span class="comment">// Q.transpose() * P3D_;</span>
<a name="l00121"></a>00121 
<a name="l00122"></a>00122   <span class="comment">// align model frame with first frame</span>
<a name="l00123"></a>00123   <span class="comment">// Now need to apply an additional rotation so that the</span>
<a name="l00124"></a>00124   <span class="comment">// first projection matrix is approximately the identity.</span>
<a name="l00125"></a>00125   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> P0=<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a6978f66bc36f8936ccbab4716aa40a48">extract</a>(2,3);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127   vcl_cout&lt;&lt;<span class="stringliteral">&quot;P0= &quot;</span>&lt;&lt;P0&lt;&lt;vcl_endl;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129   <span class="comment">// Compute a rotation matrix for this projection</span>
<a name="l00130"></a>00130   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> R0=<a class="code" href="m23d__rotation__from__ortho__projection_8cxx.html#a2cf97e887c93319dc4eb4066fc25b7b6" title="Generate pure 3 x 3 rotation matrix from 2 x 3 projection matrix.">m23d_rotation_from_ortho_projection</a>(P0);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   <span class="comment">// apply rotation to mean shape</span>
<a name="l00133"></a>00133   <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>= <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>*R0.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4ecdc9960874f4c3c4f01dd194305a5f">transpose</a>();
<a name="l00134"></a>00134 
<a name="l00135"></a>00135   <span class="comment">// apply reverse rotation to projections</span>
<a name="l00136"></a>00136   P3D_=R0* <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="preprocessor">#if 0 // commented out</span>
<a name="l00140"></a>00140 <span class="preprocessor"></span>
<a name="l00141"></a>00141   <span class="comment">// older method (still works fine!)</span>
<a name="l00142"></a>00142   <span class="comment">// uses fewer constraints</span>
<a name="l00143"></a>00143   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> Q;
<a name="l00144"></a>00144   <a class="code" href="classm23d__ortho__rigid__builder.html#a6d113296445f73b121815af20009906b" title="find matrix Q using constraints on matrix P which must contain orthonormal projects in each (2*3) sub...">find_correction_matrix_alt</a>( Q, <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146   <span class="comment">//apply correction + rotation at same time</span>
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   <span class="comment">// Now need to apply an additional rotation so that the</span>
<a name="l00149"></a>00149   <span class="comment">// first projection matrix is approximately the identity.</span>
<a name="l00150"></a>00150 
<a name="l00151"></a>00151   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> P0=<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a6978f66bc36f8936ccbab4716aa40a48">extract</a>(2,3)*Q;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="preprocessor">#if 0</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>  vcl_cout&lt;&lt;<span class="stringliteral">&quot;P_.extract(2,3)= &quot;</span>&lt;&lt;<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a6978f66bc36f8936ccbab4716aa40a48">extract</a>(2,3)&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00155"></a>00155           &lt;&lt;<span class="stringliteral">&quot;Q= &quot;</span>&lt;&lt;Q&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00156"></a>00156           &lt;&lt;<span class="stringliteral">&quot;P0= &quot;</span>&lt;&lt;P0&lt;&lt;vcl_endl;
<a name="l00157"></a>00157 <span class="preprocessor">#endif // 0</span>
<a name="l00158"></a>00158 <span class="preprocessor"></span>
<a name="l00159"></a>00159   <span class="comment">// Compute a rotation matrix for this</span>
<a name="l00160"></a>00160   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> R=<a class="code" href="m23d__rotation__from__ortho__projection_8cxx.html#a2cf97e887c93319dc4eb4066fc25b7b6" title="Generate pure 3 x 3 rotation matrix from 2 x 3 projection matrix.">m23d_rotation_from_ortho_projection</a>(P0);
<a name="l00161"></a>00161 
<a name="l00162"></a>00162   vcl_cout&lt;&lt;<span class="stringliteral">&quot;P0*Rt\n&quot;</span>&lt;&lt;P0*R.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4ecdc9960874f4c3c4f01dd194305a5f">transpose</a>()&lt;&lt;vcl_endl;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164   <span class="comment">// Apply inverse so that P.Q gives unit projection</span>
<a name="l00165"></a>00165   <span class="comment">// ie apply rotation to the correction matrix</span>
<a name="l00166"></a>00166   Q=Q*R.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4ecdc9960874f4c3c4f01dd194305a5f">transpose</a>();
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <span class="comment">// Apply the correction matrix</span>
<a name="l00169"></a>00169   <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>=<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>*Q;
<a name="l00170"></a>00170   P3D_=<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__inverse_8h.html#ae861a19f1bfc63caa92078aa251900ac">vnl_inverse</a>(Q) * <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>;
<a name="l00171"></a>00171 <span class="preprocessor">#endif // 0</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   <span class="comment">// Disambiguate the ambiguity in the sign of the z ordinates</span>
<a name="l00175"></a>00175   <span class="comment">// First non-zero element should be negative.</span>
<a name="l00176"></a>00176   <span class="comment">// nb mainly for benefit of test program!</span>
<a name="l00177"></a>00177   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;np;++i)
<a name="l00178"></a>00178   {
<a name="l00179"></a>00179     <span class="keywordflow">if</span> (<a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>(2,i)&lt;0) <span class="keywordflow">break</span>;
<a name="l00180"></a>00180     <span class="keywordflow">if</span> (<a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>(2,i)&gt;0)
<a name="l00181"></a>00181     {
<a name="l00182"></a>00182       <span class="comment">// Flip sign of z elements</span>
<a name="l00183"></a>00183       <a class="code" href="classm23d__ortho__rigid__builder.html#a17ca7d2bd7121f04f39eb3cc48a350e6" title="Flip z coords.">flip_z_coords</a>();
<a name="l00184"></a>00184       <span class="keywordflow">break</span>;
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186   }
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 <span class="comment">//: Flip z coords</span>
<a name="l00190"></a>00190 <span class="comment">// may need to do this to fix z coord ambiguity</span>
<a name="l00191"></a><a class="code" href="classm23d__ortho__rigid__builder.html#a17ca7d2bd7121f04f39eb3cc48a350e6">00191</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#a17ca7d2bd7121f04f39eb3cc48a350e6" title="Flip z coords.">m23d_ortho_rigid_builder::flip_z_coords</a>()
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193   vcl_cerr&lt;&lt;<span class="stringliteral">&quot;flipping z coords!\n&quot;</span>;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="keywordtype">unsigned</span> np = <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>();
<a name="l00196"></a>00196   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;np;++j)
<a name="l00197"></a>00197   {
<a name="l00198"></a>00198     <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>(2,j)*=-1;
<a name="l00199"></a>00199   }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201   <span class="keywordtype">unsigned</span> nf = <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>();
<a name="l00202"></a>00202   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;nf;++j)
<a name="l00203"></a>00203   {
<a name="l00204"></a>00204     <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>(j,2)*=-1;
<a name="l00205"></a>00205   }
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="comment">//: find matrix Q using constraints on matrix P which must contain orthonormal projects in each (2*3) submatrix for each frame old method</span>
<a name="l00209"></a><a class="code" href="classm23d__ortho__rigid__builder.html#a6d113296445f73b121815af20009906b">00209</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#a6d113296445f73b121815af20009906b" title="find matrix Q using constraints on matrix P which must contain orthonormal projects in each (2*3) sub...">m23d_ortho_rigid_builder::find_correction_matrix_alt</a>( <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; Q,
<a name="l00210"></a>00210                                                            <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; P)
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212   <span class="comment">// Apply orthogonality constraints to estimate affine correction matrix G</span>
<a name="l00213"></a>00213   <span class="keywordtype">unsigned</span> nq = 6;
<a name="l00214"></a>00214   <span class="keywordtype">int</span> nf= P.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()/2;
<a name="l00215"></a>00215   <span class="keywordtype">unsigned</span> n_con = 2*nf+1;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217   <span class="comment">// Set up constraints on elements of L=QQt</span>
<a name="l00218"></a>00218   <span class="comment">// L symmetric, encoded using elements i,j&lt;=i in the vector q</span>
<a name="l00219"></a>00219   <span class="comment">// q obtained by solving Aq=rhs</span>
<a name="l00220"></a>00220   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> A(n_con,nq);
<a name="l00221"></a>00221   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> rhs(n_con);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223   <span class="keywordtype">unsigned</span> c=0;
<a name="l00224"></a>00224   <span class="comment">// If P0 is projection matrix for first shape, arrange that P0.P0&#39;=I</span>
<a name="l00225"></a>00225   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> px0 = P.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#aa798b087903b1528197357cd4c6f2e95">get_row</a>(0);
<a name="l00226"></a>00226   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> py0 = P.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#aa798b087903b1528197357cd4c6f2e95">get_row</a>(1);
<a name="l00227"></a>00227   <a class="code" href="m23d__set__q__constraint_8cxx.html#a7a6f7754c7da45516da83e9c2d71087f" title="Defines constraint on elements of Q of form a&#39;Qb=r.">m23d_set_q_constraint1</a>(A,rhs,c,px0,px0,1); ++c;
<a name="l00228"></a>00228   <a class="code" href="m23d__set__q__constraint_8cxx.html#a7a6f7754c7da45516da83e9c2d71087f" title="Defines constraint on elements of Q of form a&#39;Qb=r.">m23d_set_q_constraint1</a>(A,rhs,c,py0,py0,1); ++c;
<a name="l00229"></a>00229   <a class="code" href="m23d__set__q__constraint_8cxx.html#a7a6f7754c7da45516da83e9c2d71087f" title="Defines constraint on elements of Q of form a&#39;Qb=r.">m23d_set_q_constraint1</a>(A,rhs,c,px0,py0,0); ++c;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231   <span class="comment">// These constraints aim to impose orthogonality on rows of projection</span>
<a name="l00232"></a>00232   <span class="comment">// matrices.</span>
<a name="l00233"></a>00233   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=1;i&lt;(unsigned)nf;++i)
<a name="l00234"></a>00234   {
<a name="l00235"></a>00235     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> pxi = P.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#aa798b087903b1528197357cd4c6f2e95">get_row</a>(2*i);
<a name="l00236"></a>00236     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> pyi = P.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#aa798b087903b1528197357cd4c6f2e95">get_row</a>(2*i+1);
<a name="l00237"></a>00237     <a class="code" href="m23d__set__q__constraint_8cxx.html#afd8657f6095956718550f0c3b61dbae0" title="Defines constraint on elements of Q of form aQa&#39;-bQb&#39;=0.">m23d_set_q_constraint2</a>(A,rhs,c,pxi,pyi); ++c;
<a name="l00238"></a>00238     <a class="code" href="m23d__set__q__constraint_8cxx.html#a7a6f7754c7da45516da83e9c2d71087f" title="Defines constraint on elements of Q of form a&#39;Qb=r.">m23d_set_q_constraint1</a>(A,rhs,c,pxi,pyi,0); ++c;
<a name="l00239"></a>00239   }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   assert(c==n_con);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html">vnl_svd&lt;double&gt;</a> svd_A(A);
<a name="l00244"></a>00244   vcl_cout&lt;&lt;<span class="stringliteral">&quot;Singular values of constraints: &quot;</span>&lt;&lt;svd_A.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html#a3b3197be0858ae3315117e6d49cfa4ff">W</a>().<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__diag__matrix.html#a72a738ea784122a9fd8e96117512f8f1">diagonal</a>()&lt;&lt;vcl_endl;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> q = svd_A.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html#ac2cbab9e5659cebda7829337d285fbcc">solve</a>(rhs);
<a name="l00247"></a>00247   vcl_cout&lt;&lt;<span class="stringliteral">&quot;RMS Error in q = &quot;</span>&lt;&lt;(A*q-rhs).rms()&lt;&lt;vcl_endl;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> L(3,3);
<a name="l00250"></a>00250   c=0;
<a name="l00251"></a>00251   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;3;++i)
<a name="l00252"></a>00252     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;=i;++j,++c)
<a name="l00253"></a>00253       L(i,j)=L(j,i)=q[c];
<a name="l00254"></a>00254 <span class="preprocessor">#if 0</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>  vcl_cout&lt;&lt;<span class="stringliteral">&quot;L= &quot;</span>&lt;&lt;L&lt;&lt;vcl_endl;
<a name="l00256"></a>00256 <span class="preprocessor">#endif</span>
<a name="l00257"></a>00257 <span class="preprocessor"></span>  <span class="comment">// If G is the 3 x 3 correction matrix, then G.G&#39;=Q</span>
<a name="l00258"></a>00258   <span class="comment">// Use cholesky decomposition to compute G</span>
<a name="l00259"></a>00259   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html">vnl_symmetric_eigensystem&lt;double&gt;</a> eig(L);
<a name="l00260"></a>00260 <span class="preprocessor">#if 0</span>
<a name="l00261"></a>00261 <span class="preprocessor"></span>  <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> Q(3,3);
<a name="l00262"></a>00262 <span class="preprocessor">#endif</span>
<a name="l00263"></a>00263 <span class="preprocessor"></span>  Q.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a1fa1949e6219d0db6e3ad50a32d7e1e0">set_size</a>(3,3);
<a name="l00264"></a>00264   vcl_cout&lt;&lt;<span class="stringliteral">&quot;Eigenvalues: &quot;</span>&lt;&lt;eig.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html#ac715b0f8a512dde94c029f38f342496a">D</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__diag__matrix.html#a72a738ea784122a9fd8e96117512f8f1">diagonal</a>()&lt;&lt;vcl_endl;
<a name="l00265"></a>00265   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;3;++i)
<a name="l00266"></a>00266   {
<a name="l00267"></a>00267     <span class="comment">// Deal with case where Q is not pos-definite (ie has -ive eigenvalues).</span>
<a name="l00268"></a>00268     <span class="comment">//double s = 0.00001;</span>
<a name="l00269"></a>00269     <span class="comment">//if (eig.get_eigenvalue(2-i)&gt;0.0)</span>
<a name="l00270"></a>00270     <span class="comment">//  s = vcl_sqrt(eig.get_eigenvalue(2-i));</span>
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <span class="comment">// nb critical bit making sure Q is pos def</span>
<a name="l00273"></a>00273     <span class="keywordtype">double</span> s= vcl_sqrt(  vcl_fabs(eig.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html#a8a4ab2ac2cee9187f51895a4c017d810">get_eigenvalue</a>(2-i)) );
<a name="l00274"></a>00274     Q.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#abe844803572d5640c760689ccbbbc1a7">set_column</a>(i,s*eig.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html#a49ae783735f6fdfc7fa4854e2bbfd48f">get_eigenvector</a>(2-i));
<a name="l00275"></a>00275   }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 <span class="preprocessor">#if 0</span>
<a name="l00278"></a>00278 <span class="preprocessor"></span>  vcl_cout&lt;&lt;<span class="stringliteral">&quot;Q= &quot;</span>&lt;&lt;Q&lt;&lt;vcl_endl;
<a name="l00279"></a>00279 <span class="preprocessor">#endif</span>
<a name="l00280"></a>00280 <span class="preprocessor"></span>}
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 <span class="comment">//: find matrix Q using constraints on matrix P which must contain orthonormal projects in each (2*3) submatrix for each frame</span>
<a name="l00284"></a><a class="code" href="classm23d__ortho__rigid__builder.html#a94586ba7a441316600d4db0e6d6f0290">00284</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#a94586ba7a441316600d4db0e6d6f0290" title="find matrix Q using constraints on matrix P which must contain orthonormal projects in each (2*3) sub...">m23d_ortho_rigid_builder::find_correction_matrix</a>( <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; Q,
<a name="l00285"></a>00285                                                        <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; P)
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287   <span class="keywordtype">int</span> nf= P.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()/2;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   <span class="comment">// build ortho constraint matrix G</span>
<a name="l00290"></a>00290   <span class="comment">// where GI=c</span>
<a name="l00291"></a>00291   <span class="comment">// G= 3nf * 6</span>
<a name="l00292"></a>00292   <span class="comment">// I= 6 * 1</span>
<a name="l00293"></a>00293   <span class="comment">// c= 3nf * 1</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   <span class="comment">// then</span>
<a name="l00296"></a>00296   <span class="comment">//L = [I(1) I(2) I(3);</span>
<a name="l00297"></a>00297   <span class="comment">//     I(2) I(4) I(5);</span>
<a name="l00298"></a>00298   <span class="comment">//      I(3) I(5) I(6)];</span>
<a name="l00299"></a>00299   <span class="comment">// and L=QQt</span>
<a name="l00300"></a>00300 
<a name="l00301"></a>00301   <span class="comment">// based on</span>
<a name="l00302"></a>00302   <span class="comment">//i QQt i=1</span>
<a name="l00303"></a>00303   <span class="comment">//j QQt j=1</span>
<a name="l00304"></a>00304   <span class="comment">//i QQt j=0</span>
<a name="l00305"></a>00305   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> G(nf*3,6);
<a name="l00306"></a>00306   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> con_vec(nf*3);
<a name="l00307"></a>00307   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> f=0; f&lt;nf; ++f)
<a name="l00308"></a>00308   {
<a name="l00309"></a>00309     <span class="comment">// 3 constraints per frame</span>
<a name="l00310"></a>00310     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> i_vec= P.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#aa798b087903b1528197357cd4c6f2e95">get_row</a>(f*2);
<a name="l00311"></a>00311     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> j_vec= P.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#aa798b087903b1528197357cd4c6f2e95">get_row</a>(f*2+1);
<a name="l00312"></a>00312 <span class="preprocessor">#if 0</span>
<a name="l00313"></a>00313 <span class="preprocessor"></span>    vcl_cout&lt;&lt;<span class="stringliteral">&quot;f=&quot;</span>&lt;&lt;f&lt;&lt;vcl_endl
<a name="l00314"></a>00314             &lt;&lt;<span class="stringliteral">&quot;i_vec= &quot;</span>&lt;&lt;i_vec&lt;&lt;vcl_endl
<a name="l00315"></a>00315             &lt;&lt;<span class="stringliteral">&quot;j_vec= &quot;</span>&lt;&lt;j_vec&lt;&lt;vcl_endl;
<a name="l00316"></a>00316 <span class="preprocessor">#endif</span>
<a name="l00317"></a>00317 <span class="preprocessor"></span>    <span class="comment">//i QQt i=1</span>
<a name="l00318"></a>00318     <span class="keywordtype">int</span> r0= f*3;
<a name="l00319"></a>00319     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> c0_vec;
<a name="l00320"></a>00320     <a class="code" href="classm23d__ortho__rigid__builder.html#a713539ec4f6fe6fbaa6f2b2a133acba0" title="find matrix Q using constraints on matrix P which must contain.">compute_one_row_of_constraints</a>( c0_vec, i_vec, i_vec );
<a name="l00321"></a>00321     G.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#adc196bd7f503952815ae16297e9bffd5">set_row</a>(r0,c0_vec);
<a name="l00322"></a>00322     con_vec(r0)=1;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <span class="comment">//j QQt j=1</span>
<a name="l00325"></a>00325     <span class="keywordtype">int</span> r1= f*3+1;
<a name="l00326"></a>00326     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> c1_vec;
<a name="l00327"></a>00327     <a class="code" href="classm23d__ortho__rigid__builder.html#a713539ec4f6fe6fbaa6f2b2a133acba0" title="find matrix Q using constraints on matrix P which must contain.">compute_one_row_of_constraints</a>( c1_vec, j_vec, j_vec );
<a name="l00328"></a>00328     G.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#adc196bd7f503952815ae16297e9bffd5">set_row</a>(r1,c1_vec);
<a name="l00329"></a>00329     con_vec(r1)=1;
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="comment">//i QQt j=0</span>
<a name="l00332"></a>00332     <span class="keywordtype">int</span> r2= f*3+2;
<a name="l00333"></a>00333     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> c2_vec;
<a name="l00334"></a>00334     <a class="code" href="classm23d__ortho__rigid__builder.html#a713539ec4f6fe6fbaa6f2b2a133acba0" title="find matrix Q using constraints on matrix P which must contain.">compute_one_row_of_constraints</a>( c2_vec, i_vec, j_vec );
<a name="l00335"></a>00335     G.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#adc196bd7f503952815ae16297e9bffd5">set_row</a>(r2,c2_vec);
<a name="l00336"></a>00336     con_vec(r2)=0;
<a name="l00337"></a>00337   }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339   <span class="comment">// solve for I</span>
<a name="l00340"></a>00340   <span class="comment">//GI=con</span>
<a name="l00341"></a>00341   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html">vnl_svd&lt;double&gt;</a> svd_G(G);
<a name="l00342"></a>00342   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> I= svd_G.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html#aece6a02ceb1a134d9791302bd1d373a1">pinverse</a>()*con_vec;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344   <span class="comment">//3x3 matrix L</span>
<a name="l00345"></a>00345   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> L(3,3);
<a name="l00346"></a>00346   L(0,0)= I(0);
<a name="l00347"></a>00347   L(0,1)= I(1);
<a name="l00348"></a>00348   L(0,2)= I(2);
<a name="l00349"></a>00349   L(1,0)= I(1);
<a name="l00350"></a>00350   L(1,1)= I(3);
<a name="l00351"></a>00351   L(1,2)= I(4);
<a name="l00352"></a>00352   L(2,0)= I(2);
<a name="l00353"></a>00353   L(2,1)= I(4);
<a name="l00354"></a>00354   L(2,2)= I(5);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356   <span class="comment">// solve QQt= L</span>
<a name="l00357"></a>00357   <span class="comment">// use symmetric eigen decomposition L= V*D*Vt</span>
<a name="l00358"></a>00358 <span class="preprocessor">#if 0</span>
<a name="l00359"></a>00359 <span class="preprocessor"></span>  vcl_cout&lt;&lt;<span class="stringliteral">&quot;L= &quot;</span>&lt;&lt;L&lt;&lt;vcl_endl;
<a name="l00360"></a>00360 <span class="preprocessor">#endif</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span>
<a name="l00362"></a>00362   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html">vnl_symmetric_eigensystem&lt;double&gt;</a> eig(L);
<a name="l00363"></a>00363 <span class="preprocessor">#if 0</span>
<a name="l00364"></a>00364 <span class="preprocessor"></span>  vcl_cout&lt;&lt;<span class="stringliteral">&quot;eig.V= &quot;</span>&lt;&lt;eig.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html#ada5db9723e7177e1f46de5c69fe82d05">V</a>&lt;&lt;vcl_endl
<a name="l00365"></a>00365           &lt;&lt;<span class="stringliteral">&quot;eig.D= &quot;</span>&lt;&lt;eig.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html#ac715b0f8a512dde94c029f38f342496a">D</a>&lt;&lt;vcl_endl;
<a name="l00366"></a>00366   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> Q(3,3);
<a name="l00367"></a>00367 <span class="preprocessor">#endif</span>
<a name="l00368"></a>00368 <span class="preprocessor"></span>  Q.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a1fa1949e6219d0db6e3ad50a32d7e1e0">set_size</a>(3,3);
<a name="l00369"></a>00369   vcl_cout&lt;&lt;<span class="stringliteral">&quot;Eigenvalues: &quot;</span>&lt;&lt;eig.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html#ac715b0f8a512dde94c029f38f342496a">D</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__diag__matrix.html#a72a738ea784122a9fd8e96117512f8f1">diagonal</a>()&lt;&lt;vcl_endl;
<a name="l00370"></a>00370   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;3;++i)
<a name="l00371"></a>00371   {
<a name="l00372"></a>00372     <span class="comment">// Deal with case where Q is not pos-definite (ie has -ive eigenvalues).</span>
<a name="l00373"></a>00373 <span class="preprocessor">#if 0</span>
<a name="l00374"></a>00374 <span class="preprocessor"></span>    <span class="keywordtype">double</span> s=0.00001; <span class="comment">// = vcl_sqrt(0.00001);</span>
<a name="l00375"></a>00375     <span class="keywordflow">if</span> (eig.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html#a8a4ab2ac2cee9187f51895a4c017d810">get_eigenvalue</a>(2-i)&gt;0.0)
<a name="l00376"></a>00376     {
<a name="l00377"></a>00377       s = vcl_sqrt(eig.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html#a8a4ab2ac2cee9187f51895a4c017d810">get_eigenvalue</a>(2-i));
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379 <span class="preprocessor">#endif</span>
<a name="l00380"></a>00380 <span class="preprocessor"></span>
<a name="l00381"></a>00381     <span class="comment">// nb critical bit making sure Q is pos def</span>
<a name="l00382"></a>00382     <span class="keywordtype">double</span> s= vcl_sqrt(  vcl_fabs(eig.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html#a8a4ab2ac2cee9187f51895a4c017d810">get_eigenvalue</a>(2-i)) );
<a name="l00383"></a>00383     Q.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#abe844803572d5640c760689ccbbbc1a7">set_column</a>(i,s*eig.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__symmetric__eigensystem.html#a49ae783735f6fdfc7fa4854e2bbfd48f">get_eigenvector</a>(2-i) );
<a name="l00384"></a>00384   }
<a name="l00385"></a>00385 <span class="preprocessor">#if 0</span>
<a name="l00386"></a>00386 <span class="preprocessor"></span>  vcl_cout&lt;&lt;<span class="stringliteral">&quot;Q= &quot;</span>&lt;&lt;Q&lt;&lt;vcl_endl;
<a name="l00387"></a>00387 <span class="preprocessor">#endif</span>
<a name="l00388"></a>00388 <span class="preprocessor"></span>}
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="comment">//: find matrix Q using constraints on matrix P which must contain from two rows of a projection matrix (a+b) find six constraints used to compute (QQt) symmetric matrix</span>
<a name="l00391"></a><a class="code" href="classm23d__ortho__rigid__builder.html#a713539ec4f6fe6fbaa6f2b2a133acba0">00391</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#a713539ec4f6fe6fbaa6f2b2a133acba0" title="find matrix Q using constraints on matrix P which must contain.">m23d_ortho_rigid_builder::compute_one_row_of_constraints</a>( <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; c,
<a name="l00392"></a>00392                                                                <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; a,
<a name="l00393"></a>00393                                                                <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; b)
<a name="l00394"></a>00394 {
<a name="l00395"></a>00395   c.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#ae34b3cfb08e104f2ac81a74dc91537cc">set_size</a>(6);
<a name="l00396"></a>00396   c(0)=a(0)*b(0);
<a name="l00397"></a>00397   c(1)=a(1)*b(0)+a(0)*b(1);
<a name="l00398"></a>00398   c(2)=a(2)*b(0)+a(0)*b(2);
<a name="l00399"></a>00399   c(3)=a(1)*b(1);
<a name="l00400"></a>00400   c(4)=a(2)*b(1)+a(1)*b(2);
<a name="l00401"></a>00401   c(5)=a(2)*b(2);
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="comment">//: Modify projection matrices so they are scaled orthographic projections</span>
<a name="l00406"></a>00406 <span class="comment">//  $ P = s(I|0)*R $</span>
<a name="l00407"></a><a class="code" href="classm23d__ortho__rigid__builder.html#a49536bd7064e236dbd344f55754a4079">00407</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#a49536bd7064e236dbd344f55754a4079" title="Modify projection matrices so they are scaled orthographic projections.">m23d_ortho_rigid_builder::make_pure_projections</a>()
<a name="l00408"></a>00408 {
<a name="l00409"></a>00409   <span class="keywordtype">unsigned</span> nf = <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()/2;
<a name="l00410"></a>00410 
<a name="l00411"></a>00411   <span class="comment">// Force first to be identity</span>
<a name="l00412"></a>00412   <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>(0,0)=1; <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>(0,1)=0; <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>(0,2)=0;
<a name="l00413"></a>00413   <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>(1,0)=0; <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>(1,1)=1; <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>(1,2)=0;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415   <span class="comment">// Replace each subsequent 2x3 projection with the</span>
<a name="l00416"></a>00416   <span class="comment">// closest pure scaled orthogonal projection.</span>
<a name="l00417"></a>00417   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=1;i&lt;nf;++i)
<a name="l00418"></a>00418   {
<a name="l00419"></a>00419     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> newPi = <a class="code" href="m23d__scaled__ortho__projection_8cxx.html#a2686130f98c4cb81f80485f43cffaddf" title="Extracts scaled rotation/projection component of 2x3 projection matrix P.">m23d_scaled_ortho_projection</a>(<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a6978f66bc36f8936ccbab4716aa40a48">extract</a>(2,3,2*i,0));
<a name="l00420"></a>00420     <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a8a46918b792658fd2032ebf9c2294deb">update</a>(newPi,2*i,0);
<a name="l00421"></a>00421   }
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="comment">//: Refine estimates of projection and structure</span>
<a name="l00425"></a><a class="code" href="classm23d__ortho__rigid__builder.html#a17e7837c5c80c227805a70fbc1c06a47">00425</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#a17e7837c5c80c227805a70fbc1c06a47" title="Refine estimates of projection and structure.">m23d_ortho_rigid_builder::refine</a>()
<a name="l00426"></a>00426 {
<a name="l00427"></a>00427   <a class="code" href="classm23d__ortho__rigid__builder.html#a49536bd7064e236dbd344f55754a4079" title="Modify projection matrices so they are scaled orthographic projections.">make_pure_projections</a>();
<a name="l00428"></a>00428   <span class="comment">// Re-estimate the 3D shape by solving the linear equation</span>
<a name="l00429"></a>00429   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html">vnl_svd&lt;double&gt;</a> svd(<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>);
<a name="l00430"></a>00430   <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a> = svd.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__svd.html#aece6a02ceb1a134d9791302bd1d373a1">pinverse</a>() * <a class="code" href="classm23d__ortho__rigid__builder.html#a7050dc85baeaddadaafce2bdd31b4428" title="Centred version of the 2D views supplied to reconstruct().">P2Dc_</a>;
<a name="l00431"></a>00431   <span class="comment">// Slightly less stable than backsub, but what the heck</span>
<a name="l00432"></a>00432   <span class="comment">//(you live on the edge Tim!-dac)</span>
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 <span class="comment">//: Return 3d rigid pts</span>
<a name="l00437"></a>00437 <span class="comment">// I.e., aligned with first frame</span>
<a name="l00438"></a><a class="code" href="classm23d__ortho__rigid__builder.html#aa4f58399ee0d8c263934f4fcdaae12e1">00438</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#aa4f58399ee0d8c263934f4fcdaae12e1" title="Return 3d pts given 3*np matrix.">m23d_ortho_rigid_builder::mat_to_3d_pts</a>(vcl_vector&lt; <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> &gt;&amp; pt_vec,
<a name="l00439"></a>00439                                              <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; M)<span class="keyword"> const</span>
<a name="l00440"></a>00440 <span class="keyword"></span>{
<a name="l00441"></a>00441   <span class="comment">// get pts out of P3D_ matrix</span>
<a name="l00442"></a>00442   <span class="keywordflow">if</span> ( M.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>() != 3 )
<a name="l00443"></a>00443   {
<a name="l00444"></a>00444     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;ERROR m23d_ortho_rigid_builder::mat_to_3d_pts()\n&quot;</span>
<a name="l00445"></a>00445             &lt;&lt;<span class="stringliteral">&quot;problem with size of matrix\n&quot;</span>
<a name="l00446"></a>00446             &lt;&lt;<span class="stringliteral">&quot;M.rows()= &quot;</span>&lt;&lt;M.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00447"></a>00447             &lt;&lt;<span class="stringliteral">&quot;M.cols()= &quot;</span>&lt;&lt;M.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00448"></a>00448     vcl_abort();
<a name="l00449"></a>00449   }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <span class="keywordtype">int</span> np= M.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>();
<a name="l00452"></a>00452   pt_vec.resize(np);
<a name="l00453"></a>00453   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;np; ++i)
<a name="l00454"></a>00454   {
<a name="l00455"></a>00455     pt_vec[i].set( M(0,i), M(1,i), M(2,i) );
<a name="l00456"></a>00456   }
<a name="l00457"></a>00457 }
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 <span class="comment">//: Get back 3d pts rotated and shifted for each frame</span>
<a name="l00460"></a><a class="code" href="classm23d__ortho__rigid__builder.html#a97b314e8e4b54b45a9c93c202b86554a">00460</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#a97b314e8e4b54b45a9c93c202b86554a" title="Get back 3d pts rotated and shifted for each frame.">m23d_ortho_rigid_builder::recon_shapes</a>(vcl_vector&lt; vcl_vector&lt; <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> &gt; &gt;&amp; pt_vec_list )<span class="keyword"> const</span>
<a name="l00461"></a>00461 <span class="keyword"></span>{
<a name="l00462"></a>00462   <span class="keywordflow">if</span> (<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>() &lt; 2 || <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>() != 3 )
<a name="l00463"></a>00463   {
<a name="l00464"></a>00464     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;ERROR m23d_ortho_rigid_builder::recon_shapes()\n&quot;</span>
<a name="l00465"></a>00465             &lt;&lt;<span class="stringliteral">&quot;problem with size of P_\n&quot;</span>
<a name="l00466"></a>00466             &lt;&lt;<span class="stringliteral">&quot;P_.rows()= &quot;</span>&lt;&lt;<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00467"></a>00467             &lt;&lt;<span class="stringliteral">&quot;P_.cols()= &quot;</span>&lt;&lt;<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00468"></a>00468     vcl_abort();
<a name="l00469"></a>00469   }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471   <span class="keywordtype">unsigned</span> nf= <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()/2;
<a name="l00472"></a>00472   pt_vec_list.resize(nf);
<a name="l00473"></a>00473   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;nf;++i)
<a name="l00474"></a>00474   {
<a name="l00475"></a>00475     <span class="comment">//vnl_matrix&lt;double&gt; newPi = m23d_scaled_ortho_projection(P_.extract(2,3,2*i,0));</span>
<a name="l00476"></a>00476     <span class="comment">//P_.update(newPi,2*i,0);</span>
<a name="l00477"></a>00477     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> P0= <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a6978f66bc36f8936ccbab4716aa40a48">extract</a>(2,3,2*i,0);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     <span class="comment">// Compute a rotation matrix for this projection</span>
<a name="l00480"></a>00480     <span class="comment">// then update shape and</span>
<a name="l00481"></a>00481     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> R0=<a class="code" href="m23d__rotation__from__ortho__projection_8cxx.html#a2cf97e887c93319dc4eb4066fc25b7b6" title="Generate pure 3 x 3 rotation matrix from 2 x 3 projection matrix.">m23d_rotation_from_ortho_projection</a>(P0);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <span class="comment">// apply rotation to base shape</span>
<a name="l00484"></a>00484     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> rot_pts_mat=R0* <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>;
<a name="l00485"></a>00485     <a class="code" href="classm23d__ortho__rigid__builder.html#aa4f58399ee0d8c263934f4fcdaae12e1" title="Return 3d pts given 3*np matrix.">mat_to_3d_pts</a>( pt_vec_list[i], rot_pts_mat );
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <span class="comment">// apply cog_ translation to each pt vector</span>
<a name="l00488"></a>00488     <span class="keywordtype">int</span> np= pt_vec_list[i].size();
<a name="l00489"></a>00489     <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> tran_vec( <a class="code" href="classm23d__ortho__rigid__builder.html#ab6aa31f0aceab2ae736c4b9b4828fc91" title="The CoG of each shape supplied to reconstruct().">cog_</a>[i].x(), <a class="code" href="classm23d__ortho__rigid__builder.html#ab6aa31f0aceab2ae736c4b9b4828fc91" title="The CoG of each shape supplied to reconstruct().">cog_</a>[i].y(), 0 );
<a name="l00490"></a>00490     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p=0; p&lt;np; ++p)
<a name="l00491"></a>00491     {
<a name="l00492"></a>00492       pt_vec_list[i][p]= pt_vec_list[i][p] + tran_vec;
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494   }
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 
<a name="l00498"></a>00498 <span class="comment">//: Get back 3d pts rotated and shifted for each frame</span>
<a name="l00499"></a><a class="code" href="classm23d__ortho__rigid__builder.html#aac6551c02346c841031f57210d63de66">00499</a> <span class="keywordtype">void</span> <a class="code" href="classm23d__ortho__rigid__builder.html#aac6551c02346c841031f57210d63de66" title="Return 3d pts given 3*np matrix.">m23d_ortho_rigid_builder::get_shape_3d_pts</a>( vcl_vector&lt; <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;double&gt;</a> &gt;&amp; pts )<span class="keyword"> const</span>
<a name="l00500"></a>00500 <span class="keyword"></span>{
<a name="l00501"></a>00501   <span class="keywordflow">if</span> (<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>() &lt; 2 || <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>() != 3 )
<a name="l00502"></a>00502   {
<a name="l00503"></a>00503     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;ERROR m23d_ortho_rigid_builder::get_shape_3d_pts()\n&quot;</span>
<a name="l00504"></a>00504             &lt;&lt;<span class="stringliteral">&quot;problem with size of P_\n&quot;</span>
<a name="l00505"></a>00505             &lt;&lt;<span class="stringliteral">&quot;P_.rows()= &quot;</span>&lt;&lt;<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a840b1c4c74689f19b0496d476c5cc2d7">rows</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00506"></a>00506             &lt;&lt;<span class="stringliteral">&quot;P_.cols()= &quot;</span>&lt;&lt;<a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>()&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00507"></a>00507     vcl_abort();
<a name="l00508"></a>00508   }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510 
<a name="l00511"></a>00511   <span class="comment">//vnl_matrix&lt;double&gt; newPi = m23d_scaled_ortho_projection(P_.extract(2,3,2*i,0));</span>
<a name="l00512"></a>00512   <span class="comment">//P_.update(newPi,2*i,0);</span>
<a name="l00513"></a>00513   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> P0= <a class="code" href="classm23d__ortho__rigid__builder.html#abad35beff5e7f078fb94f7c3d82fe3c8" title="The 2ns x 3 projection matrix.">P_</a>.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a6978f66bc36f8936ccbab4716aa40a48">extract</a>(2,3);
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   <span class="comment">// Compute a rotation matrix for this projection</span>
<a name="l00516"></a>00516   <span class="comment">// then update shape and</span>
<a name="l00517"></a>00517   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> R0=<a class="code" href="m23d__rotation__from__ortho__projection_8cxx.html#a2cf97e887c93319dc4eb4066fc25b7b6" title="Generate pure 3 x 3 rotation matrix from 2 x 3 projection matrix.">m23d_rotation_from_ortho_projection</a>(P0);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519   <span class="comment">// apply rotation to base shape</span>
<a name="l00520"></a>00520   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> rot_pts_mat=R0* <a class="code" href="classm23d__ortho__rigid__builder.html#a8b7080a2cd8dfbafb702519c6abf91f1" title="3 x np matrix, each column containing one 3D point.">P3D_</a>;
<a name="l00521"></a>00521   <a class="code" href="classm23d__ortho__rigid__builder.html#aa4f58399ee0d8c263934f4fcdaae12e1" title="Return 3d pts given 3*np matrix.">mat_to_3d_pts</a>( pts, rot_pts_mat );
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 
<a name="l00524"></a>00524   <span class="keywordtype">int</span> np= pts.size();
<a name="l00525"></a>00525   <a class="codeRef" doxygen="core_vgl.tag:../../../../core/vgl/html" href="../../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;double&gt;</a> tran_vec( <a class="code" href="classm23d__ortho__rigid__builder.html#ab6aa31f0aceab2ae736c4b9b4828fc91" title="The CoG of each shape supplied to reconstruct().">cog_</a>[0].x(), <a class="code" href="classm23d__ortho__rigid__builder.html#ab6aa31f0aceab2ae736c4b9b4828fc91" title="The CoG of each shape supplied to reconstruct().">cog_</a>[0].y(), 0 );
<a name="l00526"></a>00526   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p=0; p&lt;np; ++p)
<a name="l00527"></a>00527   {
<a name="l00528"></a>00528     pts[p]= pts[p] + tran_vec;
<a name="l00529"></a>00529   }
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 1 2013 17:34:31 for contrib/mul/m23d by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
