<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>contrib/mul/mbl/mbl_log.h File Reference</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a>  </div>
  <div class="headertitle">
<div class="title">contrib/mul/mbl/mbl_log.h File Reference</div>  </div>
</div>
<div class="contents">

<p>Flexible and efficient status and error logging.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;vcl_fstream.h&gt;</code><br/>
<code>#include &lt;vcl_streambuf.h&gt;</code><br/>
<code>#include &lt;vcl_string.h&gt;</code><br/>
<code>#include &lt;vcl_ostream.h&gt;</code><br/>
<code>#include &lt;vcl_set.h&gt;</code><br/>
<code>#include &lt;vcl_map.h&gt;</code><br/>
<code>#include &lt;vcl_ios.h&gt;</code><br/>
</div>
<p><a href="mbl__log_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmbl__log__streambuf.html">mbl_log_streambuf</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Allows stream-like syntax on logger.  <a href="classmbl__log__streambuf.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmbl__log__null__streambuf.html">mbl_log_null_streambuf</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">A null streambuf ignores all input.  <a href="classmbl__log__null__streambuf.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmbl__log__output__base.html">mbl_log_output_base</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Base class for destinations of a logging event.  <a href="classmbl__log__output__base.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmbl__log__output__stream.html">mbl_log_output_stream</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Outputs log messages to an existing stream (e.g. vcl_cerr).  <a href="classmbl__log__output__stream.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmbl__log__output__file.html">mbl_log_output_file</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Outputs log messages to a named file.  <a href="classmbl__log__output__file.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmbl__logger.html">mbl_logger</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Main user logging class - represents a category.  <a href="classmbl__logger.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmbl__log__categories.html">mbl_log_categories</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This class handles category lists.  <a href="classmbl__log__categories.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmbl__log__categories_1_1cat__spec.html">mbl_log_categories::cat_spec</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmbl__logger__root.html">mbl_logger_root</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Singleton, keeps records of logging state.  <a href="classmbl__logger__root.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mbl__log_8h.html#a5a0cfdeb6abb82a7054651ef3b5b626a">MBL_LOG</a>(my_level, logger, message)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Log a message.  <a href="#a5a0cfdeb6abb82a7054651ef3b5b626a"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Flexible and efficient status and error logging. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Ian Scott </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>16-Jan-2005 Good log statements are left in the code, and switched on or off at runtime. To make this feasible, the decision about whether to send a log message should be as efficient as possible. The runtime cost of a switched off mbl_log statement will be no more than an integer comparison, if you have a decent optimising compiler.</dd></dl>
<p>These classes are patterned after the log4j logging library, although without all of the sophistication. (We have not copied any code from log4j (or other logging libraries) - just the ideas.)</p>
<p>To send a message to the log you need to do two things - create a logger object, and send a message to it. By creating a logger, you identify a category of logging events. You should create a separate category for each module of your program. However, creating loggers may not be cheap - so it is best not to do it too often. </p>
<div class="fragment"><pre class="fragment"> <a class="code" href="classmbl__logger.html" title="Main user logging class - represents a category.">mbl_logger</a> my_log(<span class="stringliteral">&quot;imorphics.easy_stuff.does_halt&quot;</span>);
</pre></div><p> The easiest way to send a log message looks like: </p>
<div class="fragment"><pre class="fragment"> <a class="code" href="mbl__log_8h.html#a5a0cfdeb6abb82a7054651ef3b5b626a" title="Log a message.">MBL_LOG</a>(WARN, my_log, <span class="stringliteral">&quot;Infinite loop: Time wasted so far &quot;</span> &lt;&lt; time() );
</pre></div><p> The system will have been setup to assign a log level to a particular category. The log levels are EMERG &lt; ALERT &lt; CRIT &lt; ERR &lt; WARN &lt; NOTICE &lt; INFO &lt; DEBUG. The above log message will be sent if the level for category "imorphics.easy_stuff.does_halt" is set to WARN or higher. You can avoid using macros by calling the logger directly </p>
<div class="fragment"><pre class="fragment"> my_log.log(<a class="code" href="classmbl__logger.html#a5bb59a9d1fc98f3bc5118fce310f1df3a805f8dd402385b15f857f7f8c62472e3">mbl_logger::WARN</a>) &lt;&lt; <span class="stringliteral">&quot;Infinite loop: Time wasted so far &quot;</span> &lt;&lt; time() &lt;&lt; vcl_endl;
</pre></div><p> The vcl_endl (or a vcl_flush) is necessary to terminate the log line. The problem with this explicit version is that the stream insertion and call to the time() function take place, even if the logging level is set below WARN. Ideally, we would like unsent log messages to take as little time as possible - so that there is no overhead in leaving the log message in your code. To achieve this we can test the log level first </p>
<div class="fragment"><pre class="fragment"> <span class="keywordflow">if</span> (my_log.level() &gt;= <a class="code" href="classmbl__logger.html#a5bb59a9d1fc98f3bc5118fce310f1df3a805f8dd402385b15f857f7f8c62472e3">mbl_logger::WARN</a>)
   my_log.log(<a class="code" href="classmbl__logger.html#a5bb59a9d1fc98f3bc5118fce310f1df3a805f8dd402385b15f857f7f8c62472e3">mbl_logger::WARN</a>) &lt;&lt; <span class="stringliteral">&quot;Infinite loop: Time wasted so far &quot;</span> &lt;&lt; time() &lt;&lt; vcl_endl;
</pre></div><p> Of course, you should just use MBL_LOG which handles this for you. Additionally MBL_LOG sorts out termination of the log message without using vcl_endl, allowing you to send multi-line messages in a single log output.</p>
<p>You can also use the logger to control the dumping of data files straight to the filesystem. </p>
<div class="fragment"><pre class="fragment"> <span class="keywordflow">if</span> (my_log.level() &gt;= <a class="code" href="classmbl__logger.html#a5bb59a9d1fc98f3bc5118fce310f1df3afa32b0c170e0357af3cc47a33eec95b4">mbl_logger::INFO</a> &amp;&amp; my_log.dump())
 {
   vcl_string filename=my_log.dump_prefix()+<span class="stringliteral">&quot;my_image.png&quot;</span>;
   <span class="keywordflow">if</span> (vil_save(my_image, filename.c_str()))
     <a class="code" href="mbl__log_8h.html#a5a0cfdeb6abb82a7054651ef3b5b626a" title="Log a message.">MBL_LOG</a>(INFO, my_log, <span class="stringliteral">&quot;Saved my_image to &quot;</span> &lt;&lt; filename);
   <span class="keywordflow">else</span>
     <a class="code" href="mbl__log_8h.html#a5a0cfdeb6abb82a7054651ef3b5b626a" title="Log a message.">MBL_LOG</a>(ERR, my_log, <span class="stringliteral">&quot;Failed to save my_image to &quot;</span> &lt;&lt; filename);
 }
</pre></div><p>You can find all logger names in all source code in some subtree using the following command: </p>
<div class="fragment"><pre class="fragment">  find . -type f | fgrep -<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__vector_8h.html#a38bf1e5e0427bdeba2b469eea9befc23">v</a> /.svn/ | xargs perl -ne <span class="stringliteral">&#39;print if s/.*\bmbl_logger(\s+\w+)?\s*\(\&quot;(.*)\&quot;\).*/$2\n/;&#39;</span> | sort -u
</pre></div> 
<p>Definition in file <a class="el" href="mbl__log_8h_source.html">mbl_log.h</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="a5a0cfdeb6abb82a7054651ef3b5b626a"></a><!-- doxytag: member="mbl_log.h::MBL_LOG" ref="a5a0cfdeb6abb82a7054651ef3b5b626a" args="(my_level, logger, message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MBL_LOG</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">my_level, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">logger, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">message&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> { <a class="code" href="classmbl__logger.html" title="Main user logging class - represents a category.">mbl_logger</a> &amp;rlogger = <a class="code" href="mbl__progress__hierarchy_8cxx.html#ae452dcdc61acdf66416cc9c36816ccd9">logger</a>; \
    if (rlogger.<a class="code" href="classmbl__logger.html#a3c6d0465fecb06075cbbd7d041acac9d" title="Higher means more output.">level</a>() &gt;= mbl_logger:: my_level) {\
      rlogger.<a class="code" href="classmbl__logger.html#af089fc367217abb1ec42f83ecb9f25e5">mtstart</a>(mbl_logger:: my_level, __FILE__, __LINE__); \
      vcl_ios_fmtflags flags=rlogger.<a class="code" href="classmbl__logger.html#a3aae6aaf4721160f2c997c7153c3e568" title="A log with manual event start and stop requirements.">mtlog</a>().flags(); \
      vcl_streamsize precision=rlogger.<a class="code" href="classmbl__logger.html#a3aae6aaf4721160f2c997c7153c3e568" title="A log with manual event start and stop requirements.">mtlog</a>().precision(); \
      vcl_streamsize width=rlogger.<a class="code" href="classmbl__logger.html#a3aae6aaf4721160f2c997c7153c3e568" title="A log with manual event start and stop requirements.">mtlog</a>().width(); \
      rlogger.mtlog() &lt;&lt; message &lt;&lt; vcl_endl; \
      rlogger.mtlog().width(width); \
      rlogger.mtlog().precision(precision); \
      rlogger.mtlog().flags(flags); \
      rlogger.mtstop(); } \
  } <span class="keywordflow">while</span> (<span class="keyword">false</span>)
</pre></div>
<p>Log a message. </p>
<p>This macro wraps up normal uses of the logger efficiently in source code-length and run-time. </p>
<div class="fragment"><pre class="fragment"> <a class="code" href="mbl__log_8h.html#a5a0cfdeb6abb82a7054651ef3b5b626a" title="Log a message.">MBL_LOG</a>(DEBUG, my_logger, <span class="stringliteral">&quot;time: &quot;</span> &lt;&lt; time() &lt;&lt; <span class="stringliteral">&quot;\nstatus: &quot;</span> &lt;&lt; my_data);
</pre></div><p> No function evaluations (e.g. of time() ) will take place unless the logger is enabled. The logger will also work correctly even if <code>operator&lt;&lt;(my_data_t&amp;)</code> flushes the stream. </p>

<p>Definition at line <a class="el" href="mbl__log_8h_source.html#l00370">370</a> of file <a class="el" href="mbl__log_8h_source.html">mbl_log.h</a>.</p>

</div>
</div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 1 2013 17:33:13 for contrib/mul/mbl by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
