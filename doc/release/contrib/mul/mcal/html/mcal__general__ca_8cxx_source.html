<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>contrib/mul/mcal/mcal_general_ca.cxx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">contrib/mul/mcal/mcal_general_ca.cxx</div>  </div>
</div>
<div class="contents">
<a href="mcal__general__ca_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="mcal__general__ca_8h.html" title="Class to perform general Component Analysis.">mcal_general_ca.h</a>&quot;</span>
<a name="l00002"></a>00002 <span class="comment">//:</span>
<a name="l00003"></a>00003 <span class="comment">// \file</span>
<a name="l00004"></a>00004 <span class="comment">// \author Tim Cootes</span>
<a name="l00005"></a>00005 <span class="comment">// \brief Class to perform general Component Analysis</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;vcl_cstdlib.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;vcl_string.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;vcl_sstream.h&gt;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/vsl__indent_8h.html">vsl/vsl_indent.h</a>&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/mbl__matxvec_8h.html">mbl/mbl_matxvec.h</a>&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;vcl_cmath.h&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;vcl_vector.h&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/vsl__binary__io_8h.html">vsl/vsl_binary_io.h</a>&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/mbl__parse__block_8h.html">mbl/mbl_parse_block.h</a>&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/mbl__read__props_8h.html">mbl/mbl_read_props.h</a>&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;vul/vul_string.h&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/mbl__exception_8h.html">mbl/mbl_exception.h</a>&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__brent__minimizer_8h.html">vnl/algo/vnl_brent_minimizer.h</a>&gt;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment">//=======================================================================</span>
<a name="l00023"></a>00023 <span class="comment">// Constructors</span>
<a name="l00024"></a>00024 <span class="comment">//=======================================================================</span>
<a name="l00025"></a>00025 
<a name="l00026"></a><a class="code" href="classmcal__general__ca.html#a5e4814f0c3c62424f0dc65317483b581">00026</a> <a class="code" href="classmcal__general__ca.html#a5e4814f0c3c62424f0dc65317483b581" title="Dflt ctor.">mcal_general_ca::mcal_general_ca</a>()
<a name="l00027"></a>00027 {
<a name="l00028"></a>00028   <a class="code" href="classmcal__general__ca.html#aa5aaefeb72be09e4af40eb5341706bc0" title="Set parameters to default values.">set_defaults</a>();
<a name="l00029"></a>00029 }
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">//: Initialise, taking clones of supplied objects</span>
<a name="l00032"></a><a class="code" href="classmcal__general__ca.html#ab0170a2fdb964e8d82e6ca4855c62ad2">00032</a> <span class="keywordtype">void</span> <a class="code" href="classmcal__general__ca.html#ab0170a2fdb964e8d82e6ca4855c62ad2" title="Initialise, taking clones of supplied objects.">mcal_general_ca::set</a>(<span class="keyword">const</span> <a class="code" href="classmcal__component__analyzer.html" title="Base for objects which perform some form of linear component analysis.">mcal_component_analyzer</a>&amp; initial_ca,
<a name="l00033"></a>00033                           <span class="keyword">const</span> <a class="code" href="classmcal__single__basis__cost.html" title="Base for objects which compute a cost function for one basis direction.">mcal_single_basis_cost</a>&amp; basis_cost)
<a name="l00034"></a>00034 {
<a name="l00035"></a>00035   <a class="code" href="classmcal__general__ca.html#aa50bb4e82f64f8705e16c1a6e9f1cb10" title="Object to perform initial component analysis (usually PCA).">initial_ca_</a> = <a class="code" href="classmcal__general__ca.html#a8ee46a819b2be1f7e617155e2641cf36" title="Object to perform initial component analysis (usually PCA).">initial_ca</a>;
<a name="l00036"></a>00036   <a class="code" href="classmcal__general__ca.html#a8c73ca7d366e8b0575ffd6e7ead5be7e" title="Object to evaluate component of cost associated with each basis vector.">basis_cost_</a> = <a class="code" href="classmcal__general__ca.html#aab7968c3e506086d55b75d3e9fd42883" title="Object to evaluate component of cost associated with each basis vector.">basis_cost</a>;
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="classmcal__general__ca.html#aa5aaefeb72be09e4af40eb5341706bc0">00039</a> <span class="keywordtype">void</span> <a class="code" href="classmcal__general__ca.html#aa5aaefeb72be09e4af40eb5341706bc0" title="Set parameters to default values.">mcal_general_ca::set_defaults</a>()
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041   <a class="code" href="classmcal__general__ca.html#a2bed075403013ceb5efcc1a63cc41ad5" title="Maximum number of passes during optimisation.">max_passes_</a> = 50;
<a name="l00042"></a>00042   <a class="code" href="classmcal__general__ca.html#a405a7adc34005ec600f3d0833724e964" title="Threshold on angular movement, used to terminate optimisation.">move_thresh_</a>=1e-4;
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="comment">//=======================================================================</span>
<a name="l00046"></a>00046 <span class="comment">// Destructor</span>
<a name="l00047"></a>00047 <span class="comment">//=======================================================================</span>
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="classmcal__general__ca.html#a775205f07eaf8fc418f50e95b774a77e">00049</a> <a class="code" href="classmcal__general__ca.html#a775205f07eaf8fc418f50e95b774a77e" title="Destructor.">mcal_general_ca::~mcal_general_ca</a>()
<a name="l00050"></a>00050 {
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="classmcal__pair__cost1.html">00053</a> <span class="keyword">class </span><a class="code" href="classmcal__pair__cost1.html">mcal_pair_cost1</a> : <span class="keyword">public</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__cost__function.html">vnl_cost_function</a>
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055  <span class="keyword">private</span>:
<a name="l00056"></a><a class="code" href="classmcal__pair__cost1.html#a4fa8a3bd18f120b36521b6df939152f1">00056</a>   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; <a class="code" href="classmcal__pair__cost1.html#a4fa8a3bd18f120b36521b6df939152f1">proj1_</a>;
<a name="l00057"></a><a class="code" href="classmcal__pair__cost1.html#a461bfd48e1d85b853d7b450d80779b60">00057</a>   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; <a class="code" href="classmcal__pair__cost1.html#a461bfd48e1d85b853d7b450d80779b60">proj2_</a>;
<a name="l00058"></a><a class="code" href="classmcal__pair__cost1.html#a682afc5a81b8200dcd8a2006e6059361">00058</a>   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; <a class="code" href="classmcal__pair__cost1.html#a682afc5a81b8200dcd8a2006e6059361">mode1_</a>;
<a name="l00059"></a><a class="code" href="classmcal__pair__cost1.html#a42261d961635c8891c2ccf08ec884055">00059</a>   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; <a class="code" href="classmcal__pair__cost1.html#a42261d961635c8891c2ccf08ec884055">mode2_</a>;
<a name="l00060"></a><a class="code" href="classmcal__pair__cost1.html#a40b72a563eac33a2208687be9c7acc69">00060</a>   <a class="code" href="classmcal__single__basis__cost.html" title="Base for objects which compute a cost function for one basis direction.">mcal_single_basis_cost</a>&amp; <a class="code" href="classmcal__pair__cost1.html#a40b72a563eac33a2208687be9c7acc69">cost_</a>;
<a name="l00061"></a><a class="code" href="classmcal__pair__cost1.html#a1e01fd2d53b655e1a1148a98191293d3">00061</a>   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> <a class="code" href="classmcal__pair__cost1.html#a3c814aa18333e7f62eeea7ec2b98f555">p1</a>,<a class="code" href="classmcal__pair__cost1.html#a1e01fd2d53b655e1a1148a98191293d3">p2</a>,<a class="code" href="classmcal__pair__cost1.html#ab5cbb3b62f2576c51f264080c2fbab89">m1</a>,<a class="code" href="classmcal__pair__cost1.html#a27d98c34606d9a69eabe8e12d260301b">m2</a>;
<a name="l00062"></a>00062  <span class="keyword">public</span>:
<a name="l00063"></a><a class="code" href="classmcal__pair__cost1.html#ad71512b4dcab1798c46a8c4ae2568447">00063</a>   <a class="code" href="classmcal__pair__cost1.html#ad71512b4dcab1798c46a8c4ae2568447">mcal_pair_cost1</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; proj1,
<a name="l00064"></a>00064                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; proj2,
<a name="l00065"></a>00065                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode1,
<a name="l00066"></a>00066                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode2,
<a name="l00067"></a>00067                   <a class="code" href="classmcal__single__basis__cost.html" title="Base for objects which compute a cost function for one basis direction.">mcal_single_basis_cost</a>&amp; cost)
<a name="l00068"></a>00068   : <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__cost__function.html">vnl_cost_function</a>(1), <a class="code" href="classmcal__pair__cost1.html#a4fa8a3bd18f120b36521b6df939152f1">proj1_</a>(proj1),<a class="code" href="classmcal__pair__cost1.html#a461bfd48e1d85b853d7b450d80779b60">proj2_</a>(proj2),<a class="code" href="classmcal__pair__cost1.html#a682afc5a81b8200dcd8a2006e6059361">mode1_</a>(mode1),<a class="code" href="classmcal__pair__cost1.html#a42261d961635c8891c2ccf08ec884055">mode2_</a>(mode2),<a class="code" href="classmcal__pair__cost1.html#a40b72a563eac33a2208687be9c7acc69">cost_</a>(cost) {}
<a name="l00069"></a>00069 
<a name="l00070"></a>00070   <span class="keywordtype">double</span> <a class="code" href="classmcal__pair__cost1.html#aeb3b8bcbf73301f81ea3a338dd7ec560">f</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; x);
<a name="l00071"></a>00071 };
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="classmcal__pair__cost1.html#aeb3b8bcbf73301f81ea3a338dd7ec560">00073</a> <span class="keywordtype">double</span> <a class="code" href="classmcal__pair__cost1.html#aeb3b8bcbf73301f81ea3a338dd7ec560">mcal_pair_cost1::f</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; x)
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075   <span class="keywordtype">double</span> sinA = vcl_sin(x[0]);
<a name="l00076"></a>00076   <span class="keywordtype">double</span> cosA = vcl_cos(x[0]);
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   <span class="comment">// Rotate axes by A=x[0]</span>
<a name="l00079"></a>00079   <a class="code" href="classmcal__pair__cost1.html#ab5cbb3b62f2576c51f264080c2fbab89">m1</a> = cosA*<a class="code" href="classmcal__pair__cost1.html#a682afc5a81b8200dcd8a2006e6059361">mode1_</a> + sinA*<a class="code" href="classmcal__pair__cost1.html#a42261d961635c8891c2ccf08ec884055">mode2_</a>;
<a name="l00080"></a>00080   <a class="code" href="classmcal__pair__cost1.html#a27d98c34606d9a69eabe8e12d260301b">m2</a> = cosA*mode2_ - sinA*<a class="code" href="classmcal__pair__cost1.html#a682afc5a81b8200dcd8a2006e6059361">mode1_</a>;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <span class="comment">// Rotate projections equivalently</span>
<a name="l00083"></a>00083   <a class="code" href="classmcal__pair__cost1.html#a3c814aa18333e7f62eeea7ec2b98f555">p1</a> = cosA*<a class="code" href="classmcal__pair__cost1.html#a4fa8a3bd18f120b36521b6df939152f1">proj1_</a> + sinA*<a class="code" href="classmcal__pair__cost1.html#a461bfd48e1d85b853d7b450d80779b60">proj2_</a>;
<a name="l00084"></a>00084   <a class="code" href="classmcal__pair__cost1.html#a1e01fd2d53b655e1a1148a98191293d3">p2</a> = cosA*proj2_ - sinA*<a class="code" href="classmcal__pair__cost1.html#a4fa8a3bd18f120b36521b6df939152f1">proj1_</a>;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086   <span class="keywordtype">double</span> sum = <a class="code" href="classmcal__pair__cost1.html#a40b72a563eac33a2208687be9c7acc69">cost_</a>.<a class="code" href="classmcal__single__basis__cost.html#ad232c960484766a457ba116a09140d1e" title="Compute component of the cost function from given basis vector.">cost</a>(<a class="code" href="classmcal__pair__cost1.html#ab5cbb3b62f2576c51f264080c2fbab89">m1</a>,<a class="code" href="classmcal__pair__cost1.html#a3c814aa18333e7f62eeea7ec2b98f555">p1</a>) + <a class="code" href="classmcal__pair__cost1.html#a40b72a563eac33a2208687be9c7acc69">cost_</a>.<a class="code" href="classmcal__single__basis__cost.html#ad232c960484766a457ba116a09140d1e" title="Compute component of the cost function from given basis vector.">cost</a>(<a class="code" href="classmcal__pair__cost1.html#a27d98c34606d9a69eabe8e12d260301b">m2</a>,<a class="code" href="classmcal__pair__cost1.html#a1e01fd2d53b655e1a1148a98191293d3">p2</a>);
<a name="l00087"></a>00087   <span class="keywordflow">return</span> sum;
<a name="l00088"></a>00088 }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="comment">//: Cost, assuming it can be evaluated from variance of projection</span>
<a name="l00091"></a><a class="code" href="classmcal__pair__cost2.html">00091</a> <span class="keyword">class </span><a class="code" href="classmcal__pair__cost2.html" title="Cost, assuming it can be evaluated from variance of projection.">mcal_pair_cost2</a> : <span class="keyword">public</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__cost__function.html">vnl_cost_function</a>
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093  <span class="keyword">private</span>:
<a name="l00094"></a><a class="code" href="classmcal__pair__cost2.html#ad19422966a7ca29dce543f17fd1dd5c6">00094</a>   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> <a class="code" href="classmcal__pair__cost2.html#ad19422966a7ca29dce543f17fd1dd5c6">S_</a>;
<a name="l00095"></a><a class="code" href="classmcal__pair__cost2.html#aae7bd3b096b94708ad7e83aa8b35ca6f">00095</a>   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; <a class="code" href="classmcal__pair__cost2.html#aae7bd3b096b94708ad7e83aa8b35ca6f">mode1_</a>;
<a name="l00096"></a><a class="code" href="classmcal__pair__cost2.html#a2fd5292e9b6682c3ddb27bb5e765d11a">00096</a>   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; <a class="code" href="classmcal__pair__cost2.html#a2fd5292e9b6682c3ddb27bb5e765d11a">mode2_</a>;
<a name="l00097"></a><a class="code" href="classmcal__pair__cost2.html#a1d6d3f36a847d7ba185316d841bef090">00097</a>   <a class="code" href="classmcal__single__basis__cost.html" title="Base for objects which compute a cost function for one basis direction.">mcal_single_basis_cost</a>&amp; <a class="code" href="classmcal__pair__cost2.html#a1d6d3f36a847d7ba185316d841bef090">cost_</a>;
<a name="l00098"></a><a class="code" href="classmcal__pair__cost2.html#a0088f4c59c958b5ae2033852d0742380">00098</a>   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> <a class="code" href="classmcal__pair__cost2.html#a1acffe218bf43ff24d3234a3b3c20dc1">m1</a>,<a class="code" href="classmcal__pair__cost2.html#a0088f4c59c958b5ae2033852d0742380">m2</a>;
<a name="l00099"></a>00099  <span class="keyword">public</span>:
<a name="l00100"></a><a class="code" href="classmcal__pair__cost2.html#a00288a34978f22a738b85a369a168d14">00100</a>   <a class="code" href="classmcal__pair__cost2.html#a00288a34978f22a738b85a369a168d14">mcal_pair_cost2</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; S,
<a name="l00101"></a>00101                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode1,
<a name="l00102"></a>00102                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode2,
<a name="l00103"></a>00103                   <a class="code" href="classmcal__single__basis__cost.html" title="Base for objects which compute a cost function for one basis direction.">mcal_single_basis_cost</a>&amp; cost)
<a name="l00104"></a>00104   : <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__cost__function.html">vnl_cost_function</a>(1), <a class="code" href="classmcal__pair__cost2.html#ad19422966a7ca29dce543f17fd1dd5c6">S_</a>(S),
<a name="l00105"></a>00105     <a class="code" href="classmcal__pair__cost2.html#aae7bd3b096b94708ad7e83aa8b35ca6f">mode1_</a>(mode1),<a class="code" href="classmcal__pair__cost2.html#a2fd5292e9b6682c3ddb27bb5e765d11a">mode2_</a>(mode2),<a class="code" href="classmcal__pair__cost2.html#a1d6d3f36a847d7ba185316d841bef090">cost_</a>(cost) {}
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <a class="code" href="classmcal__pair__cost2.html#a00288a34978f22a738b85a369a168d14">mcal_pair_cost2</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; proj1,
<a name="l00108"></a>00108                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; proj2,
<a name="l00109"></a>00109                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode1,
<a name="l00110"></a>00110                   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode2,
<a name="l00111"></a>00111                   <a class="code" href="classmcal__single__basis__cost.html" title="Base for objects which compute a cost function for one basis direction.">mcal_single_basis_cost</a>&amp; cost);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   <span class="keywordtype">double</span> <a class="code" href="classmcal__pair__cost2.html#abae93a6a6bbf5e7268089585e59222da">f</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; x);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115   <span class="keywordtype">void</span> <a class="code" href="classmcal__pair__cost2.html#aa6b6804038f73a0798f30f5474b6b722">covar</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; p1,
<a name="l00116"></a>00116              <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; p2,
<a name="l00117"></a>00117              <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; S);
<a name="l00118"></a>00118 };
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="classmcal__pair__cost2.html#a590fc2ab005390dfc143fb3ed2013dfe">00120</a> <a class="code" href="classmcal__pair__cost2.html#a00288a34978f22a738b85a369a168d14">mcal_pair_cost2::mcal_pair_cost2</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; proj1,
<a name="l00121"></a>00121                                  <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; proj2,
<a name="l00122"></a>00122                                  <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode1,
<a name="l00123"></a>00123                                  <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode2,
<a name="l00124"></a>00124                                  <a class="code" href="classmcal__single__basis__cost.html" title="Base for objects which compute a cost function for one basis direction.">mcal_single_basis_cost</a>&amp; cost)
<a name="l00125"></a>00125   : <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__cost__function.html">vnl_cost_function</a>(1),mode1_(mode1),mode2_(mode2),cost_(cost)
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127   <a class="code" href="classmcal__pair__cost2.html#aa6b6804038f73a0798f30f5474b6b722">covar</a>(proj1,proj2,<a class="code" href="classmcal__pair__cost2.html#ad19422966a7ca29dce543f17fd1dd5c6">S_</a>);
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="classmcal__pair__cost2.html#abae93a6a6bbf5e7268089585e59222da">00131</a> <span class="keywordtype">double</span> <a class="code" href="classmcal__pair__cost2.html#abae93a6a6bbf5e7268089585e59222da">mcal_pair_cost2::f</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; x)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133   <span class="keywordtype">double</span> sinA = vcl_sin(x[0]);
<a name="l00134"></a>00134   <span class="keywordtype">double</span> cosA = vcl_cos(x[0]);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136   <span class="comment">// Rotate axes by A=x[0]</span>
<a name="l00137"></a>00137   <a class="code" href="classmcal__pair__cost2.html#a1acffe218bf43ff24d3234a3b3c20dc1">m1</a> = cosA*<a class="code" href="classmcal__pair__cost2.html#aae7bd3b096b94708ad7e83aa8b35ca6f">mode1_</a> + sinA*<a class="code" href="classmcal__pair__cost2.html#a2fd5292e9b6682c3ddb27bb5e765d11a">mode2_</a>;
<a name="l00138"></a>00138   <a class="code" href="classmcal__pair__cost2.html#a0088f4c59c958b5ae2033852d0742380">m2</a> = cosA*mode2_ - sinA*<a class="code" href="classmcal__pair__cost2.html#aae7bd3b096b94708ad7e83aa8b35ca6f">mode1_</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140   <span class="comment">// Rotate covariance equivalently</span>
<a name="l00141"></a>00141   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> R(2,2);
<a name="l00142"></a>00142   R(0,0)=cosA;  R(0,1) = sinA;
<a name="l00143"></a>00143   R(1,0)=-sinA; R(1,1) = cosA;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a> SA = R*<a class="code" href="classmcal__pair__cost2.html#ad19422966a7ca29dce543f17fd1dd5c6">S_</a>*R.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4ecdc9960874f4c3c4f01dd194305a5f">transpose</a>();
<a name="l00146"></a>00146 
<a name="l00147"></a>00147   <span class="keywordtype">double</span> c1 = <a class="code" href="classmcal__pair__cost2.html#a1d6d3f36a847d7ba185316d841bef090">cost_</a>.<a class="code" href="classmcal__single__basis__cost.html#a2f9c52e3a0a0bcfa52a6329232510b15" title="Compute component of the cost function from given basis vector.">cost_from_variance</a>(<a class="code" href="classmcal__pair__cost2.html#a1acffe218bf43ff24d3234a3b3c20dc1">m1</a>,SA(0,0));
<a name="l00148"></a>00148   <span class="keywordtype">double</span> c2 = <a class="code" href="classmcal__pair__cost2.html#a1d6d3f36a847d7ba185316d841bef090">cost_</a>.<a class="code" href="classmcal__single__basis__cost.html#a2f9c52e3a0a0bcfa52a6329232510b15" title="Compute component of the cost function from given basis vector.">cost_from_variance</a>(<a class="code" href="classmcal__pair__cost2.html#a0088f4c59c958b5ae2033852d0742380">m2</a>,SA(1,1));
<a name="l00149"></a>00149   <span class="keywordflow">return</span> c1+c2;
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="classmcal__pair__cost2.html#aa6b6804038f73a0798f30f5474b6b722">00152</a> <span class="keywordtype">void</span> <a class="code" href="classmcal__pair__cost2.html#aa6b6804038f73a0798f30f5474b6b722">mcal_pair_cost2::covar</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; p1,
<a name="l00153"></a>00153                             <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; p2,
<a name="l00154"></a>00154                             <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; S)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156   S.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a1fa1949e6219d0db6e3ad50a32d7e1e0">set_size</a>(2,2);
<a name="l00157"></a>00157   S(0,0) = <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__matrix_8h.html#a3a6406941c788eaae99974a3c8b58cee">dot_product</a>(p1,p1)/p1.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#a11191c91a1dbb4e1d8423dad8b110712">size</a>();
<a name="l00158"></a>00158   S(1,1) = <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__matrix_8h.html#a3a6406941c788eaae99974a3c8b58cee">dot_product</a>(p2,p2)/p1.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#a11191c91a1dbb4e1d8423dad8b110712">size</a>();
<a name="l00159"></a>00159   S(0,1) = <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/vnl__matrix_8h.html#a3a6406941c788eaae99974a3c8b58cee">dot_product</a>(p1,p2)/p1.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#a11191c91a1dbb4e1d8423dad8b110712">size</a>();
<a name="l00160"></a>00160   S(1,0) = S(0,1);
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 <span class="comment">//: Optimise the mode vectors so as to minimise the cost function</span>
<a name="l00165"></a><a class="code" href="classmcal__general__ca.html#a688e58250c85044272405fc82e34f90b">00165</a> <span class="keywordtype">double</span> <a class="code" href="classmcal__general__ca.html#a688e58250c85044272405fc82e34f90b" title="Optimise the mode vectors so as to minimise the cost function.">mcal_general_ca::optimise_mode_pair</a>(<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; proj1,
<a name="l00166"></a>00166                                            <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; proj2,
<a name="l00167"></a>00167                                            <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode1,
<a name="l00168"></a>00168                                            <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode2)
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__cost__function.html">vnl_cost_function</a> *cost_fn;
<a name="l00171"></a>00171   <span class="keywordflow">if</span> (<a class="code" href="classmcal__general__ca.html#aab7968c3e506086d55b75d3e9fd42883" title="Object to evaluate component of cost associated with each basis vector.">basis_cost</a>().can_use_variance())
<a name="l00172"></a>00172   {
<a name="l00173"></a>00173     <span class="comment">// Use more efficient cost evaluation</span>
<a name="l00174"></a>00174     cost_fn = <span class="keyword">new</span> <a class="code" href="classmcal__pair__cost2.html" title="Cost, assuming it can be evaluated from variance of projection.">mcal_pair_cost2</a>(proj1,proj2,mode1,mode2,<a class="code" href="classmcal__general__ca.html#aab7968c3e506086d55b75d3e9fd42883" title="Object to evaluate component of cost associated with each basis vector.">basis_cost</a>());
<a name="l00175"></a>00175   }
<a name="l00176"></a>00176   <span class="keywordflow">else</span>
<a name="l00177"></a>00177   {
<a name="l00178"></a>00178     <span class="comment">// Use cost which explicitly rotates projection data</span>
<a name="l00179"></a>00179     cost_fn = <span class="keyword">new</span> <a class="code" href="classmcal__pair__cost1.html">mcal_pair_cost1</a>(proj1,proj2,mode1,mode2,<a class="code" href="classmcal__general__ca.html#aab7968c3e506086d55b75d3e9fd42883" title="Object to evaluate component of cost associated with each basis vector.">basis_cost</a>());
<a name="l00180"></a>00180   }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__brent__minimizer.html">vnl_brent_minimizer</a> brent1(*cost_fn);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="comment">// Note that rotation should be in range [0,pi/2)</span>
<a name="l00185"></a>00185   <span class="comment">// There is fourfold cyclic symmetry - cost(A)==cost(A+pi/2)</span>
<a name="l00186"></a>00186   <span class="comment">// We could perform an initial exhaustive search, then use</span>
<a name="l00187"></a>00187   <span class="comment">// A=minimize_given_bounds(a,b,c)</span>
<a name="l00188"></a>00188   <span class="keywordtype">double</span> A = brent1.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__brent__minimizer.html#afac30be38d0a9f777968cfbc24713cc7">minimize</a>(0.0);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190   <span class="comment">// Tidy up</span>
<a name="l00191"></a>00191   <span class="keyword">delete</span> cost_fn;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <span class="keywordflow">if</span> (A==0.0) <span class="keywordflow">return</span> 0.0;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="comment">// Apply rotation</span>
<a name="l00196"></a>00196   <span class="keywordtype">double</span> sinA = vcl_sin(A);
<a name="l00197"></a>00197   <span class="keywordtype">double</span> cosA = vcl_cos(A);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> m1=mode1,m2=mode2;
<a name="l00200"></a>00200   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> p1=proj1,p2=proj2;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="comment">// Rotate axes by A=x[0]</span>
<a name="l00203"></a>00203   mode1 = cosA*m1 + sinA*m2;
<a name="l00204"></a>00204   mode2 = cosA*m2 - sinA*m1;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   <span class="comment">// Rotate projections equivalently</span>
<a name="l00207"></a>00207   proj1 = cosA*p1 + sinA*p2;
<a name="l00208"></a>00208   proj2 = cosA*p2 - sinA*p1;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210   <span class="keywordflow">return</span> vcl_fabs(A);
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="comment">//: Optimise the mode vectors so as to minimise the cost function</span>
<a name="l00214"></a><a class="code" href="classmcal__general__ca.html#aa44a3a6bee9890e72cc0e8038e673c89">00214</a> <span class="keywordtype">double</span> <a class="code" href="classmcal__general__ca.html#aa44a3a6bee9890e72cc0e8038e673c89" title="Optimise the mode vectors so as to minimise the cost function.">mcal_general_ca::optimise_one_pass</a>(vcl_vector&lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> &gt;&amp; proj,
<a name="l00215"></a>00215                                           <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; modes)
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217   <span class="keywordtype">unsigned</span> n_modes = modes.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>();
<a name="l00218"></a>00218   <span class="keywordtype">double</span> move_sum=0.0;
<a name="l00219"></a>00219   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=1;i&lt;n_modes;++i)
<a name="l00220"></a>00220   {
<a name="l00221"></a>00221     <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> mode1 = modes.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a381354e34437c46e90bc636d246d86ce">get_column</a>(i);
<a name="l00222"></a>00222     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;i;++j)
<a name="l00223"></a>00223     {
<a name="l00224"></a>00224       <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> mode2 = modes.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a381354e34437c46e90bc636d246d86ce">get_column</a>(j);
<a name="l00225"></a>00225       move_sum += <a class="code" href="classmcal__general__ca.html#a688e58250c85044272405fc82e34f90b" title="Optimise the mode vectors so as to minimise the cost function.">optimise_mode_pair</a>(proj[i],proj[j],mode1,mode2);
<a name="l00226"></a>00226       modes.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#abe844803572d5640c760689ccbbbc1a7">set_column</a>(j,mode2);
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228     modes.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#abe844803572d5640c760689ccbbbc1a7">set_column</a>(i,mode1);
<a name="l00229"></a>00229   }
<a name="l00230"></a>00230   <span class="keywordflow">return</span> move_sum;
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="comment">//: Compute projections onto each mode</span>
<a name="l00234"></a>00234 <span class="comment">//  proj[j][i] is the projection of the i-th data sample onto the j-th mode</span>
<a name="l00235"></a><a class="code" href="classmcal__general__ca.html#afd025edf813c5598e1855002a0f62c92">00235</a> <span class="keywordtype">void</span> <a class="code" href="classmcal__general__ca.html#afd025edf813c5598e1855002a0f62c92" title="Compute projections onto each mode.">mcal_general_ca::compute_projections</a>(<a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/classmbl__data__wrapper.html">mbl_data_wrapper</a>&lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> &gt;&amp; data,
<a name="l00236"></a>00236                                           <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mean,
<a name="l00237"></a>00237                                           <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; modes,
<a name="l00238"></a>00238                                           vcl_vector&lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> &gt;&amp; proj)
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240   <span class="comment">// Compute projection of data onto each mode</span>
<a name="l00241"></a>00241   <span class="keywordtype">unsigned</span> n_modes = modes.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a4d3c7b58bf1dd7325262a2f6e4e57867">cols</a>();
<a name="l00242"></a>00242   <span class="keywordtype">unsigned</span> n_egs   = data.size();
<a name="l00243"></a>00243   proj.resize(n_modes);
<a name="l00244"></a>00244   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;n_modes;++j) { proj[j].set_size(n_egs); }
<a name="l00245"></a>00245   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> b(n_modes);
<a name="l00246"></a>00246   <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> dx;
<a name="l00247"></a>00247   data.reset();
<a name="l00248"></a>00248   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;n_egs;++i,data.next())
<a name="l00249"></a>00249   {
<a name="l00250"></a>00250     dx=data.current()-mean;
<a name="l00251"></a>00251     <a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/mbl__matxvec_8cxx.html#a8223fab010bcf1a70ace8af4c8bc55af">mbl_matxvec_prod_vm</a>(dx,modes,b);
<a name="l00252"></a>00252     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;n_modes;++j) proj[j][i]=b[j];
<a name="l00253"></a>00253   }
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">//: Optimise the mode vectors so as to minimise the cost function</span>
<a name="l00257"></a><a class="code" href="classmcal__general__ca.html#a616f1a3526affd6daea2fdd292155712">00257</a> <span class="keywordtype">void</span> <a class="code" href="classmcal__general__ca.html#a616f1a3526affd6daea2fdd292155712" title="Optimise the mode vectors so as to minimise the cost function.">mcal_general_ca::optimise_about_mean</a>(<a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/classmbl__data__wrapper.html">mbl_data_wrapper</a>&lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> &gt;&amp; data,
<a name="l00258"></a>00258                                           <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mean,
<a name="l00259"></a>00259                                           <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; modes,
<a name="l00260"></a>00260                                           <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode_var)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262   <span class="comment">// Compute projection of data onto each mode</span>
<a name="l00263"></a>00263   <span class="keywordtype">unsigned</span> n_modes = mode_var.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#a11191c91a1dbb4e1d8423dad8b110712">size</a>();
<a name="l00264"></a>00264   <span class="keywordtype">unsigned</span> n_egs   = data.size();
<a name="l00265"></a>00265   vcl_vector&lt;vnl_vector&lt;double&gt; &gt; proj(n_modes);
<a name="l00266"></a>00266   <a class="code" href="classmcal__general__ca.html#afd025edf813c5598e1855002a0f62c92" title="Compute projections onto each mode.">compute_projections</a>(data,mean,modes,proj);
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   <span class="comment">// Perform multiple passes</span>
<a name="l00269"></a>00269   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;<a class="code" href="classmcal__general__ca.html#a2bed075403013ceb5efcc1a63cc41ad5" title="Maximum number of passes during optimisation.">max_passes_</a>;++i)
<a name="l00270"></a>00270   {
<a name="l00271"></a>00271     <span class="keywordflow">if</span> (<a class="code" href="classmcal__general__ca.html#aa44a3a6bee9890e72cc0e8038e673c89" title="Optimise the mode vectors so as to minimise the cost function.">optimise_one_pass</a>(proj,modes)&lt;<a class="code" href="classmcal__general__ca.html#a405a7adc34005ec600f3d0833724e964" title="Threshold on angular movement, used to terminate optimisation.">move_thresh_</a>) <span class="keywordflow">break</span>;
<a name="l00272"></a>00272   }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274   <span class="comment">// Compute the variances on each mode</span>
<a name="l00275"></a>00275   <a class="code" href="classmcal__general__ca.html#afd025edf813c5598e1855002a0f62c92" title="Compute projections onto each mode.">compute_projections</a>(data,mean,modes,proj);
<a name="l00276"></a>00276   mode_var.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#ae34b3cfb08e104f2ac81a74dc91537cc">set_size</a>(n_modes);
<a name="l00277"></a>00277   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;n_modes;++j)
<a name="l00278"></a>00278     mode_var[j]=proj[j].squared_magnitude()/n_egs;
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="comment">//: Compute modes of the supplied data relative to the supplied mean</span>
<a name="l00282"></a>00282 <span class="comment">//  Model is x = mean + modes*b,  where b is a vector of weights on each mode.</span>
<a name="l00283"></a>00283 <span class="comment">//  mode_var[i] gives the variance of the data projected onto that mode.</span>
<a name="l00284"></a><a class="code" href="classmcal__general__ca.html#a8920681f191110867180e9c652154e65">00284</a> <span class="keywordtype">void</span> <a class="code" href="classmcal__general__ca.html#a8920681f191110867180e9c652154e65" title="Compute modes of the supplied data relative to the supplied mean.">mcal_general_ca::build_about_mean</a>(<a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/classmbl__data__wrapper.html">mbl_data_wrapper</a>&lt;<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a> &gt;&amp; data,
<a name="l00285"></a>00285                                        <span class="keyword">const</span> <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mean,
<a name="l00286"></a>00286                                        <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html">vnl_matrix&lt;double&gt;</a>&amp; modes,
<a name="l00287"></a>00287                                        <a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;double&gt;</a>&amp; mode_var)
<a name="l00288"></a>00288 {
<a name="l00289"></a>00289   <span class="keywordflow">if</span> (data.size()==0)
<a name="l00290"></a>00290   {
<a name="l00291"></a>00291     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;mcal_general_ca::build_about_mean() No samples supplied.\n&quot;</span>;
<a name="l00292"></a>00292     vcl_abort();
<a name="l00293"></a>00293   }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   data.reset();
<a name="l00296"></a>00296 
<a name="l00297"></a>00297   <span class="keywordflow">if</span> (data.current().size()==0)
<a name="l00298"></a>00298   {
<a name="l00299"></a>00299     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;mcal_general_ca::build_about_mean()\n&quot;</span>
<a name="l00300"></a>00300             &lt;&lt;<span class="stringliteral">&quot;Warning: Samples claim to have zero dimensions.\n&quot;</span>
<a name="l00301"></a>00301             &lt;&lt;<span class="stringliteral">&quot;Constructing empty model.\n&quot;</span>;
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     modes.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__matrix.html#a1fa1949e6219d0db6e3ad50a32d7e1e0">set_size</a>(0,0);
<a name="l00304"></a>00304     mode_var.<a class="codeRef" doxygen="core_vnl.tag:../../../../core/vnl/html" href="../../../../core/vnl/html/classvnl__vector.html#ae34b3cfb08e104f2ac81a74dc91537cc">set_size</a>(0);
<a name="l00305"></a>00305     <span class="keywordflow">return</span>;
<a name="l00306"></a>00306   }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   <span class="comment">// Compute initial approximation</span>
<a name="l00309"></a>00309   <a class="code" href="classmcal__general__ca.html#a8ee46a819b2be1f7e617155e2641cf36" title="Object to perform initial component analysis (usually PCA).">initial_ca</a>().<a class="code" href="classmcal__component__analyzer.html#ad999c5fef5cab715d2f9e166da239e88" title="Compute modes of the supplied data relative to the supplied mean.">build_about_mean</a>(data,mean,modes,mode_var);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311   <span class="comment">// Now perform optimisation</span>
<a name="l00312"></a>00312   <a class="code" href="classmcal__general__ca.html#a616f1a3526affd6daea2fdd292155712" title="Optimise the mode vectors so as to minimise the cost function.">optimise_about_mean</a>(data,mean,modes,mode_var);
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="comment">//=======================================================================</span>
<a name="l00317"></a>00317 <span class="comment">// Method: is_a</span>
<a name="l00318"></a>00318 <span class="comment">//=======================================================================</span>
<a name="l00319"></a>00319 
<a name="l00320"></a><a class="code" href="classmcal__general__ca.html#afabc62ba3efb5bfbcf9b77c2fb406110">00320</a> vcl_string  <a class="code" href="classmcal__general__ca.html#afabc62ba3efb5bfbcf9b77c2fb406110" title="Name of the class.">mcal_general_ca::is_a</a>()<span class="keyword"> const</span>
<a name="l00321"></a>00321 <span class="keyword"></span>{
<a name="l00322"></a>00322   <span class="keywordflow">return</span> vcl_string(<span class="stringliteral">&quot;mcal_general_ca&quot;</span>);
<a name="l00323"></a>00323 }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="comment">//=======================================================================</span>
<a name="l00326"></a>00326 <span class="comment">// Method: version_no</span>
<a name="l00327"></a>00327 <span class="comment">//=======================================================================</span>
<a name="l00328"></a>00328 
<a name="l00329"></a><a class="code" href="classmcal__general__ca.html#ac311b24bc0b163bbb89d8cfad0495fed">00329</a> <span class="keywordtype">short</span> <a class="code" href="classmcal__general__ca.html#ac311b24bc0b163bbb89d8cfad0495fed" title="Version number for I/O.">mcal_general_ca::version_no</a>()<span class="keyword"> const</span>
<a name="l00330"></a>00330 <span class="keyword"></span>{
<a name="l00331"></a>00331   <span class="keywordflow">return</span> 1;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="comment">//=======================================================================</span>
<a name="l00335"></a>00335 <span class="comment">// Method: clone</span>
<a name="l00336"></a>00336 <span class="comment">//=======================================================================</span>
<a name="l00337"></a>00337 
<a name="l00338"></a><a class="code" href="classmcal__general__ca.html#a9d26d67c131a1ffeab39f7fd0b8e23f7">00338</a> <a class="code" href="classmcal__component__analyzer.html" title="Base for objects which perform some form of linear component analysis.">mcal_component_analyzer</a>* <a class="code" href="classmcal__general__ca.html#a9d26d67c131a1ffeab39f7fd0b8e23f7" title="Create a copy on the heap and return base class pointer.">mcal_general_ca::clone</a>()<span class="keyword"> const</span>
<a name="l00339"></a>00339 <span class="keyword"></span>{
<a name="l00340"></a>00340   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classmcal__general__ca.html#a5e4814f0c3c62424f0dc65317483b581" title="Dflt ctor.">mcal_general_ca</a>(*<span class="keyword">this</span>);
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 <span class="comment">//=======================================================================</span>
<a name="l00344"></a>00344 <span class="comment">// Method: print</span>
<a name="l00345"></a>00345 <span class="comment">//=======================================================================</span>
<a name="l00346"></a>00346 
<a name="l00347"></a><a class="code" href="classmcal__general__ca.html#a23362f4c941271c30b4b6096e7de80ee">00347</a> <span class="keywordtype">void</span> <a class="code" href="classmcal__general__ca.html#a23362f4c941271c30b4b6096e7de80ee" title="Print class to os.">mcal_general_ca::print_summary</a>(vcl_ostream&amp; os)<span class="keyword"> const</span>
<a name="l00348"></a>00348 <span class="keyword"></span>{
<a name="l00349"></a>00349   <a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/vsl__indent_8cxx.html#a7752e120d8c66b368d428e1e3313662f">vsl_indent_inc</a>(os);
<a name="l00350"></a>00350   os&lt;&lt;<span class="stringliteral">&quot;{\n&quot;</span>
<a name="l00351"></a>00351     &lt;&lt;<a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/classvsl__indent.html">vsl_indent</a>()&lt;&lt;<span class="stringliteral">&quot;initial_ca: &quot;</span>&lt;&lt;<a class="code" href="classmcal__general__ca.html#aa50bb4e82f64f8705e16c1a6e9f1cb10" title="Object to perform initial component analysis (usually PCA).">initial_ca_</a>&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00352"></a>00352     &lt;&lt;<a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/classvsl__indent.html">vsl_indent</a>()&lt;&lt;<span class="stringliteral">&quot;basis_cost: &quot;</span>&lt;&lt;<a class="code" href="classmcal__general__ca.html#a8c73ca7d366e8b0575ffd6e7ead5be7e" title="Object to evaluate component of cost associated with each basis vector.">basis_cost_</a>&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00353"></a>00353     &lt;&lt;<a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/classvsl__indent.html">vsl_indent</a>()&lt;&lt;<span class="stringliteral">&quot;} &quot;</span>;
<a name="l00354"></a>00354   <a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/vsl__indent_8cxx.html#aabb0c2ec398423f6815a3b3ebc8f978b">vsl_indent_dec</a>(os);
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 <span class="comment">//=======================================================================</span>
<a name="l00358"></a>00358 <span class="comment">// Method: save</span>
<a name="l00359"></a>00359 <span class="comment">//=======================================================================</span>
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="classmcal__general__ca.html#a26eecde49b77120b01e57ff9bcd0e90c">00361</a> <span class="keywordtype">void</span> <a class="code" href="classmcal__general__ca.html#a26eecde49b77120b01e57ff9bcd0e90c" title="Save class to binary file stream.">mcal_general_ca::b_write</a>(<a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/classvsl__b__ostream.html">vsl_b_ostream</a>&amp; bfs)<span class="keyword"> const</span>
<a name="l00362"></a>00362 <span class="keyword"></span>{
<a name="l00363"></a>00363   <a class="code" href="mcal__component__analyzer_8cxx.html#a40ebc3f47ba20185c11039977923d9bc" title="Binary file stream output operator for class reference.">vsl_b_write</a>(bfs,<a class="code" href="classmcal__general__ca.html#ac311b24bc0b163bbb89d8cfad0495fed" title="Version number for I/O.">version_no</a>());
<a name="l00364"></a>00364   <a class="code" href="mcal__component__analyzer_8cxx.html#a40ebc3f47ba20185c11039977923d9bc" title="Binary file stream output operator for class reference.">vsl_b_write</a>(bfs,<a class="code" href="classmcal__general__ca.html#aa50bb4e82f64f8705e16c1a6e9f1cb10" title="Object to perform initial component analysis (usually PCA).">initial_ca_</a>);
<a name="l00365"></a>00365   <a class="code" href="mcal__component__analyzer_8cxx.html#a40ebc3f47ba20185c11039977923d9bc" title="Binary file stream output operator for class reference.">vsl_b_write</a>(bfs,<a class="code" href="classmcal__general__ca.html#a8c73ca7d366e8b0575ffd6e7ead5be7e" title="Object to evaluate component of cost associated with each basis vector.">basis_cost_</a>);
<a name="l00366"></a>00366   <a class="code" href="mcal__component__analyzer_8cxx.html#a40ebc3f47ba20185c11039977923d9bc" title="Binary file stream output operator for class reference.">vsl_b_write</a>(bfs,<a class="code" href="classmcal__general__ca.html#a2bed075403013ceb5efcc1a63cc41ad5" title="Maximum number of passes during optimisation.">max_passes_</a>);
<a name="l00367"></a>00367   <a class="code" href="mcal__component__analyzer_8cxx.html#a40ebc3f47ba20185c11039977923d9bc" title="Binary file stream output operator for class reference.">vsl_b_write</a>(bfs,<a class="code" href="classmcal__general__ca.html#a405a7adc34005ec600f3d0833724e964" title="Threshold on angular movement, used to terminate optimisation.">move_thresh_</a>);
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 <span class="comment">//=======================================================================</span>
<a name="l00371"></a>00371 <span class="comment">// Method: load</span>
<a name="l00372"></a>00372 <span class="comment">//=======================================================================</span>
<a name="l00373"></a>00373 
<a name="l00374"></a><a class="code" href="classmcal__general__ca.html#af3716f7bf7d7cfcb76f579638f815342">00374</a> <span class="keywordtype">void</span> <a class="code" href="classmcal__general__ca.html#af3716f7bf7d7cfcb76f579638f815342" title="Load class from binary file stream.">mcal_general_ca::b_read</a>(<a class="codeRef" doxygen="core_vsl.tag:../../../../core/vsl/html" href="../../../../core/vsl/html/classvsl__b__istream.html">vsl_b_istream</a>&amp; bfs)
<a name="l00375"></a>00375 {
<a name="l00376"></a>00376   <span class="keywordtype">short</span> version;
<a name="l00377"></a>00377   <a class="code" href="mcal__component__analyzer_8cxx.html#a99732c9d26fb08eb62b99afaece15474" title="Binary file stream input operator for class reference.">vsl_b_read</a>(bfs,version);
<a name="l00378"></a>00378   <span class="keywordflow">switch</span> (version)
<a name="l00379"></a>00379   {
<a name="l00380"></a>00380     <span class="keywordflow">case</span> 1:
<a name="l00381"></a>00381       <a class="code" href="mcal__component__analyzer_8cxx.html#a99732c9d26fb08eb62b99afaece15474" title="Binary file stream input operator for class reference.">vsl_b_read</a>(bfs,<a class="code" href="classmcal__general__ca.html#aa50bb4e82f64f8705e16c1a6e9f1cb10" title="Object to perform initial component analysis (usually PCA).">initial_ca_</a>);
<a name="l00382"></a>00382       <a class="code" href="mcal__component__analyzer_8cxx.html#a99732c9d26fb08eb62b99afaece15474" title="Binary file stream input operator for class reference.">vsl_b_read</a>(bfs,<a class="code" href="classmcal__general__ca.html#a8c73ca7d366e8b0575ffd6e7ead5be7e" title="Object to evaluate component of cost associated with each basis vector.">basis_cost_</a>);
<a name="l00383"></a>00383       <a class="code" href="mcal__component__analyzer_8cxx.html#a99732c9d26fb08eb62b99afaece15474" title="Binary file stream input operator for class reference.">vsl_b_read</a>(bfs,<a class="code" href="classmcal__general__ca.html#a2bed075403013ceb5efcc1a63cc41ad5" title="Maximum number of passes during optimisation.">max_passes_</a>);
<a name="l00384"></a>00384       <a class="code" href="mcal__component__analyzer_8cxx.html#a99732c9d26fb08eb62b99afaece15474" title="Binary file stream input operator for class reference.">vsl_b_read</a>(bfs,<a class="code" href="classmcal__general__ca.html#a405a7adc34005ec600f3d0833724e964" title="Threshold on angular movement, used to terminate optimisation.">move_thresh_</a>);
<a name="l00385"></a>00385       <span class="keywordflow">break</span>;
<a name="l00386"></a>00386     <span class="keywordflow">default</span>:
<a name="l00387"></a>00387       vcl_cerr &lt;&lt; <span class="stringliteral">&quot;mcal_general_ca::b_read()\n&quot;</span>
<a name="l00388"></a>00388                &lt;&lt; <span class="stringliteral">&quot;Unexpected version number &quot;</span> &lt;&lt; version &lt;&lt; vcl_endl;
<a name="l00389"></a>00389       vcl_abort();
<a name="l00390"></a>00390   }
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <span class="comment">//=======================================================================</span>
<a name="l00394"></a>00394 <span class="comment">//: Read initialisation settings from a stream.</span>
<a name="l00395"></a>00395 <span class="comment">// Parameters:</span>
<a name="l00396"></a>00396 <span class="comment">// \verbatim</span>
<a name="l00397"></a>00397 <span class="comment">// {</span>
<a name="l00398"></a>00398 <span class="comment">//   initial_ca: mcal_pca { ... }</span>
<a name="l00399"></a>00399 <span class="comment">//   basis_cost: mcal_sparse_basis_cost { alpha: 0.1 }</span>
<a name="l00400"></a>00400 <span class="comment">// }</span>
<a name="l00401"></a>00401 <span class="comment">// \endverbatim</span>
<a name="l00402"></a>00402 <span class="comment">// \throw mbl_exception_parse_error if the parse fails.</span>
<a name="l00403"></a><a class="code" href="classmcal__general__ca.html#ad19f9e9662acd1a59e248fa6337f34f0">00403</a> <span class="keywordtype">void</span> <a class="code" href="classmcal__general__ca.html#ad19f9e9662acd1a59e248fa6337f34f0" title="Read initialisation settings from a stream.">mcal_general_ca::config_from_stream</a>(vcl_istream &amp; is)
<a name="l00404"></a>00404 {
<a name="l00405"></a>00405   vcl_string s = <a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/mbl__parse__block_8cxx.html#a684a27aaae999af03348b00248263e80">mbl_parse_block</a>(is);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407   vcl_istringstream ss(s);
<a name="l00408"></a>00408   <a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/classmbl__read__props__type.html">mbl_read_props_type</a> props = <a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/mbl__read__props_8cxx.html#ab92bddc7c08bdfd06700a567c9dbb127">mbl_read_props_ws</a>(ss);
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <a class="code" href="classmcal__general__ca.html#aa5aaefeb72be09e4af40eb5341706bc0" title="Set parameters to default values.">set_defaults</a>();
<a name="l00411"></a>00411 
<a name="l00412"></a>00412   <span class="keywordflow">if</span> (props.find(<span class="stringliteral">&quot;initial_ca&quot;</span>)!=props.end())
<a name="l00413"></a>00413   {
<a name="l00414"></a>00414     vcl_istringstream ss(props[<span class="stringliteral">&quot;initial_ca&quot;</span>]);
<a name="l00415"></a>00415     vcl_auto_ptr&lt;mcal_component_analyzer&gt; ca;
<a name="l00416"></a>00416     ca=<a class="code" href="classmcal__component__analyzer.html#ae27430bf51623c16ac28cbc9c76b748a" title="Create a concrete mcal_component_analyzer object, from a text specification.">mcal_component_analyzer::create_from_stream</a>(ss);
<a name="l00417"></a>00417     <a class="code" href="classmcal__general__ca.html#aa50bb4e82f64f8705e16c1a6e9f1cb10" title="Object to perform initial component analysis (usually PCA).">initial_ca_</a> = *ca;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     props.erase(<span class="stringliteral">&quot;initial_ca&quot;</span>);
<a name="l00420"></a>00420   }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422   <span class="keywordflow">if</span> (props.find(<span class="stringliteral">&quot;basis_cost&quot;</span>)!=props.end())
<a name="l00423"></a>00423   {
<a name="l00424"></a>00424     vcl_istringstream ss(props[<span class="stringliteral">&quot;basis_cost&quot;</span>]);
<a name="l00425"></a>00425     vcl_auto_ptr&lt;mcal_single_basis_cost&gt; bc;
<a name="l00426"></a>00426     bc=<a class="code" href="classmcal__component__analyzer.html#ae27430bf51623c16ac28cbc9c76b748a" title="Create a concrete mcal_component_analyzer object, from a text specification.">mcal_single_basis_cost::create_from_stream</a>(ss);
<a name="l00427"></a>00427     <a class="code" href="classmcal__general__ca.html#a8c73ca7d366e8b0575ffd6e7ead5be7e" title="Object to evaluate component of cost associated with each basis vector.">basis_cost_</a> = *bc;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     props.erase(<span class="stringliteral">&quot;basis_cost&quot;</span>);
<a name="l00430"></a>00430   }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432   <span class="keywordflow">if</span> (props.find(<span class="stringliteral">&quot;max_passes&quot;</span>)!=props.end())
<a name="l00433"></a>00433   {
<a name="l00434"></a>00434     <a class="code" href="classmcal__general__ca.html#a2bed075403013ceb5efcc1a63cc41ad5" title="Maximum number of passes during optimisation.">max_passes_</a> = vul_string_atoi(props[<span class="stringliteral">&quot;max_passes&quot;</span>]);
<a name="l00435"></a>00435     props.erase(<span class="stringliteral">&quot;max_passes&quot;</span>);
<a name="l00436"></a>00436   }
<a name="l00437"></a>00437   <span class="keywordflow">if</span> (props.find(<span class="stringliteral">&quot;move_thresh&quot;</span>)!=props.end())
<a name="l00438"></a>00438   {
<a name="l00439"></a>00439     <a class="code" href="classmcal__general__ca.html#a405a7adc34005ec600f3d0833724e964" title="Threshold on angular movement, used to terminate optimisation.">move_thresh_</a> = vul_string_atoi(props[<span class="stringliteral">&quot;move_thresh&quot;</span>]);
<a name="l00440"></a>00440     props.erase(<span class="stringliteral">&quot;move_thresh&quot;</span>);
<a name="l00441"></a>00441   }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   <span class="keywordflow">try</span>
<a name="l00445"></a>00445   {
<a name="l00446"></a>00446     <a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/mbl__read__props_8cxx.html#ac7721a95b8e94481944044ac28561884">mbl_read_props_look_for_unused_props</a>(
<a name="l00447"></a>00447           <span class="stringliteral">&quot;mcal_general_ca::config_from_stream&quot;</span>, props);
<a name="l00448"></a>00448   }
<a name="l00449"></a>00449   <span class="keywordflow">catch</span>(<a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/classmbl__exception__unused__props.html">mbl_exception_unused_props</a> &amp;e)
<a name="l00450"></a>00450   {
<a name="l00451"></a>00451     <span class="keywordflow">throw</span> <a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/classmbl__exception__parse__error.html">mbl_exception_parse_error</a>(e.<a class="codeRef" doxygen="contrib_mul_mbl.tag:../../../../contrib/mul/mbl/html" href="../../../../contrib/mul/mbl/html/classmbl__exception__unused__props.html#aec204e319510d29887bbd2a106eef8d4">what</a>());
<a name="l00452"></a>00452   }
<a name="l00453"></a>00453 }
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 1 2013 17:34:44 for contrib/mul/mcal by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
