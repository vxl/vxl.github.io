<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>core/vil/file_formats/vil_dicom_header.cxx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">core/vil/file_formats/vil_dicom_header.cxx</div>  </div>
</div>
<div class="contents">
<a href="vil__dicom__header_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// DicomHeaderFormat.cxx</span>
<a name="l00002"></a>00002 <span class="comment">// =====================</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">// The implementation of the vil_dicom_header_format class to read</span>
<a name="l00005"></a>00005 <span class="comment">// and write the header part of a dicom file.</span>
<a name="l00006"></a>00006 <span class="comment">//</span>
<a name="l00007"></a>00007 <span class="comment">// Author: Chris Wolstenholme</span>
<a name="l00008"></a>00008 <span class="comment">// E-mail: cwolstenholme@imorphics.com</span>
<a name="l00009"></a>00009 <span class="comment">// Copyright (c) 2001 iMorphics Ltd</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;vil/vil_config.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#if HAS_DCMTK</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="vil__dicom__header_8h.html" title="DICOM Header reader and writer.">vil_dicom_header.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;<a class="code" href="vil__stream_8h.html" title="Stream interface for VIL image loaders.">vil/vil_stream.h</a>&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;vcl_iostream.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;vcl_cstdlib.h&gt;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="comment">//================================================================</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="keywordtype">void</span>
<a name="l00022"></a>00022 <a class="code" href="structvil__dicom__header__info.html#a3ed3d6fcb65046030a3b3c919872f186" title="Clears a header info struct.">vil_dicom_header_info_clear</a>( <a class="code" href="structvil__dicom__header__info.html" title="DICOM information read from the header.">vil_dicom_header_info</a>&amp; info )
<a name="l00023"></a>00023 {
<a name="l00024"></a>00024   <span class="comment">// Clear all the elements of the info structure</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026   <span class="comment">// Identity info</span>
<a name="l00027"></a>00027   info.<a class="code" href="structvil__dicom__header__info.html#ab2e661074712d3278c35658b0e371dc4">header_valid_</a> = <span class="keyword">false</span>;
<a name="l00028"></a>00028   info.<a class="code" href="structvil__dicom__header__info.html#a5cc976b81614b99175f1106c221ec52e">file_type_</a> = <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70a88abc3c43dc62161c2b371a2e6141f11">VIL_DICOM_HEADER_DTUNKNOWN</a>;
<a name="l00029"></a>00029   info.<a class="code" href="structvil__dicom__header__info.html#a8c61703a6fb9d84e8580148b36ea5ede">file_endian_</a> = <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a1bd8d6ebd37de76fc9a565ca03a5b45f">VIL_DICOM_HEADER_DEUNKNOWN</a>;
<a name="l00030"></a>00030   info.<a class="code" href="structvil__dicom__header__info.html#a731078907ed7a09e3f7428e933f1281d">sys_endian_</a> = <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a1bd8d6ebd37de76fc9a565ca03a5b45f">VIL_DICOM_HEADER_DEUNKNOWN</a>;
<a name="l00031"></a>00031   info.<a class="code" href="structvil__dicom__header__info.html#a26771743f759f9b5a21caf97a9a6e9f2">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a32f53615819a4bf00f0e7d2873564135">VIL_DICOM_HEADER_DITUNKNOWN</a>;
<a name="l00032"></a>00032   info.<a class="code" href="structvil__dicom__header__info.html#a51b5c4a6f5edc9d9bec2b501c1da4a50">image_id_type_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00033"></a>00033   info.<a class="code" href="structvil__dicom__header__info.html#a1783af1e11ce3a501a06972fe163618a">sop_cl_uid_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00034"></a>00034   info.<a class="code" href="structvil__dicom__header__info.html#acbba4d626725d05c3a3d13df39c05b43">sop_in_uid_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00035"></a>00035   info.<a class="code" href="structvil__dicom__header__info.html#a5374963a3797bc0ca92ab6294e3c9773">study_date_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00036"></a>00036   info.<a class="code" href="structvil__dicom__header__info.html#a3b93935abda4b9fcac5d0c5e4459d8c8">series_date_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00037"></a>00037   info.<a class="code" href="structvil__dicom__header__info.html#a2ec7c7ce7c12bead6bafc7c7e09264a7">acquisition_date_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00038"></a>00038   info.<a class="code" href="structvil__dicom__header__info.html#a888921ecddbbf7c29292af66f4a691cb">image_date_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00039"></a>00039   info.<a class="code" href="structvil__dicom__header__info.html#a39dcd605903b066de506f1bd4b3ec858">study_time_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00040"></a>00040   info.<a class="code" href="structvil__dicom__header__info.html#a5e863e3dc22f6e4a5bd45798c1beafbf">series_time_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00041"></a>00041   info.<a class="code" href="structvil__dicom__header__info.html#a4f80f17af50a264a8ec5b072a8c98de4">acquisition_time_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00042"></a>00042   info.<a class="code" href="structvil__dicom__header__info.html#af519eefd2903de8389f0027269058483">image_time_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00043"></a>00043   info.<a class="code" href="structvil__dicom__header__info.html#a5f78f57e677e18bfd69da03519f09757">accession_number_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00044"></a>00044   info.<a class="code" href="structvil__dicom__header__info.html#aecd1987606184e698190c60562add11a">modality_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00045"></a>00045   info.<a class="code" href="structvil__dicom__header__info.html#a0e18f19b67af15aa1ec8d257c7406485">manufacturer_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00046"></a>00046   info.<a class="code" href="structvil__dicom__header__info.html#ab0b7594b6219efbad1137269d4fa4528">institution_name_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00047"></a>00047   info.<a class="code" href="structvil__dicom__header__info.html#afc916db3d8c3c72d27f20f564156b8b4">institution_addr_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00048"></a>00048   info.<a class="code" href="structvil__dicom__header__info.html#a49907326c98464276f2041903b5df793">ref_phys_name_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00049"></a>00049   info.<a class="code" href="structvil__dicom__header__info.html#aed23bcd2efae06aa2083677b67b7c585">station_name_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00050"></a>00050   info.<a class="code" href="structvil__dicom__header__info.html#ac1206b309faec7373da15985f8368fa2">study_desc_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00051"></a>00051   info.<a class="code" href="structvil__dicom__header__info.html#adae00f5ee6ddcf20d78cbdc90d318021">att_phys_name_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00052"></a>00052   info.<a class="code" href="structvil__dicom__header__info.html#a002dce62bc96c7bd328ebd592fd440dd">operator_name_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00053"></a>00053   info.<a class="code" href="structvil__dicom__header__info.html#a76d5c2f3b4401aa812afcf3b19d172e5">model_name_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   <span class="comment">// Patient info</span>
<a name="l00056"></a>00056   info.<a class="code" href="structvil__dicom__header__info.html#aeda143f0de9a3ba71bd5277a73388aa7">patient_name_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00057"></a>00057   info.<a class="code" href="structvil__dicom__header__info.html#a0da2c8e5ceae6db7cae9b2baf9149d0a">patient_id_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00058"></a>00058   info.<a class="code" href="structvil__dicom__header__info.html#ac4e630ac8f780556ac1ada607ba28b74">patient_dob_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00059"></a>00059   info.<a class="code" href="structvil__dicom__header__info.html#a30a1e404488ee732868dabd51b7bd054">patient_sex_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00060"></a>00060   info.<a class="code" href="structvil__dicom__header__info.html#a31a2c471b8d5001dbbc90460259e073c">patient_age_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00061"></a>00061   info.<a class="code" href="structvil__dicom__header__info.html#af27622129f1ce95f90497746b99bccf1">patient_weight_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00062"></a>00062   info.<a class="code" href="structvil__dicom__header__info.html#a12eae05b09f3219a1bfdead385e4d3de">patient_hist_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   <span class="comment">// Acquisition info</span>
<a name="l00065"></a>00065   info.<a class="code" href="structvil__dicom__header__info.html#a7ac226d9ddf88fc0cea1350426fad54f">scanning_seq_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00066"></a>00066   info.<a class="code" href="structvil__dicom__header__info.html#a183c02f78d1f13d852eb20df1ed3d139">sequence_var_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00067"></a>00067   info.<a class="code" href="structvil__dicom__header__info.html#afff7c01ecb18f62620e72adbee994525">scan_options_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00068"></a>00068   info.<a class="code" href="structvil__dicom__header__info.html#a2bdd2f5c25abff6b42c6ca782b0a14dd">mr_acq_type_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00069"></a>00069   info.<a class="code" href="structvil__dicom__header__info.html#af468ca89ac563cacbc2861ff91313179">sequence_name_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00070"></a>00070   info.<a class="code" href="structvil__dicom__header__info.html#a78faba722978b5de1fec7fee0c68f71f">angio_flag_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00071"></a>00071   info.<a class="code" href="structvil__dicom__header__info.html#ab831a2dc77db87da8a5c6f0428bfb02e">slice_thickness_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00072"></a>00072   info.<a class="code" href="structvil__dicom__header__info.html#ac77ea2d5e0aca979f2ad132f1c4beaf2">repetition_time_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00073"></a>00073   info.<a class="code" href="structvil__dicom__header__info.html#ac4c578ba8622f710273c23a7f2b022c4">echo_time_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00074"></a>00074   info.<a class="code" href="structvil__dicom__header__info.html#a283301548fe2572ebeb7cdc2fb0ced11">inversion_time_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00075"></a>00075   info.<a class="code" href="structvil__dicom__header__info.html#a5e08399eb4c3fe00ef7d6ec9b2e1c260">number_of_averages_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00076"></a>00076   info.<a class="code" href="structvil__dicom__header__info.html#aa8694422437518935400631e463dec7b">echo_numbers_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00077"></a>00077   info.<a class="code" href="structvil__dicom__header__info.html#a6e848d181e56d1098864e1a49baa68ca">mag_field_strength_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00078"></a>00078   info.<a class="code" href="structvil__dicom__header__info.html#a6db5df230d0e53a886609b58831e51b0">echo_train_length_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00079"></a>00079   info.<a class="code" href="structvil__dicom__header__info.html#a1cbe88966e02ff67179bd61ce7ceb4e0">pixel_bandwidth_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00080"></a>00080   info.<a class="code" href="structvil__dicom__header__info.html#ae99ebb2b7f731ddf49a7f6ee7d4e79cf">software_vers_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00081"></a>00081   info.<a class="code" href="structvil__dicom__header__info.html#acdb15d5d9d32d81c7c2c95cbe2d28d9c">protocol_name_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00082"></a>00082   info.<a class="code" href="structvil__dicom__header__info.html#a204735535306c1b1bd3cece3657547e5">heart_rate_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00083"></a>00083   info.<a class="code" href="structvil__dicom__header__info.html#a973185fefa1922113efdf043426b7e48">card_num_images_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00084"></a>00084   info.<a class="code" href="structvil__dicom__header__info.html#a6f31554f8e97eb242c9aeec6a0d8e4bf">trigger_window_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00085"></a>00085   info.<a class="code" href="structvil__dicom__header__info.html#a196505719c77aee5ae16d1848d1a16dd">reconst_diameter_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00086"></a>00086   info.<a class="code" href="structvil__dicom__header__info.html#ad78486d841c9d66842389aa6c24b49cf">receiving_coil_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00087"></a>00087   info.<a class="code" href="structvil__dicom__header__info.html#a5032dd00fb3b8892c38314248cad1a4b">phase_enc_dir_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00088"></a>00088   info.<a class="code" href="structvil__dicom__header__info.html#ac228324597a65d2bddbe7e115fdcc639">flip_angle_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00089"></a>00089   info.<a class="code" href="structvil__dicom__header__info.html#a59812c867dc2d9d87dce213840f345a7">sar_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00090"></a>00090   info.<a class="code" href="structvil__dicom__header__info.html#a5cf38f0f6d613e9761398c4f5f2b9424">patient_pos_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092   <span class="comment">// Relationship info</span>
<a name="l00093"></a>00093   info.<a class="code" href="structvil__dicom__header__info.html#adf02b9e66dc179f88611585ae3246d7e">stud_ins_uid_</a>= <span class="stringliteral">&quot;&quot;</span>;
<a name="l00094"></a>00094   info.<a class="code" href="structvil__dicom__header__info.html#ae46a857ee833e0aed1e6ab459710c4d0">ser_ins_uid_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00095"></a>00095   info.<a class="code" href="structvil__dicom__header__info.html#ac29ae72b701ecb59f70fff8e4088d67f">study_id_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00096"></a>00096   info.<a class="code" href="structvil__dicom__header__info.html#a901098c71ec72810d06c4311bd6bb666">series_number_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00097"></a>00097   info.<a class="code" href="structvil__dicom__header__info.html#a2cc5202cae1a686ad72a02c9f4dfc62e">acquisition_number_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00098"></a>00098   info.<a class="code" href="structvil__dicom__header__info.html#a0829d31bf9f12315d9f9f2be925ebb0e">image_number_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00099"></a>00099   info.<a class="code" href="structvil__dicom__header__info.html#a39c127d40d5a071bbaffa50ac912caaf">pat_orient_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00100"></a>00100   info.<a class="code" href="structvil__dicom__header__info.html#ad64bf289ea06444fcbaacfcf669479bb">image_pos_</a>.clear();
<a name="l00101"></a>00101   info.<a class="code" href="structvil__dicom__header__info.html#ae4ae2377fba75f5603dfc0ef5c7279bf">image_orient_</a>.clear();
<a name="l00102"></a>00102   info.<a class="code" href="structvil__dicom__header__info.html#a28b195a6d73472254de16173e897de41">frame_of_ref_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00103"></a>00103   info.<a class="code" href="structvil__dicom__header__info.html#ae3d38baafab2b70097cc8312f49d47d1">images_in_acq_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00104"></a>00104   info.<a class="code" href="structvil__dicom__header__info.html#ae3bcde240a0ffecc9a3a060c7e3530d3">pos_ref_ind_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00105"></a>00105   info.<a class="code" href="structvil__dicom__header__info.html#adbdbbe6857be0a85e0ea79a1c627730b">slice_location_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="comment">// Image info</span>
<a name="l00108"></a>00108   info.<a class="code" href="structvil__dicom__header__info.html#ad65f1baf306d6a32bb5641b2c80f2f9c">pix_samps_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00109"></a>00109   info.<a class="code" href="structvil__dicom__header__info.html#ad10dd496ea7fd5e107c6321169a02897">photo_interp_</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00110"></a>00110   info.<a class="code" href="structvil__dicom__header__info.html#aa3b2dd88703a6d82614d06a9ff7dfafe">size_x_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00111"></a>00111   info.<a class="code" href="structvil__dicom__header__info.html#a78eafe0731c974109307e2473e35a605">size_y_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00112"></a>00112   info.<a class="code" href="structvil__dicom__header__info.html#a27377c3d91f660c87d2bfa2cbbec225a">size_z_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00113"></a>00113   info.<a class="code" href="structvil__dicom__header__info.html#aa5c9b984019acb609b0039300518148e">high_bit_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00114"></a>00114   info.<a class="code" href="structvil__dicom__header__info.html#a0c372481641d36985af54b13cd0aa337">small_im_pix_val_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00115"></a>00115   info.<a class="code" href="structvil__dicom__header__info.html#adca5451d8bce1197a5b170fd3afcd4e5">large_im_pix_val_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00116"></a>00116   info.<a class="code" href="structvil__dicom__header__info.html#ad53e2fbb58bd8dc8063db2e6ee177022">pixel_padding_val_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00117"></a>00117   info.<a class="code" href="structvil__dicom__header__info.html#ae6f2ebd5b537d77061e80b859cc568fe">window_centre_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00118"></a>00118   info.<a class="code" href="structvil__dicom__header__info.html#a49023b81ab13ddc407fd050edc2dd6f9">window_width_</a> = <a class="code" href="vil__dicom__header_8h.html#a2e2bd4976daaa3046f69700795cb9e69">VIL_DICOM_HEADER_UNSPECIFIED</a>;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120   <span class="comment">// Info for loading image</span>
<a name="l00121"></a>00121   info.<a class="code" href="structvil__dicom__header__info.html#a683166f59271e8f0ff82c898d1700347">spacing_x_</a> = <a class="code" href="vil__dicom__header_8h.html#a39b66a48b825a7ba16b8f2f36949eb7c">VIL_DICOM_HEADER_DEFAULTSIZE_FLOAT</a>;
<a name="l00122"></a>00122   info.<a class="code" href="structvil__dicom__header__info.html#ac3a6905bb65779442664f412770e1094">spacing_y_</a> = <a class="code" href="vil__dicom__header_8h.html#a39b66a48b825a7ba16b8f2f36949eb7c">VIL_DICOM_HEADER_DEFAULTSIZE_FLOAT</a>;
<a name="l00123"></a>00123   info.<a class="code" href="structvil__dicom__header__info.html#aef03bd48bad1973d198268220dfa77de">spacing_slice_</a> = <a class="code" href="vil__dicom__header_8h.html#a39b66a48b825a7ba16b8f2f36949eb7c">VIL_DICOM_HEADER_DEFAULTSIZE_FLOAT</a>;
<a name="l00124"></a>00124   info.<a class="code" href="structvil__dicom__header__info.html#a019200da9590b92452886bd4456f37b5">res_intercept_</a> = <a class="code" href="vil__dicom__header_8h.html#aa66f944225ccf44d3a40cfb44a12aad4">VIL_DICOM_HEADER_DEFAULTINTERCEPT</a>;
<a name="l00125"></a>00125   info.<a class="code" href="structvil__dicom__header__info.html#a49cf1a40c2f66b5efe56f5b591364c00">res_slope_</a> = <a class="code" href="vil__dicom__header_8h.html#a46d0455df45577c19b13358e73fe043f">VIL_DICOM_HEADER_DEFAULTSLOPE</a>;
<a name="l00126"></a>00126   info.<a class="code" href="structvil__dicom__header__info.html#a668e86ad08c53c48bc28133b43f9d140">pix_rep_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00127"></a>00127   info.<a class="code" href="structvil__dicom__header__info.html#ae6d9ceef71fcd43875774b1712a7a3c6">stored_bits_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00128"></a>00128   info.<a class="code" href="structvil__dicom__header__info.html#afe7b8cbaa8d2f98746461ac3a8df3770">allocated_bits_</a> = <a class="code" href="vil__dicom__header_8h.html#a25c9a4c38cbf5fc635b6cc4e2617e1c8">VIL_DICOM_HEADER_UNSPECIFIED_UNSIGNED</a>;
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="comment">//================================================================</span>
<a name="l00133"></a>00133 <span class="comment">// Default constructor</span>
<a name="l00134"></a>00134 <span class="comment">//================================================================</span>
<a name="l00135"></a>00135 <a class="code" href="classvil__dicom__header__format.html#a16ed46244117f80e3b0c496711a215a5">vil_dicom_header_format::vil_dicom_header_format</a>() :
<a name="l00136"></a>00136 info_valid_(false),
<a name="l00137"></a>00137 file_endian_(<a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a1bd8d6ebd37de76fc9a565ca03a5b45f">VIL_DICOM_HEADER_DEUNKNOWN</a>),
<a name="l00138"></a>00138 image_type_(<a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a32f53615819a4bf00f0e7d2873564135">VIL_DICOM_HEADER_DITUNKNOWN</a>)
<a name="l00139"></a>00139 {
<a name="l00140"></a>00140   <span class="comment">// Work out the endianism of this architecture</span>
<a name="l00141"></a>00141   endian_ = calculateEndian();
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="comment">//================================================================</span>
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <a class="code" href="classvil__dicom__header__format.html#a390b60cade8a57162847e32f74abba5f">vil_dicom_header_format::~vil_dicom_header_format</a>()
<a name="l00147"></a>00147 {
<a name="l00148"></a>00148   <span class="comment">// Do Nothing</span>
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="comment">//================================================================</span>
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="keywordtype">bool</span> <a class="code" href="classvil__dicom__header__format.html#a1a3c8656632d48a72279dbe979e7f55a" title="True if it is known DICOM format.">vil_dicom_header_format::isDicomFormat</a>(<a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155   <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70" title="DICOM types.">vil_dicom_header_type</a> dtype;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   dtype = <a class="code" href="classvil__dicom__header__format.html#a607a2f747410bdf67825bf9c497c769a" title="Method to determine the file type.">determineFileType</a>(fs);
<a name="l00158"></a>00158 
<a name="l00159"></a>00159   <span class="keywordflow">return</span> dtype!=<a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70a88abc3c43dc62161c2b371a2e6141f11">VIL_DICOM_HEADER_DTUNKNOWN</a>;
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="comment">//================================================================</span>
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 <a class="code" href="structvil__dicom__header__info.html" title="DICOM information read from the header.">vil_dicom_header_info</a> <a class="code" href="classvil__dicom__header__format.html#a9c960b16dae9ce6ef8e29b3846ecd728" title="Read the dicom header into a header struct.">vil_dicom_header_format::readHeader</a>(<a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00165"></a>00165 {
<a name="l00166"></a>00166   <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70" title="DICOM types.">vil_dicom_header_type</a> dtype;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <span class="comment">// Clear the current header</span>
<a name="l00169"></a>00169   <a class="code" href="classvil__dicom__header__format.html#ab577953ac009bd89ecdf43a7ca69370d">clearInfo</a>();
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   dtype = <a class="code" href="classvil__dicom__header__format.html#a607a2f747410bdf67825bf9c497c769a" title="Method to determine the file type.">determineFileType</a>(fs);
<a name="l00172"></a>00172   <span class="comment">// Check if the file is dicom first</span>
<a name="l00173"></a>00173   <span class="keywordflow">if</span> (dtype != <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70a88abc3c43dc62161c2b371a2e6141f11">VIL_DICOM_HEADER_DTUNKNOWN</a>)
<a name="l00174"></a>00174   {
<a name="l00175"></a>00175     <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#a5cc976b81614b99175f1106c221ec52e">file_type_</a> = dtype;
<a name="l00176"></a>00176     <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#a731078907ed7a09e3f7428e933f1281d">sys_endian_</a> = <a class="code" href="classvil__dicom__header__format.html#a4ceb2ddc21b353dcf75feee6ed9e8c1e" title="Return the current system endian.">systemEndian</a>();
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     <span class="keywordflow">if</span> (dtype == <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70a2c504b0e7fdb823e7204ca81ac80938a">VIL_DICOM_HEADER_DTPART10</a>)
<a name="l00179"></a>00179     {
<a name="l00180"></a>00180       <a class="code" href="classvil__dicom__header__format.html#ac5d3a62f7546a30d77ecbc702af5a2ec" title="A variable to hold the current header file&#39;s endian.">file_endian_</a> = <a class="code" href="classvil__dicom__header__format.html#a9282125ab8f59b74735a35679e46fe64" title="Initialise all the necessary meta-file stuff.">determineMetaInfo</a>(fs);
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#a8c61703a6fb9d84e8580148b36ea5ede">file_endian_</a> = <a class="code" href="classvil__dicom__header__format.html#a873c0045914f9105e1c37a43d5dea392" title="Return the endian of the header being read.">fileEndian</a>();
<a name="l00184"></a>00184     <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#a26771743f759f9b5a21caf97a9a6e9f2">image_type_</a> = <a class="code" href="classvil__dicom__header__format.html#adbcfd305f93a76572d77d78ab966b78c" title="Return any encapsulated image type.">imageType</a>();
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <a class="code" href="classvil__dicom__header__format.html#a9f9f26eedc80952673e57b2197a0d624" title="Method to read the elements from the header.">readHeaderElements</a>(fs);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <a class="code" href="classvil__dicom__header__format.html#a68360671e4c0848e57bd7fce333f7c36" title="TRUE if the header info is valid (i.e. has been read) otherwise FALSE.">info_valid_</a> = <span class="keyword">true</span>;
<a name="l00189"></a>00189   } <span class="comment">// End of if (dtype != VIL_DICOM_HEADER_DTUNKNOWN)</span>
<a name="l00190"></a>00190   <span class="keywordflow">else</span> <span class="comment">// It&#39;s not a dicom file, so can&#39;t read</span>
<a name="l00191"></a>00191   {
<a name="l00192"></a>00192     vcl_cerr&lt;&lt;<span class="stringliteral">&quot;Unknown file type - not a DICOM file...\n&quot;</span>
<a name="l00193"></a>00193             &lt;&lt;<span class="stringliteral">&quot;File header not read\n&quot;</span>;
<a name="l00194"></a>00194   }
<a name="l00195"></a>00195   <span class="keywordflow">return</span> <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>;
<a name="l00196"></a>00196 }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="comment">//================================================================</span>
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <a class="code" href="structvil__dicom__header__info.html" title="DICOM information read from the header.">vil_dicom_header_info</a> <a class="code" href="classvil__dicom__header__format.html#a1362f4c7fe1e2972098612939d9a5a2a" title="Method to return the last struct of header info set.">vil_dicom_header_format::lastHeader</a>(<span class="keywordtype">void</span>)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202   <span class="keywordflow">return</span> <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="comment">//================================================================</span>
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="keywordtype">bool</span> <a class="code" href="classvil__dicom__header__format.html#ab29826fffb6ea0792cda52bbeebe7177" title="Method to indicate if the header info held is valid or not.">vil_dicom_header_format::headerValid</a>(<span class="keywordtype">void</span>)
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209 <span class="keywordflow">return</span> <a class="code" href="classvil__dicom__header__format.html#a68360671e4c0848e57bd7fce333f7c36" title="TRUE if the header info is valid (i.e. has been read) otherwise FALSE.">info_valid_</a>;
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 <span class="comment">//================================================================</span>
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17" title="Endian types.">vil_dicom_header_endian</a> <a class="code" href="classvil__dicom__header__format.html#a4ceb2ddc21b353dcf75feee6ed9e8c1e" title="Return the current system endian.">vil_dicom_header_format::systemEndian</a>(<span class="keywordtype">void</span>)
<a name="l00215"></a>00215 {
<a name="l00216"></a>00216   <span class="keywordflow">return</span> <a class="code" href="classvil__dicom__header__format.html#aeaf845bb3f322e4811ac2be75b8f76dd" title="A variable to hold the discovered architecture endian.">endian_</a>;
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 <span class="comment">//================================================================</span>
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17" title="Endian types.">vil_dicom_header_endian</a> <a class="code" href="classvil__dicom__header__format.html#a873c0045914f9105e1c37a43d5dea392" title="Return the endian of the header being read.">vil_dicom_header_format::fileEndian</a>(<span class="keywordtype">void</span>)
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223   <span class="keywordflow">return</span> <a class="code" href="classvil__dicom__header__format.html#ac5d3a62f7546a30d77ecbc702af5a2ec" title="A variable to hold the current header file&#39;s endian.">file_endian_</a>;
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">//================================================================</span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048" title="Encapsulated image types.">vil_dicom_header_image_type</a> <a class="code" href="classvil__dicom__header__format.html#adbcfd305f93a76572d77d78ab966b78c" title="Return any encapsulated image type.">vil_dicom_header_format::imageType</a>(<span class="keywordtype">void</span>)
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230   <span class="keywordflow">return</span> <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a>;
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="comment">//================================================================</span>
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70" title="DICOM types.">vil_dicom_header_type</a> <a class="code" href="classvil__dicom__header__format.html#a607a2f747410bdf67825bf9c497c769a" title="Method to determine the file type.">vil_dicom_header_format::determineFileType</a>(<a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00236"></a>00236 {
<a name="l00237"></a>00237   <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70" title="DICOM types.">vil_dicom_header_type</a> result = <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70a88abc3c43dc62161c2b371a2e6141f11">VIL_DICOM_HEADER_DTUNKNOWN</a>;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   <span class="comment">// Check the file is open, otherwise fail - the vcl_fstream should</span>
<a name="l00240"></a>00240   <span class="comment">// be controlled outside of this class</span>
<a name="l00241"></a>00241   <span class="keywordflow">if</span> (fs.<a class="code" href="classvil__stream.html#a5062b8aff09e290556e784762e436f94" title="Return false if the stream is broken.">ok</a>())
<a name="l00242"></a>00242   {
<a name="l00243"></a>00243     <span class="comment">// There are four possibilities:</span>
<a name="l00244"></a>00244     <span class="comment">// The file is Part10 with 128 byte pre-amble</span>
<a name="l00245"></a>00245     <span class="comment">// The file is Part10 with no pre-amble</span>
<a name="l00246"></a>00246     <span class="comment">// The file is a non-Part10 dicom file</span>
<a name="l00247"></a>00247     <span class="comment">// The file is not a dicom file (or can&#39;t be determined as such)</span>
<a name="l00248"></a>00248     <span class="keywordtype">char</span> dicm_read[5];
<a name="l00249"></a>00249     vcl_string dicm_test;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     <span class="comment">// Skip 128 byte pre-amble and test for DICM again</span>
<a name="l00252"></a>00252     fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(128);
<a name="l00253"></a>00253     fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(dicm_read,4);
<a name="l00254"></a>00254     dicm_read[4]=0;
<a name="l00255"></a>00255     dicm_test=dicm_read;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="keywordflow">if</span> (dicm_test == <span class="stringliteral">&quot;DICM&quot;</span>)
<a name="l00258"></a>00258     {
<a name="l00259"></a>00259       result = <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70a2c504b0e7fdb823e7204ca81ac80938a">VIL_DICOM_HEADER_DTPART10</a>;
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261     <span class="keywordflow">else</span>
<a name="l00262"></a>00262     {
<a name="l00263"></a>00263       <span class="comment">// Read the first four chars and see if they are the letters</span>
<a name="l00264"></a>00264       <span class="comment">// DICM</span>
<a name="l00265"></a>00265       fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(0);
<a name="l00266"></a>00266       fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(dicm_read,4);
<a name="l00267"></a>00267       dicm_read[4]=0;    <span class="comment">// Null terminate</span>
<a name="l00268"></a>00268       dicm_test=dicm_read;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270       <span class="keywordflow">if</span> (dicm_test == <span class="stringliteral">&quot;DICM&quot;</span>)
<a name="l00271"></a>00271       {
<a name="l00272"></a>00272         result = <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70a2c504b0e7fdb823e7204ca81ac80938a">VIL_DICOM_HEADER_DTPART10</a>;
<a name="l00273"></a>00273       }
<a name="l00274"></a>00274       <span class="keywordflow">else</span>
<a name="l00275"></a>00275       {
<a name="l00276"></a>00276         <span class="comment">// Some other format - test it with both little and</span>
<a name="l00277"></a>00277         <span class="comment">// big endian</span>
<a name="l00278"></a>00278         <span class="keywordtype">int</span> num_tries = 0;
<a name="l00279"></a>00279         <span class="keywordtype">bool</span> known = <span class="keyword">false</span>;
<a name="l00280"></a>00280         <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17" title="Endian types.">vil_dicom_header_endian</a> old_endian = <a class="code" href="classvil__dicom__header__format.html#ac5d3a62f7546a30d77ecbc702af5a2ec" title="A variable to hold the current header file&#39;s endian.">file_endian_</a>;
<a name="l00281"></a>00281         <a class="code" href="classvil__dicom__header__format.html#ac5d3a62f7546a30d77ecbc702af5a2ec" title="A variable to hold the current header file&#39;s endian.">file_endian_</a> = <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a7a04e2c42756d063445ba8e62ee955eb">VIL_DICOM_HEADER_DEBIGENDIAN</a>;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283         <span class="keywordflow">while</span> (num_tries &lt; 2 &amp;&amp; !known)
<a name="l00284"></a>00284         {
<a name="l00285"></a>00285           <span class="comment">// Go back to the beginning and search for the</span>
<a name="l00286"></a>00286           <span class="comment">// first element of the Identifying group</span>
<a name="l00287"></a>00287           fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(0);
<a name="l00288"></a>00288           vxl_uint_16 group, element;
<a name="l00289"></a>00289           vxl_uint_32 data_block_size, num_elements;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291           fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;group, <span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l00292"></a>00292           group = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(group);
<a name="l00293"></a>00293           fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;element, <span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l00294"></a>00294           element = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(element);
<a name="l00295"></a>00295           fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;data_block_size, <span class="keyword">sizeof</span>(vxl_uint_32));
<a name="l00296"></a>00296           data_block_size = <a class="code" href="classvil__dicom__header__format.html#a935fa97017c4e75dc2d801e85ffcea01" title="Method to byte swap an unsigned int if necessary.">intSwap</a>(data_block_size);
<a name="l00297"></a>00297           <span class="keywordflow">if</span> (data_block_size &gt; 0x1000000) {
<a name="l00298"></a>00298             vcl_cerr&lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; : WARNING:\n&quot;</span>
<a name="l00299"></a>00299                     &lt;&lt;<span class="stringliteral">&quot;data_block_size=&quot;</span> &lt;&lt; data_block_size &lt;&lt; <span class="stringliteral">&quot; is most probably too large\n&quot;</span>;
<a name="l00300"></a>00300             <span class="keywordflow">break</span>;
<a name="l00301"></a>00301           }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303           num_elements = 0;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305           <span class="keywordflow">while</span> (group &lt; <a class="code" href="vil__dicom__header_8h.html#aea14a9b7a4fb49678088c05863605192">VIL_DICOM_HEADER_IDENTIFYINGGROUP</a> &amp;&amp;
<a name="l00306"></a>00306                  num_elements &lt; <a class="code" href="vil__dicom__header_8h.html#ae000510cb8346976f3fd9a87e8725dae">VIL_DICOM_HEADER_MAXHEADERSIZE</a> &amp;&amp;
<a name="l00307"></a>00307                  fs.<a class="code" href="classvil__stream.html#a5062b8aff09e290556e784762e436f94" title="Return false if the stream is broken.">ok</a>())
<a name="l00308"></a>00308           {
<a name="l00309"></a>00309             <span class="comment">// It&#39;s not what we want, so skip it and</span>
<a name="l00310"></a>00310             <span class="comment">// get the next one</span>
<a name="l00311"></a>00311             fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(data_block_size + fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>());
<a name="l00312"></a>00312 
<a name="l00313"></a>00313             fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;group, <span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l00314"></a>00314             group = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(group);
<a name="l00315"></a>00315             fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;element, <span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l00316"></a>00316             element = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(element);
<a name="l00317"></a>00317             fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;data_block_size, <span class="keyword">sizeof</span>(vxl_uint_32));
<a name="l00318"></a>00318             data_block_size = <a class="code" href="classvil__dicom__header__format.html#a935fa97017c4e75dc2d801e85ffcea01" title="Method to byte swap an unsigned int if necessary.">intSwap</a>(data_block_size);
<a name="l00319"></a>00319             <span class="keywordflow">if</span> (data_block_size &gt; 0x1000000) {
<a name="l00320"></a>00320               vcl_cerr&lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; : WARNING:\n&quot;</span>
<a name="l00321"></a>00321                       &lt;&lt;<span class="stringliteral">&quot;data_block_size=&quot;</span> &lt;&lt; data_block_size &lt;&lt; <span class="stringliteral">&quot; is most probably too large\n&quot;</span>;
<a name="l00322"></a>00322               <span class="keywordflow">break</span>;
<a name="l00323"></a>00323             }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325             num_elements++;
<a name="l00326"></a>00326           } <span class="comment">// End of while (group...)</span>
<a name="l00327"></a>00327 
<a name="l00328"></a>00328           <span class="comment">// Check the elements read and see if it fits</span>
<a name="l00329"></a>00329           <span class="comment">// with a known header</span>
<a name="l00330"></a>00330           <span class="keywordflow">if</span> (group == <a class="code" href="vil__dicom__header_8h.html#aea14a9b7a4fb49678088c05863605192">VIL_DICOM_HEADER_IDENTIFYINGGROUP</a>)
<a name="l00331"></a>00331           {
<a name="l00332"></a>00332             <span class="comment">// First, standard non-Part10 header</span>
<a name="l00333"></a>00333             <span class="keywordflow">if</span> (element == <a class="code" href="vil__dicom__header_8h.html#a2349632bd408dd58480dffba88e75e86">VIL_DICOM_HEADER_IDGROUPLENGTH</a> &amp;&amp;
<a name="l00334"></a>00334                 data_block_size == 4)
<a name="l00335"></a>00335             {
<a name="l00336"></a>00336               <span class="comment">// Put the file back at the beginning</span>
<a name="l00337"></a>00337               fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(0);
<a name="l00338"></a>00338               result = <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70a34b8a64681d428f0d468e3011a481a40">VIL_DICOM_HEADER_DTNON_PART10</a>;
<a name="l00339"></a>00339               known = <span class="keyword">true</span>;
<a name="l00340"></a>00340             } <span class="comment">// End of if (element...)</span>
<a name="l00341"></a>00341             <span class="comment">// Now a non-standard non-Part10</span>
<a name="l00342"></a>00342             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (element == <a class="code" href="vil__dicom__header_8h.html#a49c08995d3fbbc25fa1abd4815bbde46">VIL_DICOM_HEADER_IDIMAGETYPE</a> ||
<a name="l00343"></a>00343                      element == <a class="code" href="vil__dicom__header_8h.html#ae76566c5dd64c2b93d21eecaf3293194">VIL_DICOM_HEADER_IDLENGTHTOEND</a> ||
<a name="l00344"></a>00344                      element == <a class="code" href="vil__dicom__header_8h.html#a8f254d0912f74949fe956d052e20609f">VIL_DICOM_HEADER_IDSPECIFICCHARACTER</a>)
<a name="l00345"></a>00345             {
<a name="l00346"></a>00346               <span class="comment">// Put the file back at the beginning</span>
<a name="l00347"></a>00347               fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(0);
<a name="l00348"></a>00348               result = <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70a34b8a64681d428f0d468e3011a481a40">VIL_DICOM_HEADER_DTNON_PART10</a>;
<a name="l00349"></a>00349               known = <span class="keyword">true</span>;
<a name="l00350"></a>00350             } <span class="comment">// End of else if (element...)</span>
<a name="l00351"></a>00351           } <span class="comment">// End of if (group == VIL_DICOM_HEADER_IDENTIFYINGGROUP)</span>
<a name="l00352"></a>00352 
<a name="l00353"></a>00353           <span class="keywordflow">if</span> (!known)
<a name="l00354"></a>00354           {
<a name="l00355"></a>00355             <a class="code" href="classvil__dicom__header__format.html#ac5d3a62f7546a30d77ecbc702af5a2ec" title="A variable to hold the current header file&#39;s endian.">file_endian_</a> = <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a14ea2fc4719a11d6bae9d5e20bce5b51">VIL_DICOM_HEADER_DELITTLEENDIAN</a>;
<a name="l00356"></a>00356           }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358           num_tries++;
<a name="l00359"></a>00359         } <span class="comment">// End of while (num_tries &lt; 2 &amp;&amp; !known)</span>
<a name="l00360"></a>00360 
<a name="l00361"></a>00361         <span class="keywordflow">if</span> (!known)
<a name="l00362"></a>00362         {
<a name="l00363"></a>00363           <a class="code" href="classvil__dicom__header__format.html#ac5d3a62f7546a30d77ecbc702af5a2ec" title="A variable to hold the current header file&#39;s endian.">file_endian_</a> = old_endian;
<a name="l00364"></a>00364         }
<a name="l00365"></a>00365       } <span class="comment">// End of else</span>
<a name="l00366"></a>00366     } <span class="comment">// End of else</span>
<a name="l00367"></a>00367   } <span class="comment">// End of if (fs.ok())</span>
<a name="l00368"></a>00368   <span class="keywordflow">else</span>
<a name="l00369"></a>00369   {
<a name="l00370"></a>00370     vcl_cerr &lt;&lt; <span class="stringliteral">&quot;File not open for reading:\n&quot;</span>
<a name="l00371"></a>00371              &lt;&lt; <span class="stringliteral">&quot;vil_dicom_header_format::determineFileType()\n&quot;</span>;
<a name="l00372"></a>00372   } <span class="comment">// End of else</span>
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="keywordflow">return</span> result;
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="comment">//================================================================</span>
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 <span class="keywordtype">void</span> <a class="code" href="classvil__dicom__header__format.html#a9f9f26eedc80952673e57b2197a0d624" title="Method to read the elements from the header.">vil_dicom_header_format::readHeaderElements</a>(<a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00380"></a>00380 {
<a name="l00381"></a>00381   vxl_uint_16 group, element;  <span class="comment">// The groups and elements read from the header part of the dicom file</span>
<a name="l00382"></a>00382   vxl_uint_32 data_block_size; <span class="comment">// The size of the information held for this group/element pair</span>
<a name="l00383"></a>00383   vcl_cerr &lt;&lt; <span class="stringliteral">&quot;vil_dicom_header_format::readHeaderElements - Deprecated function called - use the DCMTK code instead!&quot;</span>;
<a name="l00384"></a>00384   vcl_abort();
<a name="l00385"></a>00385 
<a name="l00386"></a>00386   <span class="comment">// Read the first group/element pair</span>
<a name="l00387"></a>00387   fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;group, <span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l00388"></a>00388   fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;element, <span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l00389"></a>00389 
<a name="l00390"></a>00390   <span class="comment">// Swap them if necessary</span>
<a name="l00391"></a>00391   group = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(group);
<a name="l00392"></a>00392   element = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(element);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394   <span class="comment">// Loop until the file ends (unexpectedly!) or the</span>
<a name="l00395"></a>00395   <span class="comment">// pixel data is found</span>
<a name="l00396"></a>00396   <span class="keywordflow">while</span> (fs.<a class="code" href="classvil__stream.html#a5062b8aff09e290556e784762e436f94" title="Return false if the stream is broken.">ok</a>() &amp;&amp; !<a class="code" href="classvil__dicom__header__format.html#a985547c9c86ec5be5de8c4d849c45aae" title="Method to determine whether or not the actual pixel data has been reached.">pixelDataFound</a>(group, element))
<a name="l00397"></a>00397   {
<a name="l00398"></a>00398     <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(vxl_uint_32) != fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;data_block_size, <span class="keyword">sizeof</span>(vxl_uint_32)))
<a name="l00399"></a>00399       <span class="keywordflow">break</span>;
<a name="l00400"></a>00400     data_block_size = <a class="code" href="classvil__dicom__header__format.html#a935fa97017c4e75dc2d801e85ffcea01" title="Method to byte swap an unsigned int if necessary.">intSwap</a>(data_block_size);
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (data_block_size &gt; 0x1000000) {
<a name="l00402"></a>00402       vcl_cerr&lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; : WARNING:\n&quot;</span>
<a name="l00403"></a>00403               &lt;&lt;<span class="stringliteral">&quot;data_block_size=&quot;</span> &lt;&lt; data_block_size &lt;&lt; <span class="stringliteral">&quot; is most probably too large\n&quot;</span>;
<a name="l00404"></a>00404       <span class="keywordflow">break</span>;
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406     <a class="code" href="classvil__dicom__header__format.html#a0b7f606eb1a76c59ce7dbb1107e0ed4f" title="Method to convert the Value Representation (VR) (if it exists).">convertValueRepresentation</a>(data_block_size, fs);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="keywordflow">switch</span> (group)
<a name="l00409"></a>00409     {
<a name="l00410"></a>00410      <span class="comment">// Read identifying info</span>
<a name="l00411"></a>00411      <span class="keywordflow">case</span> <a class="code" href="vil__dicom__header_8h.html#aea14a9b7a4fb49678088c05863605192">VIL_DICOM_HEADER_IDENTIFYINGGROUP</a>:
<a name="l00412"></a>00412       <a class="code" href="classvil__dicom__header__format.html#aa81b6d0d1a5db4515dcc1eca3c433e02" title="Method to read the identifying group&#39;s details.">readIdentifyingElements</a>(element, data_block_size, fs);
<a name="l00413"></a>00413       <span class="keywordflow">break</span>;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415      <span class="comment">// Read the patient info</span>
<a name="l00416"></a>00416      <span class="keywordflow">case</span> <a class="code" href="vil__dicom__header_8h.html#ac974e35817533d0fd5c593d33d1921aa">VIL_DICOM_HEADER_PATIENTINFOGROUP</a>:
<a name="l00417"></a>00417       <a class="code" href="classvil__dicom__header__format.html#a31316c2e4df70e51b667eca2cdf014b7" title="Method to read the patient details.">readPatientElements</a>(element, data_block_size, fs);
<a name="l00418"></a>00418       <span class="keywordflow">break</span>;
<a name="l00419"></a>00419 
<a name="l00420"></a>00420      <span class="keywordflow">case</span> <a class="code" href="vil__dicom__header_8h.html#acc3895e75021ed11435228857596df37">VIL_DICOM_HEADER_ACQUISITIONGROUP</a>:
<a name="l00421"></a>00421       <a class="code" href="classvil__dicom__header__format.html#a747fc7a4e32252c276886fb3af15de5c" title="Method to read the acquisition group&#39;s details.">readAcquisitionElements</a>(element, data_block_size, fs);
<a name="l00422"></a>00422       <span class="keywordflow">break</span>;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424      <span class="keywordflow">case</span> <a class="code" href="vil__dicom__header_8h.html#a2a9fe42c20b71ebf0bb182ee8dbbeed2">VIL_DICOM_HEADER_RELATIONSHIPGROUP</a>:
<a name="l00425"></a>00425       <a class="code" href="classvil__dicom__header__format.html#af2eeaefd8f62755b598ab8b8c10a280b" title="Method to read the relationship group&#39;s details.">readRelationshipElements</a>(element, data_block_size, fs);
<a name="l00426"></a>00426       <span class="keywordflow">break</span>;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428      <span class="keywordflow">case</span> <a class="code" href="vil__dicom__header_8h.html#ac0037b3357924b6c1bf722c419f2b699">VIL_DICOM_HEADER_IMAGEGROUP</a>:
<a name="l00429"></a>00429       <a class="code" href="classvil__dicom__header__format.html#a930b7e723b5acd41a482edc60188a4be" title="Method to read the image group&#39;s details.">readImageElements</a>(element, data_block_size, fs);
<a name="l00430"></a>00430       <span class="keywordflow">break</span>;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432      <span class="keywordflow">case</span> <a class="code" href="vil__dicom__header_8h.html#adbbff22db0813e4ab08dbc527531fad6">VIL_DICOM_HEADER_DELIMITERGROUP</a>:
<a name="l00433"></a>00433       <a class="code" href="classvil__dicom__header__format.html#aa114f8705d54a6b49b23afd610913785" title="Method to read the delimiter group&#39;s details.">readDelimiterElements</a>(element, data_block_size, fs);
<a name="l00434"></a>00434       <span class="keywordflow">break</span>;
<a name="l00435"></a>00435 
<a name="l00436"></a>00436      <span class="comment">// Nothing found, so skip this data block</span>
<a name="l00437"></a>00437      <span class="keywordflow">default</span>:
<a name="l00438"></a>00438       fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(data_block_size + fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>());
<a name="l00439"></a>00439       <span class="keywordflow">break</span>;
<a name="l00440"></a>00440     } <span class="comment">// End of switch</span>
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     <span class="comment">// Read the next group and element</span>
<a name="l00443"></a>00443     fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;group, <span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l00444"></a>00444     fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;element, <span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="comment">// Swap them if necessary</span>
<a name="l00447"></a>00447     group = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(group);
<a name="l00448"></a>00448     element = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(element);
<a name="l00449"></a>00449   } <span class="comment">// End of while</span>
<a name="l00450"></a>00450 
<a name="l00451"></a>00451 
<a name="l00452"></a>00452   <span class="comment">// Read the final block size info - throw away!</span>
<a name="l00453"></a>00453   <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(vxl_uint_32) != fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;data_block_size, <span class="keyword">sizeof</span>(vxl_uint_32)))
<a name="l00454"></a>00454     <span class="keywordflow">return</span>;
<a name="l00455"></a>00455   data_block_size = <a class="code" href="classvil__dicom__header__format.html#a935fa97017c4e75dc2d801e85ffcea01" title="Method to byte swap an unsigned int if necessary.">intSwap</a>(data_block_size);
<a name="l00456"></a>00456   <span class="keywordflow">if</span> (data_block_size &gt; 0x1000000)
<a name="l00457"></a>00457     vcl_cerr &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; : WARNING\n&quot;</span>
<a name="l00458"></a>00458              &lt;&lt;<span class="stringliteral">&quot;data_block_size=&quot;</span> &lt;&lt; data_block_size &lt;&lt; <span class="stringliteral">&quot; is most probably too large\n&quot;</span>;
<a name="l00459"></a>00459   <span class="keywordflow">else</span>
<a name="l00460"></a>00460     <a class="code" href="classvil__dicom__header__format.html#a0b7f606eb1a76c59ce7dbb1107e0ed4f" title="Method to convert the Value Representation (VR) (if it exists).">convertValueRepresentation</a>(data_block_size, fs);
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <span class="comment">//================================================================</span>
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 <span class="comment">// These macros will be used a lot of times in the subsequent read* methods</span>
<a name="l00466"></a>00466 <span class="preprocessor">#define CASE(X,M,F) \</span>
<a name="l00467"></a>00467 <span class="preprocessor">   case X : \</span>
<a name="l00468"></a>00468 <span class="preprocessor">    data_p = new char[dblock_size+1]; </span><span class="comment">/* Ensure room for 0 */</span> \
<a name="l00469"></a>00469     if (data_p) \
<a name="l00470"></a>00470     { \
<a name="l00471"></a>00471       fs.read(data_p,dblock_size); \
<a name="l00472"></a>00472       data_p[dblock_size]=0; \
<a name="l00473"></a>00473       last_read_.M = F(data_p); \
<a name="l00474"></a>00474     } \
<a name="l00475"></a>00475     break
<a name="l00476"></a>00476 
<a name="l00477"></a>00477 <span class="preprocessor">#define CASE_SWP(X,M) \</span>
<a name="l00478"></a>00478 <span class="preprocessor">   case X : \</span>
<a name="l00479"></a>00479 <span class="preprocessor">    data_p = new char[dblock_size+1]; </span><span class="comment">/* Ensure room for 0 */</span> \
<a name="l00480"></a>00480     if (data_p) \
<a name="l00481"></a>00481     { \
<a name="l00482"></a>00482       fs.read(data_p,dblock_size); \
<a name="l00483"></a>00483       data_p[dblock_size]=0; \
<a name="l00484"></a>00484       charSwap(data_p, sizeof(vxl_uint_16)); \
<a name="l00485"></a>00485       last_read_.M = *((vxl_uint_16*)data_p); \
<a name="l00486"></a>00486     } \
<a name="l00487"></a>00487     break
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 <span class="keywordtype">void</span> <a class="code" href="classvil__dicom__header__format.html#aa81b6d0d1a5db4515dcc1eca3c433e02" title="Method to read the identifying group&#39;s details.">vil_dicom_header_format::readIdentifyingElements</a>(<span class="keywordtype">short</span> element,
<a name="l00490"></a>00490                                                       <span class="keywordtype">int</span> dblock_size,
<a name="l00491"></a>00491                                                       <a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00492"></a>00492 {
<a name="l00493"></a>00493   <span class="comment">// Pointer to any data read</span>
<a name="l00494"></a>00494   <span class="keywordtype">char</span> *data_p = 0;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496   <span class="comment">// Check the elements</span>
<a name="l00497"></a>00497   <span class="keywordflow">switch</span> ((vxl_uint_16)element)
<a name="l00498"></a>00498   {
<a name="l00499"></a>00499    CASE(<a class="code" href="vil__dicom__header_8h.html#a49c08995d3fbbc25fa1abd4815bbde46">VIL_DICOM_HEADER_IDIMAGETYPE</a>,         image_id_type_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the image type</span>
<a name="l00500"></a>00500    CASE(<a class="code" href="vil__dicom__header_8h.html#a54b30508c52b5cc1f9f66b83c9f4d0f6">VIL_DICOM_HEADER_IDSOPCLASSID</a>,        sop_cl_uid_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the SOP class ID</span>
<a name="l00501"></a>00501    CASE(<a class="code" href="vil__dicom__header_8h.html#a76ea0243c5c82967db866128ad4d0059">VIL_DICOM_HEADER_IDSOPINSTANCEID</a>,     sop_in_uid_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the SOP instance ID</span>
<a name="l00502"></a>00502    CASE(<a class="code" href="vil__dicom__header_8h.html#a53397f8e6166c5066f4d9ff8598b7ac5">VIL_DICOM_HEADER_IDSTUDYDATE</a>,         study_date_,vcl_atol); <span class="comment">// It&#39;s the study date</span>
<a name="l00503"></a>00503    CASE(<a class="code" href="vil__dicom__header_8h.html#af17ef247e2907b389fbf45ed2fae6770">VIL_DICOM_HEADER_IDSERIESDATE</a>,        series_date_,vcl_atol); <span class="comment">// It&#39;s the series date</span>
<a name="l00504"></a>00504    CASE(<a class="code" href="vil__dicom__header_8h.html#a634042951bceccb9d2af2cc7b295edb7">VIL_DICOM_HEADER_IDACQUISITIONDATE</a>,   acquisition_date_,vcl_atol); <span class="comment">// It&#39;s the acquisition date</span>
<a name="l00505"></a>00505    CASE(<a class="code" href="vil__dicom__header_8h.html#a6a8cc514f21f78318c2c1255a777c775">VIL_DICOM_HEADER_IDIMAGEDATE</a>,         image_date_,vcl_atol); <span class="comment">// It&#39;s the image date</span>
<a name="l00506"></a>00506    CASE(<a class="code" href="vil__dicom__header_8h.html#ab1cf322912ef104b87be4bb3bf3c17cc">VIL_DICOM_HEADER_IDSTUDYTIME</a>,         study_time_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the study time</span>
<a name="l00507"></a>00507    CASE(<a class="code" href="vil__dicom__header_8h.html#acc10750c74d52e7ca130c321868aa7e0">VIL_DICOM_HEADER_IDSERIESTIME</a>,        series_time_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the series time</span>
<a name="l00508"></a>00508    CASE(<a class="code" href="vil__dicom__header_8h.html#a0bf13af39052cbf2095e66510ca76806">VIL_DICOM_HEADER_IDACQUISITIONTIME</a>,   acquisition_time_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the acquisition time</span>
<a name="l00509"></a>00509    CASE(<a class="code" href="vil__dicom__header_8h.html#ae52d795ec3f58874fc4275e8802b1eac">VIL_DICOM_HEADER_IDIMAGETIME</a>,         image_time_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the image time</span>
<a name="l00510"></a>00510    CASE(<a class="code" href="vil__dicom__header_8h.html#a78828616109077f514fd2c84d850000e">VIL_DICOM_HEADER_IDACCESSIONNUMBER</a>,   accession_number_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the accession number</span>
<a name="l00511"></a>00511    CASE(<a class="code" href="vil__dicom__header_8h.html#af672e323ee91e82da2955a98ae6d32b0">VIL_DICOM_HEADER_IDMODALITY</a>,          modality_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the imaging modality</span>
<a name="l00512"></a>00512    CASE(<a class="code" href="vil__dicom__header_8h.html#ae618dc2792e30a0bce544158e08ed281">VIL_DICOM_HEADER_IDMANUFACTURER</a>,      manufacturer_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the manufacturer name</span>
<a name="l00513"></a>00513    CASE(<a class="code" href="vil__dicom__header_8h.html#a0a126a1cc79c45488f5b8244496131fb">VIL_DICOM_HEADER_IDINSTITUTIONNAME</a>,   institution_name_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the institution name</span>
<a name="l00514"></a>00514    CASE(<a class="code" href="vil__dicom__header_8h.html#a09362ec83270cd7815ec109ad13bf440">VIL_DICOM_HEADER_IDINSTITUTIONADDRESS</a>,institution_addr_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the institution address</span>
<a name="l00515"></a>00515    CASE(<a class="code" href="vil__dicom__header_8h.html#a3e94dd266a6a6661e8688af8b90a0fec">VIL_DICOM_HEADER_IDREFERRINGPHYSICIAN</a>,ref_phys_name_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the referring physician&#39;s name</span>
<a name="l00516"></a>00516    CASE(<a class="code" href="vil__dicom__header_8h.html#a9dc6b3b6e48fc9f47d9bc8f79cc629a8">VIL_DICOM_HEADER_IDSTATIONNAME</a>,       station_name_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the imaging station name</span>
<a name="l00517"></a>00517    CASE(<a class="code" href="vil__dicom__header_8h.html#ac66ed4bee89c5705fdaabbe379f4257e">VIL_DICOM_HEADER_IDSTUDYDESCRIPTION</a>,  study_desc_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the study description</span>
<a name="l00518"></a>00518    CASE(<a class="code" href="vil__dicom__header_8h.html#af6ba48c4b9dd6731d843d2873ff608bc">VIL_DICOM_HEADER_IDSERIESDESCRIPTION</a>, series_desc_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the series description</span>
<a name="l00519"></a>00519    CASE(<a class="code" href="vil__dicom__header_8h.html#ab6d1a283028e9c8450ac6a1686520105">VIL_DICOM_HEADER_IDATTENDINGPHYSICIAN</a>,att_phys_name_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the name of the attending physician</span>
<a name="l00520"></a>00520    CASE(<a class="code" href="vil__dicom__header_8h.html#a5eaffbb90c00f6a18c5d4c59cc11be67">VIL_DICOM_HEADER_IDOPERATORNAME</a>,      operator_name_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the name of the scanner operator</span>
<a name="l00521"></a>00521    CASE(<a class="code" href="vil__dicom__header_8h.html#a234b9789eb76e72c9e194ca1c0948acd">VIL_DICOM_HEADER_IDMANUFACTURERMODEL</a>, model_name_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the scanner model</span>
<a name="l00522"></a>00522    <span class="keywordflow">default</span>: <span class="comment">// It&#39;s nothing we want, so skip it!</span>
<a name="l00523"></a>00523     fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(dblock_size + fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>());
<a name="l00524"></a>00524     <span class="keywordflow">break</span>;
<a name="l00525"></a>00525   } <span class="comment">// End of switch</span>
<a name="l00526"></a>00526 
<a name="l00527"></a>00527   <span class="keyword">delete</span>[] data_p;
<a name="l00528"></a>00528 }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530 <span class="comment">//================================================================</span>
<a name="l00531"></a>00531 
<a name="l00532"></a>00532 <span class="keywordtype">void</span> <a class="code" href="classvil__dicom__header__format.html#a31316c2e4df70e51b667eca2cdf014b7" title="Method to read the patient details.">vil_dicom_header_format::readPatientElements</a>(<span class="keywordtype">short</span> element,
<a name="l00533"></a>00533                                                   <span class="keywordtype">int</span> dblock_size,
<a name="l00534"></a>00534                                                   <a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00535"></a>00535 {
<a name="l00536"></a>00536   <span class="comment">// Pointer to any data read</span>
<a name="l00537"></a>00537   <span class="keywordtype">char</span> *data_p = 0;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539   <span class="comment">// Check the elements</span>
<a name="l00540"></a>00540   <span class="keywordflow">switch</span> ((vxl_uint_16)element)
<a name="l00541"></a>00541   {
<a name="l00542"></a>00542    CASE(<a class="code" href="vil__dicom__header_8h.html#aa15ac17e49d5804fdae718fd5be153ad">VIL_DICOM_HEADER_PIPATIENTNAME</a>,     patient_name_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the patient&#39;s name</span>
<a name="l00543"></a>00543    CASE(<a class="code" href="vil__dicom__header_8h.html#af8563201d235952c51bc06c1f6b67763">VIL_DICOM_HEADER_PIPATIENTID</a>,       patient_id_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the patient&#39;s id</span>
<a name="l00544"></a>00544    CASE(<a class="code" href="vil__dicom__header_8h.html#a7705ed0b925f80870438dbbab7619491">VIL_DICOM_HEADER_PIPATIENTBIRTHDATE</a>,patient_dob_,vcl_atol); <span class="comment">// It&#39;s the patient&#39;s date of birth</span>
<a name="l00545"></a>00545    CASE(<a class="code" href="vil__dicom__header_8h.html#ae8e5fd216948aa93b4c14ffde5441423">VIL_DICOM_HEADER_PIPATIENTSEX</a>,      patient_sex_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the patient&#39;s sex</span>
<a name="l00546"></a>00546    CASE(<a class="code" href="vil__dicom__header_8h.html#a831ea81f642ccdb32f881039d2d06730">VIL_DICOM_HEADER_PIPATIENTAGE</a>,      patient_age_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the patient&#39;s age</span>
<a name="l00547"></a>00547    CASE(<a class="code" href="vil__dicom__header_8h.html#abc044431697ee7cbba287de0ab67d430">VIL_DICOM_HEADER_PIPATIENTWEIGHT</a>,   patient_weight_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the patient&#39;s weight</span>
<a name="l00548"></a>00548    CASE(<a class="code" href="vil__dicom__header_8h.html#ae1507df0647765e66980ad8c6a732cfa">VIL_DICOM_HEADER_PIPATIENTHISTORY</a>,  patient_hist_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the patient&#39;s history</span>
<a name="l00549"></a>00549    <span class="keywordflow">default</span>: <span class="comment">// It&#39;s nothing we want, so skip it!</span>
<a name="l00550"></a>00550     fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(dblock_size + fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>());
<a name="l00551"></a>00551     <span class="keywordflow">break</span>;
<a name="l00552"></a>00552   } <span class="comment">// End of switch</span>
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   <span class="keyword">delete</span>[] data_p;
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 <span class="comment">//================================================================</span>
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 <span class="keywordtype">void</span> <a class="code" href="classvil__dicom__header__format.html#a747fc7a4e32252c276886fb3af15de5c" title="Method to read the acquisition group&#39;s details.">vil_dicom_header_format::readAcquisitionElements</a>(<span class="keywordtype">short</span> element,
<a name="l00560"></a>00560                                                       <span class="keywordtype">int</span> dblock_size,
<a name="l00561"></a>00561                                                       <a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563   <span class="comment">// Pointer to any data read</span>
<a name="l00564"></a>00564   <span class="keywordtype">char</span> *data_p = 0;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <span class="comment">// Check the elements</span>
<a name="l00567"></a>00567   <span class="keywordflow">switch</span> ((vxl_uint_16)element)
<a name="l00568"></a>00568   {
<a name="l00569"></a>00569    CASE(<a class="code" href="vil__dicom__header_8h.html#a5c66e122514d11d5a3c9179311ba18c8">VIL_DICOM_HEADER_AQSCANNINGSEQUENCE</a>,      scanning_seq_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the scanning sequence</span>
<a name="l00570"></a>00570    CASE(<a class="code" href="vil__dicom__header_8h.html#afb1d81e712ec2f6a4cb18290200ddd4b">VIL_DICOM_HEADER_AQSEQUENCEVARIANT</a>,       sequence_var_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the sequence variant</span>
<a name="l00571"></a>00571    CASE(<a class="code" href="vil__dicom__header_8h.html#a3e620d2f09e13b4303cb079ba64e8b04">VIL_DICOM_HEADER_AQSCANOPTIONS</a>,           scan_options_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the scan options</span>
<a name="l00572"></a>00572    CASE(<a class="code" href="vil__dicom__header_8h.html#ae7ecc85440c857bd8fa8873db660a586">VIL_DICOM_HEADER_AQMRACQUISITIONTYPE</a>,     mr_acq_type_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the MR acquisition type</span>
<a name="l00573"></a>00573    CASE(<a class="code" href="vil__dicom__header_8h.html#a2691051d85aef0e0425a225586ca609a">VIL_DICOM_HEADER_AQSEQUENCENAME</a>,          sequence_name_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the sequence name</span>
<a name="l00574"></a>00574    CASE(<a class="code" href="vil__dicom__header_8h.html#acfcccd76b3f237ce71962e83def3a7fd">VIL_DICOM_HEADER_AQANGIOFLAG</a>,             angio_flag_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the angio flag</span>
<a name="l00575"></a>00575    CASE(<a class="code" href="vil__dicom__header_8h.html#a5bd1792246124826ed8f288d33070060">VIL_DICOM_HEADER_AQSLICETHICKNESS</a>,        slice_thickness_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the slice thickness</span>
<a name="l00576"></a>00576    CASE(<a class="code" href="vil__dicom__header_8h.html#aa1648d1afbecd7a6e0c1eaf99ccef7a4">VIL_DICOM_HEADER_AQREPETITIONTIME</a>,        repetition_time_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the repetition time</span>
<a name="l00577"></a>00577    CASE(<a class="code" href="vil__dicom__header_8h.html#aa90534e399ba1bbbaa5a003cd80a45a5">VIL_DICOM_HEADER_AQECHOTIME</a>,              echo_time_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the echo time</span>
<a name="l00578"></a>00578    CASE(<a class="code" href="vil__dicom__header_8h.html#ad27102f86564f725905948e6e3d1bbd7">VIL_DICOM_HEADER_AQINVERSIONTIME</a>,         inversion_time_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the inversion time</span>
<a name="l00579"></a>00579    CASE(<a class="code" href="vil__dicom__header_8h.html#aeb2951772cb72a43094c2f4a30795f36">VIL_DICOM_HEADER_AQNUMBEROFAVERAGES</a>,      number_of_averages_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the number of averages</span>
<a name="l00580"></a>00580    CASE(<a class="code" href="vil__dicom__header_8h.html#a3135915873e46289b63c2aac9fdd891b">VIL_DICOM_HEADER_AQECHONUMBERS</a>,           echo_numbers_,vcl_atoi); <span class="comment">// It&#39;s the echo numbers</span>
<a name="l00581"></a>00581    CASE(<a class="code" href="vil__dicom__header_8h.html#a4848a19fc4ac4ebdec8eff3290d4c36d">VIL_DICOM_HEADER_AQMAGNETICFIELDSTRENGTH</a>, mag_field_strength_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the magnetic field strength</span>
<a name="l00582"></a>00582    CASE(<a class="code" href="vil__dicom__header_8h.html#a5afb7a9d1af13d4e4685f310618735eb">VIL_DICOM_HEADER_AQSLICESPACING</a>,          spacing_slice_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the slice spacing</span>
<a name="l00583"></a>00583    CASE(<a class="code" href="vil__dicom__header_8h.html#a8fbc83f095886a94b02710a3a04cab04">VIL_DICOM_HEADER_AQECHOTRAINLENGTH</a>,       echo_train_length_,(<span class="keywordtype">int</span>)vcl_atoi); <span class="comment">// It&#39;s the echo train length</span>
<a name="l00584"></a>00584    CASE(<a class="code" href="vil__dicom__header_8h.html#ac39f29f202f55360b40b17775e600a1b">VIL_DICOM_HEADER_AQPIXELBANDWIDTH</a>,        pixel_bandwidth_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the pixel bandwidth</span>
<a name="l00585"></a>00585    CASE(<a class="code" href="vil__dicom__header_8h.html#a6540c54116a6913f9498186f791af4ea">VIL_DICOM_HEADER_AQSOFTWAREVERSION</a>,       software_vers_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the scanner software version</span>
<a name="l00586"></a>00586    CASE(<a class="code" href="vil__dicom__header_8h.html#affb350942cf19244f89cab7b651371fb">VIL_DICOM_HEADER_AQPROTOCOLNAME</a>,          protocol_name_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the protocol name</span>
<a name="l00587"></a>00587    CASE(<a class="code" href="vil__dicom__header_8h.html#af77c28ac9e86ccd916af815c1e8f7975">VIL_DICOM_HEADER_AQHEARTRATE</a>,             heart_rate_,vcl_atoi); <span class="comment">// It&#39;s the heart rate</span>
<a name="l00588"></a>00588    CASE(<a class="code" href="vil__dicom__header_8h.html#a0f5d8a13168927b0aa8c9a64f77827ae">VIL_DICOM_HEADER_AQCARDIACNUMBEROFIMAGES</a>, card_num_images_,vcl_atoi); <span class="comment">// It&#39;s the cardiac number of images</span>
<a name="l00589"></a>00589    CASE(<a class="code" href="vil__dicom__header_8h.html#ab6109d8541cc9ac6fff8deb0429bed64">VIL_DICOM_HEADER_AQTRIGGERWINDOW</a>,         trigger_window_,vcl_atoi); <span class="comment">// It&#39;s the trigger window</span>
<a name="l00590"></a>00590    CASE(<a class="code" href="vil__dicom__header_8h.html#a30dd0ae6557908aab04c33ea017f3d18">VIL_DICOM_HEADER_AQRECONTRUCTIONDIAMETER</a>, reconst_diameter_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the reconstruction diameter</span>
<a name="l00591"></a>00591    CASE(<a class="code" href="vil__dicom__header_8h.html#aaf2caf85b9e1ccd5a119cab9c3bb11f8">VIL_DICOM_HEADER_AQRECEIVINGCOIL</a>,         receiving_coil_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the receiving coil</span>
<a name="l00592"></a>00592    CASE(<a class="code" href="vil__dicom__header_8h.html#a4ac4635440b2b3b4deb54e40c1a705dd">VIL_DICOM_HEADER_AQPHASEENCODINGDIRECTION</a>,phase_enc_dir_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the phase encoding direction</span>
<a name="l00593"></a>00593    CASE(<a class="code" href="vil__dicom__header_8h.html#a125c8f26626fd78bd718ebfe2c9ec80e">VIL_DICOM_HEADER_AQFLIPANGLE</a>,             flip_angle_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the flip angle</span>
<a name="l00594"></a>00594    CASE(<a class="code" href="vil__dicom__header_8h.html#a2bf8b6264f15813724b20b0556cdac08">VIL_DICOM_HEADER_AQSAR</a>,                   sar_,(<span class="keywordtype">float</span>)vcl_atof); <span class="comment">// It&#39;s the sar</span>
<a name="l00595"></a>00595    CASE(<a class="code" href="vil__dicom__header_8h.html#a7c854fdf75a948ccfa47e6d8d0423fb4">VIL_DICOM_HEADER_AQPATIENTPOSITION</a>,       patient_pos_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the patient position</span>
<a name="l00596"></a>00596    <span class="keywordflow">default</span>: <span class="comment">// It&#39;s nothing we want, so skip it!</span>
<a name="l00597"></a>00597     fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(dblock_size + fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>());
<a name="l00598"></a>00598     <span class="keywordflow">break</span>;
<a name="l00599"></a>00599   } <span class="comment">// End of switch</span>
<a name="l00600"></a>00600 
<a name="l00601"></a>00601   <span class="keyword">delete</span>[] data_p;
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 <span class="comment">//================================================================</span>
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 <span class="keywordtype">void</span> <a class="code" href="classvil__dicom__header__format.html#af2eeaefd8f62755b598ab8b8c10a280b" title="Method to read the relationship group&#39;s details.">vil_dicom_header_format::readRelationshipElements</a>(<span class="keywordtype">short</span> element,
<a name="l00607"></a>00607                                                        <span class="keywordtype">int</span> dblock_size,
<a name="l00608"></a>00608                                                        <a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00609"></a>00609 {
<a name="l00610"></a>00610   <span class="comment">// Pointer to any data read</span>
<a name="l00611"></a>00611   <span class="keywordtype">char</span> *data_p = 0;
<a name="l00612"></a>00612 
<a name="l00613"></a>00613   <span class="comment">// Check the elements</span>
<a name="l00614"></a>00614   <span class="keywordflow">switch</span> ((vxl_uint_16)element)
<a name="l00615"></a>00615   {
<a name="l00616"></a>00616    CASE(<a class="code" href="vil__dicom__header_8h.html#a985757eaccf9ee42c708cd223ac5783b">VIL_DICOM_HEADER_RSSTUDYINSTANCEUID</a>,   stud_ins_uid_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the study instance id</span>
<a name="l00617"></a>00617    CASE(<a class="code" href="vil__dicom__header_8h.html#afc6b9e46eda8faee0beb85f5df33434d">VIL_DICOM_HEADER_RSSERIESINSTANCEUID</a>,  ser_ins_uid_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the series instance id</span>
<a name="l00618"></a>00618    CASE(<a class="code" href="vil__dicom__header_8h.html#abb2e5b9740165d09abd541877bda0fd0">VIL_DICOM_HEADER_RSSTUDYID</a>,            study_id_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the study id</span>
<a name="l00619"></a>00619    CASE(<a class="code" href="vil__dicom__header_8h.html#a5282d5b9bcb6099d9f0c8d02ebd37249">VIL_DICOM_HEADER_RSSERIESNUMBER</a>,       series_number_,vcl_atoi); <span class="comment">// It&#39;s the series number</span>
<a name="l00620"></a>00620    CASE(<a class="code" href="vil__dicom__header_8h.html#aa5a917d2a2ac7b9556100ea8590f2fe1">VIL_DICOM_HEADER_RSAQUISITIONNUMBER</a>,   acquisition_number_,vcl_atoi); <span class="comment">// It&#39;s the acqusition number</span>
<a name="l00621"></a>00621    CASE(<a class="code" href="vil__dicom__header_8h.html#a1c9229c54435c5a16fb51e0b246aa5cb">VIL_DICOM_HEADER_RSIMAGENUMBER</a>,        image_number_,vcl_atoi); <span class="comment">// It&#39;s the image number</span>
<a name="l00622"></a>00622    CASE(<a class="code" href="vil__dicom__header_8h.html#ae45ce4f6da7101512b12d881a4bb2795">VIL_DICOM_HEADER_RSPATIENTORIENTATION</a>, pat_orient_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the patient orientation</span>
<a name="l00623"></a>00623 <span class="comment">//   CASE(VIL_DICOM_HEADER_RSIMAGEPOSITION,      image_pos_, (float)vcl_atof); // It&#39;s the image position</span>
<a name="l00624"></a>00624 <span class="comment">//   CASE(VIL_DICOM_HEADER_RSIMAGEORIENTATION,   image_orient_, (float)vcl_atof); // It&#39;s the image orientation</span>
<a name="l00625"></a>00625    CASE(<a class="code" href="vil__dicom__header_8h.html#a55be282bc2f827d9dc55b74a1bb5c4c7">VIL_DICOM_HEADER_RSFRAMEOFREFERENCEUID</a>,frame_of_ref_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the frame of reference uid</span>
<a name="l00626"></a>00626    CASE(<a class="code" href="vil__dicom__header_8h.html#a054f56038bd914ca25fae4000e77c377">VIL_DICOM_HEADER_RSIMAGESINACQUISITION</a>,images_in_acq_,vcl_atoi); <span class="comment">// It&#39;s the number of images in the acquisition</span>
<a name="l00627"></a>00627    CASE(<a class="code" href="vil__dicom__header_8h.html#ae3ea6ecd25435e948f062546ad7b9998">VIL_DICOM_HEADER_RSPOSITIONREFERENCE</a>,  pos_ref_ind_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the position reference</span>
<a name="l00628"></a>00628    CASE(<a class="code" href="vil__dicom__header_8h.html#a407d74aab1eb571baee91ae37d23042f">VIL_DICOM_HEADER_RSSLICELOCATION</a>,      slice_location_,(<span class="keywordtype">float</span>) vcl_atof); <span class="comment">// It&#39;s the slice location</span>
<a name="l00629"></a>00629    <span class="keywordflow">default</span>: <span class="comment">// It&#39;s nothing we want, so skip it!</span>
<a name="l00630"></a>00630     fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(dblock_size + fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>());
<a name="l00631"></a>00631     <span class="keywordflow">break</span>;
<a name="l00632"></a>00632   } <span class="comment">// End of switch</span>
<a name="l00633"></a>00633 
<a name="l00634"></a>00634   <span class="keyword">delete</span>[] data_p;
<a name="l00635"></a>00635 }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 <span class="comment">//================================================================</span>
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 <span class="keywordtype">void</span> <a class="code" href="classvil__dicom__header__format.html#a930b7e723b5acd41a482edc60188a4be" title="Method to read the image group&#39;s details.">vil_dicom_header_format::readImageElements</a>(<span class="keywordtype">short</span> element,
<a name="l00641"></a>00641                                                 <span class="keywordtype">int</span> dblock_size,
<a name="l00642"></a>00642                                                 <a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644     <span class="comment">// Pointer to any data read</span>
<a name="l00645"></a>00645   <span class="keywordtype">char</span> *data_p = 0;
<a name="l00646"></a>00646 
<a name="l00647"></a>00647   <span class="comment">// Check the elements</span>
<a name="l00648"></a>00648   <span class="keywordflow">switch</span> ((vxl_uint_16)element)
<a name="l00649"></a>00649   {
<a name="l00650"></a>00650    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#af8102cceb923a539505bc348478fc8b0">VIL_DICOM_HEADER_IMSAMPLESPERPIXEL</a>,    pix_samps_); <span class="comment">// It&#39;s the samples per pixel</span>
<a name="l00651"></a>00651    CASE(<a class="code" href="vil__dicom__header_8h.html#ab744b7561d554cd8cd550b61fb2514ae">VIL_DICOM_HEADER_IMPHOTOMETRICINTERP</a>,      photo_interp_, (<span class="keywordtype">char</span> *)); <span class="comment">// It&#39;s the photometric interpretation</span>
<a name="l00652"></a>00652    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#a5497665267d771ce5d8559b1ea3e5148">VIL_DICOM_HEADER_IMROWS</a>,               size_y_); <span class="comment">// It&#39;s the rows</span>
<a name="l00653"></a>00653    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#a650b56f631e38185d7dbbec28cec6c21">VIL_DICOM_HEADER_IMCOLUMNS</a>,            size_x_); <span class="comment">// It&#39;s the columns</span>
<a name="l00654"></a>00654    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#a651508421d7b3d0b390c2f79ead3e8e4">VIL_DICOM_HEADER_IMPLANES</a>,             size_z_); <span class="comment">// It&#39;s the planes</span>
<a name="l00655"></a>00655    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#a71f4e5d1a68fe266ec8842936ac811c3">VIL_DICOM_HEADER_IMBITSALLOCATED</a>,      allocated_bits_); <span class="comment">// It&#39;s the allocated bits</span>
<a name="l00656"></a>00656    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#a7576d24cdfdb4a79269c4b967a3dc49b">VIL_DICOM_HEADER_IMBITSSTORED</a>,         stored_bits_); <span class="comment">// It&#39;s the stored bits info</span>
<a name="l00657"></a>00657    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#a87cf772028d1bc316343eaf2c813efc9">VIL_DICOM_HEADER_IMHIGHBIT</a>,            high_bit_); <span class="comment">// It&#39;s the high bit</span>
<a name="l00658"></a>00658    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#a1ef3b1eaeb62be2cff0b504789972d7d">VIL_DICOM_HEADER_IMPIXELREPRESENTATION</a>,pix_rep_); <span class="comment">// It&#39;s the pixel representation</span>
<a name="l00659"></a>00659    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#aec282f2208bff9332e50c446217fa728">VIL_DICOM_HEADER_IMSMALLIMPIXELVALUE</a>,  small_im_pix_val_); <span class="comment">// It&#39;s the smallest image pixel value</span>
<a name="l00660"></a>00660    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#a6d2e9adaef49b3c5f686c3f917c5c8d0">VIL_DICOM_HEADER_IMLARGEIMPIXELVALUE</a>,  large_im_pix_val_); <span class="comment">// It&#39;s the largest image pixel value</span>
<a name="l00661"></a>00661    CASE_SWP(<a class="code" href="vil__dicom__header_8h.html#af837cb0ea47059cefe552390ddd55631">VIL_DICOM_HEADER_IMPIXELPADDINGVALUE</a>,  pixel_padding_val_); <span class="comment">// It&#39;s the pixel padding value</span>
<a name="l00662"></a>00662    CASE(<a class="code" href="vil__dicom__header_8h.html#a0f12de78417596d9502553241d61c529">VIL_DICOM_HEADER_IMWINDOWCENTER</a>,           window_centre_,(<span class="keywordtype">float</span>) vcl_atof); <span class="comment">// It&#39;s the window centre</span>
<a name="l00663"></a>00663    CASE(<a class="code" href="vil__dicom__header_8h.html#ac90346a81b93f5ea8d412606a931eec0">VIL_DICOM_HEADER_IMWINDOWWIDTH</a>,            window_width_,(<span class="keywordtype">float</span>) vcl_atof); <span class="comment">// It&#39;s the window width</span>
<a name="l00664"></a>00664    CASE(<a class="code" href="vil__dicom__header_8h.html#a7c1064ae5b59337651a4b2e92430ea96">VIL_DICOM_HEADER_IMRESCALEINTERCEPT</a>,       res_intercept_,(<span class="keywordtype">float</span>) vcl_atof); <span class="comment">// It&#39;s the rescale intercept</span>
<a name="l00665"></a>00665    CASE(<a class="code" href="vil__dicom__header_8h.html#a25fbc72b6f6462721fc4961f924d6c0b">VIL_DICOM_HEADER_IMRESCALESLOPE</a>,           res_slope_,(<span class="keywordtype">float</span>) vcl_atof); <span class="comment">// It&#39;s the rescale slope</span>
<a name="l00666"></a>00666    <span class="keywordflow">case</span> <a class="code" href="vil__dicom__header_8h.html#af97f3dc88fe4f25cf706ea56ee919ad6">VIL_DICOM_HEADER_IMPIXELSPACING</a> : <span class="comment">// It&#39;s the pixel spacing</span>
<a name="l00667"></a>00667     data_p = <span class="keyword">new</span> <span class="keywordtype">char</span>[dblock_size+1];
<a name="l00668"></a>00668     <span class="keywordflow">if</span> (data_p)
<a name="l00669"></a>00669     {
<a name="l00670"></a>00670       fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(data_p,dblock_size);
<a name="l00671"></a>00671       data_p[dblock_size]=0;
<a name="l00672"></a>00672       <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#a683166f59271e8f0ff82c898d1700347">spacing_x_</a> = (float) vcl_atof(data_p);
<a name="l00673"></a>00673 
<a name="l00674"></a>00674       <span class="comment">// The y size should come after a &#39;\&#39;</span>
<a name="l00675"></a>00675       <span class="comment">// If only a 0 is found, ysize = xsize</span>
<a name="l00676"></a>00676       <span class="keywordtype">char</span> gone = <span class="charliteral">&#39;x&#39;</span>;
<a name="l00677"></a>00677       <span class="keywordflow">while</span> (gone != 0 &amp;&amp; gone != <span class="charliteral">&#39;\\&#39;</span>)
<a name="l00678"></a>00678       {
<a name="l00679"></a>00679         gone = data_p[0];
<a name="l00680"></a>00680         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;dblock_size; i++)
<a name="l00681"></a>00681           data_p[i] = data_p[i+1];
<a name="l00682"></a>00682       }
<a name="l00683"></a>00683       <span class="keywordflow">if</span> (gone == <span class="charliteral">&#39;\\&#39;</span>)
<a name="l00684"></a>00684         <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#ac3a6905bb65779442664f412770e1094">spacing_y_</a> = (float) vcl_atof(data_p);
<a name="l00685"></a>00685       <span class="keywordflow">else</span>
<a name="l00686"></a>00686         <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#ac3a6905bb65779442664f412770e1094">spacing_y_</a> = (float) <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#a683166f59271e8f0ff82c898d1700347">spacing_x_</a>;
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688     <span class="keywordflow">break</span>;
<a name="l00689"></a>00689 
<a name="l00690"></a>00690    <span class="keywordflow">default</span>: <span class="comment">// It&#39;s nothing we want, so skip it!</span>
<a name="l00691"></a>00691     fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(dblock_size + fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>());
<a name="l00692"></a>00692     <span class="keywordflow">break</span>;
<a name="l00693"></a>00693   } <span class="comment">// End of switch</span>
<a name="l00694"></a>00694 
<a name="l00695"></a>00695   <span class="keyword">delete</span>[] data_p;
<a name="l00696"></a>00696 }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 <span class="comment">//================================================================</span>
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 <span class="keywordtype">void</span> <a class="code" href="classvil__dicom__header__format.html#aa114f8705d54a6b49b23afd610913785" title="Method to read the delimiter group&#39;s details.">vil_dicom_header_format::readDelimiterElements</a>(<span class="keywordtype">short</span> element,
<a name="l00701"></a>00701                                                     <span class="keywordtype">int</span> dblock_size,
<a name="l00702"></a>00702                                                     <a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00703"></a>00703 {
<a name="l00704"></a>00704   <span class="comment">// Check the elements</span>
<a name="l00705"></a>00705   <span class="keywordflow">switch</span> ((vxl_uint_16)element)
<a name="l00706"></a>00706   {
<a name="l00707"></a>00707    <span class="keywordflow">case</span> <a class="code" href="vil__dicom__header_8h.html#a3ceb0f820fee2df6a2b5c31fdd413f48">VIL_DICOM_HEADER_DLITEM</a>:
<a name="l00708"></a>00708    <span class="keywordflow">case</span> <a class="code" href="vil__dicom__header_8h.html#a0c07b6ebb69058ed6cd6e16387693721">VIL_DICOM_HEADER_DLITEMDELIMITATIONITEM</a>:
<a name="l00709"></a>00709    <span class="keywordflow">case</span> <a class="code" href="vil__dicom__header_8h.html#a56b550b39987a1deae52ea0fa2b5819f">VIL_DICOM_HEADER_DLSEQDELIMITATIONITEM</a>:
<a name="l00710"></a>00710     <span class="comment">// There&#39;s no data block</span>
<a name="l00711"></a>00711     <span class="keywordflow">break</span>;
<a name="l00712"></a>00712     <span class="comment">// It&#39;s nothing we want, so skip it!</span>
<a name="l00713"></a>00713    <span class="keywordflow">default</span>:
<a name="l00714"></a>00714     fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(dblock_size + fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>());
<a name="l00715"></a>00715     <span class="keywordflow">break</span>;
<a name="l00716"></a>00716   } <span class="comment">// End of switch</span>
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 <span class="comment">//================================================================</span>
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 <span class="keywordtype">bool</span> <a class="code" href="classvil__dicom__header__format.html#a0b7f606eb1a76c59ce7dbb1107e0ed4f" title="Method to convert the Value Representation (VR) (if it exists).">vil_dicom_header_format::convertValueRepresentation</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;dblock_size,
<a name="l00722"></a>00722                                                          <a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00723"></a>00723 {
<a name="l00724"></a>00724   <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l00725"></a>00725   vcl_string first, last;
<a name="l00726"></a>00726   <span class="keywordtype">char</span> temp[3];
<a name="l00727"></a>00727 
<a name="l00728"></a>00728   <span class="comment">// Union to convert the int to chars</span>
<a name="l00729"></a>00729   <span class="keyword">union </span>int_char
<a name="l00730"></a>00730   {
<a name="l00731"></a>00731     vxl_uint_32 int_val;
<a name="l00732"></a>00732     <span class="keywordtype">char</span> char_val[4];
<a name="l00733"></a>00733   } conv_dblock;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735   <span class="keywordflow">if</span> (<a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#a5cc976b81614b99175f1106c221ec52e">file_type_</a> != <a class="code" href="vil__dicom__header_8h.html#ab095159c91414d5c498ec1b31c3fdc70a88abc3c43dc62161c2b371a2e6141f11">VIL_DICOM_HEADER_DTUNKNOWN</a>)
<a name="l00736"></a>00736   {
<a name="l00737"></a>00737     conv_dblock.int_val = dblock_size;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     <span class="comment">// Create the strings to check (the latter two positions in</span>
<a name="l00740"></a>00740     <span class="comment">// the vcl_string are swapped in case of little endian-ness)</span>
<a name="l00741"></a>00741     temp[0] = conv_dblock.char_val[0];
<a name="l00742"></a>00742     temp[1] = conv_dblock.char_val[1];
<a name="l00743"></a>00743     temp[2] = 0;
<a name="l00744"></a>00744 
<a name="l00745"></a>00745     first = temp;
<a name="l00746"></a>00746 
<a name="l00747"></a>00747     temp[0] = conv_dblock.char_val[3];
<a name="l00748"></a>00748     temp[1] = conv_dblock.char_val[2];
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     last = temp;
<a name="l00751"></a>00751 
<a name="l00752"></a>00752     <span class="comment">// Check if VR is a nested sequence (SQ)</span>
<a name="l00753"></a>00753     <span class="keywordflow">if</span> (first == <a class="code" href="vil__dicom__header_8h.html#a6cd16b2a3d4e601142e4c2881d34a1e9">VIL_DICOM_HEADER_SEQUENCE</a> || last == <a class="code" href="vil__dicom__header_8h.html#a6cd16b2a3d4e601142e4c2881d34a1e9">VIL_DICOM_HEADER_SEQUENCE</a>)
<a name="l00754"></a>00754     {
<a name="l00755"></a>00755       fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;dblock_size, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00756"></a>00756       dblock_size = 0;
<a name="l00757"></a>00757       result = <span class="keyword">true</span>;
<a name="l00758"></a>00758     } <span class="comment">// End of if (first...)</span>
<a name="l00759"></a>00759     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (first == <a class="code" href="vil__dicom__header_8h.html#a106fb58fee3043bdcfd8f169e9d34a11">VIL_DICOM_HEADER_OTHERBYTE</a> ||
<a name="l00760"></a>00760              first == <a class="code" href="vil__dicom__header_8h.html#a0fd66ba7d198d31e00047eff08f38525">VIL_DICOM_HEADER_OTHERWORD</a> ||
<a name="l00761"></a>00761              last == <a class="code" href="vil__dicom__header_8h.html#a106fb58fee3043bdcfd8f169e9d34a11">VIL_DICOM_HEADER_OTHERBYTE</a>  ||
<a name="l00762"></a>00762              last == <a class="code" href="vil__dicom__header_8h.html#a0fd66ba7d198d31e00047eff08f38525">VIL_DICOM_HEADER_OTHERWORD</a>)
<a name="l00763"></a>00763     {
<a name="l00764"></a>00764       fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;dblock_size, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00765"></a>00765       dblock_size = <a class="code" href="classvil__dicom__header__format.html#a935fa97017c4e75dc2d801e85ffcea01" title="Method to byte swap an unsigned int if necessary.">intSwap</a>(dblock_size);
<a name="l00766"></a>00766       result = <span class="keyword">true</span>;
<a name="l00767"></a>00767     } <span class="comment">// End of else if (first...)</span>
<a name="l00768"></a>00768     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dblock_size == <a class="code" href="vil__dicom__header_8h.html#ad475253baadf9da9aa75056ab6bb0600">VIL_DICOM_HEADER_ALLSET</a>)
<a name="l00769"></a>00769     {
<a name="l00770"></a>00770       dblock_size = 0;
<a name="l00771"></a>00771       result = <span class="keyword">true</span>;
<a name="l00772"></a>00772     } <span class="comment">// End of else if (dblock_size == VIL_DICOM_HEADER_ALLSET)</span>
<a name="l00773"></a>00773     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (first == <a class="code" href="vil__dicom__header_8h.html#a3b132709bf37c144d007467970b27b5f">VIL_DICOM_HEADER_APPLICATIONENTRY</a>    ||
<a name="l00774"></a>00774              first == <a class="code" href="vil__dicom__header_8h.html#af7ac040333bc32ba3445011970179743">VIL_DICOM_HEADER_AGESTRING</a>           ||
<a name="l00775"></a>00775              first == <a class="code" href="vil__dicom__header_8h.html#a5a80be4ad4b1d0e4aed94a757c92ade7">VIL_DICOM_HEADER_ATTRIBUTETAG</a>        ||
<a name="l00776"></a>00776              first == <a class="code" href="vil__dicom__header_8h.html#ac7708e26644389f5be3891ff41441762">VIL_DICOM_HEADER_CODESTRING</a>          ||
<a name="l00777"></a>00777              first == <a class="code" href="vil__dicom__header_8h.html#a52b869cf1104fbb2591c39ca68e8948f">VIL_DICOM_HEADER_DATE</a>                ||
<a name="l00778"></a>00778              first == <a class="code" href="vil__dicom__header_8h.html#ad09e592bb4ec78229e24a129967aba7d">VIL_DICOM_HEADER_DECIMALSTRING</a>       ||
<a name="l00779"></a>00779              first == <a class="code" href="vil__dicom__header_8h.html#a83c4078edb184af69d579ecd4c4776e6">VIL_DICOM_HEADER_DATETIME</a>            ||
<a name="l00780"></a>00780              first == <a class="code" href="vil__dicom__header_8h.html#addc7ac6099fcca4afdf5cb6d95003af4">VIL_DICOM_HEADER_FLOATINGPOINTDOUBLE</a> ||
<a name="l00781"></a>00781              first == <a class="code" href="vil__dicom__header_8h.html#a439f08c0d39fe5089b3c9a99568110e0">VIL_DICOM_HEADER_FLOATINGPOINTSINGLE</a> ||
<a name="l00782"></a>00782              first == <a class="code" href="vil__dicom__header_8h.html#a0d2c95c376ec2b59609dd895c6eb63ba">VIL_DICOM_HEADER_INTEGERSTRING</a>       ||
<a name="l00783"></a>00783              first == <a class="code" href="vil__dicom__header_8h.html#ae1bafa68cbafd15e581bf7ab420e8270">VIL_DICOM_HEADER_LONGSTRING</a>          ||
<a name="l00784"></a>00784              first == <a class="code" href="vil__dicom__header_8h.html#ae9cce06e8e5bef65e600eb8556163896">VIL_DICOM_HEADER_LONGTEXT</a>            ||
<a name="l00785"></a>00785              first == <a class="code" href="vil__dicom__header_8h.html#aa0f5a2cea2a319e724b74b2ab56add56">VIL_DICOM_HEADER_PERSONNAME</a>          ||
<a name="l00786"></a>00786              first == <a class="code" href="vil__dicom__header_8h.html#a44cfea59b1d8bae55769e3ffbdb4cd52">VIL_DICOM_HEADER_SHORTSTRING</a>         ||
<a name="l00787"></a>00787              first == <a class="code" href="vil__dicom__header_8h.html#a53d5fec250f14d69e013f984bc523160">VIL_DICOM_HEADER_SIGNEDLONG</a>          ||
<a name="l00788"></a>00788              first == <a class="code" href="vil__dicom__header_8h.html#aeb7c5ba99760216a8853362eaca22700">VIL_DICOM_HEADER_SIGNEDSHORT</a>         ||
<a name="l00789"></a>00789              first == <a class="code" href="vil__dicom__header_8h.html#a030650c0776a2a707864c9bed2357cd3">VIL_DICOM_HEADER_SHORTTEXT</a>           ||
<a name="l00790"></a>00790              first == <a class="code" href="vil__dicom__header_8h.html#a03ca1efd65e395473a44e97fd8492d01">VIL_DICOM_HEADER_TIME</a>                ||
<a name="l00791"></a>00791              first == <a class="code" href="vil__dicom__header_8h.html#a8f2dfcf9c8e7e675264dea29d4ff04da">VIL_DICOM_HEADER_UNIQUEIDENTIFIER</a>    ||
<a name="l00792"></a>00792              first == <a class="code" href="vil__dicom__header_8h.html#ab1175b0576e037c65ffd7f0c14558be3">VIL_DICOM_HEADER_UNSIGNEDLONG</a>        ||
<a name="l00793"></a>00793              first == <a class="code" href="vil__dicom__header_8h.html#a174faec9282617377c754e721e849c55">VIL_DICOM_HEADER_UNSIGNEDSHORT</a>)
<a name="l00794"></a>00794     {
<a name="l00795"></a>00795       <span class="keywordflow">if</span> (<a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#a731078907ed7a09e3f7428e933f1281d">sys_endian_</a> == <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a14ea2fc4719a11d6bae9d5e20bce5b51">VIL_DICOM_HEADER_DELITTLEENDIAN</a>)
<a name="l00796"></a>00796       {
<a name="l00797"></a>00797         dblock_size = (<span class="keywordtype">unsigned</span> int)((256*conv_dblock.char_val[3]) + conv_dblock.char_val[2]);
<a name="l00798"></a>00798       }
<a name="l00799"></a>00799       <span class="keywordflow">else</span>
<a name="l00800"></a>00800       {
<a name="l00801"></a>00801         dblock_size = (<span class="keywordtype">unsigned</span> int)((256*conv_dblock.char_val[2]) + conv_dblock.char_val[3]);
<a name="l00802"></a>00802       }
<a name="l00803"></a>00803 
<a name="l00804"></a>00804       result = <span class="keyword">true</span>;
<a name="l00805"></a>00805     } <span class="comment">// End of else if (first...)</span>
<a name="l00806"></a>00806     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (last == <a class="code" href="vil__dicom__header_8h.html#a3b132709bf37c144d007467970b27b5f">VIL_DICOM_HEADER_APPLICATIONENTRY</a>    ||
<a name="l00807"></a>00807              last == <a class="code" href="vil__dicom__header_8h.html#af7ac040333bc32ba3445011970179743">VIL_DICOM_HEADER_AGESTRING</a>           ||
<a name="l00808"></a>00808              last == <a class="code" href="vil__dicom__header_8h.html#a5a80be4ad4b1d0e4aed94a757c92ade7">VIL_DICOM_HEADER_ATTRIBUTETAG</a>        ||
<a name="l00809"></a>00809              last == <a class="code" href="vil__dicom__header_8h.html#ac7708e26644389f5be3891ff41441762">VIL_DICOM_HEADER_CODESTRING</a>          ||
<a name="l00810"></a>00810              last == <a class="code" href="vil__dicom__header_8h.html#a52b869cf1104fbb2591c39ca68e8948f">VIL_DICOM_HEADER_DATE</a>                ||
<a name="l00811"></a>00811              last == <a class="code" href="vil__dicom__header_8h.html#ad09e592bb4ec78229e24a129967aba7d">VIL_DICOM_HEADER_DECIMALSTRING</a>       ||
<a name="l00812"></a>00812              last == <a class="code" href="vil__dicom__header_8h.html#a83c4078edb184af69d579ecd4c4776e6">VIL_DICOM_HEADER_DATETIME</a>            ||
<a name="l00813"></a>00813              last == <a class="code" href="vil__dicom__header_8h.html#addc7ac6099fcca4afdf5cb6d95003af4">VIL_DICOM_HEADER_FLOATINGPOINTDOUBLE</a> ||
<a name="l00814"></a>00814              last == <a class="code" href="vil__dicom__header_8h.html#a439f08c0d39fe5089b3c9a99568110e0">VIL_DICOM_HEADER_FLOATINGPOINTSINGLE</a> ||
<a name="l00815"></a>00815              last == <a class="code" href="vil__dicom__header_8h.html#a0d2c95c376ec2b59609dd895c6eb63ba">VIL_DICOM_HEADER_INTEGERSTRING</a>       ||
<a name="l00816"></a>00816              last == <a class="code" href="vil__dicom__header_8h.html#ae1bafa68cbafd15e581bf7ab420e8270">VIL_DICOM_HEADER_LONGSTRING</a>          ||
<a name="l00817"></a>00817              last == <a class="code" href="vil__dicom__header_8h.html#ae9cce06e8e5bef65e600eb8556163896">VIL_DICOM_HEADER_LONGTEXT</a>            ||
<a name="l00818"></a>00818              last == <a class="code" href="vil__dicom__header_8h.html#aa0f5a2cea2a319e724b74b2ab56add56">VIL_DICOM_HEADER_PERSONNAME</a>          ||
<a name="l00819"></a>00819              last == <a class="code" href="vil__dicom__header_8h.html#a44cfea59b1d8bae55769e3ffbdb4cd52">VIL_DICOM_HEADER_SHORTSTRING</a>         ||
<a name="l00820"></a>00820              last == <a class="code" href="vil__dicom__header_8h.html#a53d5fec250f14d69e013f984bc523160">VIL_DICOM_HEADER_SIGNEDLONG</a>          ||
<a name="l00821"></a>00821              last == <a class="code" href="vil__dicom__header_8h.html#aeb7c5ba99760216a8853362eaca22700">VIL_DICOM_HEADER_SIGNEDSHORT</a>         ||
<a name="l00822"></a>00822              last == <a class="code" href="vil__dicom__header_8h.html#a030650c0776a2a707864c9bed2357cd3">VIL_DICOM_HEADER_SHORTTEXT</a>           ||
<a name="l00823"></a>00823              last == <a class="code" href="vil__dicom__header_8h.html#a03ca1efd65e395473a44e97fd8492d01">VIL_DICOM_HEADER_TIME</a>                ||
<a name="l00824"></a>00824              last == <a class="code" href="vil__dicom__header_8h.html#a8f2dfcf9c8e7e675264dea29d4ff04da">VIL_DICOM_HEADER_UNIQUEIDENTIFIER</a>    ||
<a name="l00825"></a>00825              last == <a class="code" href="vil__dicom__header_8h.html#ab1175b0576e037c65ffd7f0c14558be3">VIL_DICOM_HEADER_UNSIGNEDLONG</a>        ||
<a name="l00826"></a>00826              last == <a class="code" href="vil__dicom__header_8h.html#a174faec9282617377c754e721e849c55">VIL_DICOM_HEADER_UNSIGNEDSHORT</a>)
<a name="l00827"></a>00827     {
<a name="l00828"></a>00828       <span class="keywordflow">if</span> (<a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a>.<a class="code" href="structvil__dicom__header__info.html#a731078907ed7a09e3f7428e933f1281d">sys_endian_</a> == <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a14ea2fc4719a11d6bae9d5e20bce5b51">VIL_DICOM_HEADER_DELITTLEENDIAN</a>)
<a name="l00829"></a>00829       {
<a name="l00830"></a>00830         dblock_size = (<span class="keywordtype">unsigned</span> int)((256*conv_dblock.char_val[1]) + conv_dblock.char_val[0]);
<a name="l00831"></a>00831       }
<a name="l00832"></a>00832       <span class="keywordflow">else</span>
<a name="l00833"></a>00833       {
<a name="l00834"></a>00834         dblock_size = (<span class="keywordtype">unsigned</span> int)((256*conv_dblock.char_val[0]) + conv_dblock.char_val[1]);
<a name="l00835"></a>00835       }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837       result = <span class="keyword">true</span>;
<a name="l00838"></a>00838     } <span class="comment">// End of else if (last...)</span>
<a name="l00839"></a>00839   } <span class="comment">// End of if (last_read_.file_type_ != VIL_DICOM_HEADER_DTUNKNOWN)</span>
<a name="l00840"></a>00840 
<a name="l00841"></a>00841   <span class="keywordflow">return</span> result;
<a name="l00842"></a>00842 }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844 <span class="comment">//================================================================</span>
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 <span class="keywordtype">bool</span> <a class="code" href="classvil__dicom__header__format.html#a985547c9c86ec5be5de8c4d849c45aae" title="Method to determine whether or not the actual pixel data has been reached.">vil_dicom_header_format::pixelDataFound</a>(<span class="keywordtype">short</span> group, <span class="keywordtype">short</span> element)
<a name="l00847"></a>00847 {
<a name="l00848"></a>00848   <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l00849"></a>00849 
<a name="l00850"></a>00850   <span class="comment">// Check if it&#39;s the pixel data</span>
<a name="l00851"></a>00851   <span class="keywordflow">if</span> ((vxl_uint_16)group == <a class="code" href="vil__dicom__header_8h.html#a19aaf394c9dafc6a55859a90df0a1a63">VIL_DICOM_HEADER_PIXELGROUP</a> &amp;&amp;
<a name="l00852"></a>00852       (vxl_uint_16)element == <a class="code" href="vil__dicom__header_8h.html#a21be553beebfb4f1ee377a7467362c5b">VIL_DICOM_HEADER_PXPIXELDATA</a>)
<a name="l00853"></a>00853   {
<a name="l00854"></a>00854     result = <span class="keyword">true</span>;
<a name="l00855"></a>00855   }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857   <span class="keywordflow">return</span> result;
<a name="l00858"></a>00858 }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860 <span class="comment">//================================================================</span>
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 <span class="keywordtype">void</span> <a class="code" href="classvil__dicom__header__format.html#ab577953ac009bd89ecdf43a7ca69370d">vil_dicom_header_format::clearInfo</a>(<span class="keywordtype">void</span>)
<a name="l00863"></a>00863 {
<a name="l00864"></a>00864   <a class="code" href="vil__dicom__header_8h.html#a3ed3d6fcb65046030a3b3c919872f186" title="Clears a header info struct.">vil_dicom_header_info_clear</a>( <a class="code" href="classvil__dicom__header__format.html#aebb9971364cf04ee6b62abbbd772eb58" title="Holds the info from the last header read.">last_read_</a> );
<a name="l00865"></a>00865 
<a name="l00866"></a>00866   <span class="comment">// And make it invalid</span>
<a name="l00867"></a>00867   <a class="code" href="classvil__dicom__header__format.html#a68360671e4c0848e57bd7fce333f7c36" title="TRUE if the header info is valid (i.e. has been read) otherwise FALSE.">info_valid_</a> = <span class="keyword">false</span>;
<a name="l00868"></a>00868 }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870 <span class="comment">//================================================================</span>
<a name="l00871"></a>00871 
<a name="l00872"></a>00872 <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17" title="Endian types.">vil_dicom_header_endian</a> <a class="code" href="classvil__dicom__header__format.html#a679d25bf87762623e27c4bc1edfcab72" title="Work out whether the current architecture is big or little endian.">vil_dicom_header_format::calculateEndian</a>(<span class="keywordtype">void</span>)
<a name="l00873"></a>00873 {
<a name="l00874"></a>00874   <span class="comment">// Create a union to test endian</span>
<a name="l00875"></a>00875   <span class="keyword">union </span>int_byte
<a name="l00876"></a>00876   {
<a name="l00877"></a>00877     vxl_uint_32 int_val;
<a name="l00878"></a>00878     vxl_byte by_val[4];
<a name="l00879"></a>00879   } calc_endian;
<a name="l00880"></a>00880 
<a name="l00881"></a>00881   <span class="comment">// Put 1 into the union</span>
<a name="l00882"></a>00882   calc_endian.int_val = 1;
<a name="l00883"></a>00883 
<a name="l00884"></a>00884   <span class="comment">// Test which byte has the value 1 in it</span>
<a name="l00885"></a>00885   <span class="keywordflow">return</span> calc_endian.by_val[0] == 1 ?
<a name="l00886"></a>00886     <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a14ea2fc4719a11d6bae9d5e20bce5b51">VIL_DICOM_HEADER_DELITTLEENDIAN</a> :
<a name="l00887"></a>00887     <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a7a04e2c42756d063445ba8e62ee955eb">VIL_DICOM_HEADER_DEBIGENDIAN</a>;
<a name="l00888"></a>00888 }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890 <span class="comment">//===============================================================</span>
<a name="l00891"></a>00891 
<a name="l00892"></a>00892 <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17" title="Endian types.">vil_dicom_header_endian</a> <a class="code" href="classvil__dicom__header__format.html#a9282125ab8f59b74735a35679e46fe64" title="Initialise all the necessary meta-file stuff.">vil_dicom_header_format::determineMetaInfo</a>(<a class="code" href="classvil__stream.html" title="Stream interface for VIL image loaders.">vil_stream</a> &amp;fs)
<a name="l00893"></a>00893 {
<a name="l00894"></a>00894   <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17" title="Endian types.">vil_dicom_header_endian</a> ret_end = <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a14ea2fc4719a11d6bae9d5e20bce5b51">VIL_DICOM_HEADER_DELITTLEENDIAN</a>; <span class="comment">// Assume little if none found</span>
<a name="l00895"></a>00895   <span class="comment">//vil_dicom_header_endian ret_end = VIL_DICOM_HEADER_DEBIGENDIAN;</span>
<a name="l00896"></a>00896 
<a name="l00897"></a>00897   vxl_uint_16 group, element;
<a name="l00898"></a>00898   vxl_uint_32 data_block_size;
<a name="l00899"></a>00899   <a class="code" href="vil__stream_8h.html#aa5e912c853d0dd23b24eefd6f6e5a3a4">vil_streampos</a> ret_pos = fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>(); <span class="comment">// Maintain the file position</span>
<a name="l00900"></a>00900 
<a name="l00901"></a>00901   <span class="comment">// The first section of the file header is always little endian,</span>
<a name="l00902"></a>00902   <span class="comment">// so set the file endian</span>
<a name="l00903"></a>00903   <a class="code" href="classvil__dicom__header__format.html#ac5d3a62f7546a30d77ecbc702af5a2ec" title="A variable to hold the current header file&#39;s endian.">file_endian_</a> = <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a14ea2fc4719a11d6bae9d5e20bce5b51">VIL_DICOM_HEADER_DELITTLEENDIAN</a>;
<a name="l00904"></a>00904   <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a32f53615819a4bf00f0e7d2873564135">VIL_DICOM_HEADER_DITUNKNOWN</a>;
<a name="l00905"></a>00905 
<a name="l00906"></a>00906   <span class="comment">// Read the next group</span>
<a name="l00907"></a>00907   fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;group,<span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l00908"></a>00908   group = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(group);
<a name="l00909"></a>00909 
<a name="l00910"></a>00910   <span class="keywordflow">while</span> (fs.<a class="code" href="classvil__stream.html#a5062b8aff09e290556e784762e436f94" title="Return false if the stream is broken.">ok</a>() &amp;&amp; group &lt;= <a class="code" href="vil__dicom__header_8h.html#a1619dc5f61a634ee915c80c03acde826">VIL_DICOM_HEADER_METAFILEGROUP</a>)
<a name="l00911"></a>00911   {
<a name="l00912"></a>00912     <span class="comment">// Read the element</span>
<a name="l00913"></a>00913 
<a name="l00914"></a>00914     fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;element,<span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l00915"></a>00915     element = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(element);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     <span class="comment">// Read the data block size</span>
<a name="l00918"></a>00918     <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(vxl_uint_32) != fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;data_block_size, <span class="keyword">sizeof</span>(vxl_uint_32)))
<a name="l00919"></a>00919       <span class="keywordflow">break</span>;
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     data_block_size = <a class="code" href="classvil__dicom__header__format.html#a935fa97017c4e75dc2d801e85ffcea01" title="Method to byte swap an unsigned int if necessary.">intSwap</a>(data_block_size);
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="keywordflow">if</span> (data_block_size &gt; 0x1000000) {
<a name="l00924"></a>00924       vcl_cerr&lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; : WARNING:\n&quot;</span>
<a name="l00925"></a>00925               &lt;&lt;<span class="stringliteral">&quot;data_block_size=&quot;</span> &lt;&lt; data_block_size &lt;&lt; <span class="stringliteral">&quot; is most probably too large\n&quot;</span>;
<a name="l00926"></a>00926       <span class="keywordflow">break</span>;
<a name="l00927"></a>00927     }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929     <a class="code" href="classvil__dicom__header__format.html#a0b7f606eb1a76c59ce7dbb1107e0ed4f" title="Method to convert the Value Representation (VR) (if it exists).">convertValueRepresentation</a>(data_block_size,fs);
<a name="l00930"></a>00930 
<a name="l00931"></a>00931     <span class="keywordflow">if</span> (group == <a class="code" href="vil__dicom__header_8h.html#a1619dc5f61a634ee915c80c03acde826">VIL_DICOM_HEADER_METAFILEGROUP</a> &amp;&amp;
<a name="l00932"></a>00932         element == <a class="code" href="vil__dicom__header_8h.html#ab08f1e68964079bbaa8395f3bb8a4bef">VIL_DICOM_HEADER_MFTRANSFERSYNTAX</a>)
<a name="l00933"></a>00933     {
<a name="l00934"></a>00934       <span class="comment">// This tells us the transfer syntax for the file</span>
<a name="l00935"></a>00935       <span class="keywordtype">char</span> * tfx_type = <span class="keyword">new</span> <span class="keywordtype">char</span>[data_block_size+1]; <span class="comment">// Ensure room for 0</span>
<a name="l00936"></a>00936       <span class="keywordflow">if</span> (tfx_type)
<a name="l00937"></a>00937       {
<a name="l00938"></a>00938         fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(tfx_type, data_block_size);
<a name="l00939"></a>00939         tfx_type[data_block_size]=0;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941         <span class="comment">// Now see what it is</span>
<a name="l00942"></a>00942 
<a name="l00943"></a>00943         vcl_string temp = tfx_type;
<a name="l00944"></a>00944         <span class="keyword">delete</span> [] tfx_type;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946         <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#aa9c9e7b8fac9abfe6ed2dfee24013fea">VIL_DICOM_HEADER_IMPLICITLITTLE</a> ||
<a name="l00947"></a>00947             temp == <a class="code" href="vil__dicom__header_8h.html#aeef0d10e127ae3903fc13dbb705bc1c7">VIL_DICOM_HEADER_EXPLICITLITTLE</a>)
<a name="l00948"></a>00948         {
<a name="l00949"></a>00949           <span class="comment">// Little endian</span>
<a name="l00950"></a>00950           ret_end = <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a14ea2fc4719a11d6bae9d5e20bce5b51">VIL_DICOM_HEADER_DELITTLEENDIAN</a>;
<a name="l00951"></a>00951         }
<a name="l00952"></a>00952         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#a5e25385230d6c93f16d31bbe73161a0d">VIL_DICOM_HEADER_EXPLICITBIG</a>)
<a name="l00953"></a>00953         {
<a name="l00954"></a>00954           <span class="comment">// Big endian</span>
<a name="l00955"></a>00955           ret_end = <a class="code" href="vil__dicom__header_8h.html#a06a5e4e8ea5bed4631535881ba088a17a7a04e2c42756d063445ba8e62ee955eb">VIL_DICOM_HEADER_DEBIGENDIAN</a>;
<a name="l00956"></a>00956         }
<a name="l00957"></a>00957         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#a71802c1bb761601c1cf500bbf163c864">VIL_DICOM_HEADER_JPEGBASELINE_P1</a>)
<a name="l00958"></a>00958         {
<a name="l00959"></a>00959           <span class="comment">// Jpeg Baseline</span>
<a name="l00960"></a>00960           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a1bab0a8f907c875a46778e5079f63512">VIL_DICOM_HEADER_DITJPEGBASE</a>;
<a name="l00961"></a>00961         }
<a name="l00962"></a>00962         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#a05b0f658009f2acf5c7ff1594a5103a8">VIL_DICOM_HEADER_JPEGDEFLOSSY_P2_4</a> ||
<a name="l00963"></a>00963                  temp == <a class="code" href="vil__dicom__header_8h.html#a0abba033ae3b5dc8edcb0d64406903d7">VIL_DICOM_HEADER_JPEGEXTENDED_P3_5</a>)
<a name="l00964"></a>00964         {
<a name="l00965"></a>00965           <span class="comment">// Jpeg extended lossy</span>
<a name="l00966"></a>00966           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a0504ab1268d81b436a120d8a66b75ad1">VIL_DICOM_HEADER_DITJPEGEXTLOSSY</a>;
<a name="l00967"></a>00967         }
<a name="l00968"></a>00968         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#a5849c4005a7e60bb0be0a2b448d39f25">VIL_DICOM_HEADER_JPEGSPECTRAL_P6_8</a> ||
<a name="l00969"></a>00969                  temp == <a class="code" href="vil__dicom__header_8h.html#a7eef6b08ee2081041643f88bcf3d086c">VIL_DICOM_HEADER_JPEGSPECTRAL_P7_9</a>)
<a name="l00970"></a>00970         {
<a name="l00971"></a>00971           <span class="comment">// Jpeg spectral selection non-hierarchical</span>
<a name="l00972"></a>00972           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a253a59e7c151dcc3fa0d608b3249a2f9">VIL_DICOM_HEADER_DITJPEGSPECNH</a>;
<a name="l00973"></a>00973         }
<a name="l00974"></a>00974         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#a7ca6d1ef2c321bebf8b4dfd780028178">VIL_DICOM_HEADER_JPEGFULLPROG_P10_12</a> ||
<a name="l00975"></a>00975                  temp == <a class="code" href="vil__dicom__header_8h.html#abf58419e5cb40fe7c579dcbd93907e19">VIL_DICOM_HEADER_JPEGFULLPROG_P11_13</a>)
<a name="l00976"></a>00976         {
<a name="l00977"></a>00977           <span class="comment">// Full progression non-hierarchical</span>
<a name="l00978"></a>00978           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a8cb301e6e2b5d9f12bb86080559d1f69">VIL_DICOM_HEADER_DITJPEGFULLNH</a>;
<a name="l00979"></a>00979         }
<a name="l00980"></a>00980         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#a997c2f8e1c37627acd84a7373c44fc4c">VIL_DICOM_HEADER_JPEGLOSSLESS_P14</a> ||
<a name="l00981"></a>00981                  temp == <a class="code" href="vil__dicom__header_8h.html#ac70d427d54a20d9a98a5673347c50ae6">VIL_DICOM_HEADER_JPEGLOSSLESS_P15</a>)
<a name="l00982"></a>00982         {
<a name="l00983"></a>00983           <span class="comment">// Lossless non-hierarchical</span>
<a name="l00984"></a>00984           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a1059f83d2926fe6018aceebbcc4db94f">VIL_DICOM_HEADER_DITJPEGLOSSLNH</a>;
<a name="l00985"></a>00985         }
<a name="l00986"></a>00986         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#a621a975cd6b9d4b00150f3d13983745c">VIL_DICOM_HEADER_JPEGEXTHIER_P16_18</a> ||
<a name="l00987"></a>00987                  temp == <a class="code" href="vil__dicom__header_8h.html#a4f51239a920799238e703fcdd4cd2f9b">VIL_DICOM_HEADER_JPEGEXTHIER_P17_19</a>)
<a name="l00988"></a>00988         {
<a name="l00989"></a>00989           <span class="comment">// Extended hierarchical</span>
<a name="l00990"></a>00990           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a741e75982d51666d6ddfbac0b9f1d6bf">VIL_DICOM_HEADER_DITJPEGEXTHIER</a>;
<a name="l00991"></a>00991         }
<a name="l00992"></a>00992         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#a2a9eebabc10d9a41a65386083ca00ee6">VIL_DICOM_HEADER_JPEGSPECHIER_P20_22</a> ||
<a name="l00993"></a>00993                  temp == <a class="code" href="vil__dicom__header_8h.html#a1ce8e4b31ecd3db5bb70a00ae5de1e12">VIL_DICOM_HEADER_JPEGSPECHIER_P21_23</a>)
<a name="l00994"></a>00994         {
<a name="l00995"></a>00995           <span class="comment">// Spectral selection hierarchical</span>
<a name="l00996"></a>00996           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048afaea076efab645501472632045e24196">VIL_DICOM_HEADER_DITJPEGSPECHIER</a>;
<a name="l00997"></a>00997         }
<a name="l00998"></a>00998         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#a99f0f088b4f58eb92226e15fc2f22c8f">VIL_DICOM_HEADER_JPEGFULLHIER_P24_26</a> ||
<a name="l00999"></a>00999                  temp == <a class="code" href="vil__dicom__header_8h.html#a4574060b4cb4224e9e8aea5e70442342">VIL_DICOM_HEADER_JPEGFULLHIER_P25_27</a>)
<a name="l01000"></a>01000         {
<a name="l01001"></a>01001           <span class="comment">// Full progression hierarchical</span>
<a name="l01002"></a>01002           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a64ab836198816ba7cc57fb47d1f1bc9d">VIL_DICOM_HEADER_DITJPEGFULLHIER</a>;
<a name="l01003"></a>01003         }
<a name="l01004"></a>01004         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#af1bf5a469337380f3db91098f95166d8">VIL_DICOM_HEADER_JPEGLLESSHIER_P28</a> ||
<a name="l01005"></a>01005                  temp == <a class="code" href="vil__dicom__header_8h.html#a14168c219c3babab88edac0355ebd395">VIL_DICOM_HEADER_JPEGLLESSHIER_P29</a>)
<a name="l01006"></a>01006         {
<a name="l01007"></a>01007           <span class="comment">// Lossless hierarchical</span>
<a name="l01008"></a>01008           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048a13a19ff0df40fd631cf9de8a48d93c3a">VIL_DICOM_HEADER_DITJPEGLOSSLHIER</a>;
<a name="l01009"></a>01009         }
<a name="l01010"></a>01010         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#af90594c8c2313260dcf601fbe31499cf">VIL_DICOM_HEADER_JPEGLLESSDEF_P14_SV1</a>)
<a name="l01011"></a>01011         {
<a name="l01012"></a>01012           <span class="comment">// The default for lossless jpeg</span>
<a name="l01013"></a>01013           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048af702958e6637e5cb20c993f5be3f8282">VIL_DICOM_HEADER_DITJPEGLOSSLDEF</a>;
<a name="l01014"></a>01014         }
<a name="l01015"></a>01015         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp == <a class="code" href="vil__dicom__header_8h.html#a75ed1029342e67061e8e6b6ad843b172">VIL_DICOM_HEADER_RLELOSSLESS</a>)
<a name="l01016"></a>01016         {
<a name="l01017"></a>01017           <span class="comment">// RLE encapsulated</span>
<a name="l01018"></a>01018           <a class="code" href="classvil__dicom__header__format.html#ace1be684bfa805d05d4822bca3478d4c" title="A variable to hole the current encapsulate file type (if any).">image_type_</a> = <a class="code" href="vil__dicom__header_8h.html#abee6a33e62b504f47967d5e05a236048ad5603b92152a076f770a8d91d554dc3b">VIL_DICOM_HEADER_DITRLE</a>;
<a name="l01019"></a>01019         }
<a name="l01020"></a>01020 
<a name="l01021"></a>01021       } <span class="comment">// End of if (tfx_type)</span>
<a name="l01022"></a>01022     } <span class="comment">// End of if (group...)</span>
<a name="l01023"></a>01023     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (group == <a class="code" href="vil__dicom__header_8h.html#adbbff22db0813e4ab08dbc527531fad6">VIL_DICOM_HEADER_DELIMITERGROUP</a> &amp;&amp;
<a name="l01024"></a>01024              (element == <a class="code" href="vil__dicom__header_8h.html#a3ceb0f820fee2df6a2b5c31fdd413f48">VIL_DICOM_HEADER_DLITEM</a> ||
<a name="l01025"></a>01025               element == <a class="code" href="vil__dicom__header_8h.html#a0c07b6ebb69058ed6cd6e16387693721">VIL_DICOM_HEADER_DLITEMDELIMITATIONITEM</a> ||
<a name="l01026"></a>01026               element == <a class="code" href="vil__dicom__header_8h.html#a56b550b39987a1deae52ea0fa2b5819f">VIL_DICOM_HEADER_DLSEQDELIMITATIONITEM</a>))
<a name="l01027"></a>01027     {
<a name="l01028"></a>01028       <span class="comment">// Do nothing</span>
<a name="l01029"></a>01029     }
<a name="l01030"></a>01030     <span class="keywordflow">else</span>
<a name="l01031"></a>01031     {
<a name="l01032"></a>01032         <span class="comment">// Ignore the data that&#39;s there</span>
<a name="l01033"></a>01033         fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(data_block_size + fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>());
<a name="l01034"></a>01034     }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036     ret_pos = fs.<a class="code" href="classvil__stream.html#aab44ec874db0df01b3d585c81d726042" title="Return file pointer.">tell</a>();
<a name="l01037"></a>01037 
<a name="l01038"></a>01038     <span class="comment">// Read the next group</span>
<a name="l01039"></a>01039 
<a name="l01040"></a>01040     fs.<a class="code" href="classvil__stream.html#a7c3585371cfe43aae4b5293fbafb9b52" title="Read n bytes into buf. Returns number of bytes read.">read</a>(&amp;group,<span class="keyword">sizeof</span>(vxl_uint_16));
<a name="l01041"></a>01041     group = <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">shortSwap</a>(group);
<a name="l01042"></a>01042 
<a name="l01043"></a>01043   } <span class="comment">// End of while</span>
<a name="l01044"></a>01044 
<a name="l01045"></a>01045   <span class="comment">// Reset the pointer before the last read group</span>
<a name="l01046"></a>01046   fs.<a class="code" href="classvil__stream.html#ab592f40f2538ea648fc101a0adea1a6d" title="Goto file pointer.">seek</a>(ret_pos);
<a name="l01047"></a>01047 
<a name="l01048"></a>01048   <span class="keywordflow">return</span> ret_end;
<a name="l01049"></a>01049 }
<a name="l01050"></a>01050 
<a name="l01051"></a>01051 <span class="comment">//===============================================================</span>
<a name="l01052"></a>01052 
<a name="l01053"></a>01053 vxl_uint_16 <a class="code" href="classvil__dicom__header__format.html#ae325acbeab83f4927b7e4abe7c32a850" title="Method to byte swap an unsigned short int if necessary.">vil_dicom_header_format::shortSwap</a>(vxl_uint_16 short_in)
<a name="l01054"></a>01054 {
<a name="l01055"></a>01055   vxl_uint_16 result = short_in;
<a name="l01056"></a>01056 
<a name="l01057"></a>01057   <span class="comment">// Only swap if the architecture is different to the</span>
<a name="l01058"></a>01058   <span class="comment">// file (the logic means that if one is unknown it swaps,</span>
<a name="l01059"></a>01059   <span class="comment">// if both are unknown, it doesnt)</span>
<a name="l01060"></a>01060   <span class="keywordflow">if</span> (<a class="code" href="classvil__dicom__header__format.html#ac5d3a62f7546a30d77ecbc702af5a2ec" title="A variable to hold the current header file&#39;s endian.">file_endian_</a> != <a class="code" href="classvil__dicom__header__format.html#aeaf845bb3f322e4811ac2be75b8f76dd" title="A variable to hold the discovered architecture endian.">endian_</a>)
<a name="l01061"></a>01061   {
<a name="l01062"></a>01062     <span class="comment">// Create a short unioned with two chars</span>
<a name="l01063"></a>01063     <span class="keyword">union </span>short_char
<a name="l01064"></a>01064     {
<a name="l01065"></a>01065       vxl_uint_16 short_val;
<a name="l01066"></a>01066       vxl_byte byte_val[2];
<a name="l01067"></a>01067     } short_swap;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069     <span class="comment">// Set the swapper</span>
<a name="l01070"></a>01070     short_swap.short_val = short_in;
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     <span class="comment">// Swap them over</span>
<a name="l01073"></a>01073     vxl_byte temp = short_swap.byte_val[0];
<a name="l01074"></a>01074     short_swap.byte_val[0]=short_swap.byte_val[1];
<a name="l01075"></a>01075     short_swap.byte_val[1]=temp;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     result = short_swap.short_val;
<a name="l01078"></a>01078   } <span class="comment">// End of if (file_endian_ != endian_)</span>
<a name="l01079"></a>01079 
<a name="l01080"></a>01080   <span class="keywordflow">return</span> result;
<a name="l01081"></a>01081 }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083 <span class="comment">//===============================================================</span>
<a name="l01084"></a>01084 
<a name="l01085"></a>01085 vxl_uint_32 <a class="code" href="classvil__dicom__header__format.html#a935fa97017c4e75dc2d801e85ffcea01" title="Method to byte swap an unsigned int if necessary.">vil_dicom_header_format::intSwap</a>(vxl_uint_32 int_in)
<a name="l01086"></a>01086 {
<a name="l01087"></a>01087   vxl_uint_32 result = int_in;
<a name="l01088"></a>01088 
<a name="l01089"></a>01089   <span class="comment">// Only swap if the architecture is different to the</span>
<a name="l01090"></a>01090   <span class="comment">// file (the logic means that if one is unknown it swaps,</span>
<a name="l01091"></a>01091   <span class="comment">// if both are unknown, it doesnt)</span>
<a name="l01092"></a>01092   <span class="keywordflow">if</span> (<a class="code" href="classvil__dicom__header__format.html#ac5d3a62f7546a30d77ecbc702af5a2ec" title="A variable to hold the current header file&#39;s endian.">file_endian_</a> != <a class="code" href="classvil__dicom__header__format.html#aeaf845bb3f322e4811ac2be75b8f76dd" title="A variable to hold the discovered architecture endian.">endian_</a>)
<a name="l01093"></a>01093   {
<a name="l01094"></a>01094     <span class="comment">// Create a vxl_uint_32 unioned with four chars</span>
<a name="l01095"></a>01095     <span class="keyword">union </span>int_char
<a name="l01096"></a>01096     {
<a name="l01097"></a>01097       vxl_uint_32 int_val;
<a name="l01098"></a>01098       vxl_byte byte_val[4];
<a name="l01099"></a>01099     } int_swap;
<a name="l01100"></a>01100 
<a name="l01101"></a>01101     <span class="comment">// Set the swapper</span>
<a name="l01102"></a>01102     int_swap.int_val = int_in;
<a name="l01103"></a>01103 
<a name="l01104"></a>01104     <span class="comment">// Swap them over (end ones first)</span>
<a name="l01105"></a>01105     vxl_byte temp = int_swap.byte_val[0];
<a name="l01106"></a>01106     int_swap.byte_val[0]=int_swap.byte_val[3];
<a name="l01107"></a>01107     int_swap.byte_val[3]=temp;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109     <span class="comment">// Now the middle ones</span>
<a name="l01110"></a>01110     temp = int_swap.byte_val[1];
<a name="l01111"></a>01111     int_swap.byte_val[1] = int_swap.byte_val[2];
<a name="l01112"></a>01112     int_swap.byte_val[2] = temp;
<a name="l01113"></a>01113 
<a name="l01114"></a>01114     result = int_swap.int_val;
<a name="l01115"></a>01115   } <span class="comment">// End of if (file_endian_ != endian_)</span>
<a name="l01116"></a>01116 
<a name="l01117"></a>01117   <span class="keywordflow">return</span> result;
<a name="l01118"></a>01118 }
<a name="l01119"></a>01119 
<a name="l01120"></a>01120 <span class="comment">//===============================================================</span>
<a name="l01121"></a>01121 
<a name="l01122"></a>01122 <span class="keywordtype">void</span> <a class="code" href="classvil__dicom__header__format.html#acb0a52b1fa7baba59b14b40c6cf232c9" title="Method to swap a number inside a char array.">vil_dicom_header_format::charSwap</a>(<span class="keywordtype">char</span> *char_in, <span class="keywordtype">int</span> val_size)
<a name="l01123"></a>01123 {
<a name="l01124"></a>01124   <span class="comment">// Only swap if the architecture is different to the</span>
<a name="l01125"></a>01125   <span class="comment">// file (the logic means that if one is unknown it swaps,</span>
<a name="l01126"></a>01126   <span class="comment">// if both are unknown, it doesnt)</span>
<a name="l01127"></a>01127   <span class="keywordflow">if</span> (<a class="code" href="classvil__dicom__header__format.html#ac5d3a62f7546a30d77ecbc702af5a2ec" title="A variable to hold the current header file&#39;s endian.">file_endian_</a> != <a class="code" href="classvil__dicom__header__format.html#aeaf845bb3f322e4811ac2be75b8f76dd" title="A variable to hold the discovered architecture endian.">endian_</a>)
<a name="l01128"></a>01128   {
<a name="l01129"></a>01129     <span class="comment">// Swap first with last, second with one-but-last, etc.</span>
<a name="l01130"></a>01130     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=val_size/2-1; i&gt;=0; --i)
<a name="l01131"></a>01131     {
<a name="l01132"></a>01132       <span class="keywordtype">char</span> temp=char_in[i];
<a name="l01133"></a>01133       char_in[i] = char_in[val_size-i-1];
<a name="l01134"></a>01134       char_in[val_size-i-1] = temp;
<a name="l01135"></a>01135     }
<a name="l01136"></a>01136   }
<a name="l01137"></a>01137 }
<a name="l01138"></a>01138 
<a name="l01139"></a>01139 
<a name="l01140"></a>01140 <span class="keywordtype">void</span> <a class="code" href="vil__dicom__header_8h.html#a52e0d77c6261e436087c010917edca5f">vil_dicom_header_print</a>(vcl_ostream &amp;os, <span class="keyword">const</span> <a class="code" href="structvil__dicom__header__info.html" title="DICOM information read from the header.">vil_dicom_header_info</a> &amp;s)
<a name="l01141"></a>01141 {
<a name="l01142"></a>01142   os &lt;&lt; <span class="stringliteral">&quot;\n\nGeneral info fields\n&quot;</span>
<a name="l01143"></a>01143      &lt;&lt; <span class="stringliteral">&quot; file_type        The type of dicom file: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a5cc976b81614b99175f1106c221ec52e">file_type_</a> &lt;&lt; vcl_endl
<a name="l01144"></a>01144      &lt;&lt; <span class="stringliteral">&quot; sys_endian       The endian of the architecture: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a731078907ed7a09e3f7428e933f1281d">sys_endian_</a> &lt;&lt; vcl_endl
<a name="l01145"></a>01145      &lt;&lt; <span class="stringliteral">&quot; image_type       The encapsulated (or not) image type: &quot;</span> &lt;&lt;s.<a class="code" href="structvil__dicom__header__info.html#a26771743f759f9b5a21caf97a9a6e9f2">image_type_</a> &lt;&lt; vcl_endl
<a name="l01146"></a>01146 
<a name="l01147"></a>01147      &lt;&lt; <span class="stringliteral">&quot;\n\nIdentifying fields\n&quot;</span>
<a name="l01148"></a>01148      &lt;&lt; <span class="stringliteral">&quot; image_id_type    The image type from the dicom header: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a51b5c4a6f5edc9d9bec2b501c1da4a50">image_id_type_</a> &lt;&lt; vcl_endl
<a name="l01149"></a>01149      &lt;&lt; <span class="stringliteral">&quot; sop_cl_uid       The class unique id for the Service/Object Pair: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a1783af1e11ce3a501a06972fe163618a">sop_cl_uid_</a> &lt;&lt; vcl_endl
<a name="l01150"></a>01150      &lt;&lt; <span class="stringliteral">&quot; sop_in_uid       The instance uid for the SOP: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#acbba4d626725d05c3a3d13df39c05b43">sop_in_uid_</a> &lt;&lt; vcl_endl
<a name="l01151"></a>01151      &lt;&lt; <span class="stringliteral">&quot; study_date       The date of the study: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a5374963a3797bc0ca92ab6294e3c9773">study_date_</a> &lt;&lt; vcl_endl
<a name="l01152"></a>01152      &lt;&lt; <span class="stringliteral">&quot; series_date      The date this series was collected: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a3b93935abda4b9fcac5d0c5e4459d8c8">series_date_</a> &lt;&lt; vcl_endl
<a name="l01153"></a>01153      &lt;&lt; <span class="stringliteral">&quot; acquisition_date The date of acquisition: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a2ec7c7ce7c12bead6bafc7c7e09264a7">acquisition_date_</a> &lt;&lt; vcl_endl
<a name="l01154"></a>01154      &lt;&lt; <span class="stringliteral">&quot; image_date       The date of this image: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a888921ecddbbf7c29292af66f4a691cb">image_date_</a> &lt;&lt; vcl_endl
<a name="l01155"></a>01155      &lt;&lt; <span class="stringliteral">&quot; study_time       The time of the study: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a39dcd605903b066de506f1bd4b3ec858">study_time_</a> &lt;&lt; vcl_endl
<a name="l01156"></a>01156      &lt;&lt; <span class="stringliteral">&quot; series_time      The time of the series: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a5e863e3dc22f6e4a5bd45798c1beafbf">series_time_</a> &lt;&lt; vcl_endl
<a name="l01157"></a>01157      &lt;&lt; <span class="stringliteral">&quot; acquisition_time The time acquisition: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a4f80f17af50a264a8ec5b072a8c98de4">acquisition_time_</a> &lt;&lt; vcl_endl
<a name="l01158"></a>01158      &lt;&lt; <span class="stringliteral">&quot; image_time       The time of the image: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#af519eefd2903de8389f0027269058483">image_time_</a> &lt;&lt; vcl_endl
<a name="l01159"></a>01159      &lt;&lt; <span class="stringliteral">&quot; accession_number The accession number for this image: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a5f78f57e677e18bfd69da03519f09757">accession_number_</a> &lt;&lt; vcl_endl
<a name="l01160"></a>01160      &lt;&lt; <span class="stringliteral">&quot; modality         The imaging modality: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#aecd1987606184e698190c60562add11a">modality_</a> &lt;&lt; vcl_endl
<a name="l01161"></a>01161      &lt;&lt; <span class="stringliteral">&quot; manufacturer     The name of the scanner manufacturer: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a0e18f19b67af15aa1ec8d257c7406485">manufacturer_</a> &lt;&lt; vcl_endl
<a name="l01162"></a>01162      &lt;&lt; <span class="stringliteral">&quot; institution_name The name of the institution: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ab0b7594b6219efbad1137269d4fa4528">institution_name_</a> &lt;&lt; vcl_endl
<a name="l01163"></a>01163      &lt;&lt; <span class="stringliteral">&quot; institution_addr The address of the institution: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#afc916db3d8c3c72d27f20f564156b8b4">institution_addr_</a> &lt;&lt; vcl_endl
<a name="l01164"></a>01164      &lt;&lt; <span class="stringliteral">&quot; ref_phys_name    The name of the referring physician: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a49907326c98464276f2041903b5df793">ref_phys_name_</a> &lt;&lt; vcl_endl
<a name="l01165"></a>01165      &lt;&lt; <span class="stringliteral">&quot; station_name     The name of the station used: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#aed23bcd2efae06aa2083677b67b7c585">station_name_</a> &lt;&lt; vcl_endl
<a name="l01166"></a>01166      &lt;&lt; <span class="stringliteral">&quot; study_desc       A description of the study: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ac1206b309faec7373da15985f8368fa2">study_desc_</a> &lt;&lt; vcl_endl
<a name="l01167"></a>01167      &lt;&lt; <span class="stringliteral">&quot; series_desc      A description of the series: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a04d058247bc4123bfaa7071d9109f9fd">series_desc_</a> &lt;&lt; vcl_endl
<a name="l01168"></a>01168      &lt;&lt; <span class="stringliteral">&quot; att_phys_name    The name of the attending physician: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#adae00f5ee6ddcf20d78cbdc90d318021">att_phys_name_</a> &lt;&lt; vcl_endl
<a name="l01169"></a>01169      &lt;&lt; <span class="stringliteral">&quot; operator_name    The name of the MR operator: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a002dce62bc96c7bd328ebd592fd440dd">operator_name_</a> &lt;&lt; vcl_endl
<a name="l01170"></a>01170      &lt;&lt; <span class="stringliteral">&quot; model_name       The name of the MR scanner model: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a76d5c2f3b4401aa812afcf3b19d172e5">model_name_</a> &lt;&lt; vcl_endl
<a name="l01171"></a>01171 
<a name="l01172"></a>01172      &lt;&lt; <span class="stringliteral">&quot;\n\nPatient info\n&quot;</span>
<a name="l01173"></a>01173      &lt;&lt; <span class="stringliteral">&quot; patient_name     Patient&#39;s name: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#aeda143f0de9a3ba71bd5277a73388aa7">patient_name_</a> &lt;&lt; vcl_endl
<a name="l01174"></a>01174      &lt;&lt; <span class="stringliteral">&quot; patient_id       Patient&#39;s ID: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a0da2c8e5ceae6db7cae9b2baf9149d0a">patient_id_</a> &lt;&lt; vcl_endl
<a name="l01175"></a>01175      &lt;&lt; <span class="stringliteral">&quot; patient_dob      The patient&#39;s date of birth: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ac4e630ac8f780556ac1ada607ba28b74">patient_dob_</a> &lt;&lt; vcl_endl
<a name="l01176"></a>01176      &lt;&lt; <span class="stringliteral">&quot; patient_sex      The sex of the patient: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a30a1e404488ee732868dabd51b7bd054">patient_sex_</a> &lt;&lt; vcl_endl
<a name="l01177"></a>01177      &lt;&lt; <span class="stringliteral">&quot; patient_age      The age of the patient: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a31a2c471b8d5001dbbc90460259e073c">patient_age_</a> &lt;&lt; vcl_endl
<a name="l01178"></a>01178      &lt;&lt; <span class="stringliteral">&quot; patient_weight_  The weight of the patient: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#af27622129f1ce95f90497746b99bccf1">patient_weight_</a> &lt;&lt; vcl_endl
<a name="l01179"></a>01179      &lt;&lt; <span class="stringliteral">&quot; patient_hist     Any additional patient history: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a12eae05b09f3219a1bfdead385e4d3de">patient_hist_</a> &lt;&lt; vcl_endl
<a name="l01180"></a>01180 
<a name="l01181"></a>01181      &lt;&lt; <span class="stringliteral">&quot;\n\nAcquisition Info\n&quot;</span>
<a name="l01182"></a>01182      &lt;&lt; <span class="stringliteral">&quot; scanning_seq     A description of the scanning sequence: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a7ac226d9ddf88fc0cea1350426fad54f">scanning_seq_</a> &lt;&lt; vcl_endl
<a name="l01183"></a>01183      &lt;&lt; <span class="stringliteral">&quot; sequence_var     A description of the sequence variant: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a183c02f78d1f13d852eb20df1ed3d139">sequence_var_</a> &lt;&lt; vcl_endl
<a name="l01184"></a>01184      &lt;&lt; <span class="stringliteral">&quot; scan_options     A description of various scan options: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#afff7c01ecb18f62620e72adbee994525">scan_options_</a> &lt;&lt; vcl_endl
<a name="l01185"></a>01185      &lt;&lt; <span class="stringliteral">&quot; mr_acq_type      The acquisition type for this scan: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a2bdd2f5c25abff6b42c6ca782b0a14dd">mr_acq_type_</a> &lt;&lt; vcl_endl
<a name="l01186"></a>01186      &lt;&lt; <span class="stringliteral">&quot; sequence_name    The name of the sequence: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#af468ca89ac563cacbc2861ff91313179">sequence_name_</a> &lt;&lt; vcl_endl
<a name="l01187"></a>01187      &lt;&lt; <span class="stringliteral">&quot; angio_flag       The angio flag for this sequence: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a78faba722978b5de1fec7fee0c68f71f">angio_flag_</a> &lt;&lt; vcl_endl
<a name="l01188"></a>01188      &lt;&lt; <span class="stringliteral">&quot; slice_thickness_ Slice thickness (for voxel size): &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ab831a2dc77db87da8a5c6f0428bfb02e">slice_thickness_</a> &lt;&lt; vcl_endl
<a name="l01189"></a>01189      &lt;&lt; <span class="stringliteral">&quot; repetition_time_ Scan repetition time: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ac77ea2d5e0aca979f2ad132f1c4beaf2">repetition_time_</a> &lt;&lt; vcl_endl
<a name="l01190"></a>01190      &lt;&lt; <span class="stringliteral">&quot; echo_time        Scan echo time: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ac4c578ba8622f710273c23a7f2b022c4">echo_time_</a> &lt;&lt; vcl_endl
<a name="l01191"></a>01191      &lt;&lt; <span class="stringliteral">&quot; inversion_time   Scan inversion time: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a283301548fe2572ebeb7cdc2fb0ced11">inversion_time_</a> &lt;&lt; vcl_endl
<a name="l01192"></a>01192      &lt;&lt; <span class="stringliteral">&quot; number_of_averages The number of averages for this scan: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a5e08399eb4c3fe00ef7d6ec9b2e1c260">number_of_averages_</a> &lt;&lt; vcl_endl
<a name="l01193"></a>01193      &lt;&lt; <span class="stringliteral">&quot; echo_numbers     The echo numbers for this scan: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#aa8694422437518935400631e463dec7b">echo_numbers_</a> &lt;&lt; vcl_endl
<a name="l01194"></a>01194      &lt;&lt; <span class="stringliteral">&quot; mag_field_strength The strength of the magnetic field: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a6e848d181e56d1098864e1a49baa68ca">mag_field_strength_</a> &lt;&lt; vcl_endl
<a name="l01195"></a>01195      &lt;&lt; <span class="stringliteral">&quot; echo_train_length The length of the echo train: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a6db5df230d0e53a886609b58831e51b0">echo_train_length_</a> &lt;&lt; vcl_endl
<a name="l01196"></a>01196      &lt;&lt; <span class="stringliteral">&quot; pixel_bandwidth  The bandwidth of the pixels: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a1cbe88966e02ff67179bd61ce7ceb4e0">pixel_bandwidth_</a> &lt;&lt; vcl_endl
<a name="l01197"></a>01197      &lt;&lt; <span class="stringliteral">&quot; software_vers_   Versions of the scanner software used: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae99ebb2b7f731ddf49a7f6ee7d4e79cf">software_vers_</a> &lt;&lt; vcl_endl
<a name="l01198"></a>01198      &lt;&lt; <span class="stringliteral">&quot; protocol_name    The name of the protocol used: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#acdb15d5d9d32d81c7c2c95cbe2d28d9c">protocol_name_</a> &lt;&lt; vcl_endl
<a name="l01199"></a>01199      &lt;&lt; <span class="stringliteral">&quot; heart_rate       The patient&#39;s heart rate: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a204735535306c1b1bd3cece3657547e5">heart_rate_</a> &lt;&lt; vcl_endl
<a name="l01200"></a>01200      &lt;&lt; <span class="stringliteral">&quot; card_num_images  The cardiac number of images: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a973185fefa1922113efdf043426b7e48">card_num_images_</a> &lt;&lt; vcl_endl
<a name="l01201"></a>01201      &lt;&lt; <span class="stringliteral">&quot; trigger_window   The trigger window for this image: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a6f31554f8e97eb242c9aeec6a0d8e4bf">trigger_window_</a> &lt;&lt; vcl_endl
<a name="l01202"></a>01202      &lt;&lt; <span class="stringliteral">&quot; reconst_diameter The reconstruction diameter: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a196505719c77aee5ae16d1848d1a16dd">reconst_diameter_</a> &lt;&lt; vcl_endl
<a name="l01203"></a>01203      &lt;&lt; <span class="stringliteral">&quot; receiving_coil_  Details of the receiving coil: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ad78486d841c9d66842389aa6c24b49cf">receiving_coil_</a> &lt;&lt; vcl_endl
<a name="l01204"></a>01204      &lt;&lt; <span class="stringliteral">&quot; phase_enc_dir    The phase encoding direction: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a5032dd00fb3b8892c38314248cad1a4b">phase_enc_dir_</a> &lt;&lt; vcl_endl
<a name="l01205"></a>01205      &lt;&lt; <span class="stringliteral">&quot; flip_angle       The flip angle: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ac228324597a65d2bddbe7e115fdcc639">flip_angle_</a> &lt;&lt; vcl_endl
<a name="l01206"></a>01206      &lt;&lt; <span class="stringliteral">&quot; sar              The specific absorption rate: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a59812c867dc2d9d87dce213840f345a7">sar_</a> &lt;&lt; vcl_endl
<a name="l01207"></a>01207      &lt;&lt; <span class="stringliteral">&quot; patient_pos      The position of the patient in the scanner: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a5cf38f0f6d613e9761398c4f5f2b9424">patient_pos_</a> &lt;&lt; vcl_endl
<a name="l01208"></a>01208 
<a name="l01209"></a>01209      &lt;&lt; <span class="stringliteral">&quot;\n\nRelationship info\n&quot;</span>
<a name="l01210"></a>01210      &lt;&lt; <span class="stringliteral">&quot; stud_ins_uid     The study instance unique id: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#adf02b9e66dc179f88611585ae3246d7e">stud_ins_uid_</a> &lt;&lt; vcl_endl
<a name="l01211"></a>01211      &lt;&lt; <span class="stringliteral">&quot; ser_ins_uid      The series instance unique id: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae46a857ee833e0aed1e6ab459710c4d0">ser_ins_uid_</a> &lt;&lt; vcl_endl
<a name="l01212"></a>01212      &lt;&lt; <span class="stringliteral">&quot; study_id         The id of this study: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ac29ae72b701ecb59f70fff8e4088d67f">study_id_</a> &lt;&lt; vcl_endl
<a name="l01213"></a>01213      &lt;&lt; <span class="stringliteral">&quot; series_number    The number of this series: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a901098c71ec72810d06c4311bd6bb666">series_number_</a> &lt;&lt; vcl_endl
<a name="l01214"></a>01214      &lt;&lt; <span class="stringliteral">&quot; acquisition_number The number of the acquisition: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a2cc5202cae1a686ad72a02c9f4dfc62e">acquisition_number_</a> &lt;&lt; vcl_endl
<a name="l01215"></a>01215      &lt;&lt; <span class="stringliteral">&quot; image_number     The number of this image instance: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a0829d31bf9f12315d9f9f2be925ebb0e">image_number_</a> &lt;&lt; vcl_endl
<a name="l01216"></a>01216      &lt;&lt; <span class="stringliteral">&quot; pat_orient       The orientation of the patient: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a39c127d40d5a071bbaffa50ac912caaf">pat_orient_</a> &lt;&lt; vcl_endl
<a name="l01217"></a>01217      &lt;&lt; <span class="stringliteral">&quot; image_pos        The image position relative to the patient: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ad64bf289ea06444fcbaacfcf669479bb">image_pos_</a>[0] &lt;&lt; <span class="charliteral">&#39;/&#39;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ad64bf289ea06444fcbaacfcf669479bb">image_pos_</a>[1] &lt;&lt; <span class="charliteral">&#39;/&#39;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ad64bf289ea06444fcbaacfcf669479bb">image_pos_</a>[2] &lt;&lt; vcl_endl
<a name="l01218"></a>01218      &lt;&lt; <span class="stringliteral">&quot; image_orient     The image orientation relative to the patient: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae4ae2377fba75f5603dfc0ef5c7279bf">image_orient_</a>[0] &lt;&lt; <span class="charliteral">&#39;/&#39;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae4ae2377fba75f5603dfc0ef5c7279bf">image_orient_</a>[1] &lt;&lt; <span class="charliteral">&#39;/&#39;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae4ae2377fba75f5603dfc0ef5c7279bf">image_orient_</a>[2] &lt;&lt; <span class="charliteral">&#39;/&#39;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae4ae2377fba75f5603dfc0ef5c7279bf">image_orient_</a>[3] &lt;&lt; <span class="charliteral">&#39;/&#39;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae4ae2377fba75f5603dfc0ef5c7279bf">image_orient_</a>[4] &lt;&lt; <span class="charliteral">&#39;/&#39;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae4ae2377fba75f5603dfc0ef5c7279bf">image_orient_</a>[5] &lt;&lt; vcl_endl
<a name="l01219"></a>01219      &lt;&lt; <span class="stringliteral">&quot; frame_of_ref     The frame of reference&quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a28b195a6d73472254de16173e897de41">frame_of_ref_</a> &lt;&lt; vcl_endl
<a name="l01220"></a>01220      &lt;&lt; <span class="stringliteral">&quot; images_in_acq    Then number ot images in the acquisition: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae3d38baafab2b70097cc8312f49d47d1">images_in_acq_</a> &lt;&lt; vcl_endl
<a name="l01221"></a>01221      &lt;&lt; <span class="stringliteral">&quot; pos_ref_ind      The position reference indicator: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae3bcde240a0ffecc9a3a060c7e3530d3">pos_ref_ind_</a> &lt;&lt; vcl_endl
<a name="l01222"></a>01222      &lt;&lt; <span class="stringliteral">&quot; slice_location   The location of the slice: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#adbdbbe6857be0a85e0ea79a1c627730b">slice_location_</a> &lt;&lt; vcl_endl
<a name="l01223"></a>01223 
<a name="l01224"></a>01224      &lt;&lt; <span class="stringliteral">&quot;\n\nImage info\n&quot;</span>
<a name="l01225"></a>01225      &lt;&lt; <span class="stringliteral">&quot; pix_samps        The number of samples per pixel: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ad65f1baf306d6a32bb5641b2c80f2f9c">pix_samps_</a> &lt;&lt; vcl_endl
<a name="l01226"></a>01226      &lt;&lt; <span class="stringliteral">&quot; photo_interp     The photometric interpretation: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ad10dd496ea7fd5e107c6321169a02897">photo_interp_</a> &lt;&lt; vcl_endl
<a name="l01227"></a>01227      &lt;&lt; <span class="stringliteral">&quot; size_x           The number of columns: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#aa3b2dd88703a6d82614d06a9ff7dfafe">size_x_</a> &lt;&lt; vcl_endl
<a name="l01228"></a>01228      &lt;&lt; <span class="stringliteral">&quot; size_y           The number of rows: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a78eafe0731c974109307e2473e35a605">size_y_</a> &lt;&lt; vcl_endl
<a name="l01229"></a>01229      &lt;&lt; <span class="stringliteral">&quot; size_z           The number of planes: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a27377c3d91f660c87d2bfa2cbbec225a">size_z_</a> &lt;&lt; vcl_endl
<a name="l01230"></a>01230      &lt;&lt; <span class="stringliteral">&quot; high_bit         The bit used as the high bit: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#aa5c9b984019acb609b0039300518148e">high_bit_</a> &lt;&lt; vcl_endl
<a name="l01231"></a>01231      &lt;&lt; <span class="stringliteral">&quot; small_im_pix_val The smallest image pixel value: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a0c372481641d36985af54b13cd0aa337">small_im_pix_val_</a> &lt;&lt; vcl_endl
<a name="l01232"></a>01232      &lt;&lt; <span class="stringliteral">&quot; large_im_pix_val The largest image pixel value: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#adca5451d8bce1197a5b170fd3afcd4e5">large_im_pix_val_</a> &lt;&lt; vcl_endl
<a name="l01233"></a>01233      &lt;&lt; <span class="stringliteral">&quot; pixel_padding_val The value used for padding pixels: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ad53e2fbb58bd8dc8063db2e6ee177022">pixel_padding_val_</a> &lt;&lt; vcl_endl
<a name="l01234"></a>01234      &lt;&lt; <span class="stringliteral">&quot; window_centre    The value of the image window&#39;s centre: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae6f2ebd5b537d77061e80b859cc568fe">window_centre_</a> &lt;&lt; vcl_endl
<a name="l01235"></a>01235      &lt;&lt; <span class="stringliteral">&quot; window_width     The actual width of the image window: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a49023b81ab13ddc407fd050edc2dd6f9">window_width_</a> &lt;&lt; vcl_endl
<a name="l01236"></a>01236 
<a name="l01237"></a>01237      &lt;&lt; <span class="stringliteral">&quot;\n\nInfo from the tags specifically for reading the image data\n&quot;</span>
<a name="l01238"></a>01238      &lt;&lt; <span class="stringliteral">&quot; spaxing_x        The pixel spacing in x: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a683166f59271e8f0ff82c898d1700347">spacing_x_</a> &lt;&lt; vcl_endl
<a name="l01239"></a>01239      &lt;&lt; <span class="stringliteral">&quot; spacing_y        The pixel spacing in y: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ac3a6905bb65779442664f412770e1094">spacing_y_</a> &lt;&lt; vcl_endl
<a name="l01240"></a>01240      &lt;&lt; <span class="stringliteral">&quot; spacing_slice    The pixel spacing in z: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#aef03bd48bad1973d198268220dfa77de">spacing_slice_</a> &lt;&lt; vcl_endl
<a name="l01241"></a>01241      &lt;&lt; <span class="stringliteral">&quot; res_intercept    The image rescale intercept: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a019200da9590b92452886bd4456f37b5">res_intercept_</a> &lt;&lt; vcl_endl
<a name="l01242"></a>01242      &lt;&lt; <span class="stringliteral">&quot; res_slope        The image rescale slope: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a49cf1a40c2f66b5efe56f5b591364c00">res_slope_</a> &lt;&lt; vcl_endl
<a name="l01243"></a>01243      &lt;&lt; <span class="stringliteral">&quot; pix_rep          The pixel representation (+/-): &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#a668e86ad08c53c48bc28133b43f9d140">pix_rep_</a> &lt;&lt; vcl_endl
<a name="l01244"></a>01244      &lt;&lt; <span class="stringliteral">&quot; stored_bits      The bits stored: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#ae6d9ceef71fcd43875774b1712a7a3c6">stored_bits_</a> &lt;&lt; vcl_endl
<a name="l01245"></a>01245      &lt;&lt; <span class="stringliteral">&quot; allocated_bits   The bits allocated: &quot;</span> &lt;&lt; s.<a class="code" href="structvil__dicom__header__info.html#afe7b8cbaa8d2f98746461ac3a8df3770">allocated_bits_</a> &lt;&lt; vcl_endl;
<a name="l01246"></a>01246 }
<a name="l01247"></a>01247 
<a name="l01248"></a>01248 <span class="preprocessor">#endif // HAS_DCMTK</span>
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 1 2013 17:31:46 for core/vil by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
