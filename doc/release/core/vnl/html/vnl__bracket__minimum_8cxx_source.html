<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>core/vnl/algo/vnl_bracket_minimum.cxx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">core/vnl/algo/vnl_bracket_minimum.cxx</div>  </div>
</div>
<div class="contents">
<a href="vnl__bracket__minimum_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// This is core/vnl/algo/vnl_bracket_minimum.cxx</span>
<a name="l00002"></a>00002 <span class="preprocessor">#ifdef VCL_NEEDS_PRAGMA_INTERFACE</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor">#pragma implementation</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span><span class="comment">//:</span>
<a name="l00006"></a>00006 <span class="comment">// \file</span>
<a name="l00007"></a>00007 <span class="comment">// \brief Function to bracket a minimum</span>
<a name="l00008"></a>00008 <span class="comment">// \author Tim Cootes</span>
<a name="l00009"></a>00009 <span class="comment">// \date   Feb 2007</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="vnl__bracket__minimum_8h.html" title="Function to bracket a minimum.">vnl_bracket_minimum.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;<a class="code" href="vnl__fit__parabola_8h.html" title="Function to fit a parabola to three point to predict the centre line.">vnl/algo/vnl_fit_parabola.h</a>&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;vcl_cmath.h&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;vcl_algorithm.h&gt;</span>
<a name="l00015"></a>00015 <span class="comment">// not used? #include &lt;vcl_iostream.h&gt;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> GOLDEN_RATIO = 1.618033988749894848; <span class="comment">// = 0.5*(vcl_sqrt(5)-1);</span>
<a name="l00018"></a>00018 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> EPS   = 1e-7;  <span class="comment">// Loose tolerance</span>
<a name="l00019"></a>00019 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> EPSqr = 1e-14;
<a name="l00020"></a><a class="code" href="vnl__bracket__minimum_8cxx.html#a4f2e3c5359dce426ee28f83f9abca5a7">00020</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(<span class="keywordtype">double</span>&amp; a, <span class="keywordtype">double</span>&amp; b)
<a name="l00021"></a>00021 {
<a name="l00022"></a>00022   <span class="keywordtype">double</span> x=a;
<a name="l00023"></a>00023   a=b;
<a name="l00024"></a>00024   b=x;
<a name="l00025"></a>00025 }
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="classvnl__bm__func.html">00027</a> <span class="keyword">class </span><a class="code" href="classvnl__bm__func.html">vnl_bm_func</a>
<a name="l00028"></a>00028 {
<a name="l00029"></a><a class="code" href="classvnl__bm__func.html#a7cde52d0b2abacd181914b3fc58668f1">00029</a>   <a class="code" href="classvnl__vector.html">vnl_vector&lt;double&gt;</a> <a class="code" href="classvnl__bm__func.html#a7cde52d0b2abacd181914b3fc58668f1">v</a>;
<a name="l00030"></a><a class="code" href="classvnl__bm__func.html#a48085d4328f686ffa71a849f800345dd">00030</a>   <a class="code" href="classvnl__cost__function.html" title="An object that represents a function from R^n -&gt; R.">vnl_cost_function</a>* <a class="code" href="classvnl__bm__func.html#a48085d4328f686ffa71a849f800345dd">f</a>;
<a name="l00031"></a>00031  <span class="keyword">public</span>:
<a name="l00032"></a><a class="code" href="classvnl__bm__func.html#a57d7eb1c72b3f4339f05566f80687ae1">00032</a>   <a class="code" href="classvnl__bm__func.html#a57d7eb1c72b3f4339f05566f80687ae1">vnl_bm_func</a>(<a class="code" href="classvnl__cost__function.html" title="An object that represents a function from R^n -&gt; R.">vnl_cost_function</a>&amp; fn) { <a class="code" href="classvnl__bm__func.html#a48085d4328f686ffa71a849f800345dd">f</a>=&amp;fn; <a class="code" href="classvnl__bm__func.html#a7cde52d0b2abacd181914b3fc58668f1">v</a>.<a class="code" href="classvnl__vector.html#ae34b3cfb08e104f2ac81a74dc91537cc" title="Resize to n elements.">set_size</a>(1); }
<a name="l00033"></a><a class="code" href="classvnl__bm__func.html#a2f43a73c3bd3b77a6e6255adc35745f0">00033</a>   <span class="keywordtype">double</span> <a class="code" href="classvnl__bm__func.html#a2f43a73c3bd3b77a6e6255adc35745f0">operator()</a>(<span class="keywordtype">double</span> x) { <a class="code" href="classvnl__bm__func.html#a7cde52d0b2abacd181914b3fc58668f1">v</a>[0]=x; <span class="keywordflow">return</span> <a class="code" href="classvnl__bm__func.html#a48085d4328f686ffa71a849f800345dd">f</a>-&gt;<a class="code" href="classvnl__cost__function.html#a1252f15e0d7024b47410c54a78b2f1e3" title="The main function. Given the parameter vector x, compute the value of f(x).">f</a>(<a class="code" href="classvnl__bm__func.html#a7cde52d0b2abacd181914b3fc58668f1">v</a>); }
<a name="l00034"></a>00034 };
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">//: Given initial values a and b, find bracket a&lt;b&lt;c s.t. f(a)&gt;f(b)&lt;f(c)</span>
<a name="l00037"></a>00037 <span class="comment">//  Final function values at a,b,c stored in fa,fb,fc</span>
<a name="l00038"></a><a class="code" href="vnl__bracket__minimum_8h.html#a5699947e51ea91f43893f8685b7f356e">00038</a> <span class="keywordtype">void</span> <a class="code" href="vnl__bracket__minimum_8cxx.html#a61804017a75e397a0114f3b766615e2f" title="Given initial values a and b, find bracket a&lt;b&lt;c s.t. f(a)&gt;f(b)&lt;f(c).">vnl_bracket_minimum</a>(<a class="code" href="classvnl__cost__function.html" title="An object that represents a function from R^n -&gt; R.">vnl_cost_function</a>&amp; fn,
<a name="l00039"></a>00039                          <span class="keywordtype">double</span>&amp; a, <span class="keywordtype">double</span>&amp; b, <span class="keywordtype">double</span>&amp; c,
<a name="l00040"></a>00040                          <span class="keywordtype">double</span>&amp; fa, <span class="keywordtype">double</span>&amp; fb, <span class="keywordtype">double</span>&amp; fc)
<a name="l00041"></a>00041 {
<a name="l00042"></a>00042   <span class="comment">// Set up object to evaluate function</span>
<a name="l00043"></a>00043   <span class="comment">// Note that fn takes a vector input - f converts a scalar to a vector</span>
<a name="l00044"></a>00044   <a class="code" href="classvnl__bm__func.html">vnl_bm_func</a> f(fn);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <span class="keywordflow">if</span> (b==a) b=a+1.0;
<a name="l00047"></a>00047   fa = f(a);
<a name="l00048"></a>00048   fb = f(b);
<a name="l00049"></a>00049 
<a name="l00050"></a>00050   <span class="comment">// Arrange that fb&lt;=fa</span>
<a name="l00051"></a>00051   <span class="keywordflow">if</span> (fb&gt;fa)
<a name="l00052"></a>00052   {
<a name="l00053"></a>00053     <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(a,b); <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(fa,fb);
<a name="l00054"></a>00054   }
<a name="l00055"></a>00055 
<a name="l00056"></a>00056   <span class="comment">// Initial guess at c</span>
<a name="l00057"></a>00057   c = b+ GOLDEN_RATIO*(b-a);
<a name="l00058"></a>00058   fc = f(c);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060   <span class="keywordflow">while</span> (fc&lt;fb)  <span class="comment">// Keep stepping until we go uphill again</span>
<a name="l00061"></a>00061   {
<a name="l00062"></a>00062     <span class="comment">// Use parabolic interpolation to estimate position of centre</span>
<a name="l00063"></a>00063     <span class="keywordtype">double</span> p,q;
<a name="l00064"></a>00064     <a class="code" href="vnl__fit__parabola_8h.html#acedc0d68d230a237eebef5857e62facb" title="Fit a parabola so as to estimate the position of the centre line.">vnl_fit_parabola</a>(a,b,c,fa,fb,fc,p,q);
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <span class="comment">// Ensure q not within EPSqr of zero</span>
<a name="l00067"></a>00067     <span class="keywordflow">if</span> (q&gt;=0 &amp;&amp; q&lt;EPSqr) q=EPSqr;
<a name="l00068"></a>00068     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q&lt;0 &amp;&amp; q+EPSqr&gt;0) q=-1.0*EPSqr;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="comment">// Estimate of centre of parabolic fit - ie minimum</span>
<a name="l00071"></a>00071     <span class="comment">// For true quadratic function, minima is at b+p/q</span>
<a name="l00072"></a>00072     <span class="keywordtype">double</span> du = p/q;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     <span class="keywordtype">double</span> tol = EPS*(1.0+vcl_max(vcl_fabs(b),vcl_fabs(c)));
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     <span class="comment">// Don&#39;t evaluate too close to b</span>
<a name="l00077"></a>00077     <span class="keywordflow">if</span> (du&gt;=0 &amp;&amp; du&lt;tol)       du=tol;
<a name="l00078"></a>00078     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (du&lt;0 &amp;&amp; du+tol&gt;0) du=-1.0*tol;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     <span class="keywordtype">double</span> u = b + du;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     <span class="comment">// Don&#39;t evaluate too close to c</span>
<a name="l00083"></a>00083     <span class="keywordflow">if</span> ((u-c)&lt;tol &amp;&amp; (u-c)&gt;=0)        u+=tol;  <span class="comment">// u&gt;c by small amount</span>
<a name="l00084"></a>00084     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((c-u)&lt;tol &amp;&amp; (c-u)&gt;=0)   u-=tol;  <span class="comment">// u&lt;c by small amount</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <span class="keywordtype">double</span> u_limit = b + 100*(c-b);  <span class="comment">// Some way along the line</span>
<a name="l00087"></a>00087     <span class="keywordtype">double</span> fu=0.0;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="keywordflow">if</span> ((u-b)*(c-u)&gt;0.0)  <span class="comment">// u in range (b,c), allowing for c&lt;b</span>
<a name="l00090"></a>00090     {
<a name="l00091"></a>00091       fu = f(u);
<a name="l00092"></a>00092       <span class="keywordflow">if</span> (fu&lt;fc)
<a name="l00093"></a>00093       {
<a name="l00094"></a>00094         <span class="comment">// Bracket is (b,u,c)</span>
<a name="l00095"></a>00095         a=b; fa=fb;  b=u; fb=fu;
<a name="l00096"></a>00096         <span class="comment">// Ensure a&lt;b&lt;c</span>
<a name="l00097"></a>00097         <span class="keywordflow">if</span> (a&gt;c) { <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(a,c); <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(fa,fc); }
<a name="l00098"></a>00098         <span class="keywordflow">return</span>;
<a name="l00099"></a>00099       }
<a name="l00100"></a>00100       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fu&gt;fb)
<a name="l00101"></a>00101       {
<a name="l00102"></a>00102         <span class="comment">// Bracket is (a,b,u)</span>
<a name="l00103"></a>00103         c=u; fc=fu;
<a name="l00104"></a>00104         <span class="comment">// Ensure a&lt;b&lt;c</span>
<a name="l00105"></a>00105         <span class="keywordflow">if</span> (a&gt;c) { <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(a,c); <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(fa,fc); }
<a name="l00106"></a>00106         <span class="keywordflow">return</span>;
<a name="l00107"></a>00107       }
<a name="l00108"></a>00108       <span class="comment">// The predicted point is unhelpful, so try a default step</span>
<a name="l00109"></a>00109       u = c+GOLDEN_RATIO*(c-b);
<a name="l00110"></a>00110       fu = f(u);
<a name="l00111"></a>00111     }
<a name="l00112"></a>00112     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((u-c)*(u_limit-u)&gt;0.0)  <span class="comment">// u in range (c,u_limit)</span>
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114       fu = f(u);
<a name="l00115"></a>00115       <span class="keywordflow">if</span> (fu&gt;fc)
<a name="l00116"></a>00116       {
<a name="l00117"></a>00117         <span class="comment">// Bracket is (b,c,u)</span>
<a name="l00118"></a>00118         a=b; fa=fb;  b=c; fb=fc; c=u; fc=fu;
<a name="l00119"></a>00119         <span class="comment">// Ensure a&lt;b&lt;c</span>
<a name="l00120"></a>00120         <span class="keywordflow">if</span> (a&gt;c) { <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(a,c); <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(fa,fc); }
<a name="l00121"></a>00121         <span class="keywordflow">return</span>;
<a name="l00122"></a>00122       }
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((u_limit-c)*(u-u_limit)&gt;=0) <span class="comment">// u is beyond u_limit</span>
<a name="l00125"></a>00125     {
<a name="l00126"></a>00126       u=u_limit;
<a name="l00127"></a>00127       fu=f(u);
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129     <span class="keywordflow">else</span>  <span class="comment">// u is somewhere else</span>
<a name="l00130"></a>00130     {
<a name="l00131"></a>00131       <span class="comment">// Next guess is at u</span>
<a name="l00132"></a>00132       u = c+GOLDEN_RATIO*(c-b);
<a name="l00133"></a>00133       fu = f(u);
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="comment">// Move bracket</span>
<a name="l00137"></a>00137     a=b;   b=c;    c=u;
<a name="l00138"></a>00138     fa=fb; fb=fc; fc=fu;
<a name="l00139"></a>00139   }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141   <span class="comment">// Ensure a&lt;b&lt;c</span>
<a name="l00142"></a>00142   <span class="keywordflow">if</span> (a&gt;c)
<a name="l00143"></a>00143   {
<a name="l00144"></a>00144     <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(a,c); <a class="code" href="classvnl__matrix.html#aa899f9ca6246f32e2792180d64e104ef" title="Swap two matrices.">swap</a>(fa,fc);
<a name="l00145"></a>00145   }
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 1 2013 17:31:00 for core/vnl by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
