<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>core/vpgl/vpgl_perspective_camera.txx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">core/vpgl/vpgl_perspective_camera.txx</div>  </div>
</div>
<div class="contents">
<a href="vpgl__perspective__camera_8txx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// This is core/vpgl/vpgl_perspective_camera.txx</span>
<a name="l00002"></a>00002 <span class="preprocessor">#ifndef vpgl_perspective_camera_txx_</span>
<a name="l00003"></a><a class="code" href="vpgl__perspective__camera_8txx.html#a38b8430641a6159b6442c97eb6a93234">00003</a> <span class="preprocessor"></span><span class="preprocessor">#define vpgl_perspective_camera_txx_</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="comment">//:</span>
<a name="l00005"></a>00005 <span class="comment">// \file</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="vpgl__perspective__camera_8h.html" title="A class for the perspective camera model.">vpgl_perspective_camera.h</a>&quot;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__point__2d_8h.html">vgl/vgl_point_2d.h</a>&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__vector__3d_8h.html">vgl/vgl_vector_3d.h</a>&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__homg__plane__3d_8h.html">vgl/vgl_homg_plane_3d.h</a>&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__line__3d__2__points_8h.html">vgl/vgl_line_3d_2_points.h</a>&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__h__matrix__3d_8h.html">vgl/algo/vgl_h_matrix_3d.h</a>&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__det_8h.html">vnl/vnl_det.h</a>&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__qr_8h.html">vnl/algo/vnl_qr.h</a>&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__matrix__fixed_8h.html">vnl/vnl_matrix_fixed.h</a>&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#if 0</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__io__point__3d_8h.html">vgl/io/vgl_io_point_3d.h</a>&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__io__matrix__fixed_8h.html">vnl/io/vnl_io_matrix_fixed.h</a>&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__io__vector__fixed_8h.html">vnl/io/vnl_io_vector_fixed.h</a>&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#endif</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#include &lt;vul/vul_file.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;vul/vul_file_iterator.h&gt;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;vcl_cassert.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;vcl_iostream.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;vcl_fstream.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;vcl_algorithm.h&gt;</span> <span class="comment">// for std::sort()</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__trace_8h.html">vnl/vnl_trace.h</a>&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="comment">//-------------------------------------------</span>
<a name="l00033"></a>00033 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00034"></a><a class="code" href="classvpgl__perspective__camera.html#a73d156bc94eeaf62601a49d8abd3c9bd">00034</a> <a class="code" href="classvpgl__perspective__camera.html#a73d156bc94eeaf62601a49d8abd3c9bd" title="Default constructor.">vpgl_perspective_camera&lt;T&gt;::vpgl_perspective_camera</a>()
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036   R_.set_identity();
<a name="l00037"></a>00037   camera_center_.set( (T)0, (T)0, (T)0 );
<a name="l00038"></a>00038   recompute_matrix();
<a name="l00039"></a>00039 }
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="comment">//-------------------------------------------</span>
<a name="l00043"></a>00043 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00044"></a><a class="code" href="classvpgl__perspective__camera.html#a51b9121c60b6846b28f41671a53ee0fa">00044</a> <a class="code" href="classvpgl__perspective__camera.html#a73d156bc94eeaf62601a49d8abd3c9bd" title="Default constructor.">vpgl_perspective_camera&lt;T&gt;::vpgl_perspective_camera</a>(
<a name="l00045"></a>00045   <span class="keyword">const</span> <a class="code" href="classvpgl__calibration__matrix.html" title="A class representing the &quot;K&quot; matrix of a perspective camera matrix as described in.">vpgl_calibration_matrix&lt;T&gt;</a>&amp; K,
<a name="l00046"></a>00046   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a>&amp; camera_center,
<a name="l00047"></a>00047   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a>&amp; R ) :
<a name="l00048"></a>00048   K_( K ), camera_center_( camera_center ), R_( R )
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050   <a class="code" href="classvpgl__perspective__camera.html#abf76fe340d93cfaac78ed407905dd4ac" title="Recalculate the 3x4 camera matrix from the parameters.">recompute_matrix</a>();
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="comment">//-------------------------------------------</span>
<a name="l00054"></a>00054 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00055"></a><a class="code" href="classvpgl__perspective__camera.html#af3f566d3b5aefe84c25ba06c7d43d1a8">00055</a> <a class="code" href="classvpgl__perspective__camera.html#a73d156bc94eeaf62601a49d8abd3c9bd" title="Default constructor.">vpgl_perspective_camera&lt;T&gt;::vpgl_perspective_camera</a>(
<a name="l00056"></a>00056   <span class="keyword">const</span> <a class="code" href="classvpgl__calibration__matrix.html" title="A class representing the &quot;K&quot; matrix of a perspective camera matrix as described in.">vpgl_calibration_matrix&lt;T&gt;</a>&amp; K,
<a name="l00057"></a>00057   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a>&amp; R,
<a name="l00058"></a>00058   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a>&amp; t) :
<a name="l00059"></a>00059   K_( K ),  R_( R )
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061   this-&gt;<a class="code" href="classvpgl__perspective__camera.html#a2f29cc9fc588aef782985df42bf5c6d3">set_translation</a>(t);
<a name="l00062"></a>00062   <a class="code" href="classvpgl__perspective__camera.html#abf76fe340d93cfaac78ed407905dd4ac" title="Recalculate the 3x4 camera matrix from the parameters.">recompute_matrix</a>();
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="comment">//-------------------------------------------</span>
<a name="l00066"></a>00066 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00067"></a><a class="code" href="classvpgl__perspective__camera.html#a11837769fe1a00eaaed9db3b09dbd6f2">00067</a> <a class="code" href="classvpgl__perspective__camera.html#a73d156bc94eeaf62601a49d8abd3c9bd" title="Default constructor.">vpgl_perspective_camera&lt;T&gt;::vpgl_perspective_camera</a>( <span class="keyword">const</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera</a>&amp; that)
<a name="l00068"></a>00068   : <a class="code" href="classvpgl__proj__camera.html">vpgl_proj_camera</a>&lt;T&gt;(that),
<a name="l00069"></a>00069   K_(that.K_),
<a name="l00070"></a>00070   camera_center_(that.camera_center_),
<a name="l00071"></a>00071   R_(that.R_)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">//-------------------------------------------</span>
<a name="l00076"></a>00076 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00077"></a><a class="code" href="classvpgl__perspective__camera.html#ac33e42aa1d7228e48a0ed5b3db828c90">00077</a> <a class="code" href="classvpgl__proj__camera.html">vpgl_proj_camera&lt;T&gt;</a>* <a class="code" href="classvpgl__perspective__camera.html#ac33e42aa1d7228e48a0ed5b3db828c90" title="Clone `this&#39;: creation of a new object and initialization.">vpgl_perspective_camera&lt;T&gt;::clone</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00078"></a>00078 <span class="keyword"></span>{
<a name="l00079"></a>00079   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>(*this);
<a name="l00080"></a>00080 }
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="comment">//------------------------------------</span>
<a name="l00083"></a>00083 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00084"></a><a class="code" href="classvpgl__perspective__camera.html#a6fe2a0912a5ea52a9e3ed693544fe549">00084</a> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__line__3d__2__points.html">vgl_homg_line_3d_2_points&lt;T&gt;</a> <a class="code" href="classvpgl__perspective__camera.html#a6fe2a0912a5ea52a9e3ed693544fe549" title="Finite backprojection.">vpgl_perspective_camera&lt;T&gt;::backproject</a>(
<a name="l00085"></a>00085   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__2d.html">vgl_homg_point_2d&lt;T&gt;</a>&amp; image_point )<span class="keyword"> const</span>
<a name="l00086"></a>00086 <span class="keyword"></span>{
<a name="l00087"></a>00087   <span class="comment">// First find a point that projects to &quot;image_point&quot;.</span>
<a name="l00088"></a>00088   <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__vector__fixed.html">vnl_vector_fixed&lt;T,4&gt;</a> vnl_wp = this-&gt;svd()-&gt;solve(
<a name="l00089"></a>00089     <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__vector__fixed.html">vnl_vector_fixed&lt;T,3&gt;</a>( image_point.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__2d.html#a1d928ee2aae43e7cc7bec7e2db2ad989">x</a>(), image_point.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__2d.html#a098f0121fa0b75d2f4171d00a1bf7f31">y</a>(), image_point.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__2d.html#ab452fbf6dec9591ff07c0ebb7b05f1e1">w</a>() ).as_ref() );
<a name="l00090"></a>00090   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html">vgl_homg_point_3d&lt;T&gt;</a> wp( vnl_wp[0], vnl_wp[1], vnl_wp[2], vnl_wp[3] );
<a name="l00091"></a>00091   <span class="comment">// The ray is then defined by that point and the camera center.</span>
<a name="l00092"></a>00092   <span class="keywordflow">return</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__line__3d__2__points.html">vgl_homg_line_3d_2_points&lt;T&gt;</a>( <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html">vgl_homg_point_3d&lt;T&gt;</a>(camera_center_), wp );
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">//------------------------------------</span>
<a name="l00096"></a>00096 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00097"></a><a class="code" href="classvpgl__perspective__camera.html#ac387336f77aac36abd5fc689de198aee">00097</a> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__line__3d__2__points.html">vgl_line_3d_2_points&lt;T&gt;</a> <a class="code" href="classvpgl__perspective__camera.html#a6fe2a0912a5ea52a9e3ed693544fe549" title="Finite backprojection.">vpgl_perspective_camera&lt;T&gt;::backproject</a>(
<a name="l00098"></a>00098   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;T&gt;</a>&amp; image_point )<span class="keyword"> const</span>
<a name="l00099"></a>00099 <span class="keyword"></span>{
<a name="l00100"></a>00100   <span class="comment">// First find a point in front of the camera that projects to &quot;image_point&quot;.</span>
<a name="l00101"></a>00101   <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__vector__fixed.html">vnl_vector_fixed&lt;T,4&gt;</a> vnl_wp = this-&gt;svd()-&gt;solve(
<a name="l00102"></a>00102     <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__vector__fixed.html">vnl_vector_fixed&lt;T,3&gt;</a>( image_point.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__2d.html#a3d0455536dcb130f284c3eeaba1ae960">x</a>(), image_point.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__2d.html#a25dfe52017f7614103d028639125ff91">y</a>(), 1.0 ).as_ref() );
<a name="l00103"></a>00103   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html">vgl_homg_point_3d&lt;T&gt;</a> wp_homg( vnl_wp[0], vnl_wp[1], vnl_wp[2], vnl_wp[3] );
<a name="l00104"></a>00104   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a> wp;
<a name="l00105"></a>00105   <span class="keywordflow">if</span> ( !wp_homg.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a4a4417197e1a51204ab2613e8ef2f2ef">ideal</a>() )
<a name="l00106"></a>00106     wp.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a9214f0889950e12c7db9dfc6fbbcdd1a">set</a>( wp_homg.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#aceac2a4dfd00dc600196eb9b9279f5fd">x</a>()/wp_homg.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a446ca3aacd4e1a50921dba2a76403d17">w</a>(), wp_homg.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a054f0d10a7c37b4aebcae08daf66c185">y</a>()/wp_homg.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a446ca3aacd4e1a50921dba2a76403d17">w</a>(), wp_homg.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a7084d86ca9aeca00cf6c9b87bc2bfc92">z</a>()/wp_homg.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a446ca3aacd4e1a50921dba2a76403d17">w</a>() );
<a name="l00107"></a>00107   <span class="keywordflow">else</span>
<a name="l00108"></a>00108     wp.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a9214f0889950e12c7db9dfc6fbbcdd1a">set</a>( camera_center_.x()+wp_homg.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#aceac2a4dfd00dc600196eb9b9279f5fd">x</a>(),
<a name="l00109"></a>00109             camera_center_.y()+wp_homg.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a054f0d10a7c37b4aebcae08daf66c185">y</a>(),
<a name="l00110"></a>00110             camera_center_.z()+wp_homg.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a7084d86ca9aeca00cf6c9b87bc2bfc92">z</a>() );
<a name="l00111"></a>00111   <span class="keywordflow">if</span> ( is_behind_camera( <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html">vgl_homg_point_3d&lt;T&gt;</a>( wp ) ) )
<a name="l00112"></a>00112     wp = camera_center_ + ( camera_center_-wp );
<a name="l00113"></a>00113   <span class="comment">// The ray is then defined by that point and the camera center.</span>
<a name="l00114"></a>00114   <span class="keywordflow">return</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__line__3d__2__points.html">vgl_line_3d_2_points&lt;T&gt;</a>( camera_center_, wp );
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00118"></a>00118 <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__ray__3d.html">vgl_ray_3d&lt;T&gt;</a> <a class="code" href="classvpgl__perspective__camera.html#ab780b8c2f609362e889f4185b1fe6381" title="Finite ray backprojection.">vpgl_perspective_camera&lt;T&gt;::</a>
<a name="l00119"></a><a class="code" href="classvpgl__perspective__camera.html#ab780b8c2f609362e889f4185b1fe6381">00119</a> <a class="code" href="classvpgl__perspective__camera.html#ab780b8c2f609362e889f4185b1fe6381" title="Finite ray backprojection.">backproject_ray</a>( <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__2d.html">vgl_point_2d&lt;T&gt;</a>&amp; image_point )<span class="keyword"> const</span>
<a name="l00120"></a>00120 <span class="keyword"></span>{
<a name="l00121"></a>00121   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__line__3d__2__points.html">vgl_line_3d_2_points&lt;T&gt;</a> l2 = this-&gt;backproject(image_point);
<a name="l00122"></a>00122   <span class="keywordflow">return</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__ray__3d.html">vgl_ray_3d&lt;T&gt;</a>(l2.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__line__3d__2__points.html#a496c4503594c8c30be6260fc2f698c94">point1</a>(), l2.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__line__3d__2__points.html#a8b12d362528e44d7c0967db3132d5fa2">direction</a>());
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="comment">//-------------------------------------------</span>
<a name="l00126"></a>00126 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00127"></a><a class="code" href="classvpgl__perspective__camera.html#ab81a731a7bd791486500d8069e7090e8">00127</a> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> <a class="code" href="classvpgl__perspective__camera.html#ab81a731a7bd791486500d8069e7090e8" title="Compute the principal axis.">vpgl_perspective_camera&lt;T&gt;::principal_axis</a>()<span class="keyword"> const</span>
<a name="l00128"></a>00128 <span class="keyword"></span>{
<a name="l00129"></a>00129   <span class="comment">// See H&amp;Z pg 147</span>
<a name="l00130"></a>00130   <span class="comment">// P = [M|p4] : We do not need to compute det(M) because we enforce</span>
<a name="l00131"></a>00131   <span class="comment">// det(K)&gt;0 and det(R)=1 in the construction of P. Thus det(M)&gt;0;</span>
<a name="l00132"></a>00132   <span class="keyword">const</span> vnl_matrix_fixed&lt;T,3,4&gt;&amp; P = this-&gt;get_matrix();
<a name="l00133"></a>00133   <span class="keywordflow">return</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__vector__2d_8h.html#aa065437a44aac165249f81b940f1bda4">normalized</a>(<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a>(P(2,0),P(2,1),P(2,2)));
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="comment">//------------------------------------</span>
<a name="l00137"></a>00137 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00138"></a><a class="code" href="classvpgl__perspective__camera.html#a921d7cfdf3d46873e5eb371e112f9b97">00138</a> <span class="keywordtype">bool</span> <a class="code" href="classvpgl__perspective__camera.html#a921d7cfdf3d46873e5eb371e112f9b97" title="Determine whether the given point lies in front of the principal plane.">vpgl_perspective_camera&lt;T&gt;::is_behind_camera</a>(
<a name="l00139"></a>00139   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html">vgl_homg_point_3d&lt;T&gt;</a>&amp; world_point )<span class="keyword"> const</span>
<a name="l00140"></a>00140 <span class="keyword"></span>{
<a name="l00141"></a>00141   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__plane__3d.html">vgl_homg_plane_3d&lt;T&gt;</a> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__homg__line__2d_8h.html#a1cb503ddd20ff3cf9588d2b5abd202d8">l</a> = this-&gt;principal_plane();
<a name="l00142"></a>00142   T <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__ldl__cholesky_8cxx.html#a749fcd2621ed0316658d8e842a2ef5b1">dot</a> = world_point.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#aceac2a4dfd00dc600196eb9b9279f5fd">x</a>()*l.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__plane__3d.html#a7953c1e63b8fe1f02da1815972f1f2a2">a</a>() + world_point.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a054f0d10a7c37b4aebcae08daf66c185">y</a>()*l.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__plane__3d.html#ad9591fcf5af741af841d889911024e13">b</a>() +
<a name="l00143"></a>00143                world_point.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a7084d86ca9aeca00cf6c9b87bc2bfc92">z</a>()*l.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__plane__3d.html#a3a87cabef22cb6abfd081b8631fb3ec2">c</a>() + world_point.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a446ca3aacd4e1a50921dba2a76403d17">w</a>()*l.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__plane__3d.html#ab83a333e0676a516bbd02b38f099ab52">d</a>();
<a name="l00144"></a>00144   <span class="keywordflow">if</span> (world_point.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html#a446ca3aacd4e1a50921dba2a76403d17">w</a>() &lt; (T)0) dot = ((T)(-1))*dot;
<a name="l00145"></a>00145   <span class="keywordflow">return</span> dot &lt; 0;
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="comment">//-------------------------------------------</span>
<a name="l00149"></a>00149 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00150"></a><a class="code" href="classvpgl__perspective__camera.html#a52a6d4a6eed3435199c4930c4386d0dd">00150</a> <span class="keywordtype">void</span> <a class="code" href="classvpgl__perspective__camera.html#a52a6d4a6eed3435199c4930c4386d0dd" title="Setters and getters.">vpgl_perspective_camera&lt;T&gt;::set_calibration</a>( <span class="keyword">const</span> <a class="code" href="classvpgl__calibration__matrix.html" title="A class representing the &quot;K&quot; matrix of a perspective camera matrix as described in.">vpgl_calibration_matrix&lt;T&gt;</a>&amp; K)
<a name="l00151"></a>00151 {
<a name="l00152"></a>00152   K_ = K;
<a name="l00153"></a>00153   recompute_matrix();
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">//-------------------------------------------</span>
<a name="l00157"></a>00157 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00158"></a><a class="code" href="classvpgl__perspective__camera.html#a6f05d6e5b691e54d035c3da9451fc210">00158</a> <span class="keywordtype">void</span> <a class="code" href="classvpgl__perspective__camera.html#a6f05d6e5b691e54d035c3da9451fc210">vpgl_perspective_camera&lt;T&gt;::set_camera_center</a>(
<a name="l00159"></a>00159   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a>&amp; camera_center )
<a name="l00160"></a>00160 {
<a name="l00161"></a>00161   camera_center_ = camera_center;
<a name="l00162"></a>00162   recompute_matrix();
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">//-------------------------------------------</span>
<a name="l00166"></a>00166 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00167"></a><a class="code" href="classvpgl__perspective__camera.html#a2f29cc9fc588aef782985df42bf5c6d3">00167</a> <span class="keywordtype">void</span> <a class="code" href="classvpgl__perspective__camera.html#a2f29cc9fc588aef782985df42bf5c6d3">vpgl_perspective_camera&lt;T&gt;::set_translation</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a>&amp; t)
<a name="l00168"></a>00168 {
<a name="l00169"></a>00169   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a> Rt = R_.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html#ace38a61472db2247d7145f2cd1363a47">transpose</a>();
<a name="l00170"></a>00170   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> cv = -(Rt * t);
<a name="l00171"></a>00171   camera_center_.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#a116e3e1800f2c00537fe08f7e544edb8">set</a>(cv.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>(), cv.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>(), cv.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>());
<a name="l00172"></a>00172   recompute_matrix();
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="comment">//-------------------------------------------</span>
<a name="l00176"></a>00176 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00177"></a><a class="code" href="classvpgl__perspective__camera.html#a80e439cc6653dd505655034d78069a58">00177</a> <span class="keywordtype">void</span> <a class="code" href="classvpgl__perspective__camera.html#a80e439cc6653dd505655034d78069a58">vpgl_perspective_camera&lt;T&gt;::set_rotation</a>( <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a>&amp; R )
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179   R_ = R;
<a name="l00180"></a>00180   recompute_matrix();
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="comment">//-------------------------------------------</span>
<a name="l00184"></a>00184 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00185"></a><a class="code" href="classvpgl__perspective__camera.html#aefa8a5e462b3e51e129c05e95e119b07">00185</a> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> <a class="code" href="classvpgl__perspective__camera.html#aefa8a5e462b3e51e129c05e95e119b07">vpgl_perspective_camera&lt;T&gt;::get_translation</a>()<span class="keyword"> const</span>
<a name="l00186"></a>00186 <span class="keyword"></span>{
<a name="l00187"></a>00187   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> c(camera_center_.x(), camera_center_.y(),camera_center_.z());
<a name="l00188"></a>00188   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> temp = R_*c;
<a name="l00189"></a>00189   <span class="keywordflow">return</span> -temp;
<a name="l00190"></a>00190 }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="comment">//: Rotate the camera about its center such that it looks at the given point</span>
<a name="l00193"></a>00193 <span class="comment">//  The camera should also be rotated about its principal axis such that</span>
<a name="l00194"></a>00194 <span class="comment">//  the vertical image direction is closest to \p up in the world</span>
<a name="l00195"></a>00195 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00196"></a><a class="code" href="classvpgl__perspective__camera.html#a809b81538d2e1cb8645bb523a1fd93aa">00196</a> <span class="keywordtype">void</span> <a class="code" href="classvpgl__perspective__camera.html#a809b81538d2e1cb8645bb523a1fd93aa" title="Rotate the camera about its center such that it looks at the given point.">vpgl_perspective_camera&lt;T&gt;::look_at</a>(<span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html">vgl_homg_point_3d&lt;T&gt;</a>&amp; point,
<a name="l00197"></a>00197                                          <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a>&amp; up )
<a name="l00198"></a>00198 {
<a name="l00199"></a>00199   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> u = <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__vector__2d_8h.html#aa065437a44aac165249f81b940f1bda4">normalized</a>(up);
<a name="l00200"></a>00200   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> look = point - camera_center();
<a name="l00201"></a>00201   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__vector__2d_8h.html#ac4986a4b72b1d54b872d5863ac35d3e8">normalize</a>(look);
<a name="l00202"></a>00202   vcl_cout &lt;&lt; <span class="stringliteral">&quot;look at vector: &quot;</span> &lt;&lt; look &lt;&lt; vcl_endl;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 <span class="preprocessor">#if 0</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span>  T dp = <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__vector__2d_8h.html#af8601d1894aed553c33ab9d9a2c5af48">dot_product</a>(look, up);
<a name="l00206"></a>00206   <span class="keywordtype">bool</span> singularity = vcl_fabs(vcl_fabs(static_cast&lt;double&gt;(dp))-1.0)&lt;1e-08;
<a name="l00207"></a>00207   assert(!singularity);
<a name="l00208"></a>00208 <span class="preprocessor">#endif</span>
<a name="l00209"></a>00209 <span class="preprocessor"></span>  <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> z = look;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   <span class="keywordflow">if</span> (vcl_fabs(dot_product&lt;T&gt;(u,z)-T(1))&lt;1e-5)
<a name="l00212"></a>00212   {
<a name="l00213"></a>00213     T r[] = { 1, 0, 0,
<a name="l00214"></a>00214               0, 1, 0,
<a name="l00215"></a>00215               0, 0, 1 };
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     vnl_matrix_fixed&lt;T,3,3&gt; R(r);
<a name="l00218"></a>00218     set_rotation(<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a>(R));
<a name="l00219"></a>00219   }
<a name="l00220"></a>00220   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vcl_fabs(dot_product&lt;T&gt;(u,z)-T(-1))&lt;1e-5)
<a name="l00221"></a>00221   {
<a name="l00222"></a>00222     T r[] = { 1, 0, 0,
<a name="l00223"></a>00223             0, 1, 0,
<a name="l00224"></a>00224             0, 0, -1 };
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     vnl_matrix_fixed&lt;T,3,3&gt; R(r);
<a name="l00227"></a>00227     set_rotation(<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a>(R));
<a name="l00228"></a>00228   }
<a name="l00229"></a>00229   <span class="keywordflow">else</span>
<a name="l00230"></a>00230   {
<a name="l00231"></a>00231     <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> x = <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__vector__2d_8h.html#ae238212d8b18ea93da5fba3f397f984a">cross_product</a>(-u,z);
<a name="l00232"></a>00232     <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> y = <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__vector__2d_8h.html#ae238212d8b18ea93da5fba3f397f984a">cross_product</a>(z,x);
<a name="l00233"></a>00233     <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__vector__2d_8h.html#ac4986a4b72b1d54b872d5863ac35d3e8">normalize</a>(x);
<a name="l00234"></a>00234     <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__vector__2d_8h.html#ac4986a4b72b1d54b872d5863ac35d3e8">normalize</a>(y);
<a name="l00235"></a>00235     <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__vector__2d_8h.html#ac4986a4b72b1d54b872d5863ac35d3e8">normalize</a>(z);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     T r[] = { x.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>(), x.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>(), x.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>(),
<a name="l00238"></a>00238               y.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>(), y.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>(), y.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>(),
<a name="l00239"></a>00239               z.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>(), z.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>(), z.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>() };
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     vnl_matrix_fixed&lt;T,3,3&gt; R(r);
<a name="l00242"></a>00242     set_rotation(<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a>(R));
<a name="l00243"></a>00243   }
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="comment">//-------------------------------------------</span>
<a name="l00248"></a>00248 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00249"></a><a class="code" href="classvpgl__perspective__camera.html#abf76fe340d93cfaac78ed407905dd4ac">00249</a> <span class="keywordtype">void</span> <a class="code" href="classvpgl__perspective__camera.html#abf76fe340d93cfaac78ed407905dd4ac" title="Recalculate the 3x4 camera matrix from the parameters.">vpgl_perspective_camera&lt;T&gt;::recompute_matrix</a>()
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251    vnl_matrix_fixed&lt;T,3,4&gt; Pnew( (T)0 );
<a name="l00252"></a>00252 
<a name="l00253"></a>00253    <span class="comment">// Set new projection matrix to [ I | -C ].</span>
<a name="l00254"></a>00254    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; 3; i++ )
<a name="l00255"></a>00255      Pnew(i,i) = (T)1;
<a name="l00256"></a>00256    Pnew(0,3) = -camera_center_.x();
<a name="l00257"></a>00257    Pnew(1,3) = -camera_center_.y();
<a name="l00258"></a>00258    Pnew(2,3) = -camera_center_.z();
<a name="l00259"></a>00259 
<a name="l00260"></a>00260    <span class="comment">// Then multiply on left to get KR[ I | -C ].</span>
<a name="l00261"></a>00261    this-&gt;set_matrix(K_.get_matrix()*R_.as_matrix()*Pnew);
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="comment">//-------------------------------------------</span>
<a name="l00266"></a>00266 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00267"></a><a class="code" href="vpgl__perspective__camera_8txx.html#a9729aec4cd4f8be8a435cb1e90811657">00267</a> <span class="keywordtype">bool</span> <a class="code" href="vpgl__perspective__camera_8h.html#a9729aec4cd4f8be8a435cb1e90811657" title="Decompose camera into parameter blocks.">vpgl_perspective_decomposition</a>( <span class="keyword">const</span> vnl_matrix_fixed&lt;T,3,4&gt;&amp; camera_matrix,
<a name="l00268"></a>00268                                      <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>&amp; p_camera )
<a name="l00269"></a>00269 {
<a name="l00270"></a>00270   <span class="comment">// Extract the left sub matrix H from [ H t ] and check that it has rank 3.</span>
<a name="l00271"></a>00271   vnl_matrix_fixed&lt;T,3,3&gt; H = camera_matrix.extract(3,3);
<a name="l00272"></a>00272   <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__vector__fixed.html">vnl_vector_fixed&lt;T,3&gt;</a> t = camera_matrix.get_column(3);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274   T det = <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__det_8h.html#ab693288bff9c1685706df581182be4eb">vnl_det</a>(H);
<a name="l00275"></a>00275   <span class="keywordflow">if</span> ( det == (T)0 ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00276"></a>00276   <span class="comment">// To insure a true rotation (determinant = 1) we must start with a positive</span>
<a name="l00277"></a>00277   <span class="comment">// determinant H.  This is decomposed into K and R, each with positive determinant.</span>
<a name="l00278"></a>00278   <span class="keywordflow">if</span> ( det &lt; (T)0 ) {
<a name="l00279"></a>00279     H *= (T)-1;
<a name="l00280"></a>00280     t *= (T)-1;
<a name="l00281"></a>00281   }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   <span class="comment">// Now find the RQ decomposition of the sub matrix and use these to find the params.</span>
<a name="l00284"></a>00284   <span class="comment">// This will involve some trickery as VXL has no RQ decomposition, but does have QR.</span>
<a name="l00285"></a>00285   <span class="comment">// Define a matrix &quot;flipping&quot; operation by f(A)ij = An-j,n-i i.e. f flips the matrix</span>
<a name="l00286"></a>00286   <span class="comment">// about its LL-UR diagonal.  One can prove that if f(A) = B*C then A = f(A)*f(B). So</span>
<a name="l00287"></a>00287   <span class="comment">// we get the RQ decomposition of A by flipping A, then taking the QR decomposition,</span>
<a name="l00288"></a>00288   <span class="comment">// then flipping both back, noting that the flipped Q and R will remain orthogonal and</span>
<a name="l00289"></a>00289   <span class="comment">// upper right triangular respectively.</span>
<a name="l00290"></a>00290   vnl_matrix_fixed&lt;T,3,3&gt; Hf;
<a name="l00291"></a>00291   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; 3; i++ )
<a name="l00292"></a>00292     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j &lt; 3; j++ )
<a name="l00293"></a>00293       Hf(i,j) = H(2-j,2-i);
<a name="l00294"></a>00294   <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__qr.html">vnl_qr&lt;T&gt;</a> QR( Hf.as_ref() );
<a name="l00295"></a>00295   vnl_matrix_fixed&lt;T,3,3&gt; q,r,Qf,Rf;
<a name="l00296"></a>00296   q = QR.<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__qr.html#aa431a82b37aafa19e9aa8d9228c5243d">Q</a>();
<a name="l00297"></a>00297   r = QR.<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__qr.html#aed8d5789e633f9901c71fa92721911c6">R</a>();
<a name="l00298"></a>00298   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; 3; i++ ) {
<a name="l00299"></a>00299     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j &lt; 3; j++ ) {
<a name="l00300"></a>00300       Qf(i,j) = q(2-j,2-i);
<a name="l00301"></a>00301       Rf(i,j) = r(2-j,2-i);
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303   }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305   <span class="comment">// We almost have the K and R parameter blocks, but we must be sure that the diagonal</span>
<a name="l00306"></a>00306   <span class="comment">// entries of K are positive.</span>
<a name="l00307"></a>00307   <span class="keywordtype">int</span> r0pos = Rf(0,0) &gt; 0 ? 1 : -1;
<a name="l00308"></a>00308   <span class="keywordtype">int</span> r1pos = Rf(1,1) &gt; 0 ? 1 : -1;
<a name="l00309"></a>00309   <span class="keywordtype">int</span> r2pos = Rf(2,2) &gt; 0 ? 1 : -1;
<a name="l00310"></a>00310   <span class="keywordtype">int</span> diag[3] = { r0pos, r1pos, r2pos };
<a name="l00311"></a>00311   vnl_matrix_fixed&lt;T,3,3&gt; K1,R1;
<a name="l00312"></a>00312   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; 3; i++ ) {
<a name="l00313"></a>00313     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j &lt; 3; j++ ) {
<a name="l00314"></a>00314       K1(i,j) = diag[j]*Rf(i,j);
<a name="l00315"></a>00315       R1(i,j) = diag[i]*Qf(i,j);
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317   }
<a name="l00318"></a>00318   K1 = K1/K1(2,2);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320   <span class="comment">// Now we extract the parameters from the matrices we&#39;ve computed;</span>
<a name="l00321"></a>00321   <a class="code" href="classvpgl__calibration__matrix.html" title="A class representing the &quot;K&quot; matrix of a perspective camera matrix as described in.">vpgl_calibration_matrix&lt;T&gt;</a> new_K( K1 );
<a name="l00322"></a>00322   p_camera.<a class="code" href="classvpgl__perspective__camera.html#a52a6d4a6eed3435199c4930c4386d0dd" title="Setters and getters.">set_calibration</a>( new_K );
<a name="l00323"></a>00323 
<a name="l00324"></a>00324   <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__qr.html">vnl_qr&lt;T&gt;</a> QRofH(H.as_ref()); <span class="comment">// size 3x3</span>
<a name="l00325"></a>00325   <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__vector.html">vnl_vector&lt;T&gt;</a> c1 = -QRofH.solve(t.<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__vector__fixed.html#a442efcf1abd662857298990f29879cc1">as_ref</a>());
<a name="l00326"></a>00326   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a> new_c( c1(0), c1(1), c1(2) );
<a name="l00327"></a>00327   p_camera.<a class="code" href="classvpgl__perspective__camera.html#a6f05d6e5b691e54d035c3da9451fc210">set_camera_center</a>( new_c );
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   p_camera.<a class="code" href="classvpgl__perspective__camera.html#a80e439cc6653dd505655034d78069a58">set_rotation</a>( <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a>(R1) );
<a name="l00330"></a>00330 
<a name="l00331"></a>00331   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 <span class="comment">//-------------------------------------------</span>
<a name="l00336"></a>00336 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00337"></a><a class="code" href="vpgl__perspective__camera_8txx.html#a98b73d6860ae6f27f6b3718544ca638f">00337</a> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a> <a class="code" href="vpgl__perspective__camera_8h.html#a98b73d6860ae6f27f6b3718544ca638f" title="Changes the coordinate system of camera p1 such that the same change would transform p0 to K[I|0]...">vpgl_align_down</a>(
<a name="l00338"></a>00338   <span class="keyword">const</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>&amp; p0,
<a name="l00339"></a>00339   <span class="keyword">const</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>&amp; p1 )
<a name="l00340"></a>00340 {
<a name="l00341"></a>00341   <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a> new_camera;
<a name="l00342"></a>00342   new_camera.<a class="code" href="classvpgl__perspective__camera.html#a52a6d4a6eed3435199c4930c4386d0dd" title="Setters and getters.">set_calibration</a>( p0.<a class="code" href="classvpgl__perspective__camera.html#ae076c12f3eef27768e66def85ee0fcad">get_calibration</a>() );
<a name="l00343"></a>00343   new_camera.<a class="code" href="classvpgl__perspective__camera.html#a80e439cc6653dd505655034d78069a58">set_rotation</a>( p1.<a class="code" href="classvpgl__perspective__camera.html#adecda4fc86096f1b634e6d52accfb707">get_rotation</a>()*p0.<a class="code" href="classvpgl__perspective__camera.html#adecda4fc86096f1b634e6d52accfb707">get_rotation</a>().inverse() );
<a name="l00344"></a>00344   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a> a0 = p0.<a class="code" href="classvpgl__perspective__camera.html#adecda4fc86096f1b634e6d52accfb707">get_rotation</a>()*p0.<a class="code" href="classvpgl__perspective__camera.html#a9afa3b7cc67368ce725aec85d07ce9cb">get_camera_center</a>();
<a name="l00345"></a>00345   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a> a1 = p0.<a class="code" href="classvpgl__perspective__camera.html#adecda4fc86096f1b634e6d52accfb707">get_rotation</a>()*p1.<a class="code" href="classvpgl__perspective__camera.html#a9afa3b7cc67368ce725aec85d07ce9cb">get_camera_center</a>();
<a name="l00346"></a>00346   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a> new_camera_center(a1.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a1ad910614a911c7d322c086438d6441d">x</a>() - a0.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a1ad910614a911c7d322c086438d6441d">x</a>(),
<a name="l00347"></a>00347                                     a1.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a6fcfebd50c3f8570fafd49df0687feb2">y</a>() - a0.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a6fcfebd50c3f8570fafd49df0687feb2">y</a>(),
<a name="l00348"></a>00348                                     a1.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a477066fab00b63b2641305fb7e41fb62">z</a>() - a0.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a477066fab00b63b2641305fb7e41fb62">z</a>() );
<a name="l00349"></a>00349   new_camera.<a class="code" href="classvpgl__perspective__camera.html#a6f05d6e5b691e54d035c3da9451fc210">set_camera_center</a>( new_camera_center );
<a name="l00350"></a>00350   <span class="keywordflow">return</span> new_camera;
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 <span class="comment">//-------------------------------------------</span>
<a name="l00355"></a>00355 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00356"></a><a class="code" href="vpgl__perspective__camera_8txx.html#a15d7310b494a1dd8f9f2b585eb7a170a">00356</a> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a> <a class="code" href="vpgl__perspective__camera_8h.html#a15d7310b494a1dd8f9f2b585eb7a170a" title="Changes the coordinate system of camera p1 such that the same change would transform K[I|0] to p0...">vpgl_align_up</a>(
<a name="l00357"></a>00357   <span class="keyword">const</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>&amp; p0,
<a name="l00358"></a>00358   <span class="keyword">const</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>&amp; p1 )
<a name="l00359"></a>00359 {
<a name="l00360"></a>00360   <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a> new_camera;
<a name="l00361"></a>00361   new_camera.<a class="code" href="classvpgl__perspective__camera.html#a52a6d4a6eed3435199c4930c4386d0dd" title="Setters and getters.">set_calibration</a>( p0.<a class="code" href="classvpgl__perspective__camera.html#ae076c12f3eef27768e66def85ee0fcad">get_calibration</a>() );
<a name="l00362"></a>00362   new_camera.<a class="code" href="classvpgl__perspective__camera.html#a80e439cc6653dd505655034d78069a58">set_rotation</a>( p1.<a class="code" href="classvpgl__perspective__camera.html#adecda4fc86096f1b634e6d52accfb707">get_rotation</a>()*p0.<a class="code" href="classvpgl__perspective__camera.html#adecda4fc86096f1b634e6d52accfb707">get_rotation</a>() );
<a name="l00363"></a>00363   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a> a = p0.<a class="code" href="classvpgl__perspective__camera.html#adecda4fc86096f1b634e6d52accfb707">get_rotation</a>().inverse()*p1.<a class="code" href="classvpgl__perspective__camera.html#a9afa3b7cc67368ce725aec85d07ce9cb">get_camera_center</a>();
<a name="l00364"></a>00364   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a> new_camera_center( p0.<a class="code" href="classvpgl__perspective__camera.html#a9afa3b7cc67368ce725aec85d07ce9cb">get_camera_center</a>().<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a1ad910614a911c7d322c086438d6441d">x</a>() + a.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a1ad910614a911c7d322c086438d6441d">x</a>(),
<a name="l00365"></a>00365                                      p0.<a class="code" href="classvpgl__perspective__camera.html#a9afa3b7cc67368ce725aec85d07ce9cb">get_camera_center</a>().<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a6fcfebd50c3f8570fafd49df0687feb2">y</a>() + a.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a6fcfebd50c3f8570fafd49df0687feb2">y</a>(),
<a name="l00366"></a>00366                                      p0.<a class="code" href="classvpgl__perspective__camera.html#a9afa3b7cc67368ce725aec85d07ce9cb">get_camera_center</a>().<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a477066fab00b63b2641305fb7e41fb62">z</a>() + a.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a477066fab00b63b2641305fb7e41fb62">z</a>() );
<a name="l00367"></a>00367   new_camera.<a class="code" href="classvpgl__perspective__camera.html#a6f05d6e5b691e54d035c3da9451fc210">set_camera_center</a>( new_camera_center );
<a name="l00368"></a>00368   <span class="keywordflow">return</span> new_camera;
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 <span class="comment">//Post-multiply this perspective camera with a 3-d Euclidean transformation</span>
<a name="l00373"></a>00373 <span class="comment">// Must check if the transformation is Euclidean, i.e. rotation matrix</span>
<a name="l00374"></a>00374 <span class="comment">// and translation.   Since we can only work with the external interface</span>
<a name="l00375"></a>00375 <span class="comment">// the update due to the postmultiplication is:</span>
<a name="l00376"></a>00376 <span class="comment">//   K&#39; = K</span>
<a name="l00377"></a>00377 <span class="comment">//   R&#39; = R*Re</span>
<a name="l00378"></a>00378 <span class="comment">//   cc&#39; = transpose(Re)(cc - te)</span>
<a name="l00379"></a>00379 <span class="comment">// where Re and te are the rotation matrix and</span>
<a name="l00380"></a>00380 <span class="comment">//  translation vector of the euclidean transform</span>
<a name="l00381"></a>00381 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>
<a name="l00382"></a><a class="code" href="classvpgl__perspective__camera.html#a442b25ec8bf549bcdcf5c02acaf71b78">00382</a> <a class="code" href="classvpgl__perspective__camera.html#a442b25ec8bf549bcdcf5c02acaf71b78" title="Post-multiply this perspective camera with a 3-d Euclidean transformation.">vpgl_perspective_camera&lt;T&gt;::postmultiply</a>( <span class="keyword">const</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>&amp; in_cam, <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__h__matrix__3d.html">vgl_h_matrix_3d&lt;T&gt;</a>&amp; euclid_trans)
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384   assert(euclid_trans.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__h__matrix__3d.html#a3a6cc5500d342b2ba03616514dce2600">is_euclidean</a>());
<a name="l00385"></a>00385   <span class="keyword">const</span> <a class="code" href="classvpgl__calibration__matrix.html" title="A class representing the &quot;K&quot; matrix of a perspective camera matrix as described in.">vpgl_calibration_matrix&lt;T&gt;</a>&amp; K = in_cam.<a class="code" href="classvpgl__perspective__camera.html#ae076c12f3eef27768e66def85ee0fcad">get_calibration</a>();
<a name="l00386"></a>00386   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a>&amp; R = in_cam.<a class="code" href="classvpgl__perspective__camera.html#adecda4fc86096f1b634e6d52accfb707">get_rotation</a>();
<a name="l00387"></a>00387   <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a>&amp; cc = in_cam.<a class="code" href="classvpgl__perspective__camera.html#a9afa3b7cc67368ce725aec85d07ce9cb">get_camera_center</a>();
<a name="l00388"></a>00388   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a> Re(euclid_trans.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__h__matrix__3d.html#aabe76d8f6e180818bfefc087bd220291">get_upper_3x3</a>());
<a name="l00389"></a>00389   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__homg__point__3d.html">vgl_homg_point_3d&lt;T&gt;</a> t = euclid_trans.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__h__matrix__3d.html#a69a0e87e395d950aa6ffba15cbaf84ee">get_translation</a>();
<a name="l00390"></a>00390 
<a name="l00391"></a>00391   <span class="comment">//The transformed rotation matrix</span>
<a name="l00392"></a>00392   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a> Rp(R*Re);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394   <span class="comment">//must have Euclidean quantities to proceed</span>
<a name="l00395"></a>00395   assert(!t.ideal());
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <span class="comment">//Transform the camera center</span>
<a name="l00398"></a>00398   <span class="comment">//get the Euclidean components</span>
<a name="l00399"></a>00399   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> te(t.x()/t.w(), t.y()/t.w(), t.z()/t.w());
<a name="l00400"></a>00400 
<a name="l00401"></a>00401   <span class="comment">//construct the transformed center</span>
<a name="l00402"></a>00402   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;T&gt;</a> ccp = Re.inverse()*(cc-te);
<a name="l00403"></a>00403 
<a name="l00404"></a>00404   <span class="keywordflow">return</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>(K, ccp, Rp);
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00408"></a>00408 <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a> <a class="code" href="classvpgl__perspective__camera.html#a442b25ec8bf549bcdcf5c02acaf71b78" title="Post-multiply this perspective camera with a 3-d Euclidean transformation.">vpgl_perspective_camera&lt;T&gt;::</a>
<a name="l00409"></a><a class="code" href="classvpgl__perspective__camera.html#a69cfa15979897ce5cb9005b8c4534561">00409</a> <a class="code" href="classvpgl__perspective__camera.html#a442b25ec8bf549bcdcf5c02acaf71b78" title="Post-multiply this perspective camera with a 3-d Euclidean transformation.">postmultiply</a>(<span class="keyword">const</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>&amp; camera,
<a name="l00410"></a>00410              <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a>&amp; rot, <span class="keyword">const</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a>&amp; trans)
<a name="l00411"></a>00411 {
<a name="l00412"></a>00412   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__h__matrix__3d.html">vgl_h_matrix_3d&lt;T&gt;</a> H;
<a name="l00413"></a>00413   H.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__h__matrix__3d.html#a49a1abaf04b491809448c2d7464be473">set_identity</a>();
<a name="l00414"></a>00414   H.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__h__matrix__3d.html#a2a146438c5302780980aadca8d2daa4a">set_rotation_matrix</a>(rot.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html#a6cda2e8063b81a535984398338deb4db">as_matrix</a>());
<a name="l00415"></a>00415   H.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__h__matrix__3d.html#ab12f25a823d859e96c3df21a1794b116">set_translation</a>(trans.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>(), trans.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>(), trans.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>());
<a name="l00416"></a>00416   <span class="keywordflow">return</span> <a class="code" href="classvpgl__perspective__camera.html#a442b25ec8bf549bcdcf5c02acaf71b78" title="Post-multiply this perspective camera with a 3-d Euclidean transformation.">vpgl_perspective_camera&lt;T&gt;::postmultiply</a>(camera, H);
<a name="l00417"></a>00417 }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="comment">// I/O :------------------------------------------------</span>
<a name="l00420"></a>00420 
<a name="l00421"></a>00421 <span class="comment">//: Write vpgl_perspective_camera to stream</span>
<a name="l00422"></a>00422 <span class="keyword">template</span> &lt;<span class="keyword">class</span> Type&gt;
<a name="l00423"></a><a class="code" href="vpgl__perspective__camera_8txx.html#a32365b53b692e6d46c7dc09cffcbf5b9">00423</a> vcl_ostream&amp;  <a class="code" href="classvpgl__local__rational__camera.html#aaf50ddacbebdeebff2fefb0f94fe45a2" title="Write to stream.">operator&lt;&lt;</a>(vcl_ostream&amp; s,
<a name="l00424"></a>00424                          <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;Type&gt;</a> <span class="keyword">const</span>&amp; p)
<a name="l00425"></a>00425 {
<a name="l00426"></a>00426   vnl_matrix_fixed&lt;Type, 3, 3&gt; k = p.<a class="code" href="classvpgl__perspective__camera.html#ae076c12f3eef27768e66def85ee0fcad">get_calibration</a>().get_matrix();
<a name="l00427"></a>00427   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;Type&gt;</a> rot = p.<a class="code" href="classvpgl__perspective__camera.html#adecda4fc86096f1b634e6d52accfb707">get_rotation</a>();
<a name="l00428"></a>00428   vnl_matrix_fixed&lt;Type, 3, 3&gt; Rm = rot.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html#a6cda2e8063b81a535984398338deb4db">as_matrix</a>();
<a name="l00429"></a>00429   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;Type&gt;</a> t = p.<a class="code" href="classvpgl__perspective__camera.html#aefa8a5e462b3e51e129c05e95e119b07">get_translation</a>();
<a name="l00430"></a>00430   s &lt;&lt; k &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00431"></a>00431     &lt;&lt; Rm &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00432"></a>00432     &lt;&lt; t.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; t.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; t.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00433"></a>00433   <span class="keywordflow">return</span> s ;
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 <span class="comment">//: Read camera from stream</span>
<a name="l00437"></a>00437 <span class="keyword">template</span> &lt;<span class="keyword">class</span> Type&gt;
<a name="l00438"></a><a class="code" href="vpgl__perspective__camera_8txx.html#aeec9f6d1eb35537aa5baee5289874ed1">00438</a> vcl_istream&amp;  <a class="code" href="classvpgl__local__rational__camera.html#ac8431bde6c390b3f31fdcd9750f35529" title="Read from stream.">operator &gt;&gt;</a>(vcl_istream&amp; s,
<a name="l00439"></a>00439                           <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;Type&gt;</a>&amp; p)
<a name="l00440"></a>00440 {
<a name="l00441"></a>00441   vnl_matrix_fixed&lt;Type, 3, 3&gt; k, Rm;
<a name="l00442"></a>00442   <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__vector__fixed.html">vnl_vector_fixed&lt;Type, 3&gt;</a> tv;
<a name="l00443"></a>00443   s &gt;&gt; k;
<a name="l00444"></a>00444   s &gt;&gt; Rm;
<a name="l00445"></a>00445   s &gt;&gt; tv;
<a name="l00446"></a>00446   <a class="code" href="classvpgl__calibration__matrix.html" title="A class representing the &quot;K&quot; matrix of a perspective camera matrix as described in.">vpgl_calibration_matrix&lt;Type&gt;</a> K(k);
<a name="l00447"></a>00447   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;Type&gt;</a> rot(Rm);
<a name="l00448"></a>00448   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;Type&gt;</a> t(tv[0], tv[1], tv[2]);
<a name="l00449"></a>00449   p.<a class="code" href="classvpgl__perspective__camera.html#a52a6d4a6eed3435199c4930c4386d0dd" title="Setters and getters.">set_calibration</a>(K);
<a name="l00450"></a>00450   p.<a class="code" href="classvpgl__perspective__camera.html#a80e439cc6653dd505655034d78069a58">set_rotation</a>(rot);
<a name="l00451"></a>00451   p.<a class="code" href="classvpgl__perspective__camera.html#a2f29cc9fc588aef782985df42bf5c6d3">set_translation</a>(t);
<a name="l00452"></a>00452   <span class="keywordflow">return</span> s ;
<a name="l00453"></a>00453 }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455 <span class="comment">//: Save in ascii format</span>
<a name="l00456"></a>00456 <span class="keyword">template</span> &lt;<span class="keyword">class</span> Type&gt;
<a name="l00457"></a><a class="code" href="classvpgl__perspective__camera.html#a9e2eef958f66bd88222ef42cdfc65a9c">00457</a> <span class="keywordtype">void</span> <a class="code" href="classvpgl__perspective__camera.html#a9e2eef958f66bd88222ef42cdfc65a9c" title="Save in ascii format.">vpgl_perspective_camera&lt;Type&gt;::save</a>(vcl_string cam_path)
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459   vcl_ofstream os(cam_path.c_str());
<a name="l00460"></a>00460   <span class="keywordflow">if</span> (!os.is_open()) {
<a name="l00461"></a>00461     vcl_cout &lt;&lt; <span class="stringliteral">&quot;unable to open output stream in vpgl_proj_camera&lt;T&gt;::save(.)\n&quot;</span>;
<a name="l00462"></a>00462     <span class="keywordflow">return</span>;
<a name="l00463"></a>00463   }
<a name="l00464"></a>00464   os &lt;&lt; *<span class="keyword">this</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00465"></a>00465   os.close();
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <span class="comment">//: Write vpgl_perspective_camera to a vrml file</span>
<a name="l00469"></a>00469 <span class="keyword">template</span> &lt;<span class="keyword">class</span> Type&gt;
<a name="l00470"></a><a class="code" href="vpgl__perspective__camera_8txx.html#a1f74d11e4c7dac5374854693aee9b410">00470</a> <span class="keywordtype">void</span> <a class="code" href="vpgl__perspective__camera_8h.html#ad047dcbe855cf926a3cd67b2dcde6add" title="Write vpgl_perspective_camera to a vrml file, does not write a vrml header, only the camera...">vrml_write</a>(vcl_ostream&amp; str, <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;Type&gt;</a> <span class="keyword">const</span>&amp; p, <span class="keywordtype">double</span> rad)
<a name="l00471"></a>00471 {
<a name="l00472"></a>00472   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html">vgl_point_3d&lt;Type&gt;</a> cent =  p.<a class="code" href="classvpgl__perspective__camera.html#a9afa3b7cc67368ce725aec85d07ce9cb">get_camera_center</a>();
<a name="l00473"></a>00473     str &lt;&lt; <span class="stringliteral">&quot;Transform {\n&quot;</span>
<a name="l00474"></a>00474         &lt;&lt; <span class="stringliteral">&quot;translation &quot;</span> &lt;&lt; cent.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a1ad910614a911c7d322c086438d6441d">x</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; cent.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a6fcfebd50c3f8570fafd49df0687feb2">y</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span>
<a name="l00475"></a>00475         &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; cent.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a477066fab00b63b2641305fb7e41fb62">z</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00476"></a>00476         &lt;&lt; <span class="stringliteral">&quot;children [\n&quot;</span>
<a name="l00477"></a>00477         &lt;&lt; <span class="stringliteral">&quot;Shape {\n&quot;</span>
<a name="l00478"></a>00478         &lt;&lt; <span class="stringliteral">&quot; appearance Appearance{\n&quot;</span>
<a name="l00479"></a>00479         &lt;&lt; <span class="stringliteral">&quot;   material Material\n&quot;</span>
<a name="l00480"></a>00480         &lt;&lt; <span class="stringliteral">&quot;    {\n&quot;</span>
<a name="l00481"></a>00481         &lt;&lt; <span class="stringliteral">&quot;      diffuseColor &quot;</span> &lt;&lt; 1 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; 1.0 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; 0.0 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00482"></a>00482         &lt;&lt; <span class="stringliteral">&quot;      transparency &quot;</span> &lt;&lt; 0.0 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00483"></a>00483         &lt;&lt; <span class="stringliteral">&quot;    }\n&quot;</span>
<a name="l00484"></a>00484         &lt;&lt; <span class="stringliteral">&quot;  }\n&quot;</span>
<a name="l00485"></a>00485         &lt;&lt; <span class="stringliteral">&quot; geometry Sphere\n&quot;</span>
<a name="l00486"></a>00486         &lt;&lt;   <span class="stringliteral">&quot;{\n&quot;</span>
<a name="l00487"></a>00487         &lt;&lt; <span class="stringliteral">&quot;  radius &quot;</span> &lt;&lt; rad &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00488"></a>00488         &lt;&lt;  <span class="stringliteral">&quot;   }\n&quot;</span>
<a name="l00489"></a>00489         &lt;&lt;  <span class="stringliteral">&quot;  }\n&quot;</span>
<a name="l00490"></a>00490         &lt;&lt;  <span class="stringliteral">&quot; ]\n&quot;</span>
<a name="l00491"></a>00491         &lt;&lt; <span class="stringliteral">&quot;}\n&quot;</span>;
<a name="l00492"></a>00492     <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;Type&gt;</a> r = p.<a class="code" href="classvpgl__perspective__camera.html#ab81a731a7bd791486500d8069e7090e8" title="Compute the principal axis.">principal_axis</a>();
<a name="l00493"></a>00493     vcl_cout&lt;&lt;<span class="stringliteral">&quot;principal axis :&quot;</span> &lt;&lt;r&lt;&lt;vcl_endl;
<a name="l00494"></a>00494     <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__vector__fixed.html">vnl_vector_fixed&lt;Type,3&gt;</a> yaxis(0.0, 1.0, 0.0), pvec(r.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>(), r.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>(), r.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>());
<a name="l00495"></a>00495     <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;Type&gt;</a> rot(yaxis, pvec);
<a name="l00496"></a>00496     <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__quaternion.html">vnl_quaternion&lt;Type&gt;</a> q = rot.as_quaternion();
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     <span class="comment">//vnl_double_3 axis = q.axis();</span>
<a name="l00499"></a>00499     <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__vector__fixed.html">vnl_vector_fixed&lt;Type,3&gt;</a> axis = q.<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__quaternion.html#a384010e9b0b09eb66fed3ae3c8b1cd92">axis</a>();
<a name="l00500"></a>00500     vcl_cout&lt;&lt;<span class="stringliteral">&quot;quaternion &quot;</span>&lt;&lt;axis&lt;&lt; <span class="stringliteral">&quot; angle &quot;</span>&lt;&lt;q.<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__quaternion.html#a90c7ca3959a09aa42064749a47faeb35">angle</a>()&lt;&lt;<span class="stringliteral">&quot;\n\n&quot;</span>;
<a name="l00501"></a>00501     <span class="keywordtype">double</span> ang = q.<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/classvnl__quaternion.html#a90c7ca3959a09aa42064749a47faeb35">angle</a>();
<a name="l00502"></a>00502     str &lt;&lt;  <span class="stringliteral">&quot;Transform {\n&quot;</span>
<a name="l00503"></a>00503         &lt;&lt; <span class="stringliteral">&quot; translation &quot;</span> &lt;&lt; cent.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a1ad910614a911c7d322c086438d6441d">x</a>()+6*rad*r.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#a912b0263c344513af0ffa0c07415fe20">x</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; cent.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a6fcfebd50c3f8570fafd49df0687feb2">y</a>()+6*rad*r.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#af31e8106e9f1aa85bdc70bc40a73dff6">y</a>()
<a name="l00504"></a>00504         &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; cent.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__point__3d.html#a477066fab00b63b2641305fb7e41fb62">z</a>()+6*rad*r.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html#aa655643683e63092c938ea6f2b4459e0">z</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00505"></a>00505         &lt;&lt; <span class="stringliteral">&quot; rotation &quot;</span> &lt;&lt; axis[0] &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; axis[1] &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; axis[2] &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt;  ang &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00506"></a>00506         &lt;&lt; <span class="stringliteral">&quot;children [\n&quot;</span>
<a name="l00507"></a>00507         &lt;&lt; <span class="stringliteral">&quot; Shape {\n&quot;</span>
<a name="l00508"></a>00508         &lt;&lt; <span class="stringliteral">&quot; appearance Appearance{\n&quot;</span>
<a name="l00509"></a>00509         &lt;&lt; <span class="stringliteral">&quot;  material Material\n&quot;</span>
<a name="l00510"></a>00510         &lt;&lt; <span class="stringliteral">&quot;   {\n&quot;</span>
<a name="l00511"></a>00511         &lt;&lt; <span class="stringliteral">&quot;     diffuseColor 1 0 0\n&quot;</span>
<a name="l00512"></a>00512         &lt;&lt; <span class="stringliteral">&quot;     transparency 0\n&quot;</span>
<a name="l00513"></a>00513         &lt;&lt; <span class="stringliteral">&quot;    }\n&quot;</span>
<a name="l00514"></a>00514         &lt;&lt; <span class="stringliteral">&quot;  }\n&quot;</span>
<a name="l00515"></a>00515         &lt;&lt; <span class="stringliteral">&quot; geometry Cylinder\n&quot;</span>
<a name="l00516"></a>00516         &lt;&lt; <span class="stringliteral">&quot;{\n&quot;</span>
<a name="l00517"></a>00517         &lt;&lt; <span class="stringliteral">&quot; radius &quot;</span>&lt;&lt;rad/3&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>
<a name="l00518"></a>00518         &lt;&lt; <span class="stringliteral">&quot; height &quot;</span> &lt;&lt; 12*rad &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00519"></a>00519         &lt;&lt; <span class="stringliteral">&quot; }\n&quot;</span>
<a name="l00520"></a>00520         &lt;&lt; <span class="stringliteral">&quot; }\n&quot;</span>
<a name="l00521"></a>00521         &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00522"></a>00522         &lt;&lt; <span class="stringliteral">&quot;}\n&quot;</span>;
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="comment">//: Return a list of camera&#39;s, loaded from the (name sorted) files from the given directory</span>
<a name="l00527"></a>00527 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00528"></a><a class="code" href="vpgl__perspective__camera_8txx.html#afaa67dc1bd3b7279d9d9275e5486b0f4">00528</a> vcl_vector&lt;vpgl_perspective_camera&lt;T&gt; &gt; <a class="code" href="vpgl__perspective__camera_8h.html#afaa67dc1bd3b7279d9d9275e5486b0f4" title="Return a list of camera&#39;s, loaded from the (name sorted) files from the given directory.">cameras_from_directory</a>(vcl_string dir, T)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530   vcl_vector&lt;vpgl_perspective_camera&lt;T&gt; &gt; camlist;
<a name="l00531"></a>00531   <span class="keywordflow">if</span> (!vul_file::is_directory(dir.c_str()) ) {
<a name="l00532"></a>00532     vcl_cerr &lt;&lt; <span class="stringliteral">&quot;cameras_from_directory: &quot;</span> &lt;&lt; dir &lt;&lt; <span class="stringliteral">&quot; is not a directory\n&quot;</span>;
<a name="l00533"></a>00533     <span class="keywordflow">return</span> camlist;
<a name="l00534"></a>00534   }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536   <span class="comment">//get all of the cam and image files, sort them</span>
<a name="l00537"></a>00537   vcl_string camglob=dir+<span class="stringliteral">&quot;/*&quot;</span>;
<a name="l00538"></a>00538   vul_file_iterator file_it(camglob.c_str());
<a name="l00539"></a>00539   vcl_vector&lt;vcl_string&gt; cam_files;
<a name="l00540"></a>00540   <span class="keywordflow">while</span> (file_it) {
<a name="l00541"></a>00541     vcl_string camName(file_it());
<a name="l00542"></a>00542     cam_files.push_back(camName);
<a name="l00543"></a>00543     ++file_it;
<a name="l00544"></a>00544   }
<a name="l00545"></a>00545   vcl_sort(cam_files.begin(), cam_files.end());
<a name="l00546"></a>00546 
<a name="l00547"></a>00547   <span class="comment">//take sorted lists and load from file</span>
<a name="l00548"></a>00548   <span class="keywordflow">for</span> (vcl_vector&lt;vcl_string&gt;::iterator iter = cam_files.begin();
<a name="l00549"></a>00549        iter != cam_files.end(); ++iter)
<a name="l00550"></a>00550   {
<a name="l00551"></a>00551     vcl_ifstream ifs(iter-&gt;c_str());
<a name="l00552"></a>00552     <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a> pcam;
<a name="l00553"></a>00553     <span class="keywordflow">if</span> (!ifs.is_open()) {
<a name="l00554"></a>00554       vcl_cerr &lt;&lt; <span class="stringliteral">&quot;Failed to open file &quot;</span> &lt;&lt; *iter &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556     <span class="keywordflow">else</span>  {
<a name="l00557"></a>00557       ifs &gt;&gt; pcam;
<a name="l00558"></a>00558       camlist.push_back(pcam);
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560   }
<a name="l00561"></a>00561   <span class="keywordflow">return</span> camlist;
<a name="l00562"></a>00562 }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00565"></a><a class="code" href="vpgl__perspective__camera_8txx.html#a1f1ae242c7741a0342582cc0c049fb54">00565</a> <span class="keywordtype">double</span> <a class="code" href="vpgl__perspective__camera_8h.html#a1f1ae242c7741a0342582cc0c049fb54">vpgl_persp_cam_distance</a>( <span class="keyword">const</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>&amp; cam1, <span class="keyword">const</span> <a class="code" href="classvpgl__perspective__camera.html" title="This class implements the perspective camera class as described in Hartley &amp; Zisserman as a finite ca...">vpgl_perspective_camera&lt;T&gt;</a>&amp; cam2)
<a name="l00566"></a>00566 {
<a name="l00567"></a>00567   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> ray1 = cam1.<a class="code" href="classvpgl__perspective__camera.html#ab81a731a7bd791486500d8069e7090e8" title="Compute the principal axis.">principal_axis</a>();
<a name="l00568"></a>00568   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__vector__3d.html">vgl_vector_3d&lt;T&gt;</a> ray2 = cam2.<a class="code" href="classvpgl__perspective__camera.html#ab81a731a7bd791486500d8069e7090e8" title="Compute the principal axis.">principal_axis</a>();
<a name="l00569"></a>00569 
<a name="l00570"></a>00570   <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html">vgl_rotation_3d&lt;T&gt;</a> R(ray1, ray2);
<a name="l00571"></a>00571   <span class="keywordtype">double</span> <a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/vgl__rtree_8txx.html#a850204e31ddf91a3152fadee164adccc">trace</a> = <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__trace_8h.html#adb0041c97227dcda557aa48b065e1dca">vnl_trace</a>(R.<a class="codeRef" doxygen="core_vgl.tag:../../../core/vgl/html/" href="../../../core/vgl/html/classvgl__rotation__3d.html#a6cda2e8063b81a535984398338deb4db">as_matrix</a>());
<a name="l00572"></a>00572   <span class="keywordflow">return</span> vcl_acos((trace-1.0)/2.0);  <span class="comment">// dist is theta</span>
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 <span class="comment">// Code for easy instantiation.</span>
<a name="l00577"></a>00577 <span class="preprocessor">#undef vpgl_PERSPECTIVE_CAMERA_INSTANTIATE</span>
<a name="l00578"></a><a class="code" href="vpgl__perspective__camera_8txx.html#ad7f0f0cfd2af2e5b0a14077deb380c67">00578</a> <span class="preprocessor"></span><span class="preprocessor">#define vpgl_PERSPECTIVE_CAMERA_INSTANTIATE(T) \</span>
<a name="l00579"></a>00579 <span class="preprocessor">template class vpgl_perspective_camera&lt;T &gt;; \</span>
<a name="l00580"></a>00580 <span class="preprocessor">template bool vpgl_perspective_decomposition(const vnl_matrix_fixed&lt;T,3,4&gt;&amp; camera_matrix, \</span>
<a name="l00581"></a>00581 <span class="preprocessor">                                             vpgl_perspective_camera&lt;T &gt;&amp; p_camera ); \</span>
<a name="l00582"></a>00582 <span class="preprocessor">template vpgl_perspective_camera&lt;T &gt; vpgl_align_down(const vpgl_perspective_camera&lt;T &gt;&amp; p0, \</span>
<a name="l00583"></a>00583 <span class="preprocessor">                                                     const vpgl_perspective_camera&lt;T &gt;&amp; p1 ); \</span>
<a name="l00584"></a>00584 <span class="preprocessor">template vpgl_perspective_camera&lt;T &gt; vpgl_align_up(const vpgl_perspective_camera&lt;T &gt;&amp; p0, \</span>
<a name="l00585"></a>00585 <span class="preprocessor">                                                   const vpgl_perspective_camera&lt;T &gt;&amp; p1 ); \</span>
<a name="l00586"></a>00586 <span class="preprocessor">template vpgl_perspective_camera&lt;T &gt; postmultiply(const vpgl_perspective_camera&lt;T &gt;&amp; in_cam, \</span>
<a name="l00587"></a>00587 <span class="preprocessor">                                                  const vgl_h_matrix_3d&lt;T &gt;&amp; euclid_trans); \</span>
<a name="l00588"></a>00588 <span class="preprocessor">template double vpgl_persp_cam_distance(const vpgl_perspective_camera&lt;T &gt;&amp; cam1, \</span>
<a name="l00589"></a>00589 <span class="preprocessor">                                        const vpgl_perspective_camera&lt;T &gt;&amp; cam2); \</span>
<a name="l00590"></a>00590 <span class="preprocessor">template void vrml_write(vcl_ostream &amp;s, const vpgl_perspective_camera&lt;T &gt;&amp;, double rad); \</span>
<a name="l00591"></a>00591 <span class="preprocessor">template vcl_vector&lt;vpgl_perspective_camera&lt;T &gt; &gt; cameras_from_directory(vcl_string dir, T); \</span>
<a name="l00592"></a>00592 <span class="preprocessor">template vcl_ostream&amp; operator&lt;&lt;(vcl_ostream&amp;, const vpgl_perspective_camera&lt;T &gt;&amp;); \</span>
<a name="l00593"></a>00593 <span class="preprocessor">template vcl_istream&amp; operator&gt;&gt;(vcl_istream&amp;, vpgl_perspective_camera&lt;T &gt;&amp;)</span>
<a name="l00594"></a>00594 <span class="preprocessor"></span>
<a name="l00595"></a>00595 <span class="preprocessor">#endif // vpgl_perspective_camera_txx_</span>
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 1 2013 17:32:17 for core/vpgl by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
