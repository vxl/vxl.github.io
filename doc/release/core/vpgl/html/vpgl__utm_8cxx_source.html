<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>core/vpgl/vpgl_utm.cxx Source File</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">core/vpgl/vpgl_utm.cxx</div>  </div>
</div>
<div class="contents">
<a href="vpgl__utm_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// stub file for IUE class IUE_UTM_geodetic_transform</span>
<a name="l00002"></a>00002 <span class="comment">// generated by the IUE LateX macros from file</span>
<a name="l00003"></a>00003 <span class="comment">// UTM_geodetic_transform.tex</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">// Copyright (c) 1993 - 1997 Amerinex Applied Imaging, Inc.</span>
<a name="l00006"></a>00006 <span class="comment">// 409 Main St Amherst, MA 01002 All Rights Reserved</span>
<a name="l00007"></a>00007 <span class="comment">// Reproduction rights limited as described in the COPYRIGHT file.</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">// A @class{IUE_UTM_geodetic_transform} is one that relates UTM coordinates to a geodetic lat_long coordinate_system (phi, lambda, h) using a reference spheroid to define the shape of the earth (or other celestial object). where in the geodetic lat_long coordinate system, coordinates phi and lambda are the values of latitude and longitude, respectively.</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="vpgl__utm_8h.html" title="A rip-off of the IUE utm_geodedic and geodetic_utm transform classes which allows the GeoPt to suppor...">vpgl_utm.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;vcl_iostream.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;vcl_limits.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__math_8h.html">vnl/vnl_math.h</a>&gt;</span>
<a name="l00014"></a><a class="code" href="vpgl__utm_8cxx.html#a7a0bc35c1ff61bdb8a1f046d65511c2a">00014</a> <span class="preprocessor">#define DBLLONG 4.61168601e18</span>
<a name="l00015"></a><a class="code" href="vpgl__utm_8cxx.html#a307327653bcf8760695a0e413a61099e">00015</a> <span class="preprocessor"></span><span class="preprocessor">#define EPSLN   1.0e-10</span>
<a name="l00016"></a><a class="code" href="vpgl__utm_8cxx.html#a0a3cc1d5cde549e408f825ddd7f5853d">00016</a> <span class="preprocessor"></span><span class="preprocessor">#define D2R     1.745329251994328e-2</span>
<a name="l00017"></a><a class="code" href="vpgl__utm_8cxx.html#a96b5217a0cc47821a45300e5821da783">00017</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_VAL  4</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>
<a name="l00019"></a>00019 <span class="comment">// *****************************************************************************</span>
<a name="l00020"></a>00020 <span class="comment">// NAME UNIVERSAL TRANSVERSE MERCATOR - GEODETIC</span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="comment">// PURPOSE: Transforms UTM (x, y, z) to geodetic (phi, lambda, h).</span>
<a name="l00023"></a>00023 <span class="comment">//                 x,y,z values must be in meters, and (phi, lambda, h) will</span>
<a name="l00024"></a>00024 <span class="comment">//         be returned in radians.</span>
<a name="l00025"></a>00025 <span class="comment">//</span>
<a name="l00026"></a>00026 <span class="comment">// NOTE: UTM coordinate system has both zone and central_meridian slots.</span>
<a name="l00027"></a>00027 <span class="comment">//                 If zone is defined (i.e. zone &lt;&gt; 0), then zone is used.</span>
<a name="l00028"></a>00028 <span class="comment">//         Otherwise, central_meridian is used.</span>
<a name="l00029"></a>00029 <span class="comment">//</span>
<a name="l00030"></a>00030 <span class="comment">//         When dealing with Northern Hemisphere, is_southern_hemisphere</span>
<a name="l00031"></a>00031 <span class="comment">//         slot must be 0, and phi must be positive or equal to 0.</span>
<a name="l00032"></a>00032 <span class="comment">//         When dealing with Southern Hemisphere, is_southern_hemisphere</span>
<a name="l00033"></a>00033 <span class="comment">//         slot must be 1, and phi must be negative or equal to 0.</span>
<a name="l00034"></a>00034 <span class="comment">//</span>
<a name="l00035"></a>00035 <span class="comment">// ALGORITHM REFERENCES</span>
<a name="l00036"></a>00036 <span class="comment">//</span>
<a name="l00037"></a>00037 <span class="comment">// 1. Snyder, John P., &quot;Map Projections--A Working Manual&quot;, U.S. Geological</span>
<a name="l00038"></a>00038 <span class="comment">//     Survey Professional Paper 1395 (Supersedes USGS Bulletin 1532), United</span>
<a name="l00039"></a>00039 <span class="comment">//     State Government Printing Office, Washington D.C., 1987.</span>
<a name="l00040"></a>00040 <span class="comment">//</span>
<a name="l00041"></a>00041 <span class="comment">// 2. Snyder, John P. and Voxland, Philip M., &quot;An Album of Map Projections&quot;,</span>
<a name="l00042"></a>00042 <span class="comment">//     U.S. Geological Survey Professional Paper 1453 , United State Government</span>
<a name="l00043"></a>00043 <span class="comment">//     Printing Office, Washington D.C., 1989.</span>
<a name="l00044"></a>00044 <span class="comment">//</span>
<a name="l00045"></a>00045 <span class="comment">// 3. Code adapted from &quot;USGS General Cartographic Transformation Package -</span>
<a name="l00046"></a>00046 <span class="comment">//       C code (GCTPC).</span>
<a name="l00047"></a>00047 <span class="comment">// *****************************************************************************</span>
<a name="l00048"></a>00048 <span class="keyword">static</span> <span class="keywordtype">double</span> scale_factor2;
<a name="l00049"></a><a class="code" href="vpgl__utm_8cxx.html#a9a5d02491aa648d562ebab62199e2d6e">00049</a> <span class="keyword">static</span> <span class="keywordtype">double</span> es2, <a class="code" href="vpgl__utm_8cxx.html#a9a5d02491aa648d562ebab62199e2d6e">esp2</a>;
<a name="l00050"></a>00050 <span class="keyword">static</span> <span class="keywordtype">double</span> ml02;
<a name="l00051"></a>00051 <span class="keyword">static</span> <span class="keywordtype">double</span> false_easting2;
<a name="l00052"></a>00052 <span class="keyword">static</span> <span class="keywordtype">double</span> false_northing2 ;
<a name="l00053"></a>00053 <span class="keyword">static</span> <span class="keywordtype">int</span> ind2;
<a name="l00054"></a><a class="code" href="vpgl__utm_8cxx.html#ac363d11cc44cfc5dbf8baf7ce41efd21">00054</a> <span class="keyword">static</span> <span class="keywordtype">double</span> e02,<a class="code" href="vpgl__utm_8cxx.html#adb3a8466fe0cf9e60c0c1b7503f4ac72">e12</a>,<a class="code" href="vpgl__utm_8cxx.html#aac508470c8435cda48b046aaf44e3f1e">e22</a>,<a class="code" href="vpgl__utm_8cxx.html#ac363d11cc44cfc5dbf8baf7ce41efd21">e32</a>;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="comment">// Function to return the sign of an argument</span>
<a name="l00057"></a>00057 <span class="comment">// ------------------------------------------</span>
<a name="l00058"></a>00058 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> sign(<span class="keywordtype">double</span> x) { <span class="keywordflow">return</span> (x &lt; 0.0) ? -1 : 1;}
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> sqr(<span class="keywordtype">double</span> x) { <span class="keywordflow">return</span> x*x; }
<a name="l00061"></a>00061 <span class="comment">// Function to adjust a longitude angle to range from -180 to 180 radians</span>
<a name="l00062"></a>00062 <span class="comment">// added if statements</span>
<a name="l00063"></a>00063 <span class="comment">// ----------------------------------------------------------------------</span>
<a name="l00064"></a>00064 <span class="keyword">static</span> <span class="keywordtype">double</span> adjust_lon2(<span class="keywordtype">double</span> x) <span class="comment">// Angle in radians</span>
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> count = 0; count &lt;= <a class="code" href="vpgl__utm_8cxx.html#a96b5217a0cc47821a45300e5821da783">MAX_VAL</a>; ++count)
<a name="l00067"></a>00067   {
<a name="l00068"></a>00068     <span class="keywordflow">if</span> (<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(x)&lt;=vnl_math::pi)
<a name="l00069"></a>00069       <span class="keywordflow">break</span>;
<a name="l00070"></a>00070     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keywordtype">long</span>(<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(x / (vnl_math::pi))) &lt; 2)
<a name="l00071"></a>00071       x -= (sign(x) * 2*vnl_math::pi);
<a name="l00072"></a>00072     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keywordtype">long</span>(<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(x / (2*vnl_math::pi))) &lt; vcl_numeric_limits&lt;long&gt;::max())
<a name="l00073"></a>00073       x -= <span class="keywordtype">long</span>((x /(2*vnl_math::pi))*2*vnl_math::pi);
<a name="l00074"></a>00074     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">long</span>) <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(x / (vcl_numeric_limits&lt;long&gt;::max() * 2*vnl_math::pi))) &lt; vcl_numeric_limits&lt;long&gt;::max())
<a name="l00075"></a>00075       x -= (((<span class="keywordtype">long</span>)(x / (vcl_numeric_limits&lt;long&gt;::max() * 2*vnl_math::pi))) * (2*vnl_math::pi * vcl_numeric_limits&lt;long&gt;::max()));
<a name="l00076"></a>00076     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">long</span>) <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(x / (<a class="code" href="vpgl__utm_8cxx.html#a7a0bc35c1ff61bdb8a1f046d65511c2a">DBLLONG</a> * 2*vnl_math::pi))) &lt; vcl_numeric_limits&lt;long&gt;::max())
<a name="l00077"></a>00077       x -= (((<span class="keywordtype">long</span>)(x / (<a class="code" href="vpgl__utm_8cxx.html#a7a0bc35c1ff61bdb8a1f046d65511c2a">DBLLONG</a> * 2*vnl_math::pi))) * (2*vnl_math::pi * <a class="code" href="vpgl__utm_8cxx.html#a7a0bc35c1ff61bdb8a1f046d65511c2a">DBLLONG</a>));
<a name="l00078"></a>00078     <span class="keywordflow">else</span>
<a name="l00079"></a>00079       x -= (sign(x) *2*vnl_math::pi);
<a name="l00080"></a>00080   }
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <span class="keywordflow">return</span> x;
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="keyword">static</span> <span class="keywordtype">double</span> adjust_lat2(<span class="keywordtype">double</span> x) <span class="comment">// Angle in radians</span>
<a name="l00086"></a>00086 {
<a name="l00087"></a>00087   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> count = 0; count &lt;= <a class="code" href="vpgl__utm_8cxx.html#a96b5217a0cc47821a45300e5821da783">MAX_VAL</a>; ++count)
<a name="l00088"></a>00088   {
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(x)&lt;=vnl_math::pi_over_2)
<a name="l00090"></a>00090       <span class="keywordflow">break</span>;
<a name="l00091"></a>00091     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">long</span>) <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(x / vnl_math::pi_over_2)) &lt; 2)
<a name="l00092"></a>00092       x -= (sign(x) * vnl_math::pi);
<a name="l00093"></a>00093     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">long</span>) <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(x / vnl_math::pi)) &lt; vcl_numeric_limits&lt;long&gt;::max())
<a name="l00094"></a>00094       x -= (((<span class="keywordtype">long</span>)(x / vnl_math::pi))*vnl_math::pi);
<a name="l00095"></a>00095     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">long</span>) <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(x / (vcl_numeric_limits&lt;long&gt;::max() * vnl_math::pi))) &lt; vcl_numeric_limits&lt;long&gt;::max())
<a name="l00096"></a>00096       x -= (((<span class="keywordtype">long</span>)(x / (vcl_numeric_limits&lt;long&gt;::max() * vnl_math::pi))) * (vnl_math::pi * vcl_numeric_limits&lt;long&gt;::max()));
<a name="l00097"></a>00097     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">long</span>) <a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(x / (<a class="code" href="vpgl__utm_8cxx.html#a7a0bc35c1ff61bdb8a1f046d65511c2a">DBLLONG</a> * vnl_math::pi))) &lt; vcl_numeric_limits&lt;long&gt;::max())
<a name="l00098"></a>00098       x -= (((<span class="keywordtype">long</span>)(x / (<a class="code" href="vpgl__utm_8cxx.html#a7a0bc35c1ff61bdb8a1f046d65511c2a">DBLLONG</a> * vnl_math::pi))) * (vnl_math::pi * <a class="code" href="vpgl__utm_8cxx.html#a7a0bc35c1ff61bdb8a1f046d65511c2a">DBLLONG</a>));
<a name="l00099"></a>00099     <span class="keywordflow">else</span>
<a name="l00100"></a>00100       x -= (sign(x) *vnl_math::pi);
<a name="l00101"></a>00101   }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103   <span class="keywordflow">return</span> x;
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="comment">// Function computes the value of M which is the distance along a meridian</span>
<a name="l00107"></a>00107 <span class="comment">// from the Equator to latitude phi.</span>
<a name="l00108"></a>00108 <span class="comment">// ---------------------------------------------</span>
<a name="l00109"></a>00109 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">double</span> mlfn2(<span class="keywordtype">double</span> e0, <span class="keywordtype">double</span> e1, <span class="keywordtype">double</span> e2, <span class="keywordtype">double</span> e3, <span class="keywordtype">double</span> phi)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111   <span class="keywordflow">return</span> e0*phi-e1*vcl_sin(2.0*phi)+e2*vcl_sin(4.0*phi)-e3*vcl_sin(6.0*phi);
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">// Initialization function of UTM transform</span>
<a name="l00115"></a>00115 <span class="comment">// ----------------------------------------</span>
<a name="l00116"></a>00116 <span class="keyword">static</span> <span class="keywordtype">void</span> UTM_init2(<span class="keywordtype">double</span> lat_center2, <span class="keywordtype">double</span> r_major, <span class="keywordtype">double</span> e, <span class="keywordtype">int</span> south_flag)
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118   scale_factor2 = 0.9996;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120   es2 = (double) e * (<span class="keywordtype">double</span>) e;
<a name="l00121"></a>00121   e02 = 1.0-0.25*es2*(1.0+es2/16.0*(3.0+1.25*es2));
<a name="l00122"></a>00122   <a class="code" href="vpgl__utm_8cxx.html#adb3a8466fe0cf9e60c0c1b7503f4ac72">e12</a> = 0.375*es2*(1.0+0.25*es2*(1.0+0.46875*es2));
<a name="l00123"></a>00123   <a class="code" href="vpgl__utm_8cxx.html#aac508470c8435cda48b046aaf44e3f1e">e22</a> = 0.05859375*es2*es2*(1.0+0.75*es2);
<a name="l00124"></a>00124   <a class="code" href="vpgl__utm_8cxx.html#ac363d11cc44cfc5dbf8baf7ce41efd21">e32</a> = es2*es2*es2*(35.0/3072.0);
<a name="l00125"></a>00125   <a class="code" href="vpgl__utm_8cxx.html#a9a5d02491aa648d562ebab62199e2d6e">esp2</a> = es2/(1.0 - es2);
<a name="l00126"></a>00126   ml02 = r_major * mlfn2(e02, <a class="code" href="vpgl__utm_8cxx.html#adb3a8466fe0cf9e60c0c1b7503f4ac72">e12</a>, <a class="code" href="vpgl__utm_8cxx.html#aac508470c8435cda48b046aaf44e3f1e">e22</a>, <a class="code" href="vpgl__utm_8cxx.html#ac363d11cc44cfc5dbf8baf7ce41efd21">e32</a>, lat_center2);
<a name="l00127"></a>00127   false_easting2 = 500000.0;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129   false_northing2 = (south_flag) ? 10000000.0 : 0.0;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131   <span class="keywordflow">if</span> (es2 &lt; .00001)
<a name="l00132"></a>00132     ind2 = 1;
<a name="l00133"></a>00133   <span class="keywordflow">else</span>
<a name="l00134"></a>00134     ind2 = 0;
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="comment">// Constructors</span>
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="comment">// other constructors (from doc)</span>
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="comment">// Construct a transform with the given coordinate systems.</span>
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="classvpgl__utm.html#a26adf627b2e5cdcbc1efe5f2ad0a6b7b">00143</a> <a class="code" href="classvpgl__utm.html#a26adf627b2e5cdcbc1efe5f2ad0a6b7b">vpgl_utm::vpgl_utm</a>()
<a name="l00144"></a>00144   :   a_(6378137), b_(6356752.3142) <span class="comment">//WGS-84 by default</span>
<a name="l00145"></a>00145 {}
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="classvpgl__utm.html#a2b8ce18b3621cccab3f3cb8fd5597de6">00147</a> <a class="code" href="classvpgl__utm.html#a26adf627b2e5cdcbc1efe5f2ad0a6b7b">vpgl_utm::vpgl_utm</a>(<span class="keyword">const</span> <a class="code" href="classvpgl__utm.html">vpgl_utm</a>&amp; t)
<a name="l00148"></a>00148   :    a_(t.a_), b_(t.b_)
<a name="l00149"></a>00149 {}
<a name="l00150"></a>00150 
<a name="l00151"></a><a class="code" href="classvpgl__utm.html#a5fe0f5a5f54efa6e475d2943e54964ea">00151</a> <a class="code" href="classvpgl__utm.html#a5fe0f5a5f54efa6e475d2943e54964ea">vpgl_utm::~vpgl_utm</a>()
<a name="l00152"></a>00152 {}
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="comment">// Applies the transform to the instance of 3d point representing a location in the from_coordinate_system (UTM_coordinate_system) and creates a point represented the transformed location in the to_coordinate_system(geodetic_coordinate_system).</span>
<a name="l00155"></a><a class="code" href="classvpgl__utm.html#a8f28e3deec52cb73745ab627b0365c44">00155</a> <span class="keywordtype">void</span> <a class="code" href="classvpgl__utm.html#a8f28e3deec52cb73745ab627b0365c44">vpgl_utm::transform</a>(<span class="keywordtype">int</span> utm_zone, <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> z,
<a name="l00156"></a>00156                          <span class="keywordtype">double</span>&amp; lat, <span class="keywordtype">double</span>&amp; lon , <span class="keywordtype">double</span>&amp; elev,
<a name="l00157"></a>00157                          <span class="keywordtype">bool</span> south_flag,
<a name="l00158"></a>00158                          <span class="keywordtype">double</span> utm_central_meridian)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160   <span class="comment">//double D2R = vnl_math::pi_over_180;</span>
<a name="l00161"></a>00161   <span class="keywordtype">double</span> e = vcl_sqrt((sqr(<a class="code" href="classvpgl__utm.html#a567eb743f4cb8e86b475466c77f7e968">a_</a>) - sqr(<a class="code" href="classvpgl__utm.html#a573d8dc0996d1abd0ffdda8fc6f224d6">b_</a>))/sqr(<a class="code" href="classvpgl__utm.html#a567eb743f4cb8e86b475466c77f7e968">a_</a>));
<a name="l00162"></a>00162 
<a name="l00163"></a>00163   <span class="keywordflow">if</span> (utm_zone != 0)
<a name="l00164"></a>00164     utm_central_meridian = (6 * utm_zone) - 183;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   <span class="keywordtype">double</span> lon_center2 = adjust_lon2(utm_central_meridian * <a class="code" href="vpgl__utm_8cxx.html#a0a3cc1d5cde549e408f825ddd7f5853d">D2R</a>);
<a name="l00167"></a>00167   <span class="keywordtype">double</span> lat_center2 = 0.0;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   <span class="keywordtype">double</span> lambda, phi;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   UTM_init2(lat_center2, <a class="code" href="classvpgl__utm.html#a567eb743f4cb8e86b475466c77f7e968">a_</a>, e, south_flag);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="keywordtype">double</span> con,temp_phi;    <span class="comment">// temporary angles</span>
<a name="l00174"></a>00174   <span class="keywordtype">double</span> delta_phi;    <span class="comment">// difference between longitudes</span>
<a name="l00175"></a>00175   <span class="keywordtype">long</span> i;    <span class="comment">// counter variable</span>
<a name="l00176"></a>00176   <span class="keywordtype">double</span> sin_phi, cos_phi, tan_phi;    <span class="comment">// sin cos and tangent values</span>
<a name="l00177"></a>00177   <span class="keywordtype">double</span> c, cs, t, ts, n, r, d, ds;    <span class="comment">// temporary variables</span>
<a name="l00178"></a>00178   <span class="keywordtype">double</span> f, h, g, temp;    <span class="comment">// temporary variables</span>
<a name="l00179"></a>00179   <span class="keywordtype">long</span> max_iter = 6;    <span class="comment">// maximum number of iterations, I changed from 6 to 20</span>
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keywordflow">if</span> (ind2 != 0)
<a name="l00182"></a>00182   {
<a name="l00183"></a>00183     f = vcl_exp(x/(<a class="code" href="classvpgl__utm.html#a567eb743f4cb8e86b475466c77f7e968">a_</a> * scale_factor2));
<a name="l00184"></a>00184     g = .5 * (f - 1/f);
<a name="l00185"></a>00185     temp = lat_center2 + y/(<a class="code" href="classvpgl__utm.html#a567eb743f4cb8e86b475466c77f7e968">a_</a> * scale_factor2);
<a name="l00186"></a>00186     h = vcl_cos(temp);
<a name="l00187"></a>00187     con = vcl_sqrt((1.0 - h * h)/(1.0 + g * g));
<a name="l00188"></a>00188     <span class="keywordflow">if</span> (<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(con) &gt; 1.0)
<a name="l00189"></a>00189     {
<a name="l00190"></a>00190       <span class="keywordflow">if</span> (con &gt; 1.0)
<a name="l00191"></a>00191         phi = vcl_asin(1.0);
<a name="l00192"></a>00192       <span class="keywordflow">else</span>
<a name="l00193"></a>00193         phi = vcl_asin(-1.0);
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195     <span class="keywordflow">else</span>
<a name="l00196"></a>00196       phi = vcl_asin(con);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="keywordflow">if</span> (temp &lt; 0)
<a name="l00199"></a>00199       phi = -phi;
<a name="l00200"></a>00200     <span class="keywordflow">if</span> ((g == 0) &amp;&amp; (h == 0))
<a name="l00201"></a>00201     {
<a name="l00202"></a>00202       lambda = lon_center2;
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204     <span class="keywordflow">else</span>
<a name="l00205"></a>00205     {
<a name="l00206"></a>00206       lambda = adjust_lon2(vcl_atan2(g,h) + lon_center2);
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208   }
<a name="l00209"></a>00209   <span class="keywordflow">else</span>
<a name="l00210"></a>00210   {
<a name="l00211"></a>00211     x -= false_easting2;
<a name="l00212"></a>00212     y -= false_northing2;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     con = (ml02 + y / scale_factor2) / <a class="code" href="classvpgl__utm.html#a567eb743f4cb8e86b475466c77f7e968">a_</a>;
<a name="l00215"></a>00215     temp_phi = con;
<a name="l00216"></a>00216     <span class="keywordflow">for</span> (i=0;;i++)
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218       delta_phi =
<a name="l00219"></a>00219         ((con + <a class="code" href="vpgl__utm_8cxx.html#adb3a8466fe0cf9e60c0c1b7503f4ac72">e12</a> * vcl_sin(2.0*temp_phi) - <a class="code" href="vpgl__utm_8cxx.html#aac508470c8435cda48b046aaf44e3f1e">e22</a> * vcl_sin(4.0*temp_phi) + <a class="code" href="vpgl__utm_8cxx.html#ac363d11cc44cfc5dbf8baf7ce41efd21">e32</a> *
<a name="l00220"></a>00220           vcl_sin(6.0*temp_phi)) / e02) - temp_phi;
<a name="l00221"></a>00221 <span class="preprocessor">#if 0</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>      delta_phi = ((con + <a class="code" href="vpgl__utm_8cxx.html#adb3a8466fe0cf9e60c0c1b7503f4ac72">e12</a> * vcl_sin(2.0*phi) - <a class="code" href="vpgl__utm_8cxx.html#aac508470c8435cda48b046aaf44e3f1e">e22</a> * vcl_sin(4.0*phi)) / e02) - phi;
<a name="l00223"></a>00223 <span class="preprocessor">#endif</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>      temp_phi += delta_phi;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226       <span class="keywordflow">if</span> (<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(delta_phi)&lt;1E-6) <span class="keywordflow">break</span>;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228       <span class="keywordflow">if</span> (i &gt;= max_iter)
<a name="l00229"></a>00229         vcl_cout &lt;&lt; <span class="stringliteral">&quot;Transform failed to converge&quot;</span> &lt;&lt; vcl_endl;
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="keywordflow">if</span> (<a class="codeRef" doxygen="core_vnl.tag:../../../core/vnl/html/" href="../../../core/vnl/html/vnl__bignum_8h.html#a0ab6b7af70b3a04088700a2da0194249">vnl_math_abs</a>(temp_phi) &lt; vnl_math::pi_over_2)
<a name="l00233"></a>00233     {
<a name="l00234"></a>00234       sin_phi = vcl_sin(temp_phi);
<a name="l00235"></a>00235       cos_phi = vcl_cos(temp_phi);
<a name="l00236"></a>00236       tan_phi = vcl_tan(temp_phi);
<a name="l00237"></a>00237       c = <a class="code" href="vpgl__utm_8cxx.html#a9a5d02491aa648d562ebab62199e2d6e">esp2</a> * sqr(cos_phi);
<a name="l00238"></a>00238       cs = sqr(c);
<a name="l00239"></a>00239       t = sqr(tan_phi);
<a name="l00240"></a>00240       ts = sqr(t);
<a name="l00241"></a>00241       con = 1.0 - es2 * sqr(sin_phi);
<a name="l00242"></a>00242       n = <a class="code" href="classvpgl__utm.html#a567eb743f4cb8e86b475466c77f7e968">a_</a> / vcl_sqrt(con);
<a name="l00243"></a>00243       r = n * (1.0 - es2) / con;
<a name="l00244"></a>00244       d = x / (n * scale_factor2);
<a name="l00245"></a>00245       ds = sqr(d);
<a name="l00246"></a>00246       phi =
<a name="l00247"></a>00247         temp_phi - (n * tan_phi * ds / r) *
<a name="l00248"></a>00248         (0.5 - ds / 24.0 * (5.0 + 3.0 * t + 10.0 * c - 4.0 * cs - 9.0 *
<a name="l00249"></a>00249                             <a class="code" href="vpgl__utm_8cxx.html#a9a5d02491aa648d562ebab62199e2d6e">esp2</a> - ds / 30.0 * (61.0 + 90.0 * t + 298.0 *
<a name="l00250"></a>00250                                                 c + 45.0 * ts - 252.0 *
<a name="l00251"></a>00251                                                 <a class="code" href="vpgl__utm_8cxx.html#a9a5d02491aa648d562ebab62199e2d6e">esp2</a> - 3.0 * cs)));
<a name="l00252"></a>00252       lambda =
<a name="l00253"></a>00253         adjust_lon2(lon_center2 +
<a name="l00254"></a>00254                     (d * (1.0 - ds / 6.0 * (1.0 + 2.0 * t + c - ds / 20.0
<a name="l00255"></a>00255                                             * (5.0 - 2.0 * c + 28.0 * t -
<a name="l00256"></a>00256                                                3.0 * cs + 8.0 * <a class="code" href="vpgl__utm_8cxx.html#a9a5d02491aa648d562ebab62199e2d6e">esp2</a> +
<a name="l00257"></a>00257                                                24.0 * ts))) / cos_phi));
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259     <span class="keywordflow">else</span>
<a name="l00260"></a>00260     {
<a name="l00261"></a>00261       phi = vnl_math::pi_over_2 * sign(y);
<a name="l00262"></a>00262       lambda = lon_center2;
<a name="l00263"></a>00263     }
<a name="l00264"></a>00264   }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   lat = phi/<a class="code" href="vpgl__utm_8cxx.html#a0a3cc1d5cde549e408f825ddd7f5853d">D2R</a>; lon = lambda/<a class="code" href="vpgl__utm_8cxx.html#a0a3cc1d5cde549e408f825ddd7f5853d">D2R</a>, elev = z;
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="classvpgl__utm.html#ae3a1b3f2c75209fa784994867d5618a5">00269</a> <span class="keywordtype">void</span> <a class="code" href="classvpgl__utm.html#a8f28e3deec52cb73745ab627b0365c44">vpgl_utm::transform</a>(<span class="keywordtype">int</span> utm_zone, <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y,
<a name="l00270"></a>00270                          <span class="keywordtype">double</span>&amp; lat, <span class="keywordtype">double</span>&amp; lon,
<a name="l00271"></a>00271                          <span class="keywordtype">bool</span> south_flag,
<a name="l00272"></a>00272                          <span class="keywordtype">double</span> utm_central_meridian)
<a name="l00273"></a>00273 {
<a name="l00274"></a>00274   <span class="keywordtype">double</span> elev;
<a name="l00275"></a>00275   this-&gt;<a class="code" href="classvpgl__utm.html#a8f28e3deec52cb73745ab627b0365c44">transform</a>(utm_zone, x, y, 0.0,
<a name="l00276"></a>00276                   lat, lon, elev,
<a name="l00277"></a>00277                   south_flag, utm_central_meridian);
<a name="l00278"></a>00278   <span class="keywordflow">if</span> (elev) { <span class="comment">/* TODO */</span> }
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00281"></a><a class="code" href="classvpgl__utm.html#ad01defbb0f55e6a326b96ae6f6efcb4b">00281</a> <span class="keywordtype">void</span> <a class="code" href="classvpgl__utm.html#a8f28e3deec52cb73745ab627b0365c44">vpgl_utm::transform</a>(<span class="keywordtype">double</span> lat, <span class="keywordtype">double</span> lon,
<a name="l00282"></a>00282                          <span class="keywordtype">double</span>&amp; x, <span class="keywordtype">double</span>&amp; y, <span class="keywordtype">int</span>&amp; utm_zone)
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284   <span class="comment">// double D2R = vnl_math::pi_over_180;</span>
<a name="l00285"></a>00285   utm_zone = int((lon+180)/6.0) + 1;
<a name="l00286"></a>00286   <span class="keywordtype">double</span> e = vcl_sqrt(1.0 - <a class="code" href="classvpgl__utm.html#a573d8dc0996d1abd0ffdda8fc6f224d6">b_</a>*<a class="code" href="classvpgl__utm.html#a573d8dc0996d1abd0ffdda8fc6f224d6">b_</a>/(<a class="code" href="classvpgl__utm.html#a567eb743f4cb8e86b475466c77f7e968">a_</a>*<a class="code" href="classvpgl__utm.html#a567eb743f4cb8e86b475466c77f7e968">a_</a>));
<a name="l00287"></a>00287   <span class="comment">// This value must eventually set by user. lon_zone stands for</span>
<a name="l00288"></a>00288   <span class="comment">// longitudinal zone, and it must be between 1 and 60.</span>
<a name="l00289"></a>00289   <span class="keywordtype">int</span> south_flag;
<a name="l00290"></a>00290   <span class="keywordtype">double</span> utm_central_meridian = 0;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   utm_central_meridian = (6 * utm_zone) - 183;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294   south_flag = lat&lt;0;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   <span class="keywordtype">double</span> lon_center = adjust_lon2(utm_central_meridian * <a class="code" href="vpgl__utm_8cxx.html#a0a3cc1d5cde549e408f825ddd7f5853d">D2R</a>);
<a name="l00297"></a>00297   <span class="keywordtype">double</span> lat_center = 0.0;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299   <span class="keywordtype">double</span> phi = adjust_lat2(lat*D2R);
<a name="l00300"></a>00300   <span class="keywordtype">double</span> lambda = adjust_lon2(lon*D2R);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302   UTM_init2(lat_center, a_, e, south_flag);
<a name="l00303"></a>00303 
<a name="l00304"></a>00304   <span class="comment">//  double bl = -1000000.0;</span>
<a name="l00305"></a>00305 
<a name="l00306"></a>00306   <span class="keywordtype">double</span> delta_lon = adjust_lon2(lambda - lon_center);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   <span class="keywordtype">double</span> sin_phi = vcl_sin(phi);
<a name="l00309"></a>00309   <span class="keywordtype">double</span> cos_phi = vcl_cos(phi);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311   <span class="keywordtype">double</span> al = cos_phi * delta_lon;
<a name="l00312"></a>00312   <span class="keywordtype">double</span> als = sqr(al);
<a name="l00313"></a>00313   <span class="keywordtype">double</span> c = <a class="code" href="vpgl__utm_8cxx.html#a9a5d02491aa648d562ebab62199e2d6e">esp2</a> * sqr(cos_phi);
<a name="l00314"></a>00314   <span class="keywordtype">double</span> tq = vcl_tan(phi);
<a name="l00315"></a>00315   <span class="keywordtype">double</span> t = sqr(tq);
<a name="l00316"></a>00316   <span class="keywordtype">double</span> con = 1.0 - es2 * sqr(sin_phi);
<a name="l00317"></a>00317   <span class="keywordtype">double</span> n = a_ / vcl_sqrt(con);
<a name="l00318"></a>00318   <span class="keywordtype">double</span> ml = a_ * mlfn2(e02, <a class="code" href="vpgl__utm_8cxx.html#adb3a8466fe0cf9e60c0c1b7503f4ac72">e12</a>, <a class="code" href="vpgl__utm_8cxx.html#aac508470c8435cda48b046aaf44e3f1e">e22</a>, <a class="code" href="vpgl__utm_8cxx.html#ac363d11cc44cfc5dbf8baf7ce41efd21">e32</a>, phi);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320   x = scale_factor2 * n * al * (1.0 + (als / 6.0) *
<a name="l00321"></a>00321                                 (1.0 - t + c + (als / 20.0) *
<a name="l00322"></a>00322                                  (5.0 - (18.0 * t) + sqr(t) + (72.0 * c)
<a name="l00323"></a>00323                                   - (58.0 * <a class="code" href="vpgl__utm_8cxx.html#a9a5d02491aa648d562ebab62199e2d6e">esp2</a>))))
<a name="l00324"></a>00324       + false_easting2;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   y = scale_factor2 * (ml - ml02 + n * tq * (als * (0.5 + (als / 24.0) *
<a name="l00327"></a>00327                                              (5.0 - t + (9.0 * c)
<a name="l00328"></a>00328                                               + (4.0 * sqr(c))
<a name="l00329"></a>00329                                               + (als / 30.0) *
<a name="l00330"></a>00330                                               (61.0 - (58.0 * t) +
<a name="l00331"></a>00331                                                sqr(t) +
<a name="l00332"></a>00332                                                (600.0 * c) -
<a name="l00333"></a>00333                                                330.0 * <a class="code" href="vpgl__utm_8cxx.html#a9a5d02491aa648d562ebab62199e2d6e">esp2</a>)))))
<a name="l00334"></a>00334       + false_northing2;
<a name="l00335"></a>00335 }
</pre></div></div>
</div>


<hr class="footer"/><address class="footer"><small>
Generated on Wed May 1 2013 17:32:17 for core/vpgl by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
